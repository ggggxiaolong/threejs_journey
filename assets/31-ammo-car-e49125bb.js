import{S as fe,c as J,j as c,d as ge,D as ue,a as H,B as X,t as pe,Q as Ae,C as ye}from"./three.module-2fef69e5.js";import{Size as be}from"./model-76944e9e.js";import{U as L}from"./utils-315ca8db.js";import"./OrbitControls-916b91d8.js";const re=4,v=be.getInstance(),y=new fe,S=L.initCamera(v),E=L.initRenderer(v),ke=L.initControl(S,E),xe=new pe,D=new Ae(0,0,0,1),Be=new J({color:16557056}),Se=new J({color:10066329}),Z=new J({color:10027008});let w,V;const Y=new Array,W=document.createElement("div");let ce="",A={acceleration:!1,braking:!1,left:!1,right:!1,updateState:function(e,t){switch(e){case"KeyW":return this.acceleration=t,!0;case"KeyS":return this.braking=t,!0;case"KeyA":return this.left=t,!0;case"KeyD":return this.right=t,!0;default:return!1}}};Ce();window.Ammo().then(Ie);function Ce(){S.position.set(-4.84,4.39,-35.11),S.lookAt(new c(.33,-.4,.85)),E.setClearColor(12571109),v.onResize(function(){L.onResize(v,S,E)});const e=document.createElement("div");e.id="info",e.textContent=`Ammo.js Raycast vehicle demo 
Press W,A,S,D to move.`,document.body.appendChild(e),W.id="speedometer",W.textContent="0.0 km/h",document.body.appendChild(W);const t=new ge(4210752);y.add(t);const n=new ue(16777215,1);n.position.set(10,10,5),y.add(n),window.addEventListener("keydown",Re),window.addEventListener("keyup",Fe)}function Fe(e){if(A.updateState(e.code,!1))return e.preventDefault(),e.stopPropagation(),!1}function Re(e){if(A.updateState(e.code,!0))return e.preventDefault(),e.stopPropagation(),!1}function Ie(){V=new Ammo.btTransform;const e=new Ammo.btDefaultCollisionConfiguration,t=new Ammo.btCollisionDispatcher(e),n=new Ammo.btDbvtBroadphase,s=new Ammo.btSequentialImpulseConstraintSolver;w=new Ammo.btDiscreteDynamicsWorld(t,n,s,e),w.setGravity(new Ammo.btVector3(0,-9.82,0)),ae(),q(new c(0,-.5,0),new c(75,1,75),D,0,2);const b=D.clone();b.setFromAxisAngle(new c(1,0,0),-Math.PI/10),q(new c(0,-1.5,0),new c(8,4,10),b,0);const r=.75,a=8,d=6;for(let f=0;f<a;f++)for(var l=0;l<d;l++)q(new c(r*f-r*(a-1)/2,r*l-.5,10),new c(r,r,r),D,10);Ve(new c(0,4,-20),D)}function q(e,t,n,s=0,b=1){const r=s>0?Be:Se,a=new H(new X(t.x,t.y,t.z,1,1,1),r);a.position.copy(e),a.quaternion.copy(n),y.add(a);const d=new Ammo.btBoxShape(new Ammo.btVector3(t.x/2,t.y/2,t.z/2));d.setMargin(.05);const l=new Ammo.btTransform;l.setIdentity(),l.setOrigin(new Ammo.btVector3(e.x,e.y,e.z)),l.setRotation(new Ammo.btQuaternion(n.x,n.y,n.z,n.w));const f=new Ammo.btDefaultMotionState(l),_=new Ammo.btVector3(0,0,0);d.calculateLocalInertia(s,_);const $=new Ammo.btRigidBodyConstructionInfo(s,f,d,_),k=new Ammo.btRigidBody($);if(k.setFriction(b),w.addRigidBody(k),s>0){let ee=function(){const M=k.getMotionState();if(M){M.getWorldTransform(V);const C=V.getOrigin(),x=V.getRotation();a.position.set(C.x(),C.y(),C.z()),a.quaternion.set(x.x(),x.y(),x.z(),x.w())}};k.setActivationState(re),Y.push(ee)}}function Te(e,t){const n=new ye(e,e,t,24,1);n.rotateZ(Math.PI/2);const s=new H(n,Z);return s.add(new H(new X(t*1.5,e*1.75,e*.25,1,1,1),Z)),y.add(s),s}function De(e){const t=new X(e.x,e.y,e.z,1,1,1),n=new H(t,Z);return y.add(n),n}function Ve(e,t){const te=new Ammo.btBoxShape(new Ammo.btVector3(.9,.3,2)),F=new Ammo.btTransform;F.setIdentity(),F.setOrigin(new Ammo.btVector3(e.x,e.y,e.z)),F.setRotation(new Ammo.btQuaternion(t.x,t.y,t.z,t.w));const le=new Ammo.btDefaultMotionState(F),ne=new Ammo.btVector3(0,0,0);te.calculateLocalInertia(800,ne);const P=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(800,le,te,ne));P.setActivationState(re),w.addRigidBody(P);const oe=De(new c(1.8,.6,4));let i=0;const se=new Ammo.btVehicleTuning,me=new Ammo.btDefaultVehicleRaycaster(w),o=new Ammo.btRaycastVehicle(se,P,me);o.setCoordinateSystem(0,1,2),w.addAction(o);const z=0,O=1,K=2,N=3,G=[],he=new Ammo.btVector3(0,-1,0),we=new Ammo.btVector3(-1,0,0);function R(g,B,m,u,Q){const h=o.addWheel(B,he,we,.6,m,se,g);h.set_m_suspensionStiffness(20),h.set_m_wheelsDampingRelaxation(2.3),h.set_m_wheelsDampingCompression(4.4),h.set_m_frictionSlip(1e3),h.set_m_rollInfluence(.2),G[Q]=Te(m,u)}R(!0,new Ammo.btVector3(1,.3,1.7),.35,.2,z),R(!0,new Ammo.btVector3(-1,.3,1.7),.35,.2,O),R(!1,new Ammo.btVector3(-1,.3,-1),.4,.3,K),R(!1,new Ammo.btVector3(1,.3,-1),.4,.3,N);function de(){const g=o.getCurrentSpeedKmHour(),B=(g<0?"(R) ":"")+Math.abs(g).toFixed(1)+"km/h";B!=ce&&(ce=B,W.innerHTML=B);let m=0,u=0;A.acceleration&&(g<-1?m=100:u=2e3),A.braking&&(g>1?m=100:u=-2e3/2),A.left?i<.5&&(i+=.04):A.right?i>-.5&&(i-=.04):i<-.04?i+=.04:i>.04?i-=.04:i=0,o.applyEngineForce(u,K),o.applyEngineForce(u,N),o.setBrake(m/2,z),o.setBrake(m/2,O),o.setBrake(m,K),o.setBrake(m,N),o.setSteeringValue(i,z),o.setSteeringValue(i,O);const Q=o.getNumWheels();for(let p=0;p<Q;p++){o.updateWheelTransform(p,!0);const ie=o.getWheelTransformWS(p),j=ie.getOrigin(),T=ie.getRotation();G[p].position.set(j.x(),j.y(),j.z()),G[p].quaternion.set(T.x(),T.y(),T.z(),T.w())}const h=o.getChassisWorldTransform(),U=h.getOrigin(),I=h.getRotation();oe.position.set(U.x(),U.y(),U.z()),oe.quaternion.set(I.x(),I.y(),I.z(),I.w())}Y.push(de)}function ae(){E.render(y,S);const e=xe.getDelta();ke.update(),w.stepSimulation(e,10),Y.forEach(t=>t()),requestAnimationFrame(ae)}
