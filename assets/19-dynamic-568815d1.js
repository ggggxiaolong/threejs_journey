import{V as b,ag as r,c as V,S as B,$ as T,a4 as R,j as _,aI as z,e as C,aJ as Y,M as I,a as W,w as O}from"./three.module-67558082.js";import{Size as q}from"./model-76944e9e.js";import{U as p}from"./utils-612895f9.js";import"./OrbitControls-3d27026f.js";const P=new b,k=new V,g=new b;class Z{constructor(n,s){this.object=n,this.domElement=s,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;let t=0,i=0;this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onPointerDown=function(e){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0;break}this.mouseDragOn=!0},this.onPointerUp=function(e){if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1;break}this.mouseDragOn=!1},this.onPointerMove=function(e){this.domElement===document?(this.pointerX=e.pageX-this.viewHalfX,this.pointerY=e.pageY-this.viewHalfY):(this.pointerX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0;break}},this.onKeyUp=function(e){switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1;break}},this.lookAt=function(e,d,h){return e.isVector3?g.copy(e):g.set(e,d,h),this.object.lookAt(g),F(this),this},this.update=function(){const e=new b;return function(h){if(this.enabled===!1)return;if(this.heightSpeed){const x=r.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=h*(x*this.heightCoef)}else this.autoSpeedFactor=0;const a=h*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(a+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(a),this.moveLeft&&this.object.translateX(-a),this.moveRight&&this.object.translateX(a),this.moveUp&&this.object.translateY(a),this.moveDown&&this.object.translateY(-a);let u=h*this.lookSpeed;this.activeLook||(u=0);let K=1;this.constrainVertical&&(K=Math.PI/(this.verticalMax-this.verticalMin)),i-=this.pointerX*u,this.lookVertical&&(t-=this.pointerY*u*K),t=Math.max(-85,Math.min(85,t));let v=r.degToRad(90-t);const X=r.degToRad(i);this.constrainVertical&&(v=r.mapLinear(v,0,Math.PI,this.verticalMin,this.verticalMax));const H=this.object.position;e.setFromSphericalCoords(1,v,X).add(H),this.object.lookAt(e)}}(),this.dispose=function(){this.domElement.removeEventListener("contextmenu",U),this.domElement.removeEventListener("pointerdown",M),this.domElement.removeEventListener("pointermove",y),this.domElement.removeEventListener("pointerup",L),window.removeEventListener("keydown",D),window.removeEventListener("keyup",S)};const y=this.onPointerMove.bind(this),M=this.onPointerDown.bind(this),L=this.onPointerUp.bind(this),D=this.onKeyDown.bind(this),S=this.onKeyUp.bind(this);this.domElement.addEventListener("contextmenu",U),this.domElement.addEventListener("pointerdown",M),this.domElement.addEventListener("pointermove",y),this.domElement.addEventListener("pointerup",L),window.addEventListener("keydown",D),window.addEventListener("keyup",S);function F(e){const d=e.object.quaternion;P.set(0,0,-1).applyQuaternion(d),k.setFromVector3(P),t=90-r.radToDeg(k.phi),i=r.radToDeg(k.theta)}this.handleResize(),F(this)}}function U(o){o.preventDefault()}const f=q.getInstance(),c=new B,w=p.initCamera(f,60,2e4),E=p.initRenderer(f),m=new Z(w,E.domElement),A=new O,G=new T;let l;J();j();function J(){w.position.set(0,100,300),p.addAxesHelper(c,1),f.onResize(function(){p.onResize(f,w,E)}),m.handleResize();const o=G.load("/textures/water.jpg");o.wrapS=R,o.wrapT=R,o.repeat.set(5,5),c.background=new _(11193599),c.fog=new z(11193599,7e-4),m.movementSpeed=500,m.lookSpeed=.05,l=new C(2e4,2e4,127,127),l.rotateX(-Math.PI/2);const n=l.attributes.position;n.usage=Y;for(let i=0;i<n.count;i++)n.setY(i,Math.sin(i/2)*35);const s=new I({map:o,color:17663}),t=new W(l,s);c.add(t)}function j(){const o=A.getDelta(),n=A.getElapsedTime()*10;E.render(c,w),m.update(o);const s=l.attributes.position;s.usage=Y;for(let t=0;t<s.count;t++){const i=35*Math.sin(t/5+(n+t)/7);s.setY(t,i)}s.needsUpdate=!0,requestAnimationFrame(j)}
