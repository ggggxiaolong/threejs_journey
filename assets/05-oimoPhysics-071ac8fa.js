import{j as Ue,S as He,g as Je,P as Ke,W as $e,s as ts,k as is,h as De,B as Ee,l as es,i as ss,a as as,m as ns,H as _s,D as os}from"./three.module-2fef69e5.js";import{Size as ls}from"./model-76944e9e.js";import{O as rs}from"./OrbitControls-916b91d8.js";var m=m||{};m.collision||(m.collision={});m.collision.broadphase||(m.collision.broadphase={});m.collision.broadphase.BroadPhase=class{constructor(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new m.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new m.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new m.common.Transform,this.zero=new m.common.Vec3,this.rayCastHit=new m.collision.geometry.RayCastHit}createProxy(t,i){return null}destroyProxy(t){}moveProxy(t,i,s){}isOverlapping(t,i){return t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ?t._aabbMaxZ>i._aabbMinZ:!1}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(t,i,s){}convexCast(t,i,s,_){}aabbTest(t,i){}};m.collision.geometry||(m.collision.geometry={});m.collision.geometry.Geometry=class{constructor(t){this._type=t,this._volume=0}_updateMass(){}_computeAabb(t,i){}_rayCastLocal(t,i,s,_,n,l,o){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(t,i,s,_){let n,l,o,r,e,a;n=t.x,l=t.y,o=t.z,r=i.x,e=i.y,a=i.z,n-=s._positionX,l-=s._positionY,o-=s._positionZ,r-=s._positionX,e-=s._positionY,a-=s._positionZ;let h,b,X;h=s._rotation00*n+s._rotation10*l+s._rotation20*o,b=s._rotation01*n+s._rotation11*l+s._rotation21*o,X=s._rotation02*n+s._rotation12*l+s._rotation22*o,n=h,l=b,o=X;let c,u,p;if(c=s._rotation00*r+s._rotation10*e+s._rotation20*a,u=s._rotation01*r+s._rotation11*e+s._rotation21*a,p=s._rotation02*r+s._rotation12*e+s._rotation22*a,r=c,e=u,a=p,this._rayCastLocal(n,l,o,r,e,a,_)){let x,v,f,g,V,Z,I=_.position;x=I.x,v=I.y,f=I.z;let M=_.normal;g=M.x,V=M.y,Z=M.z;let y,d,B;y=s._rotation00*x+s._rotation01*v+s._rotation02*f,d=s._rotation10*x+s._rotation11*v+s._rotation12*f,B=s._rotation20*x+s._rotation21*v+s._rotation22*f,x=y,v=d,f=B;let R,k,A;R=s._rotation00*g+s._rotation01*V+s._rotation02*Z,k=s._rotation10*g+s._rotation11*V+s._rotation12*Z,A=s._rotation20*g+s._rotation21*V+s._rotation22*Z,g=R,V=k,Z=A,x+=s._positionX,v+=s._positionY,f+=s._positionZ;let z=_.position;z.x=x,z.y=v,z.z=f;let w=_.normal;return w.x=g,w.y=V,w.z=Z,!0}return!1}};m.collision.geometry.ConvexGeometry=class extends m.collision.geometry.Geometry{constructor(t){super(t),this._gjkMargin=m.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(t){t<0&&(t=0),this._gjkMargin=t}computeLocalSupportingVertex(t,i){}rayCast(t,i,s,_){return this._useGjkRayCast?m.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,s,t,i,_):super.rayCast(t,i,s,_)}};m.collision.broadphase._BroadPhase||(m.collision.broadphase._BroadPhase={});m.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(t,i,s){this.c=t;let _,n,l;_=s.x,n=s.y,l=s.z;let o,r,e,a,h,b;a=i._rotation00*_+i._rotation10*n+i._rotation20*l,h=i._rotation01*_+i._rotation11*n+i._rotation21*l,b=i._rotation02*_+i._rotation12*n+i._rotation22*l,o=a,r=h,e=b,this.localTranslation=new m.common.Vec3;let X=this.localTranslation;X.x=o,X.y=r,X.z=e,this._gjkMargin=t._gjkMargin}computeLocalSupportingVertex(t,i){this.c.computeLocalSupportingVertex(t,i);let s=this.localTranslation;if(t.x*s.x+t.y*s.y+t.z*s.z>0){let _=this.localTranslation;i.x+=_.x,i.y+=_.y,i.z+=_.z}}};m.collision.broadphase._BroadPhase.AabbGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new m.common.Vec3,this.max=new m.common.Vec3}computeLocalSupportingVertex(t,i){i.x=t.x>0?this.max.x:this.min.x,i.y=t.y>0?this.max.y:this.min.y,i.z=t.z>0?this.max.z:this.min.z}};m.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(t){}};m.collision.broadphase.BroadPhaseType=class{};m.collision.broadphase.Proxy=class{constructor(t,i){this.userData=t,this._id=i,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){let t=new m.collision.geometry.Aabb;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t}getFatAabbTo(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}};m.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}};m.collision.broadphase.bruteforce||(m.collision.broadphase.bruteforce={});m.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends m.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(t,i){let s=new m.collision.broadphase.Proxy(t,this._idCount++);return this._numProxies++,this._proxyList==null?(this._proxyList=s,this._proxyListLast=s):(this._proxyListLast._next=s,s._prev=this._proxyListLast,this._proxyListLast=s),s._aabbMinX=i._minX,s._aabbMinY=i._minY,s._aabbMinZ=i._minZ,s._aabbMaxX=i._maxX,s._aabbMaxY=i._maxY,s._aabbMaxZ=i._maxZ,s}destroyProxy(t){this._numProxies--;let i=t._prev,s=t._next;i!=null&&(i._next=s),s!=null&&(s._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null}moveProxy(t,i,s){t._aabbMinX=i._minX,t._aabbMinY=i._minY,t._aabbMinZ=i._minZ,t._aabbMaxX=i._maxX,t._aabbMaxY=i._maxY,t._aabbMaxZ=i._maxZ}collectPairs(){let t=this._proxyPairList;if(t!=null){for(;t._p1=null,t._p2=null,t=t._next,t!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;let i=this._proxyList;for(;i!=null;){let s=i._next,_=i._next;for(;_!=null;){let n=_._next;if(this._testCount++,i._aabbMinX<_._aabbMaxX&&i._aabbMaxX>_._aabbMinX&&i._aabbMinY<_._aabbMaxY&&i._aabbMaxY>_._aabbMinY&&i._aabbMinZ<_._aabbMaxZ&&i._aabbMaxZ>_._aabbMinZ){let l=this._proxyPairPool;l!=null?(this._proxyPairPool=l._next,l._next=null):l=new m.collision.broadphase.ProxyPair;let o=l;this._proxyPairList==null?this._proxyPairList=o:(o._next=this._proxyPairList,this._proxyPairList=o),o._p1=i,o._p2=_}_=n}i=s}}rayCast(t,i,s){let _,n,l,o,r,e;_=t.x,n=t.y,l=t.z,o=i.x,r=i.y,e=i.z;let a=this._proxyList;for(;a!=null;){let h=a._next,b=_,X=n,c=l,u=o,p=r,x=e,v=a._aabbMinX,f=a._aabbMinY,g=a._aabbMinZ,V=a._aabbMaxX,Z=a._aabbMaxY,I=a._aabbMaxZ,M;if(v>(b>u?b:u)||V<(b<u?b:u)||f>(X>p?X:p)||Z<(X<p?X:p)||g>(c>x?c:x)||I<(c<x?c:x))M=!1;else{let y=u-b,d=p-X,B=x-c,R=y<0?-y:y,k=d<0?-d:d,A=B<0?-B:B,z=(V-v)*.5,w=(Z-f)*.5,S=(I-g)*.5,P=b-(V+v)*.5,T=X-(Z+f)*.5,C=c-(I+g)*.5,L,q,U=T*B-C*d;if((U<0?-U:U)-(w*A+S*k)>0)q=!0;else{let Y=C*y-P*B;q=(Y<0?-Y:Y)-(S*R+z*A)>0}if(q)L=!0;else{let Y=P*d-T*y;L=(Y<0?-Y:Y)-(z*k+w*R)>0}M=!L}M&&s.process(a),a=h}}convexCast(t,i,s,_){let n=this._proxyList;for(;n!=null;){let l=n._next,o=this._aabb.min;o.x=n._aabbMinX,o.y=n._aabbMinY,o.z=n._aabbMinZ;let r=this._aabb.max;r.x=n._aabbMaxX,r.y=n._aabbMaxY,r.z=n._aabbMaxZ,this._convexSweep.init(t,i,s);let e=m.collision.narrowphase.detector.gjkepa.GjkEpa.instance;e.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)==0&&e.distance<=0&&_.process(n),n=l}}aabbTest(t,i){let s=this._proxyList;for(;s!=null;){let _=s._next;t._minX<s._aabbMaxX&&t._maxX>s._aabbMinX&&t._minY<s._aabbMaxY&&t._maxY>s._aabbMinY&&t._minZ<s._aabbMaxZ&&t._maxZ>s._aabbMinZ&&i.process(s),s=_}}};m.collision.broadphase.bvh||(m.collision.broadphase.bvh={});m.collision.broadphase.bvh.BvhBroadPhase=class extends m.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new m.collision.broadphase.bvh.BvhTree,this.movedProxies=new Array(1024),this.numMovedProxies=0}collide(t,i){this._testCount++;let s=t._height==0,_=i._height==0;if(t==i){if(s)return;this.collide(t._children[0],i),this.collide(t._children[1],i);return}if(t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){if(s&&_){let n=this._proxyPairPool;n!=null?(this._proxyPairPool=n._next,n._next=null):n=new m.collision.broadphase.ProxyPair;let l=n;this._proxyPairList==null?this._proxyPairList=l:(l._next=this._proxyPairList,this._proxyPairList=l),l._p1=t._proxy,l._p2=i._proxy;return}_||t._height>i._height?(this.collide(t._children[0],i),this.collide(t._children[1],i)):(this.collide(i._children[0],t),this.collide(i._children[1],t))}}rayCastRecursive(t,i,s,_,n,l,o,r){let e=i,a=s,h=_,b=n,X=l,c=o,u=t._aabbMinX,p=t._aabbMinY,x=t._aabbMinZ,v=t._aabbMaxX,f=t._aabbMaxY,g=t._aabbMaxZ,V;if(u>(e>b?e:b)||v<(e<b?e:b)||p>(a>X?a:X)||f<(a<X?a:X)||x>(h>c?h:c)||g<(h<c?h:c))V=!1;else{let Z=b-e,I=X-a,M=c-h,y=Z<0?-Z:Z,d=I<0?-I:I,B=M<0?-M:M,R=(v-u)*.5,k=(f-p)*.5,A=(g-x)*.5,z=e-(v+u)*.5,w=a-(f+p)*.5,S=h-(g+x)*.5,P,T,C=w*M-S*I;if((C<0?-C:C)-(k*B+A*d)>0)T=!0;else{let L=S*Z-z*M;T=(L<0?-L:L)-(A*y+R*B)>0}if(T)P=!0;else{let L=z*I-w*Z;P=(L<0?-L:L)-(R*d+k*y)>0}V=!P}if(V){if(t._height==0){r.process(t._proxy);return}this.rayCastRecursive(t._children[0],i,s,_,n,l,o,r),this.rayCastRecursive(t._children[1],i,s,_,n,l,o,r)}}convexCastRecursive(t,i,s,_,n){let l=this._aabb.min;l.x=t._aabbMinX,l.y=t._aabbMinY,l.z=t._aabbMinZ;let o=this._aabb.max;o.x=t._aabbMaxX,o.y=t._aabbMaxY,o.z=t._aabbMaxZ,this._convexSweep.init(i,s,_);let r=m.collision.narrowphase.detector.gjkepa.GjkEpa.instance;if(r.computeClosestPointsImpl(this._convexSweep,this._aabb,s,this.identity,null,!1)==0&&r.distance<=0){if(t._height==0){n.process(t._proxy);return}this.convexCastRecursive(t._children[0],i,s,_,n),this.convexCastRecursive(t._children[1],i,s,_,n)}}aabbTestRecursive(t,i,s){if(t._aabbMinX<i._maxX&&t._aabbMaxX>i._minX&&t._aabbMinY<i._maxY&&t._aabbMaxY>i._minY&&t._aabbMinZ<i._maxZ&&t._aabbMaxZ>i._minZ){if(t._height==0){s.process(t._proxy);return}this.aabbTestRecursive(t._children[0],i,s),this.aabbTestRecursive(t._children[1],i,s)}}createProxy(t,i){let s=new m.collision.broadphase.bvh.BvhProxy(t,this._idCount++);this._numProxies++,this._proxyList==null?(this._proxyList=s,this._proxyListLast=s):(this._proxyListLast._next=s,s._prev=this._proxyListLast,this._proxyListLast=s),s._aabbMinX=i._minX,s._aabbMinY=i._minY,s._aabbMinZ=i._minZ,s._aabbMaxX=i._maxX,s._aabbMaxY=i._maxY,s._aabbMaxZ=i._maxZ;let _=m.common.Setting.bvhProxyPadding;s._aabbMinX-=_,s._aabbMinY-=_,s._aabbMinZ-=_,s._aabbMaxX+=_,s._aabbMaxY+=_,s._aabbMaxZ+=_;let n=this._tree,l=n._nodePool;l!=null?(n._nodePool=l._next,l._next=null):l=new m.collision.broadphase.bvh.BvhNode;let o=l;if(o._proxy=s,s._leaf=o,o._aabbMinX=s._aabbMinX,o._aabbMinY=s._aabbMinY,o._aabbMinZ=s._aabbMinZ,o._aabbMaxX=s._aabbMaxX,o._aabbMaxY=s._aabbMaxY,o._aabbMaxZ=s._aabbMaxZ,n._numLeaves++,n.leafList==null?(n.leafList=o,n.leafListLast=o):(n.leafListLast._nextLeaf=o,o._prevLeaf=n.leafListLast,n.leafListLast=o),n._root==null)n._root=o;else{let r=n._root;for(;r._height>0;){let c=n._strategy._decideInsertion(r,o);if(c==-1)break;r=r._children[c]}let e=r._parent,a=n._nodePool;a!=null?(n._nodePool=a._next,a._next=null):a=new m.collision.broadphase.bvh.BvhNode;let h=a;if(e==null)n._root=h;else{let c=r._childIndex;e._children[c]=h,h._parent=e,h._childIndex=c}let b=r._childIndex;h._children[b]=r,r._parent=h,r._childIndex=b;let X=r._childIndex^1;for(h._children[X]=o,o._parent=h,o._childIndex=X;h!=null;){if(n._strategy._balancingEnabled&&h._height>=2){let v=h._parent,f=h._children[0],g=h._children[1],V=f._height-g._height,Z=h._childIndex;if(V>1){let I=f._children[0],M=f._children[1];if(I._height>M._height){f._children[1]=h,h._parent=f,h._childIndex=1,h._children[0]=M,M._parent=h,M._childIndex=0;let y=f._children[0],d=f._children[1];f._aabbMinX=y._aabbMinX<d._aabbMinX?y._aabbMinX:d._aabbMinX,f._aabbMinY=y._aabbMinY<d._aabbMinY?y._aabbMinY:d._aabbMinY,f._aabbMinZ=y._aabbMinZ<d._aabbMinZ?y._aabbMinZ:d._aabbMinZ,f._aabbMaxX=y._aabbMaxX>d._aabbMaxX?y._aabbMaxX:d._aabbMaxX,f._aabbMaxY=y._aabbMaxY>d._aabbMaxY?y._aabbMaxY:d._aabbMaxY,f._aabbMaxZ=y._aabbMaxZ>d._aabbMaxZ?y._aabbMaxZ:d._aabbMaxZ;let B=f._children[0]._height,R=f._children[1]._height;f._height=(B>R?B:R)+1;let k=h._children[0],A=h._children[1];h._aabbMinX=k._aabbMinX<A._aabbMinX?k._aabbMinX:A._aabbMinX,h._aabbMinY=k._aabbMinY<A._aabbMinY?k._aabbMinY:A._aabbMinY,h._aabbMinZ=k._aabbMinZ<A._aabbMinZ?k._aabbMinZ:A._aabbMinZ,h._aabbMaxX=k._aabbMaxX>A._aabbMaxX?k._aabbMaxX:A._aabbMaxX,h._aabbMaxY=k._aabbMaxY>A._aabbMaxY?k._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=k._aabbMaxZ>A._aabbMaxZ?k._aabbMaxZ:A._aabbMaxZ;let z=h._children[0]._height,w=h._children[1]._height;h._height=(z>w?z:w)+1}else{f._children[0]=h,h._parent=f,h._childIndex=0,h._children[0]=I,I._parent=h,I._childIndex=0;let y=f._children[0],d=f._children[1];f._aabbMinX=y._aabbMinX<d._aabbMinX?y._aabbMinX:d._aabbMinX,f._aabbMinY=y._aabbMinY<d._aabbMinY?y._aabbMinY:d._aabbMinY,f._aabbMinZ=y._aabbMinZ<d._aabbMinZ?y._aabbMinZ:d._aabbMinZ,f._aabbMaxX=y._aabbMaxX>d._aabbMaxX?y._aabbMaxX:d._aabbMaxX,f._aabbMaxY=y._aabbMaxY>d._aabbMaxY?y._aabbMaxY:d._aabbMaxY,f._aabbMaxZ=y._aabbMaxZ>d._aabbMaxZ?y._aabbMaxZ:d._aabbMaxZ;let B=f._children[0]._height,R=f._children[1]._height;f._height=(B>R?B:R)+1;let k=h._children[0],A=h._children[1];h._aabbMinX=k._aabbMinX<A._aabbMinX?k._aabbMinX:A._aabbMinX,h._aabbMinY=k._aabbMinY<A._aabbMinY?k._aabbMinY:A._aabbMinY,h._aabbMinZ=k._aabbMinZ<A._aabbMinZ?k._aabbMinZ:A._aabbMinZ,h._aabbMaxX=k._aabbMaxX>A._aabbMaxX?k._aabbMaxX:A._aabbMaxX,h._aabbMaxY=k._aabbMaxY>A._aabbMaxY?k._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=k._aabbMaxZ>A._aabbMaxZ?k._aabbMaxZ:A._aabbMaxZ;let z=h._children[0]._height,w=h._children[1]._height;h._height=(z>w?z:w)+1}v!=null?(v._children[Z]=f,f._parent=v,f._childIndex=Z):(n._root=f,f._parent=null),h=f}else if(V<-1){let I=g._children[0],M=g._children[1];if(I._height>M._height){g._children[1]=h,h._parent=g,h._childIndex=1,h._children[1]=M,M._parent=h,M._childIndex=1;let y=g._children[0],d=g._children[1];g._aabbMinX=y._aabbMinX<d._aabbMinX?y._aabbMinX:d._aabbMinX,g._aabbMinY=y._aabbMinY<d._aabbMinY?y._aabbMinY:d._aabbMinY,g._aabbMinZ=y._aabbMinZ<d._aabbMinZ?y._aabbMinZ:d._aabbMinZ,g._aabbMaxX=y._aabbMaxX>d._aabbMaxX?y._aabbMaxX:d._aabbMaxX,g._aabbMaxY=y._aabbMaxY>d._aabbMaxY?y._aabbMaxY:d._aabbMaxY,g._aabbMaxZ=y._aabbMaxZ>d._aabbMaxZ?y._aabbMaxZ:d._aabbMaxZ;let B=g._children[0]._height,R=g._children[1]._height;g._height=(B>R?B:R)+1;let k=h._children[0],A=h._children[1];h._aabbMinX=k._aabbMinX<A._aabbMinX?k._aabbMinX:A._aabbMinX,h._aabbMinY=k._aabbMinY<A._aabbMinY?k._aabbMinY:A._aabbMinY,h._aabbMinZ=k._aabbMinZ<A._aabbMinZ?k._aabbMinZ:A._aabbMinZ,h._aabbMaxX=k._aabbMaxX>A._aabbMaxX?k._aabbMaxX:A._aabbMaxX,h._aabbMaxY=k._aabbMaxY>A._aabbMaxY?k._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=k._aabbMaxZ>A._aabbMaxZ?k._aabbMaxZ:A._aabbMaxZ;let z=h._children[0]._height,w=h._children[1]._height;h._height=(z>w?z:w)+1}else{g._children[0]=h,h._parent=g,h._childIndex=0,h._children[1]=I,I._parent=h,I._childIndex=1;let y=g._children[0],d=g._children[1];g._aabbMinX=y._aabbMinX<d._aabbMinX?y._aabbMinX:d._aabbMinX,g._aabbMinY=y._aabbMinY<d._aabbMinY?y._aabbMinY:d._aabbMinY,g._aabbMinZ=y._aabbMinZ<d._aabbMinZ?y._aabbMinZ:d._aabbMinZ,g._aabbMaxX=y._aabbMaxX>d._aabbMaxX?y._aabbMaxX:d._aabbMaxX,g._aabbMaxY=y._aabbMaxY>d._aabbMaxY?y._aabbMaxY:d._aabbMaxY,g._aabbMaxZ=y._aabbMaxZ>d._aabbMaxZ?y._aabbMaxZ:d._aabbMaxZ;let B=g._children[0]._height,R=g._children[1]._height;g._height=(B>R?B:R)+1;let k=h._children[0],A=h._children[1];h._aabbMinX=k._aabbMinX<A._aabbMinX?k._aabbMinX:A._aabbMinX,h._aabbMinY=k._aabbMinY<A._aabbMinY?k._aabbMinY:A._aabbMinY,h._aabbMinZ=k._aabbMinZ<A._aabbMinZ?k._aabbMinZ:A._aabbMinZ,h._aabbMaxX=k._aabbMaxX>A._aabbMaxX?k._aabbMaxX:A._aabbMaxX,h._aabbMaxY=k._aabbMaxY>A._aabbMaxY?k._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=k._aabbMaxZ>A._aabbMaxZ?k._aabbMaxZ:A._aabbMaxZ;let z=h._children[0]._height,w=h._children[1]._height;h._height=(z>w?z:w)+1}v!=null?(v._children[Z]=g,g._parent=v,g._childIndex=Z):(n._root=g,g._parent=null),h=g}}let c=h._children[0]._height,u=h._children[1]._height;h._height=(c>u?c:u)+1;let p=h._children[0],x=h._children[1];h._aabbMinX=p._aabbMinX<x._aabbMinX?p._aabbMinX:x._aabbMinX,h._aabbMinY=p._aabbMinY<x._aabbMinY?p._aabbMinY:x._aabbMinY,h._aabbMinZ=p._aabbMinZ<x._aabbMinZ?p._aabbMinZ:x._aabbMinZ,h._aabbMaxX=p._aabbMaxX>x._aabbMaxX?p._aabbMaxX:x._aabbMaxX,h._aabbMaxY=p._aabbMaxY>x._aabbMaxY?p._aabbMaxY:x._aabbMaxY,h._aabbMaxZ=p._aabbMaxZ>x._aabbMaxZ?p._aabbMaxZ:x._aabbMaxZ,h=h._parent}}if(!s._moved){if(s._moved=!0,this.movedProxies.length==this.numMovedProxies){let r=new Array(this.numMovedProxies<<1),e=0,a=this.numMovedProxies;for(;e<a;){let h=e++;r[h]=this.movedProxies[h],this.movedProxies[h]=null}this.movedProxies=r}this.movedProxies[this.numMovedProxies++]=s}return s}destroyProxy(t){this._numProxies--;let i=t._prev,s=t._next;i!=null&&(i._next=s),s!=null&&(s._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;let _=t,n=this._tree,l=_._leaf;n._numLeaves--;let o=l._prevLeaf,r=l._nextLeaf;if(o!=null&&(o._nextLeaf=r),r!=null&&(r._prevLeaf=o),l==n.leafList&&(n.leafList=n.leafList._nextLeaf),l==n.leafListLast&&(n.leafListLast=n.leafListLast._prevLeaf),l._nextLeaf=null,l._prevLeaf=null,n._root==l)n._root=null;else{let e=l._parent,a=e._children[l._childIndex^1],h=e._parent;if(h==null)a._parent=null,a._childIndex=0,n._root=a,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=n._nodePool,n._nodePool=e;else{a._parent=h;let b=e._childIndex;h._children[b]=a,a._parent=h,a._childIndex=b,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=n._nodePool,n._nodePool=e;let X=h;for(;X!=null;){if(n._strategy._balancingEnabled&&X._height>=2){let v=X._parent,f=X._children[0],g=X._children[1],V=f._height-g._height,Z=X._childIndex;if(V>1){let I=f._children[0],M=f._children[1];if(I._height>M._height){f._children[1]=X,X._parent=f,X._childIndex=1,X._children[0]=M,M._parent=X,M._childIndex=0;let y=f._children[0],d=f._children[1];f._aabbMinX=y._aabbMinX<d._aabbMinX?y._aabbMinX:d._aabbMinX,f._aabbMinY=y._aabbMinY<d._aabbMinY?y._aabbMinY:d._aabbMinY,f._aabbMinZ=y._aabbMinZ<d._aabbMinZ?y._aabbMinZ:d._aabbMinZ,f._aabbMaxX=y._aabbMaxX>d._aabbMaxX?y._aabbMaxX:d._aabbMaxX,f._aabbMaxY=y._aabbMaxY>d._aabbMaxY?y._aabbMaxY:d._aabbMaxY,f._aabbMaxZ=y._aabbMaxZ>d._aabbMaxZ?y._aabbMaxZ:d._aabbMaxZ;let B=f._children[0]._height,R=f._children[1]._height;f._height=(B>R?B:R)+1;let k=X._children[0],A=X._children[1];X._aabbMinX=k._aabbMinX<A._aabbMinX?k._aabbMinX:A._aabbMinX,X._aabbMinY=k._aabbMinY<A._aabbMinY?k._aabbMinY:A._aabbMinY,X._aabbMinZ=k._aabbMinZ<A._aabbMinZ?k._aabbMinZ:A._aabbMinZ,X._aabbMaxX=k._aabbMaxX>A._aabbMaxX?k._aabbMaxX:A._aabbMaxX,X._aabbMaxY=k._aabbMaxY>A._aabbMaxY?k._aabbMaxY:A._aabbMaxY,X._aabbMaxZ=k._aabbMaxZ>A._aabbMaxZ?k._aabbMaxZ:A._aabbMaxZ;let z=X._children[0]._height,w=X._children[1]._height;X._height=(z>w?z:w)+1}else{f._children[0]=X,X._parent=f,X._childIndex=0,X._children[0]=I,I._parent=X,I._childIndex=0;let y=f._children[0],d=f._children[1];f._aabbMinX=y._aabbMinX<d._aabbMinX?y._aabbMinX:d._aabbMinX,f._aabbMinY=y._aabbMinY<d._aabbMinY?y._aabbMinY:d._aabbMinY,f._aabbMinZ=y._aabbMinZ<d._aabbMinZ?y._aabbMinZ:d._aabbMinZ,f._aabbMaxX=y._aabbMaxX>d._aabbMaxX?y._aabbMaxX:d._aabbMaxX,f._aabbMaxY=y._aabbMaxY>d._aabbMaxY?y._aabbMaxY:d._aabbMaxY,f._aabbMaxZ=y._aabbMaxZ>d._aabbMaxZ?y._aabbMaxZ:d._aabbMaxZ;let B=f._children[0]._height,R=f._children[1]._height;f._height=(B>R?B:R)+1;let k=X._children[0],A=X._children[1];X._aabbMinX=k._aabbMinX<A._aabbMinX?k._aabbMinX:A._aabbMinX,X._aabbMinY=k._aabbMinY<A._aabbMinY?k._aabbMinY:A._aabbMinY,X._aabbMinZ=k._aabbMinZ<A._aabbMinZ?k._aabbMinZ:A._aabbMinZ,X._aabbMaxX=k._aabbMaxX>A._aabbMaxX?k._aabbMaxX:A._aabbMaxX,X._aabbMaxY=k._aabbMaxY>A._aabbMaxY?k._aabbMaxY:A._aabbMaxY,X._aabbMaxZ=k._aabbMaxZ>A._aabbMaxZ?k._aabbMaxZ:A._aabbMaxZ;let z=X._children[0]._height,w=X._children[1]._height;X._height=(z>w?z:w)+1}v!=null?(v._children[Z]=f,f._parent=v,f._childIndex=Z):(n._root=f,f._parent=null),X=f}else if(V<-1){let I=g._children[0],M=g._children[1];if(I._height>M._height){g._children[1]=X,X._parent=g,X._childIndex=1,X._children[1]=M,M._parent=X,M._childIndex=1;let y=g._children[0],d=g._children[1];g._aabbMinX=y._aabbMinX<d._aabbMinX?y._aabbMinX:d._aabbMinX,g._aabbMinY=y._aabbMinY<d._aabbMinY?y._aabbMinY:d._aabbMinY,g._aabbMinZ=y._aabbMinZ<d._aabbMinZ?y._aabbMinZ:d._aabbMinZ,g._aabbMaxX=y._aabbMaxX>d._aabbMaxX?y._aabbMaxX:d._aabbMaxX,g._aabbMaxY=y._aabbMaxY>d._aabbMaxY?y._aabbMaxY:d._aabbMaxY,g._aabbMaxZ=y._aabbMaxZ>d._aabbMaxZ?y._aabbMaxZ:d._aabbMaxZ;let B=g._children[0]._height,R=g._children[1]._height;g._height=(B>R?B:R)+1;let k=X._children[0],A=X._children[1];X._aabbMinX=k._aabbMinX<A._aabbMinX?k._aabbMinX:A._aabbMinX,X._aabbMinY=k._aabbMinY<A._aabbMinY?k._aabbMinY:A._aabbMinY,X._aabbMinZ=k._aabbMinZ<A._aabbMinZ?k._aabbMinZ:A._aabbMinZ,X._aabbMaxX=k._aabbMaxX>A._aabbMaxX?k._aabbMaxX:A._aabbMaxX,X._aabbMaxY=k._aabbMaxY>A._aabbMaxY?k._aabbMaxY:A._aabbMaxY,X._aabbMaxZ=k._aabbMaxZ>A._aabbMaxZ?k._aabbMaxZ:A._aabbMaxZ;let z=X._children[0]._height,w=X._children[1]._height;X._height=(z>w?z:w)+1}else{g._children[0]=X,X._parent=g,X._childIndex=0,X._children[1]=I,I._parent=X,I._childIndex=1;let y=g._children[0],d=g._children[1];g._aabbMinX=y._aabbMinX<d._aabbMinX?y._aabbMinX:d._aabbMinX,g._aabbMinY=y._aabbMinY<d._aabbMinY?y._aabbMinY:d._aabbMinY,g._aabbMinZ=y._aabbMinZ<d._aabbMinZ?y._aabbMinZ:d._aabbMinZ,g._aabbMaxX=y._aabbMaxX>d._aabbMaxX?y._aabbMaxX:d._aabbMaxX,g._aabbMaxY=y._aabbMaxY>d._aabbMaxY?y._aabbMaxY:d._aabbMaxY,g._aabbMaxZ=y._aabbMaxZ>d._aabbMaxZ?y._aabbMaxZ:d._aabbMaxZ;let B=g._children[0]._height,R=g._children[1]._height;g._height=(B>R?B:R)+1;let k=X._children[0],A=X._children[1];X._aabbMinX=k._aabbMinX<A._aabbMinX?k._aabbMinX:A._aabbMinX,X._aabbMinY=k._aabbMinY<A._aabbMinY?k._aabbMinY:A._aabbMinY,X._aabbMinZ=k._aabbMinZ<A._aabbMinZ?k._aabbMinZ:A._aabbMinZ,X._aabbMaxX=k._aabbMaxX>A._aabbMaxX?k._aabbMaxX:A._aabbMaxX,X._aabbMaxY=k._aabbMaxY>A._aabbMaxY?k._aabbMaxY:A._aabbMaxY,X._aabbMaxZ=k._aabbMaxZ>A._aabbMaxZ?k._aabbMaxZ:A._aabbMaxZ;let z=X._children[0]._height,w=X._children[1]._height;X._height=(z>w?z:w)+1}v!=null?(v._children[Z]=g,g._parent=v,g._childIndex=Z):(n._root=g,g._parent=null),X=g}}let c=X._children[0]._height,u=X._children[1]._height;X._height=(c>u?c:u)+1;let p=X._children[0],x=X._children[1];X._aabbMinX=p._aabbMinX<x._aabbMinX?p._aabbMinX:x._aabbMinX,X._aabbMinY=p._aabbMinY<x._aabbMinY?p._aabbMinY:x._aabbMinY,X._aabbMinZ=p._aabbMinZ<x._aabbMinZ?p._aabbMinZ:x._aabbMinZ,X._aabbMaxX=p._aabbMaxX>x._aabbMaxX?p._aabbMaxX:x._aabbMaxX,X._aabbMaxY=p._aabbMaxY>x._aabbMaxY?p._aabbMaxY:x._aabbMaxY,X._aabbMaxZ=p._aabbMaxZ>x._aabbMaxZ?p._aabbMaxZ:x._aabbMaxZ,X=X._parent}}}_._leaf=null,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=n._nodePool,n._nodePool=l,_.userData=null,_._next=null,_._prev=null,_._moved&&(_._moved=!1)}moveProxy(t,i,s){let _=t;if(_._aabbMinX<=i._minX&&_._aabbMaxX>=i._maxX&&_._aabbMinY<=i._minY&&_._aabbMaxY>=i._maxY&&_._aabbMinZ<=i._minZ&&_._aabbMaxZ>=i._maxZ)return;_._aabbMinX=i._minX,_._aabbMinY=i._minY,_._aabbMinZ=i._minZ,_._aabbMaxX=i._maxX,_._aabbMaxY=i._maxY,_._aabbMaxZ=i._maxZ;let n=m.common.Setting.bvhProxyPadding;if(_._aabbMinX-=n,_._aabbMinY-=n,_._aabbMinZ-=n,_._aabbMaxX+=n,_._aabbMaxY+=n,_._aabbMaxZ+=n,s!=null){let l,o,r,e,a,h,b,X,c,u,p,x;e=0,a=0,h=0,l=s.x,o=s.y,r=s.z,b=e<l?e:l,X=a<o?a:o,c=h<r?h:r,u=e>l?e:l,p=a>o?a:o,x=h>r?h:r,_._aabbMinX+=b,_._aabbMinY+=X,_._aabbMinZ+=c,_._aabbMaxX+=u,_._aabbMaxY+=p,_._aabbMaxZ+=x}if(!_._moved){if(_._moved=!0,this.movedProxies.length==this.numMovedProxies){let l=new Array(this.numMovedProxies<<1),o=0,r=this.numMovedProxies;for(;o<r;){let e=o++;l[e]=this.movedProxies[e],this.movedProxies[e]=null}this.movedProxies=l}this.movedProxies[this.numMovedProxies++]=_}}collectPairs(){let t=this._proxyPairList;if(t!=null){for(;t._p1=null,t._p2=null,t=t._next,t!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,this._numProxies<2)return;let i=this.numMovedProxies/this._numProxies<m.common.Setting.bvhIncrementalCollisionThreshold,s=0,_=this.numMovedProxies;for(;s<_;){let n=s++,l=this.movedProxies[n];if(l._moved){let o=this._tree,r=l._leaf;o._numLeaves--;let e=r._prevLeaf,a=r._nextLeaf;if(e!=null&&(e._nextLeaf=a),a!=null&&(a._prevLeaf=e),r==o.leafList&&(o.leafList=o.leafList._nextLeaf),r==o.leafListLast&&(o.leafListLast=o.leafListLast._prevLeaf),r._nextLeaf=null,r._prevLeaf=null,o._root==r)o._root=null;else{let c=r._parent,u=c._children[r._childIndex^1],p=c._parent;if(p==null)u._parent=null,u._childIndex=0,o._root=u,c._next=null,c._childIndex=0,c._children[0]=null,c._children[1]=null,c._childIndex=0,c._parent=null,c._height=0,c._proxy=null,c._next=o._nodePool,o._nodePool=c;else{u._parent=p;let x=c._childIndex;p._children[x]=u,u._parent=p,u._childIndex=x,c._next=null,c._childIndex=0,c._children[0]=null,c._children[1]=null,c._childIndex=0,c._parent=null,c._height=0,c._proxy=null,c._next=o._nodePool,o._nodePool=c;let v=p;for(;v!=null;){if(o._strategy._balancingEnabled&&v._height>=2){let I=v._parent,M=v._children[0],y=v._children[1],d=M._height-y._height,B=v._childIndex;if(d>1){let R=M._children[0],k=M._children[1];if(R._height>k._height){M._children[1]=v,v._parent=M,v._childIndex=1,v._children[0]=k,k._parent=v,k._childIndex=0;let A=M._children[0],z=M._children[1];M._aabbMinX=A._aabbMinX<z._aabbMinX?A._aabbMinX:z._aabbMinX,M._aabbMinY=A._aabbMinY<z._aabbMinY?A._aabbMinY:z._aabbMinY,M._aabbMinZ=A._aabbMinZ<z._aabbMinZ?A._aabbMinZ:z._aabbMinZ,M._aabbMaxX=A._aabbMaxX>z._aabbMaxX?A._aabbMaxX:z._aabbMaxX,M._aabbMaxY=A._aabbMaxY>z._aabbMaxY?A._aabbMaxY:z._aabbMaxY,M._aabbMaxZ=A._aabbMaxZ>z._aabbMaxZ?A._aabbMaxZ:z._aabbMaxZ;let w=M._children[0]._height,S=M._children[1]._height;M._height=(w>S?w:S)+1;let P=v._children[0],T=v._children[1];v._aabbMinX=P._aabbMinX<T._aabbMinX?P._aabbMinX:T._aabbMinX,v._aabbMinY=P._aabbMinY<T._aabbMinY?P._aabbMinY:T._aabbMinY,v._aabbMinZ=P._aabbMinZ<T._aabbMinZ?P._aabbMinZ:T._aabbMinZ,v._aabbMaxX=P._aabbMaxX>T._aabbMaxX?P._aabbMaxX:T._aabbMaxX,v._aabbMaxY=P._aabbMaxY>T._aabbMaxY?P._aabbMaxY:T._aabbMaxY,v._aabbMaxZ=P._aabbMaxZ>T._aabbMaxZ?P._aabbMaxZ:T._aabbMaxZ;let C=v._children[0]._height,L=v._children[1]._height;v._height=(C>L?C:L)+1}else{M._children[0]=v,v._parent=M,v._childIndex=0,v._children[0]=R,R._parent=v,R._childIndex=0;let A=M._children[0],z=M._children[1];M._aabbMinX=A._aabbMinX<z._aabbMinX?A._aabbMinX:z._aabbMinX,M._aabbMinY=A._aabbMinY<z._aabbMinY?A._aabbMinY:z._aabbMinY,M._aabbMinZ=A._aabbMinZ<z._aabbMinZ?A._aabbMinZ:z._aabbMinZ,M._aabbMaxX=A._aabbMaxX>z._aabbMaxX?A._aabbMaxX:z._aabbMaxX,M._aabbMaxY=A._aabbMaxY>z._aabbMaxY?A._aabbMaxY:z._aabbMaxY,M._aabbMaxZ=A._aabbMaxZ>z._aabbMaxZ?A._aabbMaxZ:z._aabbMaxZ;let w=M._children[0]._height,S=M._children[1]._height;M._height=(w>S?w:S)+1;let P=v._children[0],T=v._children[1];v._aabbMinX=P._aabbMinX<T._aabbMinX?P._aabbMinX:T._aabbMinX,v._aabbMinY=P._aabbMinY<T._aabbMinY?P._aabbMinY:T._aabbMinY,v._aabbMinZ=P._aabbMinZ<T._aabbMinZ?P._aabbMinZ:T._aabbMinZ,v._aabbMaxX=P._aabbMaxX>T._aabbMaxX?P._aabbMaxX:T._aabbMaxX,v._aabbMaxY=P._aabbMaxY>T._aabbMaxY?P._aabbMaxY:T._aabbMaxY,v._aabbMaxZ=P._aabbMaxZ>T._aabbMaxZ?P._aabbMaxZ:T._aabbMaxZ;let C=v._children[0]._height,L=v._children[1]._height;v._height=(C>L?C:L)+1}I!=null?(I._children[B]=M,M._parent=I,M._childIndex=B):(o._root=M,M._parent=null),v=M}else if(d<-1){let R=y._children[0],k=y._children[1];if(R._height>k._height){y._children[1]=v,v._parent=y,v._childIndex=1,v._children[1]=k,k._parent=v,k._childIndex=1;let A=y._children[0],z=y._children[1];y._aabbMinX=A._aabbMinX<z._aabbMinX?A._aabbMinX:z._aabbMinX,y._aabbMinY=A._aabbMinY<z._aabbMinY?A._aabbMinY:z._aabbMinY,y._aabbMinZ=A._aabbMinZ<z._aabbMinZ?A._aabbMinZ:z._aabbMinZ,y._aabbMaxX=A._aabbMaxX>z._aabbMaxX?A._aabbMaxX:z._aabbMaxX,y._aabbMaxY=A._aabbMaxY>z._aabbMaxY?A._aabbMaxY:z._aabbMaxY,y._aabbMaxZ=A._aabbMaxZ>z._aabbMaxZ?A._aabbMaxZ:z._aabbMaxZ;let w=y._children[0]._height,S=y._children[1]._height;y._height=(w>S?w:S)+1;let P=v._children[0],T=v._children[1];v._aabbMinX=P._aabbMinX<T._aabbMinX?P._aabbMinX:T._aabbMinX,v._aabbMinY=P._aabbMinY<T._aabbMinY?P._aabbMinY:T._aabbMinY,v._aabbMinZ=P._aabbMinZ<T._aabbMinZ?P._aabbMinZ:T._aabbMinZ,v._aabbMaxX=P._aabbMaxX>T._aabbMaxX?P._aabbMaxX:T._aabbMaxX,v._aabbMaxY=P._aabbMaxY>T._aabbMaxY?P._aabbMaxY:T._aabbMaxY,v._aabbMaxZ=P._aabbMaxZ>T._aabbMaxZ?P._aabbMaxZ:T._aabbMaxZ;let C=v._children[0]._height,L=v._children[1]._height;v._height=(C>L?C:L)+1}else{y._children[0]=v,v._parent=y,v._childIndex=0,v._children[1]=R,R._parent=v,R._childIndex=1;let A=y._children[0],z=y._children[1];y._aabbMinX=A._aabbMinX<z._aabbMinX?A._aabbMinX:z._aabbMinX,y._aabbMinY=A._aabbMinY<z._aabbMinY?A._aabbMinY:z._aabbMinY,y._aabbMinZ=A._aabbMinZ<z._aabbMinZ?A._aabbMinZ:z._aabbMinZ,y._aabbMaxX=A._aabbMaxX>z._aabbMaxX?A._aabbMaxX:z._aabbMaxX,y._aabbMaxY=A._aabbMaxY>z._aabbMaxY?A._aabbMaxY:z._aabbMaxY,y._aabbMaxZ=A._aabbMaxZ>z._aabbMaxZ?A._aabbMaxZ:z._aabbMaxZ;let w=y._children[0]._height,S=y._children[1]._height;y._height=(w>S?w:S)+1;let P=v._children[0],T=v._children[1];v._aabbMinX=P._aabbMinX<T._aabbMinX?P._aabbMinX:T._aabbMinX,v._aabbMinY=P._aabbMinY<T._aabbMinY?P._aabbMinY:T._aabbMinY,v._aabbMinZ=P._aabbMinZ<T._aabbMinZ?P._aabbMinZ:T._aabbMinZ,v._aabbMaxX=P._aabbMaxX>T._aabbMaxX?P._aabbMaxX:T._aabbMaxX,v._aabbMaxY=P._aabbMaxY>T._aabbMaxY?P._aabbMaxY:T._aabbMaxY,v._aabbMaxZ=P._aabbMaxZ>T._aabbMaxZ?P._aabbMaxZ:T._aabbMaxZ;let C=v._children[0]._height,L=v._children[1]._height;v._height=(C>L?C:L)+1}I!=null?(I._children[B]=y,y._parent=I,y._childIndex=B):(o._root=y,y._parent=null),v=y}}let f=v._children[0]._height,g=v._children[1]._height;v._height=(f>g?f:g)+1;let V=v._children[0],Z=v._children[1];v._aabbMinX=V._aabbMinX<Z._aabbMinX?V._aabbMinX:Z._aabbMinX,v._aabbMinY=V._aabbMinY<Z._aabbMinY?V._aabbMinY:Z._aabbMinY,v._aabbMinZ=V._aabbMinZ<Z._aabbMinZ?V._aabbMinZ:Z._aabbMinZ,v._aabbMaxX=V._aabbMaxX>Z._aabbMaxX?V._aabbMaxX:Z._aabbMaxX,v._aabbMaxY=V._aabbMaxY>Z._aabbMaxY?V._aabbMaxY:Z._aabbMaxY,v._aabbMaxZ=V._aabbMaxZ>Z._aabbMaxZ?V._aabbMaxZ:Z._aabbMaxZ,v=v._parent}}}l._leaf=null,r._next=null,r._childIndex=0,r._children[0]=null,r._children[1]=null,r._childIndex=0,r._parent=null,r._height=0,r._proxy=null,r._next=o._nodePool,o._nodePool=r;let h=this._tree,b=h._nodePool;b!=null?(h._nodePool=b._next,b._next=null):b=new m.collision.broadphase.bvh.BvhNode;let X=b;if(X._proxy=l,l._leaf=X,X._aabbMinX=l._aabbMinX,X._aabbMinY=l._aabbMinY,X._aabbMinZ=l._aabbMinZ,X._aabbMaxX=l._aabbMaxX,X._aabbMaxY=l._aabbMaxY,X._aabbMaxZ=l._aabbMaxZ,h._numLeaves++,h.leafList==null?(h.leafList=X,h.leafListLast=X):(h.leafListLast._nextLeaf=X,X._prevLeaf=h.leafListLast,h.leafListLast=X),h._root==null)h._root=X;else{let c=h._root;for(;c._height>0;){let g=h._strategy._decideInsertion(c,X);if(g==-1)break;c=c._children[g]}let u=c._parent,p=h._nodePool;p!=null?(h._nodePool=p._next,p._next=null):p=new m.collision.broadphase.bvh.BvhNode;let x=p;if(u==null)h._root=x;else{let g=c._childIndex;u._children[g]=x,x._parent=u,x._childIndex=g}let v=c._childIndex;x._children[v]=c,c._parent=x,c._childIndex=v;let f=c._childIndex^1;for(x._children[f]=X,X._parent=x,X._childIndex=f;x!=null;){if(h._strategy._balancingEnabled&&x._height>=2){let M=x._parent,y=x._children[0],d=x._children[1],B=y._height-d._height,R=x._childIndex;if(B>1){let k=y._children[0],A=y._children[1];if(k._height>A._height){y._children[1]=x,x._parent=y,x._childIndex=1,x._children[0]=A,A._parent=x,A._childIndex=0;let z=y._children[0],w=y._children[1];y._aabbMinX=z._aabbMinX<w._aabbMinX?z._aabbMinX:w._aabbMinX,y._aabbMinY=z._aabbMinY<w._aabbMinY?z._aabbMinY:w._aabbMinY,y._aabbMinZ=z._aabbMinZ<w._aabbMinZ?z._aabbMinZ:w._aabbMinZ,y._aabbMaxX=z._aabbMaxX>w._aabbMaxX?z._aabbMaxX:w._aabbMaxX,y._aabbMaxY=z._aabbMaxY>w._aabbMaxY?z._aabbMaxY:w._aabbMaxY,y._aabbMaxZ=z._aabbMaxZ>w._aabbMaxZ?z._aabbMaxZ:w._aabbMaxZ;let S=y._children[0]._height,P=y._children[1]._height;y._height=(S>P?S:P)+1;let T=x._children[0],C=x._children[1];x._aabbMinX=T._aabbMinX<C._aabbMinX?T._aabbMinX:C._aabbMinX,x._aabbMinY=T._aabbMinY<C._aabbMinY?T._aabbMinY:C._aabbMinY,x._aabbMinZ=T._aabbMinZ<C._aabbMinZ?T._aabbMinZ:C._aabbMinZ,x._aabbMaxX=T._aabbMaxX>C._aabbMaxX?T._aabbMaxX:C._aabbMaxX,x._aabbMaxY=T._aabbMaxY>C._aabbMaxY?T._aabbMaxY:C._aabbMaxY,x._aabbMaxZ=T._aabbMaxZ>C._aabbMaxZ?T._aabbMaxZ:C._aabbMaxZ;let L=x._children[0]._height,q=x._children[1]._height;x._height=(L>q?L:q)+1}else{y._children[0]=x,x._parent=y,x._childIndex=0,x._children[0]=k,k._parent=x,k._childIndex=0;let z=y._children[0],w=y._children[1];y._aabbMinX=z._aabbMinX<w._aabbMinX?z._aabbMinX:w._aabbMinX,y._aabbMinY=z._aabbMinY<w._aabbMinY?z._aabbMinY:w._aabbMinY,y._aabbMinZ=z._aabbMinZ<w._aabbMinZ?z._aabbMinZ:w._aabbMinZ,y._aabbMaxX=z._aabbMaxX>w._aabbMaxX?z._aabbMaxX:w._aabbMaxX,y._aabbMaxY=z._aabbMaxY>w._aabbMaxY?z._aabbMaxY:w._aabbMaxY,y._aabbMaxZ=z._aabbMaxZ>w._aabbMaxZ?z._aabbMaxZ:w._aabbMaxZ;let S=y._children[0]._height,P=y._children[1]._height;y._height=(S>P?S:P)+1;let T=x._children[0],C=x._children[1];x._aabbMinX=T._aabbMinX<C._aabbMinX?T._aabbMinX:C._aabbMinX,x._aabbMinY=T._aabbMinY<C._aabbMinY?T._aabbMinY:C._aabbMinY,x._aabbMinZ=T._aabbMinZ<C._aabbMinZ?T._aabbMinZ:C._aabbMinZ,x._aabbMaxX=T._aabbMaxX>C._aabbMaxX?T._aabbMaxX:C._aabbMaxX,x._aabbMaxY=T._aabbMaxY>C._aabbMaxY?T._aabbMaxY:C._aabbMaxY,x._aabbMaxZ=T._aabbMaxZ>C._aabbMaxZ?T._aabbMaxZ:C._aabbMaxZ;let L=x._children[0]._height,q=x._children[1]._height;x._height=(L>q?L:q)+1}M!=null?(M._children[R]=y,y._parent=M,y._childIndex=R):(h._root=y,y._parent=null),x=y}else if(B<-1){let k=d._children[0],A=d._children[1];if(k._height>A._height){d._children[1]=x,x._parent=d,x._childIndex=1,x._children[1]=A,A._parent=x,A._childIndex=1;let z=d._children[0],w=d._children[1];d._aabbMinX=z._aabbMinX<w._aabbMinX?z._aabbMinX:w._aabbMinX,d._aabbMinY=z._aabbMinY<w._aabbMinY?z._aabbMinY:w._aabbMinY,d._aabbMinZ=z._aabbMinZ<w._aabbMinZ?z._aabbMinZ:w._aabbMinZ,d._aabbMaxX=z._aabbMaxX>w._aabbMaxX?z._aabbMaxX:w._aabbMaxX,d._aabbMaxY=z._aabbMaxY>w._aabbMaxY?z._aabbMaxY:w._aabbMaxY,d._aabbMaxZ=z._aabbMaxZ>w._aabbMaxZ?z._aabbMaxZ:w._aabbMaxZ;let S=d._children[0]._height,P=d._children[1]._height;d._height=(S>P?S:P)+1;let T=x._children[0],C=x._children[1];x._aabbMinX=T._aabbMinX<C._aabbMinX?T._aabbMinX:C._aabbMinX,x._aabbMinY=T._aabbMinY<C._aabbMinY?T._aabbMinY:C._aabbMinY,x._aabbMinZ=T._aabbMinZ<C._aabbMinZ?T._aabbMinZ:C._aabbMinZ,x._aabbMaxX=T._aabbMaxX>C._aabbMaxX?T._aabbMaxX:C._aabbMaxX,x._aabbMaxY=T._aabbMaxY>C._aabbMaxY?T._aabbMaxY:C._aabbMaxY,x._aabbMaxZ=T._aabbMaxZ>C._aabbMaxZ?T._aabbMaxZ:C._aabbMaxZ;let L=x._children[0]._height,q=x._children[1]._height;x._height=(L>q?L:q)+1}else{d._children[0]=x,x._parent=d,x._childIndex=0,x._children[1]=k,k._parent=x,k._childIndex=1;let z=d._children[0],w=d._children[1];d._aabbMinX=z._aabbMinX<w._aabbMinX?z._aabbMinX:w._aabbMinX,d._aabbMinY=z._aabbMinY<w._aabbMinY?z._aabbMinY:w._aabbMinY,d._aabbMinZ=z._aabbMinZ<w._aabbMinZ?z._aabbMinZ:w._aabbMinZ,d._aabbMaxX=z._aabbMaxX>w._aabbMaxX?z._aabbMaxX:w._aabbMaxX,d._aabbMaxY=z._aabbMaxY>w._aabbMaxY?z._aabbMaxY:w._aabbMaxY,d._aabbMaxZ=z._aabbMaxZ>w._aabbMaxZ?z._aabbMaxZ:w._aabbMaxZ;let S=d._children[0]._height,P=d._children[1]._height;d._height=(S>P?S:P)+1;let T=x._children[0],C=x._children[1];x._aabbMinX=T._aabbMinX<C._aabbMinX?T._aabbMinX:C._aabbMinX,x._aabbMinY=T._aabbMinY<C._aabbMinY?T._aabbMinY:C._aabbMinY,x._aabbMinZ=T._aabbMinZ<C._aabbMinZ?T._aabbMinZ:C._aabbMinZ,x._aabbMaxX=T._aabbMaxX>C._aabbMaxX?T._aabbMaxX:C._aabbMaxX,x._aabbMaxY=T._aabbMaxY>C._aabbMaxY?T._aabbMaxY:C._aabbMaxY,x._aabbMaxZ=T._aabbMaxZ>C._aabbMaxZ?T._aabbMaxZ:C._aabbMaxZ;let L=x._children[0]._height,q=x._children[1]._height;x._height=(L>q?L:q)+1}M!=null?(M._children[R]=d,d._parent=M,d._childIndex=R):(h._root=d,d._parent=null),x=d}}let g=x._children[0]._height,V=x._children[1]._height;x._height=(g>V?g:V)+1;let Z=x._children[0],I=x._children[1];x._aabbMinX=Z._aabbMinX<I._aabbMinX?Z._aabbMinX:I._aabbMinX,x._aabbMinY=Z._aabbMinY<I._aabbMinY?Z._aabbMinY:I._aabbMinY,x._aabbMinZ=Z._aabbMinZ<I._aabbMinZ?Z._aabbMinZ:I._aabbMinZ,x._aabbMaxX=Z._aabbMaxX>I._aabbMaxX?Z._aabbMaxX:I._aabbMaxX,x._aabbMaxY=Z._aabbMaxY>I._aabbMaxY?Z._aabbMaxY:I._aabbMaxY,x._aabbMaxZ=Z._aabbMaxZ>I._aabbMaxZ?Z._aabbMaxZ:I._aabbMaxZ,x=x._parent}}i&&this.collide(this._tree._root,l._leaf),l._moved=!1}this.movedProxies[n]=null}i||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}rayCast(t,i,s){if(this._tree._root==null)return;let _,n,l,o,r,e;_=t.x,n=t.y,l=t.z,o=i.x,r=i.y,e=i.z,this.rayCastRecursive(this._tree._root,_,n,l,o,r,e,s)}convexCast(t,i,s,_){this._tree._root!=null&&this.convexCastRecursive(this._tree._root,t,i,s,_)}aabbTest(t,i){this._tree._root!=null&&this.aabbTestRecursive(this._tree._root,t,i)}getTreeBalance(){return this._tree._getBalance()}};m.collision.broadphase.bvh.BvhInsertionStrategy=class{};m.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null,this._children=new Array(2),this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}};m.collision.broadphase.bvh.BvhProxy=class extends m.collision.broadphase.Proxy{constructor(t,i){super(t,i),this._leaf=null,this._moved=!1}};m.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(t,i){switch(this._insertionStrategy){case 0:let s,_,n;s=i._aabbMinX+i._aabbMaxX,_=i._aabbMinY+i._aabbMaxY,n=i._aabbMinZ+i._aabbMaxZ;let l=t._children[0],o=t._children[1],r,e,a,h,b,X;return r=l._aabbMinX+l._aabbMaxX,e=l._aabbMinY+l._aabbMaxY,a=l._aabbMinZ+l._aabbMaxZ,h=o._aabbMinX+o._aabbMaxX,b=o._aabbMinY+o._aabbMaxY,X=o._aabbMinZ+o._aabbMaxZ,r-=s,e-=_,a-=n,h-=s,b-=_,X-=n,r*r+e*e+a*a<h*h+b*b+X*X?0:1;case 1:let c=t._children[0],u=t._children[1],p=t._aabbMaxY-t._aabbMinY,x=t._aabbMaxZ-t._aabbMinZ,v,f,g,V,Z,I;v=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,f=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,g=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,V=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,Z=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,I=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let M=Z-f,y=I-g,d=((V-v)*(M+y)+M*y)*2,B=d*2,R=(d-((t._aabbMaxX-t._aabbMinX)*(p+x)+p*x)*2)*2,k;if(v=c._aabbMinX<i._aabbMinX?c._aabbMinX:i._aabbMinX,f=c._aabbMinY<i._aabbMinY?c._aabbMinY:i._aabbMinY,g=c._aabbMinZ<i._aabbMinZ?c._aabbMinZ:i._aabbMinZ,V=c._aabbMaxX>i._aabbMaxX?c._aabbMaxX:i._aabbMaxX,Z=c._aabbMaxY>i._aabbMaxY?c._aabbMaxY:i._aabbMaxY,I=c._aabbMaxZ>i._aabbMaxZ?c._aabbMaxZ:i._aabbMaxZ,c._height==0){let z=Z-f,w=I-g;k=R+((V-v)*(z+w)+z*w)*2}else{let z=Z-f,w=I-g,S=c._aabbMaxY-c._aabbMinY,P=c._aabbMaxZ-c._aabbMinZ;k=R+(((V-v)*(z+w)+z*w)*2-((c._aabbMaxX-c._aabbMinX)*(S+P)+S*P)*2)}let A;if(v=u._aabbMinX<i._aabbMinX?u._aabbMinX:i._aabbMinX,f=u._aabbMinY<i._aabbMinY?u._aabbMinY:i._aabbMinY,g=u._aabbMinZ<i._aabbMinZ?u._aabbMinZ:i._aabbMinZ,V=u._aabbMaxX>i._aabbMaxX?u._aabbMaxX:i._aabbMaxX,Z=u._aabbMaxY>i._aabbMaxY?u._aabbMaxY:i._aabbMaxY,I=u._aabbMaxZ>i._aabbMaxZ?u._aabbMaxZ:i._aabbMaxZ,u._height==0){let z=Z-f,w=I-g;A=R+((V-v)*(z+w)+z*w)*2}else{let z=Z-f,w=I-g,S=u._aabbMaxY-u._aabbMinY,P=u._aabbMaxZ-u._aabbMinZ;A=R+(((V-v)*(z+w)+z*w)*2-((u._aabbMaxX-u._aabbMinX)*(S+P)+S*P)*2)}return B<k?B<A?-1:1:k<A?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(t,i,s){let _=1/(s-i),n,l,o;n=0,l=0,o=0;let r=i;for(;r<s;){let v=t[r++];v._tmpX=v._aabbMaxX+v._aabbMinX,v._tmpY=v._aabbMaxY+v._aabbMinY,v._tmpZ=v._aabbMaxZ+v._aabbMinZ,n+=v._tmpX,l+=v._tmpY,o+=v._tmpZ}n*=_,l*=_,o*=_;let e,a,h;e=0,a=0,h=0;let b=i;for(;b<s;){let v=t[b++],f,g,V;f=v._tmpX-n,g=v._tmpY-l,V=v._tmpZ-o,f*=f,g*=g,V*=V,e+=f,a+=g,h+=V}let X=e,c=a,u=h,p=i,x=s-1;if(X>c)if(X>u){let v=n;for(;;){for(;!(t[p]._tmpX<=v);)++p;for(;!(t[x]._tmpX>=v);)--x;if(p>=x)break;let f=t[p];t[p]=t[x],t[x]=f,++p,--x}}else{let v=o;for(;;){for(;!(t[p]._tmpZ<=v);)++p;for(;!(t[x]._tmpZ>=v);)--x;if(p>=x)break;let f=t[p];t[p]=t[x],t[x]=f,++p,--x}}else if(c>u){let v=l;for(;;){for(;!(t[p]._tmpY<=v);)++p;for(;!(t[x]._tmpY>=v);)--x;if(p>=x)break;let f=t[p];t[p]=t[x],t[x]=f,++p,--x}}else{let v=o;for(;;){for(;!(t[p]._tmpZ<=v);)++p;for(;!(t[x]._tmpZ>=v);)--x;if(p>=x)break;let f=t[p];t[p]=t[x],t[x]=f,++p,--x}}return p}};m.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new m.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null,this.tmp=new Array(1024)}_print(t,i){if(i==null&&(i=""),t!=null)if(t._height==0)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",i+t._proxy._id);else{this._print(t._children[0],i+"  ");let s,_,n,l;_=t._aabbMaxX-t._aabbMinX,n=t._aabbMaxY-t._aabbMinY,l=t._aabbMaxZ-t._aabbMinZ;let o=n,r=l;if(_*(o+r)+o*r>0){let e,a,h;e=t._aabbMaxX-t._aabbMinX,a=t._aabbMaxY-t._aabbMinY,h=t._aabbMaxZ-t._aabbMinZ;let b=a,X=h;s=((e*(b+X)+b*X)*1e3+.5|0)/1e3}else{let e,a,h;e=t._aabbMaxX-t._aabbMinX,a=t._aabbMaxY-t._aabbMinY,h=t._aabbMaxZ-t._aabbMinZ;let b=a,X=h;s=((e*(b+X)+b*X)*1e3-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",i+"#"+t._height+", "+s),this._print(t._children[1],i+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(t){if(t._height==0){let i=t._prevLeaf,s=t._nextLeaf;i!=null&&(i._nextLeaf=s),s!=null&&(s._prevLeaf=i),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t;return}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}decomposeRecursive(t){if(t._height==0){t._childIndex=0,t._parent=null;return}this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}buildTopDownRecursive(t,i,s){if(s-i==1){let X=t[i],c=X._proxy;return X._aabbMinX=c._aabbMinX,X._aabbMinY=c._aabbMinY,X._aabbMinZ=c._aabbMinZ,X._aabbMaxX=c._aabbMaxX,X._aabbMaxY=c._aabbMaxY,X._aabbMaxZ=c._aabbMaxZ,X}let _=this._strategy._splitLeaves(t,i,s),n=this.buildTopDownRecursive(t,i,_),l=this.buildTopDownRecursive(t,_,s),o=this._nodePool;o!=null?(this._nodePool=o._next,o._next=null):o=new m.collision.broadphase.bvh.BvhNode;let r=o;r._children[0]=n,n._parent=r,n._childIndex=0,r._children[1]=l,l._parent=r,l._childIndex=1;let e=r._children[0],a=r._children[1];r._aabbMinX=e._aabbMinX<a._aabbMinX?e._aabbMinX:a._aabbMinX,r._aabbMinY=e._aabbMinY<a._aabbMinY?e._aabbMinY:a._aabbMinY,r._aabbMinZ=e._aabbMinZ<a._aabbMinZ?e._aabbMinZ:a._aabbMinZ,r._aabbMaxX=e._aabbMaxX>a._aabbMaxX?e._aabbMaxX:a._aabbMaxX,r._aabbMaxY=e._aabbMaxY>a._aabbMaxY?e._aabbMaxY:a._aabbMaxY,r._aabbMaxZ=e._aabbMaxZ>a._aabbMaxZ?e._aabbMaxZ:a._aabbMaxZ;let h=r._children[0]._height,b=r._children[1]._height;return r._height=(h>b?h:b)+1,r}getBalanceRecursive(t){if(t==null||t._height==0)return 0;let i=t._children[0]._height-t._children[1]._height;return i<0&&(i=-i),i+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}};m.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(t,i){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this}getMin(){let t=new m.common.Vec3;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,t}getMinTo(t){t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(t){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){let t=new m.common.Vec3;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,t}getMaxTo(t){t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(t){return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){let t=new m.common.Vec3,i,s,_;return i=this._minX+this._maxX,s=this._minY+this._maxY,_=this._minZ+this._maxZ,i*=.5,s*=.5,_*=.5,t.x=i,t.y=s,t.z=_,t}getCenterTo(t){let i,s,_;i=this._minX+this._maxX,s=this._minY+this._maxY,_=this._minZ+this._maxZ,i*=.5,s*=.5,_*=.5,t.x=i,t.y=s,t.z=_}getExtents(){let t=new m.common.Vec3,i,s,_;return i=this._maxX-this._minX,s=this._maxY-this._minY,_=this._maxZ-this._minZ,i*=.5,s*=.5,_*=.5,t.x=i,t.y=s,t.z=_,t}getExtentsTo(t){let i,s,_;i=this._maxX-this._minX,s=this._maxY-this._minY,_=this._maxZ-this._minZ,i*=.5,s*=.5,_*=.5,t.x=i,t.y=s,t.z=_}combine(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this}combined(t){let i=new m.collision.geometry.Aabb;return i._minX=this._minX<t._minX?this._minX:t._minX,i._minY=this._minY<t._minY?this._minY:t._minY,i._minZ=this._minZ<t._minZ?this._minZ:t._minZ,i._maxX=this._maxX>t._maxX?this._maxX:t._maxX,i._maxY=this._maxY>t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,i}overlap(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ?this._maxZ>t._minZ:!1}getIntersection(t){let i=new m.collision.geometry.Aabb;return i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,i}getIntersectionTo(t,i){i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ}copyFrom(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this}clone(){let t=new m.collision.geometry.Aabb;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t}};m.collision.geometry.BoxGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t){super(1),this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();let i=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>i*.2&&(this._gjkMargin=i*.2)}getHalfExtents(){let t=new m.common.Vec3;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,t}getHalfExtentsTo(t){t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){this._volume=8*(this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ);let t,i,s;t=this._halfExtentsX*this._halfExtentsX,i=this._halfExtentsY*this._halfExtentsY,s=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(i+s),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(s+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+i)}_computeAabb(t,i){let s,_,n,l,o,r,e,a,h,b,X,c;b=i._rotation00*this._halfAxisXX+i._rotation01*this._halfAxisXY+i._rotation02*this._halfAxisXZ,X=i._rotation10*this._halfAxisXX+i._rotation11*this._halfAxisXY+i._rotation12*this._halfAxisXZ,c=i._rotation20*this._halfAxisXX+i._rotation21*this._halfAxisXY+i._rotation22*this._halfAxisXZ,s=b,_=X,n=c;let u,p,x;u=i._rotation00*this._halfAxisYX+i._rotation01*this._halfAxisYY+i._rotation02*this._halfAxisYZ,p=i._rotation10*this._halfAxisYX+i._rotation11*this._halfAxisYY+i._rotation12*this._halfAxisYZ,x=i._rotation20*this._halfAxisYX+i._rotation21*this._halfAxisYY+i._rotation22*this._halfAxisYZ,l=u,o=p,r=x;let v,f,g;v=i._rotation00*this._halfAxisZX+i._rotation01*this._halfAxisZY+i._rotation02*this._halfAxisZZ,f=i._rotation10*this._halfAxisZX+i._rotation11*this._halfAxisZY+i._rotation12*this._halfAxisZZ,g=i._rotation20*this._halfAxisZX+i._rotation21*this._halfAxisZY+i._rotation22*this._halfAxisZZ,e=v,a=f,h=g,s<0&&(s=-s),_<0&&(_=-_),n<0&&(n=-n),l<0&&(l=-l),o<0&&(o=-o),r<0&&(r=-r),e<0&&(e=-e),a<0&&(a=-a),h<0&&(h=-h);let V,Z,I;V=s+l,Z=_+o,I=n+r,V+=e,Z+=a,I+=h,t._minX=i._positionX-V,t._minY=i._positionY-Z,t._minZ=i._positionZ-I,t._maxX=i._positionX+V,t._maxY=i._positionY+Z,t._maxZ=i._positionZ+I}computeLocalSupportingVertex(t,i){let s,_,n,l,o,r;s=this._gjkMargin,_=this._gjkMargin,n=this._gjkMargin,s<this._halfExtentsX||(s=this._halfExtentsX),_<this._halfExtentsY||(_=this._halfExtentsY),n<this._halfExtentsZ||(n=this._halfExtentsZ),l=this._halfExtentsX-s,o=this._halfExtentsY-_,r=this._halfExtentsZ-n,i.x=t.x>0?l:-l,i.y=t.y>0?o:-o,i.z=t.z>0?r:-r}_rayCastLocal(t,i,s,_,n,l,o){let r=this._halfExtentsX,e=this._halfExtentsY,a=this._halfExtentsZ,h=_-t,b=n-i,X=l-s,c=0,u=0,p=0,x=1,v=1,f=1;if(h>-1e-6&&h<1e-6){if(t<=-r||t>=r)return!1}else{let I=1/h,M=(-r-t)*I,y=(r-t)*I;if(M>y){let d=M;M=y,y=d}M>0&&(c=M),y<1&&(x=y)}if(b>-1e-6&&b<1e-6){if(i<=-e||i>=e)return!1}else{let I=1/b,M=(-e-i)*I,y=(e-i)*I;if(M>y){let d=M;M=y,y=d}M>0&&(u=M),y<1&&(v=y)}if(X>-1e-6&&X<1e-6){if(s<=-a||s>=a)return!1}else{let I=1/X,M=(-a-s)*I,y=(a-s)*I;if(M>y){let d=M;M=y,y=d}M>0&&(p=M),y<1&&(f=y)}if(c>=1||u>=1||p>=1||x<=0||v<=0||f<=0)return!1;let g=c,V=x,Z=0;if(u>g&&(g=u,Z=1),p>g&&(g=p,Z=2),v<V&&(V=v),f<V&&(V=f),g>V||g==0)return!1;switch(Z){case 0:o.normal.init(h>0?-1:1,0,0);break;case 1:o.normal.init(0,b>0?-1:1,0);break;case 2:o.normal.init(0,0,X>0?-1:1);break}return o.position.init(t+g*h,i+g*b,s+g*X),o.fraction=g,!0}};m.collision.geometry.CapsuleGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t,i){super(4),this._radius=t,this._halfHeight=i,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight,s=6.28318530717958*t*this._halfHeight,_=3.14159265358979*t*this._radius*4/3;this._volume=s+_;let n=this._volume==0?0:1/this._volume,l=n*(s*(t*.25+i/3)+_*(t*.4+this._halfHeight*this._radius*.75+i));this._inertiaCoeff00=l,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=n*(s*t*.5+_*t*.4),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=l}_computeAabb(t,i){let s,_,n;s=this._radius,_=this._radius,n=this._radius;let l,o,r;l=i._rotation01,o=i._rotation11,r=i._rotation21,l<0&&(l=-l),o<0&&(o=-o),r<0&&(r=-r),l*=this._halfHeight,o*=this._halfHeight,r*=this._halfHeight,s+=l,_+=o,n+=r,t._minX=i._positionX-s,t._minY=i._positionY-_,t._minZ=i._positionZ-n,t._maxX=i._positionX+s,t._maxY=i._positionY+_,t._maxZ=i._positionZ+n}computeLocalSupportingVertex(t,i){t.y>0?i.init(0,this._halfHeight,0):i.init(0,-this._halfHeight,0)}_rayCastLocal(t,i,s,_,n,l,o){let r=this._halfHeight,e=_-t,a=l-s,h=0,b,X=e*e+a*a,c=t*e+s*a,u=t*t+s*s-this._radius*this._radius,p=c*c-X*u;if(p<0)return!1;if(X>0){let q=Math.sqrt(p);if(h=(-c-q)/X,b=(-c+q)/X,h>=1||b<=0)return!1}else{if(u>=0)return!1;h=0}let x=i+(n-i)*h,v;if(x>-r&&x<r){if(h>0){v=h;let q=o.normal.init(t+e*v,0,s+a*v),U=Math.sqrt(q.x*q.x+q.y*q.y+q.z*q.z);return U>0&&(U=1/U),q.x*=U,q.y*=U,q.z*=U,o.position.init(t+v*e,x,s+v*a),o.fraction=v,!0}return!1}let f,g,V,Z,I,M;f=0,g=x<0?-r:r,V=0,Z=t-f,I=i-g,M=s-V;let y,d,B;if(y=_-t,d=n-i,B=l-s,X=y*y+d*d+B*B,c=Z*y+I*d+M*B,u=Z*Z+I*I+M*M-this._radius*this._radius,p=c*c-X*u,p<0)return!1;let R=(-c-Math.sqrt(p))/X;if(R<0||R>1)return!1;let k,A,z,w,S,P;k=Z+y*R,A=I+d*R,z=M+B*R;let T=k*k+A*A+z*z;T>0&&(T=1/Math.sqrt(T)),w=k*T,S=A*T,P=z*T,k+=f,A+=g,z+=V;let C=o.position;C.x=k,C.y=A,C.z=z;let L=o.normal;return L.x=w,L.y=S,L.z=P,o.fraction=R,!0}};m.collision.geometry.ConeGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t,i){super(3),this._radius=t,this._halfHeight=i,this.sinTheta=t/Math.sqrt(t*t+4*i*i),this.cosTheta=2*i/Math.sqrt(t*t+4*i*i),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*t+2*i)}_computeAabb(t,i){let s,_,n,l,o,r,e,a,h,b,X,c;s=i._rotation01,_=i._rotation11,n=i._rotation21,l=s*s,o=_*_,r=n*n,b=Math.sqrt(1-l),X=Math.sqrt(1-o),c=Math.sqrt(1-r),b*=this._radius,X*=this._radius,c*=this._radius,e=s*this._halfHeight,a=_*this._halfHeight,h=n*this._halfHeight;let u,p,x,v,f,g;u=-e,p=-a,x=-h,u-=b,p-=X,x-=c,v=-e,f=-a,g=-h,v+=b,f+=X,g+=c;let V,Z,I,M,y,d;V=u>v?u:v,Z=p>f?p:f,I=x>g?x:g,V>e||(V=e),Z>a||(Z=a),I>h||(I=h),M=u<v?u:v,y=p<f?p:f,d=x<g?x:g,M<e||(M=e),y<a||(y=a),d<h||(d=h),t._minX=i._positionX+M,t._minY=i._positionY+y,t._minZ=i._positionZ+d,t._maxX=i._positionX+V,t._maxY=i._positionY+Z,t._maxZ=i._positionZ+I}computeLocalSupportingVertex(t,i){let s=t.x,_=t.y,n=t.z;if(_>0&&_*_>this.sinTheta*this.sinTheta*(s*s+_*_+n*n)){i.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),i.y<0&&(i.y=0);return}let l=t.x,o=t.z,r=l*l+o*o,e=2*this._halfHeight,a=(e-this._gjkMargin)/e*this._radius-this._gjkMargin/this.cosTheta;a<0&&(a=0);let h=r>0?a/Math.sqrt(r):0,b=this._halfHeight-this._gjkMargin;b<0&&(b=0),i.x=l*h,i.y=-b,i.z=o*h}_rayCastLocal(t,i,s,_,n,l,o){let r,e=this._halfHeight,a=_-t,h=n-i,b=l-s,X=0,c=1;if(h>-1e-6&&h<1e-6){if(i<=-e||i>=e)return!1}else{let I=1/h,M=(-e-i)*I,y=(e-i)*I;if(M>y){let d=M;M=y,y=d}M>0&&(X=M),y<1&&(c=y)}if(X>=1||c<=0)return!1;let u=0,p=0;r=i-e;let x=this.cosTheta*this.cosTheta,v=x*(a*a+h*h+b*b)-h*h,f=x*(t*a+r*h+s*b)-r*h,g=x*(t*t+r*r+s*s)-r*r,V=f*f-v*g;if(v!=0){if(V<0)return!1;let I=Math.sqrt(V);if(v<0){if(h>0){if(u=0,p=(-f+I)/v,p<=0)return!1}else if(u=(-f-I)/v,p=1,u>=1)return!1}else if(u=(-f-I)/v,p=(-f+I)/v,u>=1||p<=0)return!1}else{let I=-g/(2*f);if(f>0){if(u=0,p=I,I<=0)return!1}else if(u=I,p=1,I>=1)return!1}r+=e;let Z;if(p<=X||c<=u)return!1;if(u<X){if(Z=X,Z==0)return!1;o.normal.init(0,h>0?-1:1,0)}else{if(Z=u,Z==0)return!1;let I=o.normal.init(t+a*Z,0,s+b*Z),M=Math.sqrt(I.x*I.x+I.y*I.y+I.z*I.z);M>0&&(M=1/M),I.x*=M,I.y*=M,I.z*=M;let y=this.cosTheta;I.x*=y,I.y*=y,I.z*=y,o.normal.y+=this.sinTheta}return o.position.init(t+Z*a,r+Z*h,s+Z*b),o.fraction=Z,!0}};m.collision.geometry.ConvexHullGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t){super(5),this._numVertices=t.length,this._vertices=new Array(this._numVertices),this._tmpVertices=new Array(this._numVertices);let i=0,s=this._numVertices;for(;i<s;){let _=i++;this._vertices[_]=t[_],this._tmpVertices[_]=new m.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;let t=this._vertices[0].x,i=this._vertices[0].y,s=this._vertices[0].z,_=this._vertices[0].x,n=this._vertices[0].y,l=this._vertices[0].z,o=1,r=this._numVertices;for(;o<r;){let X=o++,c=this._vertices[X].x,u=this._vertices[X].y,p=this._vertices[X].z;c<t?t=c:c>_&&(_=c),u<i?i=u:u>n&&(n=u),p<s?s=p:p>l&&(l=p)}let e=_-t,a=n-i,h=l-s;this._volume=e*a*h;let b=((t+_)*(t+_)+(i+n)*(i+n)+(s+l)*(s+l))*.25;e=e*e*.25,a=a*a*.25,h=h*h*.25,this._inertiaCoeff00=.3333333333333333*(a+h)+b,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(h+e)+b,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(e+a)+b}_computeAabb(t,i){let s,_,n,l,o,r,e,a,h;e=this._gjkMargin,a=this._gjkMargin,h=this._gjkMargin;let b,X,c,u=this._vertices[0];b=u.x,X=u.y,c=u.z;let p,x,v,f,g,V;f=i._rotation00*b+i._rotation01*X+i._rotation02*c,g=i._rotation10*b+i._rotation11*X+i._rotation12*c,V=i._rotation20*b+i._rotation21*X+i._rotation22*c,p=f,x=g,v=V,p+=i._positionX,x+=i._positionY,v+=i._positionZ,s=p,_=x,n=v,l=p,o=x,r=v;let Z=1,I=this._numVertices;for(;Z<I;){let M=this._vertices[Z++];b=M.x,X=M.y,c=M.z;let y,d,B;y=i._rotation00*b+i._rotation01*X+i._rotation02*c,d=i._rotation10*b+i._rotation11*X+i._rotation12*c,B=i._rotation20*b+i._rotation21*X+i._rotation22*c,p=y,x=d,v=B,p+=i._positionX,x+=i._positionY,v+=i._positionZ,s<p||(s=p),_<x||(_=x),n<v||(n=v),l>p||(l=p),o>x||(o=x),r>v||(r=v)}t._minX=s-e,t._minY=_-a,t._minZ=n-h,t._maxX=l+e,t._maxY=o+a,t._maxZ=r+h}computeLocalSupportingVertex(t,i){let s=this._vertices[0],_=s.x*t.x+s.y*t.y+s.z*t.z,n=0,l=1,o=this._numVertices;for(;l<o;){let e=l++,a=this._vertices[e],h=a.x*t.x+a.y*t.y+a.z*t.z;h>_&&(_=h,n=e)}let r=this._vertices[n];i.x=r.x,i.y=r.y,i.z=r.z}};m.collision.geometry.CylinderGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t,i){super(2),this._radius=t,this._halfHeight=i,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+i)}_computeAabb(t,i){let s,_,n,l,o,r,e,a,h,b,X,c;s=i._rotation01,_=i._rotation11,n=i._rotation21,s<0&&(s=-s),_<0&&(_=-_),n<0&&(n=-n),l=s*s,o=_*_,r=n*n,b=Math.sqrt(1-l),X=Math.sqrt(1-o),c=Math.sqrt(1-r),b*=this._radius,X*=this._radius,c*=this._radius,e=s*this._halfHeight,a=_*this._halfHeight,h=n*this._halfHeight;let u,p,x;u=b+e,p=X+a,x=c+h,t._minX=i._positionX-u,t._minY=i._positionY-p,t._minZ=i._positionZ-x,t._maxX=i._positionX+u,t._maxY=i._positionY+p,t._maxZ=i._positionZ+x}computeLocalSupportingVertex(t,i){let s=t.x,_=t.z,n=s*s+_*_,l=this._radius-this._gjkMargin;l<0&&(l=0);let o=n>0?l/Math.sqrt(n):0,r=this._halfHeight-this._gjkMargin;r<0&&(r=0),i.x=s*o,i.y=t.y>0?r:-r,i.z=_*o}_rayCastLocal(t,i,s,_,n,l,o){let r=this._halfHeight,e=_-t,a=n-i,h=l-s,b=0,X=1;if(a>-1e-6&&a<1e-6){if(i<=-r||i>=r)return!1}else{let V=1/a,Z=(-r-i)*V,I=(r-i)*V;if(Z>I){let M=Z;Z=I,I=M}Z>0&&(b=Z),I<1&&(X=I)}if(b>=1||X<=0)return!1;let c=0,u,p=e*e+h*h,x=t*e+s*h,v=t*t+s*s-this._radius*this._radius,f=x*x-p*v;if(f<0)return!1;if(p>0){let V=Math.sqrt(f);if(c=(-x-V)/p,u=(-x+V)/p,c>=1||u<=0)return!1}else{if(v>=0)return!1;c=0,u=1}let g;if(u<=b||X<=c)return!1;if(c<b){if(g=b,g==0)return!1;o.normal.init(0,a>0?-1:1,0)}else{if(g=c,g==0)return!1;let V=o.normal.init(t+e*g,0,s+h*g),Z=Math.sqrt(V.x*V.x+V.y*V.y+V.z*V.z);Z>0&&(Z=1/Z),V.x*=Z,V.y*=Z,V.z*=Z}return o.position.init(t+g*e,i+g*a,s+g*h),o.fraction=g,!0}};m.collision.geometry.GeometryType=class{};m.collision.geometry.RayCastHit=class{constructor(){this.position=new m.common.Vec3,this.normal=new m.common.Vec3,this.fraction=0}};m.collision.geometry.SphereGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t){super(0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(t,i){let s,_,n;s=this._radius,_=this._radius,n=this._radius,t._minX=i._positionX-s,t._minY=i._positionY-_,t._minZ=i._positionZ-n,t._maxX=i._positionX+s,t._maxY=i._positionY+_,t._maxZ=i._positionZ+n}computeLocalSupportingVertex(t,i){i.zero()}_rayCastLocal(t,i,s,_,n,l,o){let r,e,a;r=_-t,e=n-i,a=l-s;let h=r*r+e*e+a*a,b=t*r+i*e+s*a,X=b*b-h*(t*t+i*i+s*s-this._radius*this._radius);if(X<0)return!1;let c=(-b-Math.sqrt(X))/h;if(c<0||c>1)return!1;let u,p,x,v,f,g;u=t+r*c,p=i+e*c,x=s+a*c;let V=u*u+p*p+x*x;V>0&&(V=1/Math.sqrt(V)),v=u*V,f=p*V,g=x*V;let Z=o.position;Z.x=u,Z.y=p,Z.z=x;let I=o.normal;return I.x=v,I.y=f,I.z=g,o.fraction=c,!0}};m.collision.narrowphase||(m.collision.narrowphase={});m.collision.narrowphase.CollisionMatrix=class{constructor(){this.detectors=new Array(8),this.detectors[0]=new Array(8),this.detectors[1]=new Array(8),this.detectors[2]=new Array(8),this.detectors[3]=new Array(8),this.detectors[4]=new Array(8),this.detectors[5]=new Array(8);let t=new m.collision.narrowphase.detector.GjkEpaDetector;this.detectors[0][0]=new m.collision.narrowphase.detector.SphereSphereDetector,this.detectors[0][1]=new m.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[0][2]=t,this.detectors[0][3]=t,this.detectors[0][4]=new m.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[0][5]=t,this.detectors[1][0]=new m.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[1][1]=new m.collision.narrowphase.detector.BoxBoxDetector,this.detectors[1][2]=t,this.detectors[1][3]=t,this.detectors[1][4]=t,this.detectors[1][5]=t,this.detectors[2][0]=t,this.detectors[2][1]=t,this.detectors[2][2]=t,this.detectors[2][3]=t,this.detectors[2][4]=t,this.detectors[2][5]=t,this.detectors[3][0]=t,this.detectors[3][1]=t,this.detectors[3][2]=t,this.detectors[3][3]=t,this.detectors[3][4]=t,this.detectors[3][5]=t,this.detectors[4][0]=new m.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[4][1]=t,this.detectors[4][2]=t,this.detectors[4][3]=t,this.detectors[4][4]=new m.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[4][5]=t,this.detectors[5][0]=t,this.detectors[5][1]=t,this.detectors[5][2]=t,this.detectors[5][3]=t,this.detectors[5][4]=t,this.detectors[5][5]=t}getDetector(t,i){return this.detectors[t][i]}};m.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new m.common.Vec3,this.points=new Array(m.common.Setting.maxManifoldPoints),this.incremental=!1;let t=0,i=m.common.Setting.maxManifoldPoints;for(;t<i;)this.points[t++]=new m.collision.narrowphase.DetectorResultPoint}getMaxDepth(){let t=0,i=0,s=this.numPoints;for(;i<s;){let _=i++;this.points[_].depth>t&&(t=this.points[_].depth)}return t}clear(){this.numPoints=0;let t=0,i=this.points;for(;t<i.length;){let s=i[t];++t,s.position1.zero(),s.position2.zero(),s.depth=0,s.id=0}this.normal.zero()}};m.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new m.common.Vec3,this.position2=new m.common.Vec3,this.depth=0,this.id=0}};m.collision.narrowphase.detector||(m.collision.narrowphase.detector={});m.collision.narrowphase.detector.Detector=class{constructor(t){this.swapped=t}setNormal(t,i,s,_){let n=t.normal;if(n.x=i,n.y=s,n.z=_,this.swapped){let l=t.normal;l.x=-l.x,l.y=-l.y,l.z=-l.z}}addPoint(t,i,s,_,n,l,o,r,e){let a=t.points[t.numPoints++];if(a.depth=r,a.id=e,this.swapped){let h=a.position1;h.x=n,h.y=l,h.z=o;let b=a.position2;b.x=i,b.y=s,b.z=_}else{let h=a.position1;h.x=i,h.y=s,h.z=_;let b=a.position2;b.x=n,b.y=l,b.z=o}}detectImpl(t,i,s,_,n,l){}detect(t,i,s,_,n,l){t.numPoints=0;let o=0,r=t.points;for(;o<r.length;){let e=r[o];++o,e.position1.zero(),e.position2.zero(),e.depth=0,e.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,s,i,n,_,l):this.detectImpl(t,i,s,_,n,l)}};m.collision.narrowphase.detector.BoxBoxDetector=class extends m.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new m.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(t,i,s,_,n,l){let o=i,r=s;t.incremental=!1;let e,a,h,b,X,c,u,p,x;e=_._positionX,a=_._positionY,h=_._positionZ,b=n._positionX,X=n._positionY,c=n._positionZ,u=b-e,p=X-a,x=c-h;let v,f,g,V,Z,I,M,y,d,B,R,k,A,z,w,S,P,T;v=_._rotation00,f=_._rotation10,g=_._rotation20,V=_._rotation01,Z=_._rotation11,I=_._rotation21,M=_._rotation02,y=_._rotation12,d=_._rotation22,B=n._rotation00,R=n._rotation10,k=n._rotation20,A=n._rotation01,z=n._rotation11,w=n._rotation21,S=n._rotation02,P=n._rotation12,T=n._rotation22;let C=o._halfExtentsX,L=o._halfExtentsY,q=o._halfExtentsZ,U=r._halfExtentsX,Y=r._halfExtentsY,E=r._halfExtentsZ,D,Q,W,F,H,G,J,N,K,O,$,et,st,lt,rt,at,_t,ht;D=v*C,Q=f*C,W=g*C,F=V*L,H=Z*L,G=I*L,J=M*q,N=y*q,K=d*q,O=B*U,$=R*U,et=k*U,st=A*Y,lt=z*Y,rt=w*Y,at=S*E,_t=P*E,ht=T*E;let ot=1/0,bt=-1,Xt=0,ft,ut,xt;ft=0,ut=0,xt=0;let zt=C,gt=v*O+f*$+g*et,pt=v*st+f*lt+g*rt,ct=v*at+f*_t+g*ht;gt<0&&(gt=-gt),pt<0&&(pt=-pt),ct<0&&(ct=-ct);let nt=gt+pt+ct,tt=v*u+f*p+g*x,kt=zt+nt,Bt=tt<0,Mt=Bt?-tt:tt;if(Mt<kt){let jt=kt-Mt;jt<1/0&&(ot=jt,bt=0,ft=v,ut=f,xt=g,Xt=Bt?-1:1)}else return;zt=L;let Rt=V*O+Z*$+I*et,ci=V*st+Z*lt+I*rt,Xi=V*at+Z*_t+I*ht;Rt<0&&(Rt=-Rt),ci<0&&(ci=-ci),Xi<0&&(Xi=-Xi),nt=Rt+ci+Xi,tt=V*u+Z*p+I*x;let gi=zt+nt,ki=tt<0,wi=ki?-tt:tt;if(wi<gi){let jt=gi-wi;jt<ot&&(ot=jt,bt=1,ft=V,ut=Z,xt=I,Xt=ki?-1:1)}else return;zt=q;let ei=M*O+y*$+d*et,Nt=M*st+y*lt+d*rt,At=M*at+y*_t+d*ht;ei<0&&(ei=-ei),Nt<0&&(Nt=-Nt),At<0&&(At=-At),nt=ei+Nt+At,tt=M*u+y*p+d*x;let ni=zt+nt,di=tt<0,Oi=di?-tt:tt;if(Oi<ni){let jt=ni-Oi;jt<ot&&(ot=jt,bt=2,ft=M,ut=y,xt=d,Xt=di?-1:1)}else return;ot>m.common.Setting.linearSlop?ot-=m.common.Setting.linearSlop:ot=0;let Bi=B*D+R*Q+k*W,Vt=B*F+R*H+k*G,wt=B*J+R*N+k*K;Bi<0&&(Bi=-Bi),Vt<0&&(Vt=-Vt),wt<0&&(wt=-wt),zt=Bi+Vt+wt,nt=U,tt=B*u+R*p+k*x;let $t=zt+nt,fi=tt<0,Zi=fi?-tt:tt;if(Zi<$t){let jt=$t-Zi;jt<ot&&(ot=jt,bt=3,ft=B,ut=R,xt=k,Xt=fi?-1:1)}else return;let it=A*D+z*Q+w*W,Ut=A*F+z*H+w*G,ii=A*J+z*N+w*K;it<0&&(it=-it),Ut<0&&(Ut=-Ut),ii<0&&(ii=-ii),zt=it+Ut+ii,nt=Y,tt=A*u+z*p+w*x;let j=zt+nt,Jt=tt<0,Pt=Jt?-tt:tt;if(Pt<j){let jt=j-Pt;jt<ot&&(ot=jt,bt=4,ft=A,ut=z,xt=w,Xt=Jt?-1:1)}else return;let si=S*D+P*Q+T*W,_i=S*F+P*H+T*G,St=S*J+P*N+T*K;si<0&&(si=-si),_i<0&&(_i=-_i),St<0&&(St=-St),zt=si+_i+St,nt=E,tt=S*u+P*p+T*x;let ai=zt+nt,qi=tt<0,ui=qi?-tt:tt;if(ui<ai){let jt=ai-ui;jt<ot&&(ot=jt,bt=5,ft=S,ut=P,xt=T,Xt=qi?-1:1)}else return;ot>m.common.Setting.linearSlop?ot-=m.common.Setting.linearSlop:ot=0;let Yt,yt,vt;if(Yt=f*k-g*R,yt=g*B-v*k,vt=v*R-f*B,!(Yt==0&&yt==0&&vt==0)){let jt=Yt*Yt+yt*yt+vt*vt;jt>0&&(jt=1/Math.sqrt(jt)),Yt*=jt,yt*=jt,vt*=jt;let hi=Yt*F+yt*H+vt*G,qt=Yt*J+yt*N+vt*K;hi<0&&(hi=-hi),qt<0&&(qt=-qt),zt=hi+qt;let mt=Yt*st+yt*lt+vt*rt,Zt=Yt*at+yt*_t+vt*ht;mt<0&&(mt=-mt),Zt<0&&(Zt=-Zt),nt=mt+Zt,tt=Yt*u+yt*p+vt*x;let Et=zt+nt,Ft=tt<0,Wt=Ft?-tt:tt;if(Wt<Et){let Kt=Et-Wt;Kt<ot&&(ot=Kt,bt=6,ft=Yt,ut=yt,xt=vt,Xt=Ft?-1:1)}else return}if(Yt=f*w-g*z,yt=g*A-v*w,vt=v*z-f*A,!(Yt==0&&yt==0&&vt==0)){let jt=Yt*Yt+yt*yt+vt*vt;jt>0&&(jt=1/Math.sqrt(jt)),Yt*=jt,yt*=jt,vt*=jt;let hi=Yt*F+yt*H+vt*G,qt=Yt*J+yt*N+vt*K;hi<0&&(hi=-hi),qt<0&&(qt=-qt),zt=hi+qt;let mt=Yt*O+yt*$+vt*et,Zt=Yt*at+yt*_t+vt*ht;mt<0&&(mt=-mt),Zt<0&&(Zt=-Zt),nt=mt+Zt,tt=Yt*u+yt*p+vt*x;let Et=zt+nt,Ft=tt<0,Wt=Ft?-tt:tt;if(Wt<Et){let Kt=Et-Wt;Kt<ot&&(ot=Kt,bt=7,ft=Yt,ut=yt,xt=vt,Xt=Ft?-1:1)}else return}if(Yt=f*T-g*P,yt=g*S-v*T,vt=v*P-f*S,!(Yt==0&&yt==0&&vt==0)){let jt=Yt*Yt+yt*yt+vt*vt;jt>0&&(jt=1/Math.sqrt(jt)),Yt*=jt,yt*=jt,vt*=jt;let hi=Yt*F+yt*H+vt*G,qt=Yt*J+yt*N+vt*K;hi<0&&(hi=-hi),qt<0&&(qt=-qt),zt=hi+qt;let mt=Yt*O+yt*$+vt*et,Zt=Yt*st+yt*lt+vt*rt;mt<0&&(mt=-mt),Zt<0&&(Zt=-Zt),nt=mt+Zt,tt=Yt*u+yt*p+vt*x;let Et=zt+nt,Ft=tt<0,Wt=Ft?-tt:tt;if(Wt<Et){let Kt=Et-Wt;Kt<ot&&(ot=Kt,bt=8,ft=Yt,ut=yt,xt=vt,Xt=Ft?-1:1)}else return}if(Yt=Z*k-I*R,yt=I*B-V*k,vt=V*R-Z*B,!(Yt==0&&yt==0&&vt==0)){let jt=Yt*Yt+yt*yt+vt*vt;jt>0&&(jt=1/Math.sqrt(jt)),Yt*=jt,yt*=jt,vt*=jt;let hi=Yt*D+yt*Q+vt*W,qt=Yt*J+yt*N+vt*K;hi<0&&(hi=-hi),qt<0&&(qt=-qt),zt=hi+qt;let mt=Yt*st+yt*lt+vt*rt,Zt=Yt*at+yt*_t+vt*ht;mt<0&&(mt=-mt),Zt<0&&(Zt=-Zt),nt=mt+Zt,tt=Yt*u+yt*p+vt*x;let Et=zt+nt,Ft=tt<0,Wt=Ft?-tt:tt;if(Wt<Et){let Kt=Et-Wt;Kt<ot&&(ot=Kt,bt=9,ft=Yt,ut=yt,xt=vt,Xt=Ft?-1:1)}else return}if(Yt=Z*w-I*z,yt=I*A-V*w,vt=V*z-Z*A,!(Yt==0&&yt==0&&vt==0)){let jt=Yt*Yt+yt*yt+vt*vt;jt>0&&(jt=1/Math.sqrt(jt)),Yt*=jt,yt*=jt,vt*=jt;let hi=Yt*D+yt*Q+vt*W,qt=Yt*J+yt*N+vt*K;hi<0&&(hi=-hi),qt<0&&(qt=-qt),zt=hi+qt;let mt=Yt*O+yt*$+vt*et,Zt=Yt*at+yt*_t+vt*ht;mt<0&&(mt=-mt),Zt<0&&(Zt=-Zt),nt=mt+Zt,tt=Yt*u+yt*p+vt*x;let Et=zt+nt,Ft=tt<0,Wt=Ft?-tt:tt;if(Wt<Et){let Kt=Et-Wt;Kt<ot&&(ot=Kt,bt=10,ft=Yt,ut=yt,xt=vt,Xt=Ft?-1:1)}else return}if(Yt=Z*T-I*P,yt=I*S-V*T,vt=V*P-Z*S,!(Yt==0&&yt==0&&vt==0)){let jt=Yt*Yt+yt*yt+vt*vt;jt>0&&(jt=1/Math.sqrt(jt)),Yt*=jt,yt*=jt,vt*=jt;let hi=Yt*D+yt*Q+vt*W,qt=Yt*J+yt*N+vt*K;hi<0&&(hi=-hi),qt<0&&(qt=-qt),zt=hi+qt;let mt=Yt*O+yt*$+vt*et,Zt=Yt*st+yt*lt+vt*rt;mt<0&&(mt=-mt),Zt<0&&(Zt=-Zt),nt=mt+Zt,tt=Yt*u+yt*p+vt*x;let Et=zt+nt,Ft=tt<0,Wt=Ft?-tt:tt;if(Wt<Et){let Kt=Et-Wt;Kt<ot&&(ot=Kt,bt=11,ft=Yt,ut=yt,xt=vt,Xt=Ft?-1:1)}else return}if(Yt=y*k-d*R,yt=d*B-M*k,vt=M*R-y*B,!(Yt==0&&yt==0&&vt==0)){let jt=Yt*Yt+yt*yt+vt*vt;jt>0&&(jt=1/Math.sqrt(jt)),Yt*=jt,yt*=jt,vt*=jt;let hi=Yt*D+yt*Q+vt*W,qt=Yt*F+yt*H+vt*G;hi<0&&(hi=-hi),qt<0&&(qt=-qt),zt=hi+qt;let mt=Yt*st+yt*lt+vt*rt,Zt=Yt*at+yt*_t+vt*ht;mt<0&&(mt=-mt),Zt<0&&(Zt=-Zt),nt=mt+Zt,tt=Yt*u+yt*p+vt*x;let Et=zt+nt,Ft=tt<0,Wt=Ft?-tt:tt;if(Wt<Et){let Kt=Et-Wt;Kt<ot&&(ot=Kt,bt=12,ft=Yt,ut=yt,xt=vt,Xt=Ft?-1:1)}else return}if(Yt=y*w-d*z,yt=d*A-M*w,vt=M*z-y*A,!(Yt==0&&yt==0&&vt==0)){let jt=Yt*Yt+yt*yt+vt*vt;jt>0&&(jt=1/Math.sqrt(jt)),Yt*=jt,yt*=jt,vt*=jt;let hi=Yt*D+yt*Q+vt*W,qt=Yt*F+yt*H+vt*G;hi<0&&(hi=-hi),qt<0&&(qt=-qt),zt=hi+qt;let mt=Yt*O+yt*$+vt*et,Zt=Yt*at+yt*_t+vt*ht;mt<0&&(mt=-mt),Zt<0&&(Zt=-Zt),nt=mt+Zt,tt=Yt*u+yt*p+vt*x;let Et=zt+nt,Ft=tt<0,Wt=Ft?-tt:tt;if(Wt<Et){let Kt=Et-Wt;Kt<ot&&(ot=Kt,bt=13,ft=Yt,ut=yt,xt=vt,Xt=Ft?-1:1)}else return}if(Yt=y*T-d*P,yt=d*S-M*T,vt=M*P-y*S,!(Yt==0&&yt==0&&vt==0)){let jt=Yt*Yt+yt*yt+vt*vt;jt>0&&(jt=1/Math.sqrt(jt)),Yt*=jt,yt*=jt,vt*=jt;let hi=Yt*D+yt*Q+vt*W,qt=Yt*F+yt*H+vt*G;hi<0&&(hi=-hi),qt<0&&(qt=-qt),zt=hi+qt;let mt=Yt*O+yt*$+vt*et,Zt=Yt*st+yt*lt+vt*rt;mt<0&&(mt=-mt),Zt<0&&(Zt=-Zt),nt=mt+Zt,tt=Yt*u+yt*p+vt*x;let Et=zt+nt,Ft=tt<0,Wt=Ft?-tt:tt;if(Wt<Et){let Kt=Et-Wt;Kt<ot&&(ot=Kt,bt=14,ft=Yt,ut=yt,xt=vt,Xt=Ft?-1:1)}else return}if(bt>=6){ft*=Xt,ut*=Xt,xt*=Xt;let jt=(bt-6)/3|0,hi=bt-6-jt*3,qt,mt,Zt,Et,Ft,Wt,Kt,li,Yi,pi,Ot,It;switch(jt){case 0:Kt=v,li=f,Yi=g;let we=J*ft+N*ut+K*xt>0;F*ft+H*ut+G*xt>0?we?(qt=F+J,mt=H+N,Zt=G+K):(qt=F-J,mt=H-N,Zt=G-K):we?(qt=J-F,mt=N-H,Zt=K-G):(qt=F+J,mt=H+N,Zt=G+K,qt=-qt,mt=-mt,Zt=-Zt);break;case 1:Kt=V,li=Z,Yi=I;let Ve=J*ft+N*ut+K*xt>0;D*ft+Q*ut+W*xt>0?Ve?(qt=D+J,mt=Q+N,Zt=W+K):(qt=D-J,mt=Q-N,Zt=W-K):Ve?(qt=J-D,mt=N-Q,Zt=K-W):(qt=D+J,mt=Q+N,Zt=W+K,qt=-qt,mt=-mt,Zt=-Zt);break;default:Kt=M,li=y,Yi=d;let Le=F*ft+H*ut+G*xt>0;D*ft+Q*ut+W*xt>0?Le?(qt=D+F,mt=Q+H,Zt=W+G):(qt=D-F,mt=Q-H,Zt=W-G):Le?(qt=F-D,mt=H-Q,Zt=G-W):(qt=D+F,mt=Q+H,Zt=W+G,qt=-qt,mt=-mt,Zt=-Zt)}switch(qt=e+qt,mt=a+mt,Zt=h+Zt,hi){case 0:pi=B,Ot=R,It=k;let we=at*ft+_t*ut+ht*xt>0;st*ft+lt*ut+rt*xt>0?we?(Et=st+at,Ft=lt+_t,Wt=rt+ht):(Et=st-at,Ft=lt-_t,Wt=rt-ht):we?(Et=at-st,Ft=_t-lt,Wt=ht-rt):(Et=st+at,Ft=lt+_t,Wt=rt+ht,Et=-Et,Ft=-Ft,Wt=-Wt);break;case 1:pi=A,Ot=z,It=w;let Ve=at*ft+_t*ut+ht*xt>0;O*ft+$*ut+et*xt>0?Ve?(Et=O+at,Ft=$+_t,Wt=et+ht):(Et=O-at,Ft=$-_t,Wt=et-ht):Ve?(Et=at-O,Ft=_t-$,Wt=ht-et):(Et=O+at,Ft=$+_t,Wt=et+ht,Et=-Et,Ft=-Ft,Wt=-Wt);break;default:pi=S,Ot=P,It=T;let Le=st*ft+lt*ut+rt*xt>0;O*ft+$*ut+et*xt>0?Le?(Et=O+st,Ft=$+lt,Wt=et+rt):(Et=O-st,Ft=$-lt,Wt=et-rt):Le?(Et=st-O,Ft=lt-$,Wt=rt-et):(Et=O+st,Ft=$+lt,Wt=et+rt,Et=-Et,Ft=-Ft,Wt=-Wt)}Et=b-Et,Ft=X-Ft,Wt=c-Wt;let Qt,xi,Ri;Qt=qt-Et,xi=mt-Ft,Ri=Zt-Wt;let ee=Kt*pi+li*Ot+Yi*It,oe=Kt*Qt+li*xi+Yi*Ri,Qi=pi*Qt+Ot*xi+It*Ri,te=1/(1-ee*ee),Gi=(ee*Qi-oe)*te,Ci=(Qi-ee*oe)*te,le,fe,Xe,Ze,ye,Ce;le=qt+Kt*Gi,fe=mt+li*Gi,Xe=Zt+Yi*Gi,Ze=Et+pi*Ci,ye=Ft+Ot*Ci,Ce=Wt+It*Ci;let je,Re,qe;je=-ft,Re=-ut,qe=-xt,this.setNormal(t,je,Re,qe),this.addPoint(t,le,fe,Xe,Ze,ye,Ce,ot,4);return}let yi,Ii,bi,se;bt>=3?(Xt=-Xt,u=-u,p=-p,x=-x,C=U,L=Y,q=E,e=b,a=X,h=c,yi=v,Ii=f,bi=g,v=B,f=R,g=k,B=yi,R=Ii,k=bi,yi=V,Ii=Z,bi=I,V=A,Z=z,I=w,A=yi,z=Ii,w=bi,yi=M,Ii=y,bi=d,M=S,y=P,d=T,S=yi,P=Ii,T=bi,yi=D,Ii=Q,bi=W,D=O,Q=$,W=et,O=yi,$=Ii,et=bi,yi=F,Ii=H,bi=G,F=st,H=lt,G=rt,st=yi,lt=Ii,rt=bi,yi=J,Ii=N,bi=K,J=at,N=_t,K=ht,at=yi,_t=Ii,ht=bi,bt-=3,se=!0):se=!1;let me,Ei,he,ve,oi,ce,be,xe,Ye,Ni,Ji,Hi,_e,ne;switch(bt){case 0:me=D,Ei=Q,he=W,ve=v,oi=f,ce=g,be=V,xe=Z,Ye=I,Ni=M,Ji=y,Hi=d,_e=L,ne=q;break;case 1:me=F,Ei=H,he=G,ve=V,oi=Z,ce=I,be=M,xe=y,Ye=d,Ni=v,Ji=f,Hi=g,_e=q,ne=C;break;default:me=J,Ei=N,he=K,ve=M,oi=y,ce=d,be=v,xe=f,Ye=g,Ni=V,Ji=Z,Hi=I,_e=C,ne=L}if(Xt<0){me=-me,Ei=-Ei,he=-he,ve=-ve,oi=-oi,ce=-ce,yi=be,Ii=xe,bi=Ye,be=Ni,xe=Ji,Ye=Hi,Ni=yi,Ji=Ii,Hi=bi;let jt=_e;_e=ne,ne=jt}me+=e,Ei+=a,he+=h;let Ki=1,ie=0,Ui=ve*B+oi*R+ce*k;Ui<Ki&&(Ki=Ui,ie=0),-Ui<Ki&&(Ki=-Ui,ie=1),Ui=ve*A+oi*z+ce*w,Ui<Ki&&(Ki=Ui,ie=2),-Ui<Ki&&(Ki=-Ui,ie=3),Ui=ve*S+oi*P+ce*T,Ui<Ki&&(Ki=Ui,ie=4),-Ui<Ki&&(ie=5);let Wi,Si,Ht,ri,Tt,Mi,zi,Pi,Vi,ji,Gt,dt;switch(ie){case 0:Wi=O+st,Si=$+lt,Ht=et+rt,Wi+=at,Si+=_t,Ht+=ht,ri=O-st,Tt=$-lt,Mi=et-rt,ri+=at,Tt+=_t,Mi+=ht,zi=O-st,Pi=$-lt,Vi=et-rt,zi-=at,Pi-=_t,Vi-=ht,ji=O+st,Gt=$+lt,dt=et+rt,ji-=at,Gt-=_t,dt-=ht;break;case 1:Wi=st-O,Si=lt-$,Ht=rt-et,Wi+=at,Si+=_t,Ht+=ht,ri=st-O,Tt=lt-$,Mi=rt-et,ri-=at,Tt-=_t,Mi-=ht,zi=O+st,Pi=$+lt,Vi=et+rt,zi=-zi,Pi=-Pi,Vi=-Vi,zi-=at,Pi-=_t,Vi-=ht,ji=O+st,Gt=$+lt,dt=et+rt,ji=-ji,Gt=-Gt,dt=-dt,ji+=at,Gt+=_t,dt+=ht;break;case 2:Wi=O+st,Si=$+lt,Ht=et+rt,Wi+=at,Si+=_t,Ht+=ht,ri=O+st,Tt=$+lt,Mi=et+rt,ri-=at,Tt-=_t,Mi-=ht,zi=st-O,Pi=lt-$,Vi=rt-et,zi-=at,Pi-=_t,Vi-=ht,ji=st-O,Gt=lt-$,dt=rt-et,ji+=at,Gt+=_t,dt+=ht;break;case 3:Wi=O-st,Si=$-lt,Ht=et-rt,Wi+=at,Si+=_t,Ht+=ht,ri=O+st,Tt=$+lt,Mi=et+rt,ri=-ri,Tt=-Tt,Mi=-Mi,ri+=at,Tt+=_t,Mi+=ht,zi=O+st,Pi=$+lt,Vi=et+rt,zi=-zi,Pi=-Pi,Vi=-Vi,zi-=at,Pi-=_t,Vi-=ht,ji=O-st,Gt=$-lt,dt=et-rt,ji-=at,Gt-=_t,dt-=ht;break;case 4:Wi=O+st,Si=$+lt,Ht=et+rt,Wi+=at,Si+=_t,Ht+=ht,ri=st-O,Tt=lt-$,Mi=rt-et,ri+=at,Tt+=_t,Mi+=ht,zi=O+st,Pi=$+lt,Vi=et+rt,zi=-zi,Pi=-Pi,Vi=-Vi,zi+=at,Pi+=_t,Vi+=ht,ji=O-st,Gt=$-lt,dt=et-rt,ji+=at,Gt+=_t,dt+=ht;break;default:Wi=O+st,Si=$+lt,Ht=et+rt,Wi-=at,Si-=_t,Ht-=ht,ri=O-st,Tt=$-lt,Mi=et-rt,ri-=at,Tt-=_t,Mi-=ht,zi=O+st,Pi=$+lt,Vi=et+rt,zi=-zi,Pi=-Pi,Vi=-Vi,zi-=at,Pi-=_t,Vi-=ht,ji=st-O,Gt=lt-$,dt=rt-et,ji-=at,Gt-=_t,dt-=ht}Wi+=u,Si+=p,Ht+=x,ri+=u,Tt+=p,Mi+=x,zi+=u,Pi+=p,Vi+=x,ji+=u,Gt+=p,dt+=x;let Lt=this.clipper;Lt.w=_e,Lt.h=ne,Lt.numVertices=0,Lt.numTmpVertices=0;let Ai=this.clipper,Li=Ai.vertices[Ai.numVertices++];Li.x=Wi*be+Si*xe+Ht*Ye,Li.y=Wi*Ni+Si*Ji+Ht*Hi,Li.wx=Wi,Li.wy=Si,Li.wz=Ht;let Di=this.clipper,$i=Di.vertices[Di.numVertices++];$i.x=ri*be+Tt*xe+Mi*Ye,$i.y=ri*Ni+Tt*Ji+Mi*Hi,$i.wx=ri,$i.wy=Tt,$i.wz=Mi;let ae=this.clipper,re=ae.vertices[ae.numVertices++];re.x=zi*be+Pi*xe+Vi*Ye,re.y=zi*Ni+Pi*Ji+Vi*Hi,re.wx=zi,re.wy=Pi,re.wz=Vi;let pe=this.clipper,ti=pe.vertices[pe.numVertices++];ti.x=ji*be+Gt*xe+dt*Ye,ti.y=ji*Ni+Gt*Ji+dt*Hi,ti.wx=ji,ti.wy=Gt,ti.wz=dt,this.clipper.clip(),this.clipper.reduce();let Fi,vi,Ti;se?(Fi=ve,vi=oi,Ti=ce):(Fi=-ve,vi=-oi,Ti=-ce),this.setNormal(t,Fi,vi,Ti);let mi=0,Ct=this.clipper.numVertices;for(;mi<Ct;){let jt=mi++,hi=this.clipper.vertices[jt],qt,mt,Zt;qt=hi.wx,mt=hi.wy,Zt=hi.wz,qt+=e,mt+=a,Zt+=h;let Et,Ft,Wt;Et=me-qt,Ft=Ei-mt,Wt=he-Zt;let Kt=Et*ve+Ft*oi+Wt*ce,li,Yi,pi;li=qt+ve*Kt,Yi=mt+oi*Kt,pi=Zt+ce*Kt,Kt>-m.common.Setting.contactPersistenceThreshold&&(se?this.addPoint(t,qt,mt,Zt,li,Yi,pi,Kt,jt):this.addPoint(t,li,Yi,pi,qt,mt,Zt,Kt,jt))}}};m.collision.narrowphase.detector._BoxBoxDetector||(m.collision.narrowphase.detector._BoxBoxDetector={});m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}};m.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0,this.vertices=new Array(8),this.tmpVertices=new Array(8),this.vertices[0]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){let t=0,i=this.numVertices;for(;t<i;){let X=t++,c=this.vertices[X],u=this.vertices[(X+1)%this.numVertices],p=this.w+c.x,x=this.w+u.x;if(p>0&&x>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz}else if(p>0&&x<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz;let f=p/(p-x),g=this.tmpVertices[this.numTmpVertices++];g.x=c.x+(u.x-c.x)*f,g.y=c.y+(u.y-c.y)*f,g.wx=c.wx+(u.wx-c.wx)*f,g.wy=c.wy+(u.wy-c.wy)*f,g.wz=c.wz+(u.wz-c.wz)*f}else if(p<=0&&x>0){let v=p/(p-x),f=this.tmpVertices[this.numTmpVertices++];f.x=c.x+(u.x-c.x)*v,f.y=c.y+(u.y-c.y)*v,f.wx=c.wx+(u.wx-c.wx)*v,f.wy=c.wy+(u.wy-c.wy)*v,f.wz=c.wz+(u.wz-c.wz)*v}}let s=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=s,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let _=0,n=this.numVertices;for(;_<n;){let X=_++,c=this.vertices[X],u=this.vertices[(X+1)%this.numVertices],p=this.w-c.x,x=this.w-u.x;if(p>0&&x>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz}else if(p>0&&x<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz;let f=p/(p-x),g=this.tmpVertices[this.numTmpVertices++];g.x=c.x+(u.x-c.x)*f,g.y=c.y+(u.y-c.y)*f,g.wx=c.wx+(u.wx-c.wx)*f,g.wy=c.wy+(u.wy-c.wy)*f,g.wz=c.wz+(u.wz-c.wz)*f}else if(p<=0&&x>0){let v=p/(p-x),f=this.tmpVertices[this.numTmpVertices++];f.x=c.x+(u.x-c.x)*v,f.y=c.y+(u.y-c.y)*v,f.wx=c.wx+(u.wx-c.wx)*v,f.wy=c.wy+(u.wy-c.wy)*v,f.wz=c.wz+(u.wz-c.wz)*v}}let l=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=l,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let o=0,r=this.numVertices;for(;o<r;){let X=o++,c=this.vertices[X],u=this.vertices[(X+1)%this.numVertices],p=this.h+c.y,x=this.h+u.y;if(p>0&&x>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz}else if(p>0&&x<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz;let f=p/(p-x),g=this.tmpVertices[this.numTmpVertices++];g.x=c.x+(u.x-c.x)*f,g.y=c.y+(u.y-c.y)*f,g.wx=c.wx+(u.wx-c.wx)*f,g.wy=c.wy+(u.wy-c.wy)*f,g.wz=c.wz+(u.wz-c.wz)*f}else if(p<=0&&x>0){let v=p/(p-x),f=this.tmpVertices[this.numTmpVertices++];f.x=c.x+(u.x-c.x)*v,f.y=c.y+(u.y-c.y)*v,f.wx=c.wx+(u.wx-c.wx)*v,f.wy=c.wy+(u.wy-c.wy)*v,f.wz=c.wz+(u.wz-c.wz)*v}}let e=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=e,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let a=0,h=this.numVertices;for(;a<h;){let X=a++,c=this.vertices[X],u=this.vertices[(X+1)%this.numVertices],p=this.h-c.y,x=this.h-u.y;if(p>0&&x>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz}else if(p>0&&x<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz;let f=p/(p-x),g=this.tmpVertices[this.numTmpVertices++];g.x=c.x+(u.x-c.x)*f,g.y=c.y+(u.y-c.y)*f,g.wx=c.wx+(u.wx-c.wx)*f,g.wy=c.wy+(u.wy-c.wy)*f,g.wz=c.wz+(u.wz-c.wz)*f}else if(p<=0&&x>0){let v=p/(p-x),f=this.tmpVertices[this.numTmpVertices++];f.x=c.x+(u.x-c.x)*v,f.y=c.y+(u.y-c.y)*v,f.wx=c.wx+(u.wx-c.wx)*v,f.wy=c.wy+(u.wy-c.wy)*v,f.wz=c.wz+(u.wz-c.wz)*v}}let b=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=b,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(this.numVertices<4)return;let t=-1/0,i=1/0,s=-1/0,_=1/0,n=null,l=null,o=null,r=null,e=1,a=1,h=-1,b=1,X=0,c=this.numVertices;for(;X<c;){let g=this.vertices[X++],V=g.x*e+g.y*a,Z=g.x*h+g.y*b;V>t&&(t=V,n=g),V<i&&(i=V,l=g),Z>s&&(s=Z,o=g),Z<_&&(_=Z,r=g)}let u=this.tmpVertices[this.numTmpVertices++];u.x=n.x,u.y=n.y,u.wx=n.wx,u.wy=n.wy,u.wz=n.wz;let p=this.tmpVertices[this.numTmpVertices++];p.x=o.x,p.y=o.y,p.wx=o.wx,p.wy=o.wy,p.wz=o.wz;let x=this.tmpVertices[this.numTmpVertices++];x.x=l.x,x.y=l.y,x.wx=l.wx,x.wy=l.wy,x.wz=l.wz;let v=this.tmpVertices[this.numTmpVertices++];v.x=r.x,v.y=r.y,v.wx=r.wx,v.wy=r.wy,v.wz=r.wz;let f=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=f,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}};m.collision.narrowphase.detector.BoxBoxDetectorMacro=class{};m.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){this._gjkCache!=null&&this._gjkCache.clear()}};m.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends m.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,_,n,l){let o=i,r=s;t.incremental=!1;let e,a,h,b,X,c;e=_._rotation01,a=_._rotation11,h=_._rotation21,b=n._rotation01,X=n._rotation11,c=n._rotation21;let u=o._halfHeight,p=r._halfHeight,x=o._radius,v=r._radius,f,g,V,Z,I,M,y,d,B,R,k,A;f=_._positionX+e*-u,g=_._positionY+a*-u,V=_._positionZ+h*-u,Z=_._positionX+e*u,I=_._positionY+a*u,M=_._positionZ+h*u,y=n._positionX+b*-p,d=n._positionY+X*-p,B=n._positionZ+c*-p,R=n._positionX+b*p,k=n._positionY+X*p,A=n._positionZ+c*p;let z,w,S;z=f-y,w=g-d,S=V-B;let P,T,C,L,q,U;P=Z-f,T=I-g,C=M-V,L=R-y,q=k-d,U=A-B;let Y=-(z*P+w*T+S*C),E=z*L+w*q+S*U,D=u*u*4,Q=P*L+T*q+C*U,W=p*p*4,F,H;if(D==0&&W==0)F=0,H=0;else if(D==0)F=0,E<0?H=0:E>W?H=1:H=E/W;else if(W==0)H=0,Y<0?F=0:Y>D?F=1:F=Y/D;else{let gt=D*W-Q*Q;gt==0?F=0:(F=Q*E+W*Y,F<0?F=0:F>gt?F=1:F/=gt),H=F*Q+E,H<0?(H=0,Y<0?F=0:Y>D?F=1:F=Y/D):H>W?(H=1,F=Q+Y,F<0?F=0:F>D?F=1:F/=D):H/=W}let G,J,N,K,O,$;G=f+P*F,J=g+T*F,N=V+C*F,K=y+L*H,O=d+q*H,$=B+U*H;let et,st,lt;et=G-K,st=J-O,lt=N-$;let rt=et*et+st*st+lt*lt;if(rt>=(x+v)*(x+v))return;let at=Math.sqrt(rt),_t,ht,ot;at>0?(_t=et*(1/at),ht=st*(1/at),ot=lt*(1/at)):(_t=1,ht=0,ot=0),this.setNormal(t,_t,ht,ot);let bt,Xt,ft,ut,xt,zt;bt=G+_t*-x,Xt=J+ht*-x,ft=N+ot*-x,ut=K+_t*v,xt=O+ht*v,zt=$+ot*v,this.addPoint(t,bt,Xt,ft,ut,xt,zt,x+v-at,0)}};m.collision.narrowphase.detector.GjkEpaDetector=class extends m.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,_,n,l){let o=m.collision.narrowphase.detector.gjkepa.GjkEpa.instance,r=i,e=s,a=o.computeClosestPointsImpl(r,e,_,n,m.common.Setting.enableGJKCaching?l:null,!0);if(t.incremental=!0,a!=m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED){console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+a);return}if(o.distance>r._gjkMargin+e._gjkMargin)return;let h,b,X,c,u,p,x=o.closestPoint1;h=x.x,b=x.y,X=x.z;let v=o.closestPoint2;c=v.x,u=v.y,p=v.z;let f,g,V;if(f=h-c,g=b-u,V=X-p,f*f+g*g+V*V==0)return;o.distance<0&&(f=-f,g=-g,V=-V);let Z=f*f+g*g+V*V;Z>0&&(Z=1/Math.sqrt(Z)),f*=Z,g*=Z,V*=Z,this.setNormal(t,f,g,V),h+=f*-r._gjkMargin,b+=g*-r._gjkMargin,X+=V*-r._gjkMargin,c+=f*e._gjkMargin,u+=g*e._gjkMargin,p+=V*e._gjkMargin,this.addPoint(t,h,b,X,c,u,p,r._gjkMargin+e._gjkMargin-o.distance,0)}};m.collision.narrowphase.detector.SphereBoxDetector=class extends m.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,s,_,n,l){let o=s;t.incremental=!1;let r,e,a,h,b,X;r=o._halfExtentsX,e=o._halfExtentsY,a=o._halfExtentsZ,h=-r,b=-e,X=-a;let c=i._radius,u,p,x;u=_._positionX-n._positionX,p=_._positionY-n._positionY,x=_._positionZ-n._positionZ;let v,f,g,V,Z,I;if(V=n._rotation00*u+n._rotation10*p+n._rotation20*x,Z=n._rotation01*u+n._rotation11*p+n._rotation21*x,I=n._rotation02*u+n._rotation12*p+n._rotation22*x,v=V,f=Z,g=I,h<v&&r>v&&b<f&&e>f&&X<g&&a>g){let et,st,lt;et=v<0?-v:v,st=f<0?-f:f,lt=g<0?-g:g,et=r-et,st=e-st,lt=a-lt;let rt,at,_t,ht=et,ot=st,bt=lt,Xt,ft,ut,xt;ht<ot?ht<bt?(v>0?(rt=1,at=0,_t=0):(rt=-1,at=0,_t=0),ft=0,ut=1,xt=1,Xt=ht):(g>0?(rt=0,at=0,_t=1):(rt=0,at=0,_t=-1),ft=1,ut=1,xt=0,Xt=bt):ot<bt?(f>0?(rt=0,at=1,_t=0):(rt=0,at=-1,_t=0),ft=1,ut=0,xt=1,Xt=ot):(g>0?(rt=0,at=0,_t=1):(rt=0,at=0,_t=-1),ft=1,ut=1,xt=0,Xt=bt);let zt,gt,pt;zt=ft*v,gt=ut*f,pt=xt*g;let ct,nt,tt;ct=rt*r,nt=at*e,tt=_t*a,ct+=zt,nt+=gt,tt+=pt;let kt,Bt,Mt,Rt,ci,Xi,gi,ki,wi;gi=n._rotation00*ct+n._rotation01*nt+n._rotation02*tt,ki=n._rotation10*ct+n._rotation11*nt+n._rotation12*tt,wi=n._rotation20*ct+n._rotation21*nt+n._rotation22*tt,kt=gi,Bt=ki,Mt=wi;let ei,Nt,At;ei=n._rotation00*rt+n._rotation01*at+n._rotation02*_t,Nt=n._rotation10*rt+n._rotation11*at+n._rotation12*_t,At=n._rotation20*rt+n._rotation21*at+n._rotation22*_t,Rt=ei,ci=Nt,Xi=At,this.setNormal(t,Rt,ci,Xi);let ni,di,Oi,Bi,Vt,wt;ni=_._positionX+Rt*-c,di=_._positionY+ci*-c,Oi=_._positionZ+Xi*-c,Bi=n._positionX+kt,Vt=n._positionY+Bt,wt=n._positionZ+Mt,this.addPoint(t,ni,di,Oi,Bi,Vt,wt,Xt,0);return}let M,y,d;r-=1e-9,e-=1e-9,a-=1e-9,h+=1e-9,b+=1e-9,X+=1e-9,M=v<r?v:r,y=f<e?f:e,d=g<a?g:a,M>h||(M=h),y>b||(y=b),d>X||(d=X);let B,R,k;B=v-M,R=f-y,k=g-d;let A=B*B+R*R+k*k;if(A>=c*c)return;A=Math.sqrt(A);let z,w,S,P,T,C,L,q,U;L=n._rotation00*M+n._rotation01*y+n._rotation02*d,q=n._rotation10*M+n._rotation11*y+n._rotation12*d,U=n._rotation20*M+n._rotation21*y+n._rotation22*d,z=L,w=q,S=U;let Y,E,D;Y=n._rotation00*B+n._rotation01*R+n._rotation02*k,E=n._rotation10*B+n._rotation11*R+n._rotation12*k,D=n._rotation20*B+n._rotation21*R+n._rotation22*k,P=Y,T=E,C=D;let Q,W,F,H=P*P+T*T+C*C;H>0&&(H=1/Math.sqrt(H)),Q=P*H,W=T*H,F=C*H,this.setNormal(t,Q,W,F);let G,J,N,K,O,$;G=_._positionX+Q*-c,J=_._positionY+W*-c,N=_._positionZ+F*-c,K=n._positionX+z,O=n._positionY+w,$=n._positionZ+S,this.addPoint(t,G,J,N,K,O,$,c-A,0)}};m.collision.narrowphase.detector.SphereCapsuleDetector=class extends m.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,s,_,n,l){let o=s;t.incremental=!1;let r=o._halfHeight,e=i._radius,a=o._radius,h,b,X;h=n._rotation01,b=n._rotation11,X=n._rotation21;let c,u,p;c=_._positionX,u=_._positionY,p=_._positionZ;let x,v,f,g,V,Z;x=n._positionX+h*-r,v=n._positionY+b*-r,f=n._positionZ+X*-r,g=n._positionX+h*r,V=n._positionY+b*r,Z=n._positionZ+X*r;let I,M,y;I=c-x,M=u-v,y=p-f;let d,B,R;d=g-x,B=V-v,R=Z-f;let k=r*r*4,A=I*d+M*B+y*R;A<0?A=0:A>k?A=1:A/=k;let z,w,S;z=x+d*A,w=v+B*A,S=f+R*A;let P,T,C;P=c-z,T=u-w,C=p-S;let L=P*P+T*T+C*C;if(L>=(e+a)*(e+a))return;let q=Math.sqrt(L),U,Y,E;q>0?(U=P*(1/q),Y=T*(1/q),E=C*(1/q)):(U=1,Y=0,E=0),this.setNormal(t,U,Y,E);let D,Q,W,F,H,G;D=c+U*-e,Q=u+Y*-e,W=p+E*-e,F=z+U*a,H=w+Y*a,G=S+E*a,this.addPoint(t,D,Q,W,F,H,G,e+a-q,0)}};m.collision.narrowphase.detector.SphereSphereDetector=class extends m.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,_,n,l){t.incremental=!1;let o,r,e;o=_._positionX-n._positionX,r=_._positionY-n._positionY,e=_._positionZ-n._positionZ;let a=i._radius,h=s._radius,b=o*o+r*r+e*e;if(b>=(a+h)*(a+h))return;let X=Math.sqrt(b),c,u,p;X>0?(c=o*(1/X),u=r*(1/X),p=e*(1/X)):(c=1,u=0,p=0),this.setNormal(t,c,u,p);let x,v,f,g,V,Z;x=_._positionX+c*-a,v=_._positionY+u*-a,f=_._positionZ+p*-a,g=n._positionX+c*h,V=n._positionY+u*h,Z=n._positionZ+p*h,this.addPoint(t,x,v,f,g,V,Z,a+h-X,0)}};m.collision.narrowphase.detector.gjkepa||(m.collision.narrowphase.detector.gjkepa={});m.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){this._vertices=new Array(m.common.Setting.maxEPAVertices),this._center=new m.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(t){}validate(){let t=this._triangleList;for(;t!=null;){if(t._vertices[0]._tmpEdgeLoopOuterTriangle=null,t._vertices[0]._tmpEdgeLoopNext=null,t._adjacentPairIndex[0]==-1)return this._status=2,!1;if(t._adjacentTriangles[0]==null)return this._status=3,!1;if(t._vertices[1]._tmpEdgeLoopOuterTriangle=null,t._vertices[1]._tmpEdgeLoopNext=null,t._adjacentPairIndex[1]==-1)return this._status=2,!1;if(t._adjacentTriangles[1]==null)return this._status=3,!1;if(t._vertices[2]._tmpEdgeLoopOuterTriangle=null,t._vertices[2]._tmpEdgeLoopNext=null,t._adjacentPairIndex[2]==-1)return this._status=2,!1;if(t._adjacentTriangles[2]==null)return this._status=3,!1;t=t._next}return!0}findEdgeLoop(t,i,s){if(i._tmpDfsId==t)return;i._tmpDfsId=t;let _=i.tmp;_.x=s.x,_.y=s.y,_.z=s.z;let n=i._vertices[0].v;_.x-=n.x,_.y-=n.y,_.z-=n.z;let l=i.tmp,o=i._normal;if(i._tmpDfsVisible=l.x*o.x+l.y*o.y+l.z*o.z>0,!i._tmpDfsVisible){this._status=6;return}let r=0;for(;r<3;){let c=r++,u=i._adjacentTriangles[c];if(u==null)continue;let p=u.tmp;p.x=s.x,p.y=s.y,p.z=s.z;let x=u._vertices[0].v;p.x-=x.x,p.y-=x.y,p.z-=x.z;let v=u.tmp,f=u._normal;if(u._tmpDfsVisible=v.x*f.x+v.y*f.y+v.z*f.z>0,u._tmpDfsVisible)this.findEdgeLoop(t,u,s);else{let g=i._vertices[c];g._tmpEdgeLoopNext=i._vertices[i._nextIndex[c]],g._tmpEdgeLoopOuterTriangle=u}}let e=i._adjacentTriangles[0];if(e!=null){let c=i._adjacentPairIndex[0];e._adjacentTriangles[c]=null,e._adjacentPairIndex[c]=-1,i._adjacentTriangles[0]=null,i._adjacentPairIndex[0]=-1}let a=i._adjacentTriangles[1];if(a!=null){let c=i._adjacentPairIndex[1];a._adjacentTriangles[c]=null,a._adjacentPairIndex[c]=-1,i._adjacentTriangles[1]=null,i._adjacentPairIndex[1]=-1}let h=i._adjacentTriangles[2];if(h!=null){let c=i._adjacentPairIndex[2];h._adjacentTriangles[c]=null,h._adjacentPairIndex[c]=-1,i._adjacentTriangles[2]=null,i._adjacentPairIndex[2]=-1}this._numTriangles--;let b=i._prev,X=i._next;b!=null&&(b._next=X),X!=null&&(X._prev=b),i==this._triangleList&&(this._triangleList=this._triangleList._next),i==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),i._next=null,i._prev=null,i.removeReferences(),i._next=this._trianglePool,this._trianglePool=i}_init(t,i,s,_){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=s,this._vertices[3]=_;let n=this._center,l=t.v;n.x=l.x,n.y=l.y,n.z=l.z;let o=i.v;n.x+=o.x,n.y+=o.y,n.z+=o.z;let r=s.v;n.x+=r.x,n.y+=r.y,n.z+=r.z;let e=_.v;n.x+=e.x,n.y+=e.y,n.z+=e.z,n.x*=.25,n.y*=.25,n.z*=.25;let a=this._trianglePool;a!=null?(this._trianglePool=a._next,a._next=null):a=new m.collision.narrowphase.detector.gjkepa.EpaTriangle;let h=a,b=this._trianglePool;b!=null?(this._trianglePool=b._next,b._next=null):b=new m.collision.narrowphase.detector.gjkepa.EpaTriangle;let X=b,c=this._trianglePool;c!=null?(this._trianglePool=c._next,c._next=null):c=new m.collision.narrowphase.detector.gjkepa.EpaTriangle;let u=c,p=this._trianglePool;p!=null?(this._trianglePool=p._next,p._next=null):p=new m.collision.narrowphase.detector.gjkepa.EpaTriangle;let x=p;return h.init(t,i,s,this._center,!0)||(this._status=1),X.init(t,i,_,this._center,!0)||(this._status=1),u.init(t,s,_,this._center,!0)||(this._status=1),x.init(i,s,_,this._center,!0)||(this._status=1),h.setAdjacentTriangle(X)||(this._status=1),h.setAdjacentTriangle(u)||(this._status=1),h.setAdjacentTriangle(x)||(this._status=1),X.setAdjacentTriangle(u)||(this._status=1),X.setAdjacentTriangle(x)||(this._status=1),u.setAdjacentTriangle(x)||(this._status=1),this._numTriangles++,this._triangleList==null?(this._triangleList=h,this._triangleListLast=h):(this._triangleListLast._next=h,h._prev=this._triangleListLast,this._triangleListLast=h),this._numTriangles++,this._triangleList==null?(this._triangleList=X,this._triangleListLast=X):(this._triangleListLast._next=X,X._prev=this._triangleListLast,this._triangleListLast=X),this._numTriangles++,this._triangleList==null?(this._triangleList=u,this._triangleListLast=u):(this._triangleListLast._next=u,u._prev=this._triangleListLast,this._triangleListLast=u),this._numTriangles++,this._triangleList==null?(this._triangleList=x,this._triangleListLast=x):(this._triangleListLast._next=x,x._prev=this._triangleListLast,this._triangleListLast=x),this._status==0}_addVertex(t,i){this._vertices[this._numVertices++]=t;let s=i._vertices[0];if(this.findEdgeLoop(this._numVertices,i,t.v),this._status!=0)return!1;let _=s,n=null,l=null;for(;;){if(_._tmpEdgeLoopNext==null)return this._dumpAsObjModel(),this._status=4,!1;if(_._tmpEdgeLoopOuterTriangle==null)return this._status=5,!1;let o=this._trianglePool;o!=null?(this._trianglePool=o._next,o._next=null):o=new m.collision.narrowphase.detector.gjkepa.EpaTriangle;let r=o;if(l==null&&(l=r),r.init(_,_._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),this._status!=0)return!1;if(this._numTriangles++,this._triangleList==null?(this._triangleList=r,this._triangleListLast=r):(this._triangleListLast._next=r,r._prev=this._triangleListLast,this._triangleListLast=r),r.setAdjacentTriangle(_._tmpEdgeLoopOuterTriangle)||(this._status=1),n!=null&&(r.setAdjacentTriangle(n)||(this._status=1)),n=r,_=_._tmpEdgeLoopNext,_==s)break}return n.setAdjacentTriangle(l)||(this._status=1),this._status==0?this.validate():!1}_dumpAsObjModel(){}};m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{};m.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++m.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new m.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._vertices=new Array(3),this._adjacentTriangles=new Array(3),this._adjacentPairIndex=new Array(3),this.tmp=new m.common.Vec3,this._nextIndex=new Array(3),this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(t,i,s,_,n){n==null&&(n=!1);let l,o,r,e,a,h,b,X,c,u,p,x,v=t.v;l=v.x,o=v.y,r=v.z;let f=i.v;e=f.x,a=f.y,h=f.z;let g=s.v;b=g.x,X=g.y,c=g.z,u=_.x,p=_.y,x=_.z;let V,Z,I,M,y,d,B,R,k;V=e-l,Z=a-o,I=h-r,M=b-l,y=X-o,d=c-r,B=l-u,R=o-p,k=r-x;let A,z,w;A=Z*d-I*y,z=I*M-V*d,w=V*y-Z*M;let S=!1;if(B*A+R*z+k*w<0)if(n){let Mt=i;i=s,s=Mt,A*=-1,z*=-1,w*=-1}else S=!0;this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=s;let P=this._normal;P.x=A,P.y=z,P.z=w;let T=t.v,C=i.v,L=s.v,q=this.tmp,U,Y,E,D,Q,W,F,H,G,J,N,K,O,$,et,st,lt,rt;U=T.x,Y=T.y,E=T.z,D=C.x,Q=C.y,W=C.z,F=L.x,H=L.y,G=L.z,J=D-U,N=Q-Y,K=W-E,O=F-D,$=H-Q,et=G-W,st=U-F,lt=Y-H,rt=E-G;let at,_t,ht;at=N*et-K*$,_t=K*O-J*et,ht=J*$-N*O;let ot,bt,Xt,ft,ut,xt,zt,gt,pt;ot=N*ht-K*_t,bt=K*at-J*ht,Xt=J*_t-N*at,ft=$*ht-et*_t,ut=et*at-O*ht,xt=O*_t-$*at,zt=lt*ht-rt*_t,gt=rt*at-st*ht,pt=st*_t-lt*at;let ct=-1,nt,tt,kt;if(nt=0,tt=0,kt=0,U*ot+Y*bt+E*Xt<0){let Mt,Rt,ci,Xi,gi,ki;Mt=T.x,Rt=T.y,ci=T.z,Xi=C.x,gi=C.y,ki=C.z;let wi,ei,Nt;wi=Xi-Mt,ei=gi-Rt,Nt=ki-ci;let At=wi*Mt+ei*Rt+Nt*ci;if(At=-At/(wi*wi+ei*ei+Nt*Nt),At<0)q.x=Mt,q.y=Rt,q.z=ci;else if(At>1)q.x=Xi,q.y=gi,q.z=ki;else{let ni,di,Oi;ni=Mt+wi*At,di=Rt+ei*At,Oi=ci+Nt*At,q.x=ni,q.y=di,q.z=Oi}ct=q.x*q.x+q.y*q.y+q.z*q.z,nt=q.x,tt=q.y,kt=q.z}if(D*ft+Q*ut+W*xt<0){let Mt,Rt,ci,Xi,gi,ki;Mt=C.x,Rt=C.y,ci=C.z,Xi=L.x,gi=L.y,ki=L.z;let wi,ei,Nt;wi=Xi-Mt,ei=gi-Rt,Nt=ki-ci;let At=wi*Mt+ei*Rt+Nt*ci;if(At=-At/(wi*wi+ei*ei+Nt*Nt),At<0)q.x=Mt,q.y=Rt,q.z=ci;else if(At>1)q.x=Xi,q.y=gi,q.z=ki;else{let di,Oi,Bi;di=Mt+wi*At,Oi=Rt+ei*At,Bi=ci+Nt*At,q.x=di,q.y=Oi,q.z=Bi}let ni=q.x*q.x+q.y*q.y+q.z*q.z;(ct<0||ni<ct)&&(ct=ni,nt=q.x,tt=q.y,kt=q.z)}if(F*zt+H*gt+G*pt<0){let Mt,Rt,ci,Xi,gi,ki;Mt=T.x,Rt=T.y,ci=T.z,Xi=L.x,gi=L.y,ki=L.z;let wi,ei,Nt;wi=Xi-Mt,ei=gi-Rt,Nt=ki-ci;let At=wi*Mt+ei*Rt+Nt*ci;if(At=-At/(wi*wi+ei*ei+Nt*Nt),At<0)q.x=Mt,q.y=Rt,q.z=ci;else if(At>1)q.x=Xi,q.y=gi,q.z=ki;else{let di,Oi,Bi;di=Mt+wi*At,Oi=Rt+ei*At,Bi=ci+Nt*At,q.x=di,q.y=Oi,q.z=Bi}let ni=q.x*q.x+q.y*q.y+q.z*q.z;(ct<0||ni<ct)&&(ct=ni,nt=q.x,tt=q.y,kt=q.z)}if(ct>0)q.x=nt,q.y=tt,q.z=kt;else{let Mt=at*at+_t*_t+ht*ht;Mt>0&&(Mt=1/Math.sqrt(Mt)),at*=Mt,_t*=Mt,ht*=Mt;let Rt=at*at+_t*_t+ht*ht;Rt=(U*at+Y*_t+E*ht)/Rt,nt=at*Rt,tt=_t*Rt,kt=ht*Rt,q.x=nt,q.y=tt,q.z=kt}let Bt=this.tmp;return this._distanceSq=Bt.x*Bt.x+Bt.y*Bt.y+Bt.z*Bt.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!S}setAdjacentTriangle(t){let i=0;return this._vertices[0]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[0]]==t._vertices[0]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=0,i=1),this._vertices[0]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[0]]==t._vertices[1]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=0,++i),this._vertices[0]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[0]]==t._vertices[2]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=0,++i),this._vertices[1]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[1]]==t._vertices[0]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[1]]==t._vertices[1]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[1]]==t._vertices[2]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=1,++i),this._vertices[2]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[2]]==t._vertices[0]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[2]]==t._vertices[1]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[2]]==t._vertices[2]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=2,++i),i==1}removeAdjacentTriangles(){let t=this._adjacentTriangles[0];if(t!=null){let _=this._adjacentPairIndex[0];t._adjacentTriangles[_]=null,t._adjacentPairIndex[_]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}let i=this._adjacentTriangles[1];if(i!=null){let _=this._adjacentPairIndex[1];i._adjacentTriangles[_]=null,i._adjacentPairIndex[_]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}let s=this._adjacentTriangles[2];if(s!=null){let _=this._adjacentPairIndex[2];s._adjacentTriangles[_]=null,s._adjacentPairIndex[_]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}};m.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=Math.random()*1e5|0,this.v=new m.common.Vec3,this.w1=new m.common.Vec3,this.w2=new m.common.Vec3}init(t,i,s){let _=this.v;_.x=t.x,_.y=t.y,_.z=t.z;let n=this.w1;n.x=i.x,n.y=i.y,n.z=i.z;let l=this.w2;return l.x=s.x,l.y=s.y,l.z=s.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}};m.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new m.common.Vec3}clear(){this.prevClosestDir.zero()}};m.common||(m.common={});m.common.Vec3=class{constructor(t,i,s){s==null&&(s=0),i==null&&(i=0),t==null&&(t=0),this.x=t,this.y=i,this.z=s,m.common.Vec3.numCreations++}init(t,i,s){return this.x=t,this.y=i,this.z=s,this}zero(){return this.x=0,this.y=0,this.z=0,this}add(t){return new m.common.Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}add3(t,i,s){return new m.common.Vec3(this.x+t,this.y+i,this.z+s)}addScaled(t,i){return new m.common.Vec3(this.x+t.x*i,this.y+t.y*i,this.z+t.z*i)}sub(t){return new m.common.Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}sub3(t,i,s){return new m.common.Vec3(this.x-t,this.y-i,this.z-s)}scale(t){return new m.common.Vec3(this.x*t,this.y*t,this.z*t)}scale3(t,i,s){return new m.common.Vec3(this.x*t,this.y*i,this.z*s)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new m.common.Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add3Eq(t,i,s){return this.x+=t,this.y+=i,this.z+=s,this}addScaledEq(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}sub3Eq(t,i,s){return this.x-=t,this.y-=i,this.z-=s,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this}scale3Eq(t,i,s){return this.x*=t,this.y*=i,this.z*=s,this}crossEq(t){let i=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;return this.x=this.y*t.z-this.z*t.y,this.y=i,this.z=s,this}mulMat3(t){return new m.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)}mulMat4(t){return new m.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)}mulTransform(t){let i,s,_;i=this.x,s=this.y,_=this.z;let n,l,o;n=t._rotation00*i+t._rotation01*s+t._rotation02*_,l=t._rotation10*i+t._rotation11*s+t._rotation12*_,o=t._rotation20*i+t._rotation21*s+t._rotation22*_,i=n,s=l,_=o,i+=t._positionX,s+=t._positionY,_+=t._positionZ;let r=new m.common.Vec3;return r.x=i,r.y=s,r.z=_,r}mulMat3Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12,s=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02,this.y=i,this.z=s,this}mulMat4Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,s=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.y=i,this.z=s,this}mulTransformEq(t){let i,s,_;i=this.x,s=this.y,_=this.z;let n,l,o;return n=t._rotation00*i+t._rotation01*s+t._rotation02*_,l=t._rotation10*i+t._rotation11*s+t._rotation12*_,o=t._rotation20*i+t._rotation21*s+t._rotation22*_,i=n,s=l,_=o,i+=t._positionX,s+=t._positionY,_+=t._positionZ,this.x=i,this.y=s,this.z=_,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new m.common.Vec3(this.x*t,this.y*t,this.z*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this}negate(){return new m.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new m.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+", "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+", "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+"]"}};m.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){let t=new m.common.Vec3;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,t}getPositionTo(t){t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(t){return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(t){let i,s,_;i=t.x,s=t.y,_=t.z,this._positionX+=i,this._positionY+=s,this._positionZ+=_}getRotation(){let t=new m.common.Mat3;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,t}getRotationTo(t){t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(t){return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(t){let i,s,_;i=t.x,s=t.y,_=t.z;let n=Math.sin(i),l=Math.sin(s),o=Math.sin(_),r=Math.cos(i),e=Math.cos(s),a=Math.cos(_);this._rotation00=e*a,this._rotation01=-e*o,this._rotation02=l,this._rotation10=r*o+a*n*l,this._rotation11=r*a-n*l*o,this._rotation12=-e*n,this._rotation20=n*o-r*a*l,this._rotation21=a*n+r*l*o,this._rotation22=r*e}rotate(t){let i,s,_,n,l,o,r,e,a;i=t.e00,s=t.e01,_=t.e02,n=t.e10,l=t.e11,o=t.e12,r=t.e20,e=t.e21,a=t.e22;let h,b,X,c,u,p,x,v,f;h=i*this._rotation00+s*this._rotation10+_*this._rotation20,b=i*this._rotation01+s*this._rotation11+_*this._rotation21,X=i*this._rotation02+s*this._rotation12+_*this._rotation22,c=n*this._rotation00+l*this._rotation10+o*this._rotation20,u=n*this._rotation01+l*this._rotation11+o*this._rotation21,p=n*this._rotation02+l*this._rotation12+o*this._rotation22,x=r*this._rotation00+e*this._rotation10+a*this._rotation20,v=r*this._rotation01+e*this._rotation11+a*this._rotation21,f=r*this._rotation02+e*this._rotation12+a*this._rotation22,this._rotation00=h,this._rotation01=b,this._rotation02=X,this._rotation10=c,this._rotation11=u,this._rotation12=p,this._rotation20=x,this._rotation21=v,this._rotation22=f}rotateXyz(t){let i,s,_,n,l,o,r,e,a,h,b,X;i=t.x,s=t.y,_=t.z;let c=Math.sin(i),u=Math.sin(s),p=Math.sin(_),x=Math.cos(i),v=Math.cos(s),f=Math.cos(_);n=v*f,l=-v*p,o=u,r=x*p+f*c*u,e=x*f-c*u*p,a=-v*c,h=c*p-x*f*u,b=f*c+x*u*p,X=x*v;let g,V,Z,I,M,y,d,B,R;g=n*this._rotation00+l*this._rotation10+o*this._rotation20,V=n*this._rotation01+l*this._rotation11+o*this._rotation21,Z=n*this._rotation02+l*this._rotation12+o*this._rotation22,I=r*this._rotation00+e*this._rotation10+a*this._rotation20,M=r*this._rotation01+e*this._rotation11+a*this._rotation21,y=r*this._rotation02+e*this._rotation12+a*this._rotation22,d=h*this._rotation00+b*this._rotation10+X*this._rotation20,B=h*this._rotation01+b*this._rotation11+X*this._rotation21,R=h*this._rotation02+b*this._rotation12+X*this._rotation22,this._rotation00=g,this._rotation01=V,this._rotation02=Z,this._rotation10=I,this._rotation11=M,this._rotation12=y,this._rotation20=d,this._rotation21=B,this._rotation22=R}getOrientation(){let t=new m.common.Quat,i,s,_,n,l=this._rotation00,o=this._rotation11,r=this._rotation22,e=l+o+r,a;return e>0?(a=Math.sqrt(e+1),n=.5*a,a=.5/a,i=(this._rotation21-this._rotation12)*a,s=(this._rotation02-this._rotation20)*a,_=(this._rotation10-this._rotation01)*a):l>o?l>r?(a=Math.sqrt(l-o-r+1),i=.5*a,a=.5/a,s=(this._rotation01+this._rotation10)*a,_=(this._rotation02+this._rotation20)*a,n=(this._rotation21-this._rotation12)*a):(a=Math.sqrt(r-l-o+1),_=.5*a,a=.5/a,i=(this._rotation02+this._rotation20)*a,s=(this._rotation12+this._rotation21)*a,n=(this._rotation10-this._rotation01)*a):o>r?(a=Math.sqrt(o-r-l+1),s=.5*a,a=.5/a,i=(this._rotation01+this._rotation10)*a,_=(this._rotation12+this._rotation21)*a,n=(this._rotation02-this._rotation20)*a):(a=Math.sqrt(r-l-o+1),_=.5*a,a=.5/a,i=(this._rotation02+this._rotation20)*a,s=(this._rotation12+this._rotation21)*a,n=(this._rotation10-this._rotation01)*a),t.x=i,t.y=s,t.z=_,t.w=n,t}getOrientationTo(t){let i,s,_,n,l=this._rotation00,o=this._rotation11,r=this._rotation22,e=l+o+r,a;e>0?(a=Math.sqrt(e+1),n=.5*a,a=.5/a,i=(this._rotation21-this._rotation12)*a,s=(this._rotation02-this._rotation20)*a,_=(this._rotation10-this._rotation01)*a):l>o?l>r?(a=Math.sqrt(l-o-r+1),i=.5*a,a=.5/a,s=(this._rotation01+this._rotation10)*a,_=(this._rotation02+this._rotation20)*a,n=(this._rotation21-this._rotation12)*a):(a=Math.sqrt(r-l-o+1),_=.5*a,a=.5/a,i=(this._rotation02+this._rotation20)*a,s=(this._rotation12+this._rotation21)*a,n=(this._rotation10-this._rotation01)*a):o>r?(a=Math.sqrt(o-r-l+1),s=.5*a,a=.5/a,i=(this._rotation01+this._rotation10)*a,_=(this._rotation12+this._rotation21)*a,n=(this._rotation02-this._rotation20)*a):(a=Math.sqrt(r-l-o+1),_=.5*a,a=.5/a,i=(this._rotation02+this._rotation20)*a,s=(this._rotation12+this._rotation21)*a,n=(this._rotation10-this._rotation01)*a),t.x=i,t.y=s,t.z=_,t.w=n}setOrientation(t){let i,s,_,n;i=t.x,s=t.y,_=t.z,n=t.w;let l=i,o=s,r=_,e=n,a=2*l,h=2*o,b=2*r,X=l*a,c=o*h,u=r*b,p=l*h,x=o*b,v=l*b,f=e*a,g=e*h,V=e*b;return this._rotation00=1-c-u,this._rotation01=p-V,this._rotation02=v+g,this._rotation10=p+V,this._rotation11=1-X-u,this._rotation12=x-f,this._rotation20=v-g,this._rotation21=x+f,this._rotation22=1-X-c,this}clone(){let t=new m.common.Transform;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t}copyFrom(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}};m.common.Setting=class{};m.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){this.s=new Array(4),this.w1=new Array(4),this.w2=new Array(4),this.baseDirs=new Array(3),this.baseDirs[0]=new m.common.Vec3(1,0,0),this.baseDirs[1]=new m.common.Vec3(0,1,0),this.baseDirs[2]=new m.common.Vec3(0,0,1),this.tl1=new m.common.Vec3,this.tl2=new m.common.Vec3,this.rayX=new m.common.Vec3,this.rayR=new m.common.Vec3,this.tempTransform=new m.common.Transform,this.s[0]=new m.common.Vec3,this.w1[0]=new m.common.Vec3,this.w2[0]=new m.common.Vec3,this.s[1]=new m.common.Vec3,this.w1[1]=new m.common.Vec3,this.w2[1]=new m.common.Vec3,this.s[2]=new m.common.Vec3,this.w1[2]=new m.common.Vec3,this.w2[2]=new m.common.Vec3,this.s[3]=new m.common.Vec3,this.w1[3]=new m.common.Vec3,this.w2[3]=new m.common.Vec3,this.dir=new m.common.Vec3,this.closest=new m.common.Vec3,this.closestPoint1=new m.common.Vec3,this.closestPoint2=new m.common.Vec3,this.polyhedron=new m.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(t,i,s,_,n,l){this.c1=t,this.c2=i,this.tf1=s,this.tf2=_;let o=this.s,r=this.w1,e=this.w2,a=this.closest,h=this.dir;if(n!=null?(n._gjkCache==null&&(n._gjkCache=new m.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(n._gjkCache)):h.zero(),h.x*h.x+h.y*h.y+h.z*h.z==0){let p,x,v;p=_._positionX-s._positionX,x=_._positionY-s._positionY,v=_._positionZ-s._positionZ,h.x=p,h.y=x,h.z=v,h.x*h.x+h.y*h.y+h.z*h.z<1e-6&&h.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let b=this.s[this.simplexSize],X=this.w1[this.simplexSize];b.x=X.x,b.y=X.y,b.z=X.z;let c=this.w2[this.simplexSize];b.x-=c.x,b.y-=c.y,b.z-=c.z,this.simplexSize=1;let u=0;for(;u<40;){let p=0;switch(this.simplexSize){case 1:let V=o[0];a.x=V.x,a.y=V.y,a.z=V.z,p=1;break;case 2:let Z,I,M,y,d,B,R=o[0];Z=R.x,I=R.y,M=R.z;let k=o[1];y=k.x,d=k.y,B=k.z;let A,z,w;A=y-Z,z=d-I,w=B-M;let S=A*Z+z*I+w*M;if(S=-S/(A*A+z*z+w*w),S<0)a.x=Z,a.y=I,a.z=M,p=1;else if(S>1)a.x=y,a.y=d,a.z=B,p=2;else{let Ni,Ji,Hi;Ni=Z+A*S,Ji=I+z*S,Hi=M+w*S,a.x=Ni,a.y=Ji,a.z=Hi,p=3}break;case 3:let P=o[0],T=o[1],C=o[2],L,q,U,Y,E,D,Q,W,F,H,G,J,N,K,O,$,et,st;L=P.x,q=P.y,U=P.z,Y=T.x,E=T.y,D=T.z,Q=C.x,W=C.y,F=C.z,H=Y-L,G=E-q,J=D-U,N=Q-Y,K=W-E,O=F-D,$=L-Q,et=q-W,st=U-F;let lt,rt,at;lt=G*O-J*K,rt=J*N-H*O,at=H*K-G*N;let _t,ht,ot,bt,Xt,ft,ut,xt,zt;_t=G*at-J*rt,ht=J*lt-H*at,ot=H*rt-G*lt,bt=K*at-O*rt,Xt=O*lt-N*at,ft=N*rt-K*lt,ut=et*at-st*rt,xt=st*lt-$*at,zt=$*rt-et*lt;let gt=-1,pt,ct,nt,tt=0;if(pt=0,ct=0,nt=0,L*_t+q*ht+U*ot<0){let Ni,Ji,Hi,_e,ne,Ki;Ni=P.x,Ji=P.y,Hi=P.z,_e=T.x,ne=T.y,Ki=T.z;let ie,Ui,Wi;ie=_e-Ni,Ui=ne-Ji,Wi=Ki-Hi;let Si=ie*Ni+Ui*Ji+Wi*Hi;Si=-Si/(ie*ie+Ui*Ui+Wi*Wi);let Ht;if(Si<0)a.x=Ni,a.y=Ji,a.z=Hi,Ht=1;else if(Si>1)a.x=_e,a.y=ne,a.z=Ki,Ht=2;else{let ri,Tt,Mi;ri=Ni+ie*Si,Tt=Ji+Ui*Si,Mi=Hi+Wi*Si,a.x=ri,a.y=Tt,a.z=Mi,Ht=3}tt=Ht,gt=a.x*a.x+a.y*a.y+a.z*a.z,pt=a.x,ct=a.y,nt=a.z}if(Y*bt+E*Xt+D*ft<0){let Ni,Ji,Hi,_e,ne,Ki;Ni=T.x,Ji=T.y,Hi=T.z,_e=C.x,ne=C.y,Ki=C.z;let ie,Ui,Wi;ie=_e-Ni,Ui=ne-Ji,Wi=Ki-Hi;let Si=ie*Ni+Ui*Ji+Wi*Hi;Si=-Si/(ie*ie+Ui*Ui+Wi*Wi);let Ht;if(Si<0)a.x=Ni,a.y=Ji,a.z=Hi,Ht=1;else if(Si>1)a.x=_e,a.y=ne,a.z=Ki,Ht=2;else{let Tt,Mi,zi;Tt=Ni+ie*Si,Mi=Ji+Ui*Si,zi=Hi+Wi*Si,a.x=Tt,a.y=Mi,a.z=zi,Ht=3}let ri=a.x*a.x+a.y*a.y+a.z*a.z;(gt<0||ri<gt)&&(tt=Ht<<1,gt=ri,pt=a.x,ct=a.y,nt=a.z)}if(Q*ut+W*xt+F*zt<0){let Ni,Ji,Hi,_e,ne,Ki;Ni=P.x,Ji=P.y,Hi=P.z,_e=C.x,ne=C.y,Ki=C.z;let ie,Ui,Wi;ie=_e-Ni,Ui=ne-Ji,Wi=Ki-Hi;let Si=ie*Ni+Ui*Ji+Wi*Hi;Si=-Si/(ie*ie+Ui*Ui+Wi*Wi);let Ht;if(Si<0)a.x=Ni,a.y=Ji,a.z=Hi,Ht=1;else if(Si>1)a.x=_e,a.y=ne,a.z=Ki,Ht=2;else{let Tt,Mi,zi;Tt=Ni+ie*Si,Mi=Ji+Ui*Si,zi=Hi+Wi*Si,a.x=Tt,a.y=Mi,a.z=zi,Ht=3}let ri=a.x*a.x+a.y*a.y+a.z*a.z;(gt<0||ri<gt)&&(tt=Ht&1|(Ht&2)<<1,gt=ri,pt=a.x,ct=a.y,nt=a.z)}if(gt>0)a.x=pt,a.y=ct,a.z=nt,p=tt;else{let Ni=lt*lt+rt*rt+at*at;Ni>0&&(Ni=1/Math.sqrt(Ni)),lt*=Ni,rt*=Ni,at*=Ni;let Ji=lt*lt+rt*rt+at*at;Ji=(L*lt+q*rt+U*at)/Ji,pt=lt*Ji,ct=rt*Ji,nt=at*Ji,a.x=pt,a.y=ct,a.z=nt,p=7}break;case 4:let kt=o[0],Bt=o[1],Mt=o[2],Rt=o[3],ci,Xi,gi,ki,wi,ei,Nt,At,ni,di,Oi,Bi,Vt,wt,$t,fi,Zi,it,Ut,ii,j,Jt,Pt,si,_i,St,ai;ci=kt.x,Xi=kt.y,gi=kt.z,ki=Bt.x,wi=Bt.y,ei=Bt.z,Nt=Mt.x,At=Mt.y,ni=Mt.z,di=Rt.x,Oi=Rt.y,Bi=Rt.z,Vt=ki-ci,wt=wi-Xi,$t=ei-gi,fi=Nt-ci,Zi=At-Xi,it=ni-gi,Ut=di-ci,ii=Oi-Xi,j=Bi-gi,Jt=Nt-ki,Pt=At-wi,si=ni-ei,_i=di-ki,St=Oi-wi,ai=Bi-ei;let qi,ui,Yt,yt,vt,yi,Ii,bi,se,me,Ei,he;qi=wt*it-$t*Zi,ui=$t*fi-Vt*it,Yt=Vt*Zi-wt*fi,yt=Zi*j-it*ii,vt=it*Ut-fi*j,yi=fi*ii-Zi*Ut,Ii=ii*$t-j*wt,bi=j*Vt-Ut*$t,se=Ut*wt-ii*Vt,me=St*si-ai*Pt,Ei=ai*Jt-_i*si,he=_i*Pt-St*Jt;let ve=Vt*me+wt*Ei+$t*he>0?1:-1,oi=-1,ce,be,xe,Ye=0;if(ce=0,be=0,xe=0,(ci*qi+Xi*ui+gi*Yt)*ve<0){let Ni,Ji,Hi,_e,ne,Ki,ie,Ui,Wi,Si,Ht,ri,Tt,Mi,zi,Pi,Vi,ji;Ni=kt.x,Ji=kt.y,Hi=kt.z,_e=Bt.x,ne=Bt.y,Ki=Bt.z,ie=Mt.x,Ui=Mt.y,Wi=Mt.z,Si=_e-Ni,Ht=ne-Ji,ri=Ki-Hi,Tt=ie-_e,Mi=Ui-ne,zi=Wi-Ki,Pi=Ni-ie,Vi=Ji-Ui,ji=Hi-Wi;let Gt,dt,Lt;Gt=Ht*zi-ri*Mi,dt=ri*Tt-Si*zi,Lt=Si*Mi-Ht*Tt;let Ai,Li,Di,$i,ae,re,pe,ti,Fi;Ai=Ht*Lt-ri*dt,Li=ri*Gt-Si*Lt,Di=Si*dt-Ht*Gt,$i=Mi*Lt-zi*dt,ae=zi*Gt-Tt*Lt,re=Tt*dt-Mi*Gt,pe=Vi*Lt-ji*dt,ti=ji*Gt-Pi*Lt,Fi=Pi*dt-Vi*Gt;let vi=-1,Ti,mi,Ct,jt=0;if(Ti=0,mi=0,Ct=0,Ni*Ai+Ji*Li+Hi*Di<0){let qt,mt,Zt,Et,Ft,Wt;qt=kt.x,mt=kt.y,Zt=kt.z,Et=Bt.x,Ft=Bt.y,Wt=Bt.z;let Kt,li,Yi;Kt=Et-qt,li=Ft-mt,Yi=Wt-Zt;let pi=Kt*qt+li*mt+Yi*Zt;pi=-pi/(Kt*Kt+li*li+Yi*Yi);let Ot;if(pi<0)a.x=qt,a.y=mt,a.z=Zt,Ot=1;else if(pi>1)a.x=Et,a.y=Ft,a.z=Wt,Ot=2;else{let It,Qt,xi;It=qt+Kt*pi,Qt=mt+li*pi,xi=Zt+Yi*pi,a.x=It,a.y=Qt,a.z=xi,Ot=3}jt=Ot,vi=a.x*a.x+a.y*a.y+a.z*a.z,Ti=a.x,mi=a.y,Ct=a.z}if(_e*$i+ne*ae+Ki*re<0){let qt,mt,Zt,Et,Ft,Wt;qt=Bt.x,mt=Bt.y,Zt=Bt.z,Et=Mt.x,Ft=Mt.y,Wt=Mt.z;let Kt,li,Yi;Kt=Et-qt,li=Ft-mt,Yi=Wt-Zt;let pi=Kt*qt+li*mt+Yi*Zt;pi=-pi/(Kt*Kt+li*li+Yi*Yi);let Ot;if(pi<0)a.x=qt,a.y=mt,a.z=Zt,Ot=1;else if(pi>1)a.x=Et,a.y=Ft,a.z=Wt,Ot=2;else{let Qt,xi,Ri;Qt=qt+Kt*pi,xi=mt+li*pi,Ri=Zt+Yi*pi,a.x=Qt,a.y=xi,a.z=Ri,Ot=3}let It=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||It<vi)&&(jt=Ot<<1,vi=It,Ti=a.x,mi=a.y,Ct=a.z)}if(ie*pe+Ui*ti+Wi*Fi<0){let qt,mt,Zt,Et,Ft,Wt;qt=kt.x,mt=kt.y,Zt=kt.z,Et=Mt.x,Ft=Mt.y,Wt=Mt.z;let Kt,li,Yi;Kt=Et-qt,li=Ft-mt,Yi=Wt-Zt;let pi=Kt*qt+li*mt+Yi*Zt;pi=-pi/(Kt*Kt+li*li+Yi*Yi);let Ot;if(pi<0)a.x=qt,a.y=mt,a.z=Zt,Ot=1;else if(pi>1)a.x=Et,a.y=Ft,a.z=Wt,Ot=2;else{let Qt,xi,Ri;Qt=qt+Kt*pi,xi=mt+li*pi,Ri=Zt+Yi*pi,a.x=Qt,a.y=xi,a.z=Ri,Ot=3}let It=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||It<vi)&&(jt=Ot&1|(Ot&2)<<1,vi=It,Ti=a.x,mi=a.y,Ct=a.z)}let hi;if(vi>0)a.x=Ti,a.y=mi,a.z=Ct,hi=jt;else{let qt=Gt*Gt+dt*dt+Lt*Lt;qt>0&&(qt=1/Math.sqrt(qt)),Gt*=qt,dt*=qt,Lt*=qt;let mt=Gt*Gt+dt*dt+Lt*Lt;mt=(Ni*Gt+Ji*dt+Hi*Lt)/mt,Ti=Gt*mt,mi=dt*mt,Ct=Lt*mt,a.x=Ti,a.y=mi,a.z=Ct,hi=7}Ye=hi,oi=a.x*a.x+a.y*a.y+a.z*a.z,ce=a.x,be=a.y,xe=a.z}if((ci*yt+Xi*vt+gi*yi)*ve<0){let Ni,Ji,Hi,_e,ne,Ki,ie,Ui,Wi,Si,Ht,ri,Tt,Mi,zi,Pi,Vi,ji;Ni=kt.x,Ji=kt.y,Hi=kt.z,_e=Mt.x,ne=Mt.y,Ki=Mt.z,ie=Rt.x,Ui=Rt.y,Wi=Rt.z,Si=_e-Ni,Ht=ne-Ji,ri=Ki-Hi,Tt=ie-_e,Mi=Ui-ne,zi=Wi-Ki,Pi=Ni-ie,Vi=Ji-Ui,ji=Hi-Wi;let Gt,dt,Lt;Gt=Ht*zi-ri*Mi,dt=ri*Tt-Si*zi,Lt=Si*Mi-Ht*Tt;let Ai,Li,Di,$i,ae,re,pe,ti,Fi;Ai=Ht*Lt-ri*dt,Li=ri*Gt-Si*Lt,Di=Si*dt-Ht*Gt,$i=Mi*Lt-zi*dt,ae=zi*Gt-Tt*Lt,re=Tt*dt-Mi*Gt,pe=Vi*Lt-ji*dt,ti=ji*Gt-Pi*Lt,Fi=Pi*dt-Vi*Gt;let vi=-1,Ti,mi,Ct,jt=0;if(Ti=0,mi=0,Ct=0,Ni*Ai+Ji*Li+Hi*Di<0){let mt,Zt,Et,Ft,Wt,Kt;mt=kt.x,Zt=kt.y,Et=kt.z,Ft=Mt.x,Wt=Mt.y,Kt=Mt.z;let li,Yi,pi;li=Ft-mt,Yi=Wt-Zt,pi=Kt-Et;let Ot=li*mt+Yi*Zt+pi*Et;Ot=-Ot/(li*li+Yi*Yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=Zt,a.z=Et,It=1;else if(Ot>1)a.x=Ft,a.y=Wt,a.z=Kt,It=2;else{let Qt,xi,Ri;Qt=mt+li*Ot,xi=Zt+Yi*Ot,Ri=Et+pi*Ot,a.x=Qt,a.y=xi,a.z=Ri,It=3}jt=It,vi=a.x*a.x+a.y*a.y+a.z*a.z,Ti=a.x,mi=a.y,Ct=a.z}if(_e*$i+ne*ae+Ki*re<0){let mt,Zt,Et,Ft,Wt,Kt;mt=Mt.x,Zt=Mt.y,Et=Mt.z,Ft=Rt.x,Wt=Rt.y,Kt=Rt.z;let li,Yi,pi;li=Ft-mt,Yi=Wt-Zt,pi=Kt-Et;let Ot=li*mt+Yi*Zt+pi*Et;Ot=-Ot/(li*li+Yi*Yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=Zt,a.z=Et,It=1;else if(Ot>1)a.x=Ft,a.y=Wt,a.z=Kt,It=2;else{let xi,Ri,ee;xi=mt+li*Ot,Ri=Zt+Yi*Ot,ee=Et+pi*Ot,a.x=xi,a.y=Ri,a.z=ee,It=3}let Qt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Qt<vi)&&(jt=It<<1,vi=Qt,Ti=a.x,mi=a.y,Ct=a.z)}if(ie*pe+Ui*ti+Wi*Fi<0){let mt,Zt,Et,Ft,Wt,Kt;mt=kt.x,Zt=kt.y,Et=kt.z,Ft=Rt.x,Wt=Rt.y,Kt=Rt.z;let li,Yi,pi;li=Ft-mt,Yi=Wt-Zt,pi=Kt-Et;let Ot=li*mt+Yi*Zt+pi*Et;Ot=-Ot/(li*li+Yi*Yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=Zt,a.z=Et,It=1;else if(Ot>1)a.x=Ft,a.y=Wt,a.z=Kt,It=2;else{let xi,Ri,ee;xi=mt+li*Ot,Ri=Zt+Yi*Ot,ee=Et+pi*Ot,a.x=xi,a.y=Ri,a.z=ee,It=3}let Qt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Qt<vi)&&(jt=It&1|(It&2)<<1,vi=Qt,Ti=a.x,mi=a.y,Ct=a.z)}let hi;if(vi>0)a.x=Ti,a.y=mi,a.z=Ct,hi=jt;else{let mt=Gt*Gt+dt*dt+Lt*Lt;mt>0&&(mt=1/Math.sqrt(mt)),Gt*=mt,dt*=mt,Lt*=mt;let Zt=Gt*Gt+dt*dt+Lt*Lt;Zt=(Ni*Gt+Ji*dt+Hi*Lt)/Zt,Ti=Gt*Zt,mi=dt*Zt,Ct=Lt*Zt,a.x=Ti,a.y=mi,a.z=Ct,hi=7}let qt=a.x*a.x+a.y*a.y+a.z*a.z;(oi<0||qt<oi)&&(Ye=hi&1|(hi&6)<<1,oi=qt,ce=a.x,be=a.y,xe=a.z)}if((ci*Ii+Xi*bi+gi*se)*ve<0){let Ni,Ji,Hi,_e,ne,Ki,ie,Ui,Wi,Si,Ht,ri,Tt,Mi,zi,Pi,Vi,ji;Ni=kt.x,Ji=kt.y,Hi=kt.z,_e=Bt.x,ne=Bt.y,Ki=Bt.z,ie=Rt.x,Ui=Rt.y,Wi=Rt.z,Si=_e-Ni,Ht=ne-Ji,ri=Ki-Hi,Tt=ie-_e,Mi=Ui-ne,zi=Wi-Ki,Pi=Ni-ie,Vi=Ji-Ui,ji=Hi-Wi;let Gt,dt,Lt;Gt=Ht*zi-ri*Mi,dt=ri*Tt-Si*zi,Lt=Si*Mi-Ht*Tt;let Ai,Li,Di,$i,ae,re,pe,ti,Fi;Ai=Ht*Lt-ri*dt,Li=ri*Gt-Si*Lt,Di=Si*dt-Ht*Gt,$i=Mi*Lt-zi*dt,ae=zi*Gt-Tt*Lt,re=Tt*dt-Mi*Gt,pe=Vi*Lt-ji*dt,ti=ji*Gt-Pi*Lt,Fi=Pi*dt-Vi*Gt;let vi=-1,Ti,mi,Ct,jt=0;if(Ti=0,mi=0,Ct=0,Ni*Ai+Ji*Li+Hi*Di<0){let mt,Zt,Et,Ft,Wt,Kt;mt=kt.x,Zt=kt.y,Et=kt.z,Ft=Bt.x,Wt=Bt.y,Kt=Bt.z;let li,Yi,pi;li=Ft-mt,Yi=Wt-Zt,pi=Kt-Et;let Ot=li*mt+Yi*Zt+pi*Et;Ot=-Ot/(li*li+Yi*Yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=Zt,a.z=Et,It=1;else if(Ot>1)a.x=Ft,a.y=Wt,a.z=Kt,It=2;else{let Qt,xi,Ri;Qt=mt+li*Ot,xi=Zt+Yi*Ot,Ri=Et+pi*Ot,a.x=Qt,a.y=xi,a.z=Ri,It=3}jt=It,vi=a.x*a.x+a.y*a.y+a.z*a.z,Ti=a.x,mi=a.y,Ct=a.z}if(_e*$i+ne*ae+Ki*re<0){let mt,Zt,Et,Ft,Wt,Kt;mt=Bt.x,Zt=Bt.y,Et=Bt.z,Ft=Rt.x,Wt=Rt.y,Kt=Rt.z;let li,Yi,pi;li=Ft-mt,Yi=Wt-Zt,pi=Kt-Et;let Ot=li*mt+Yi*Zt+pi*Et;Ot=-Ot/(li*li+Yi*Yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=Zt,a.z=Et,It=1;else if(Ot>1)a.x=Ft,a.y=Wt,a.z=Kt,It=2;else{let xi,Ri,ee;xi=mt+li*Ot,Ri=Zt+Yi*Ot,ee=Et+pi*Ot,a.x=xi,a.y=Ri,a.z=ee,It=3}let Qt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Qt<vi)&&(jt=It<<1,vi=Qt,Ti=a.x,mi=a.y,Ct=a.z)}if(ie*pe+Ui*ti+Wi*Fi<0){let mt,Zt,Et,Ft,Wt,Kt;mt=kt.x,Zt=kt.y,Et=kt.z,Ft=Rt.x,Wt=Rt.y,Kt=Rt.z;let li,Yi,pi;li=Ft-mt,Yi=Wt-Zt,pi=Kt-Et;let Ot=li*mt+Yi*Zt+pi*Et;Ot=-Ot/(li*li+Yi*Yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=Zt,a.z=Et,It=1;else if(Ot>1)a.x=Ft,a.y=Wt,a.z=Kt,It=2;else{let xi,Ri,ee;xi=mt+li*Ot,Ri=Zt+Yi*Ot,ee=Et+pi*Ot,a.x=xi,a.y=Ri,a.z=ee,It=3}let Qt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Qt<vi)&&(jt=It&1|(It&2)<<1,vi=Qt,Ti=a.x,mi=a.y,Ct=a.z)}let hi;if(vi>0)a.x=Ti,a.y=mi,a.z=Ct,hi=jt;else{let mt=Gt*Gt+dt*dt+Lt*Lt;mt>0&&(mt=1/Math.sqrt(mt)),Gt*=mt,dt*=mt,Lt*=mt;let Zt=Gt*Gt+dt*dt+Lt*Lt;Zt=(Ni*Gt+Ji*dt+Hi*Lt)/Zt,Ti=Gt*Zt,mi=dt*Zt,Ct=Lt*Zt,a.x=Ti,a.y=mi,a.z=Ct,hi=7}let qt=a.x*a.x+a.y*a.y+a.z*a.z;(oi<0||qt<oi)&&(Ye=hi&3|(hi&4)<<1,oi=qt,ce=a.x,be=a.y,xe=a.z)}if((ki*me+wi*Ei+ei*he)*ve<0){let Ni,Ji,Hi,_e,ne,Ki,ie,Ui,Wi,Si,Ht,ri,Tt,Mi,zi,Pi,Vi,ji;Ni=Bt.x,Ji=Bt.y,Hi=Bt.z,_e=Mt.x,ne=Mt.y,Ki=Mt.z,ie=Rt.x,Ui=Rt.y,Wi=Rt.z,Si=_e-Ni,Ht=ne-Ji,ri=Ki-Hi,Tt=ie-_e,Mi=Ui-ne,zi=Wi-Ki,Pi=Ni-ie,Vi=Ji-Ui,ji=Hi-Wi;let Gt,dt,Lt;Gt=Ht*zi-ri*Mi,dt=ri*Tt-Si*zi,Lt=Si*Mi-Ht*Tt;let Ai,Li,Di,$i,ae,re,pe,ti,Fi;Ai=Ht*Lt-ri*dt,Li=ri*Gt-Si*Lt,Di=Si*dt-Ht*Gt,$i=Mi*Lt-zi*dt,ae=zi*Gt-Tt*Lt,re=Tt*dt-Mi*Gt,pe=Vi*Lt-ji*dt,ti=ji*Gt-Pi*Lt,Fi=Pi*dt-Vi*Gt;let vi=-1,Ti,mi,Ct,jt=0;if(Ti=0,mi=0,Ct=0,Ni*Ai+Ji*Li+Hi*Di<0){let mt,Zt,Et,Ft,Wt,Kt;mt=Bt.x,Zt=Bt.y,Et=Bt.z,Ft=Mt.x,Wt=Mt.y,Kt=Mt.z;let li,Yi,pi;li=Ft-mt,Yi=Wt-Zt,pi=Kt-Et;let Ot=li*mt+Yi*Zt+pi*Et;Ot=-Ot/(li*li+Yi*Yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=Zt,a.z=Et,It=1;else if(Ot>1)a.x=Ft,a.y=Wt,a.z=Kt,It=2;else{let Qt,xi,Ri;Qt=mt+li*Ot,xi=Zt+Yi*Ot,Ri=Et+pi*Ot,a.x=Qt,a.y=xi,a.z=Ri,It=3}jt=It,vi=a.x*a.x+a.y*a.y+a.z*a.z,Ti=a.x,mi=a.y,Ct=a.z}if(_e*$i+ne*ae+Ki*re<0){let mt,Zt,Et,Ft,Wt,Kt;mt=Mt.x,Zt=Mt.y,Et=Mt.z,Ft=Rt.x,Wt=Rt.y,Kt=Rt.z;let li,Yi,pi;li=Ft-mt,Yi=Wt-Zt,pi=Kt-Et;let Ot=li*mt+Yi*Zt+pi*Et;Ot=-Ot/(li*li+Yi*Yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=Zt,a.z=Et,It=1;else if(Ot>1)a.x=Ft,a.y=Wt,a.z=Kt,It=2;else{let xi,Ri,ee;xi=mt+li*Ot,Ri=Zt+Yi*Ot,ee=Et+pi*Ot,a.x=xi,a.y=Ri,a.z=ee,It=3}let Qt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Qt<vi)&&(jt=It<<1,vi=Qt,Ti=a.x,mi=a.y,Ct=a.z)}if(ie*pe+Ui*ti+Wi*Fi<0){let mt,Zt,Et,Ft,Wt,Kt;mt=Bt.x,Zt=Bt.y,Et=Bt.z,Ft=Rt.x,Wt=Rt.y,Kt=Rt.z;let li,Yi,pi;li=Ft-mt,Yi=Wt-Zt,pi=Kt-Et;let Ot=li*mt+Yi*Zt+pi*Et;Ot=-Ot/(li*li+Yi*Yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=Zt,a.z=Et,It=1;else if(Ot>1)a.x=Ft,a.y=Wt,a.z=Kt,It=2;else{let xi,Ri,ee;xi=mt+li*Ot,Ri=Zt+Yi*Ot,ee=Et+pi*Ot,a.x=xi,a.y=Ri,a.z=ee,It=3}let Qt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Qt<vi)&&(jt=It&1|(It&2)<<1,vi=Qt,Ti=a.x,mi=a.y,Ct=a.z)}let hi;if(vi>0)a.x=Ti,a.y=mi,a.z=Ct,hi=jt;else{let mt=Gt*Gt+dt*dt+Lt*Lt;mt>0&&(mt=1/Math.sqrt(mt)),Gt*=mt,dt*=mt,Lt*=mt;let Zt=Gt*Gt+dt*dt+Lt*Lt;Zt=(Ni*Gt+Ji*dt+Hi*Lt)/Zt,Ti=Gt*Zt,mi=dt*Zt,Ct=Lt*Zt,a.x=Ti,a.y=mi,a.z=Ct,hi=7}let qt=a.x*a.x+a.y*a.y+a.z*a.z;(oi<0||qt<oi)&&(Ye=hi<<1,oi=qt,ce=a.x,be=a.y,xe=a.z)}oi>0?(a.x=ce,a.y=be,a.z=xe,p=Ye):(a.zero(),p=15);break}if(a.x*a.x+a.y*a.y+a.z*a.z<1e-8){if(!l)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron();break}if(this.simplexSize==4){let V=this.computeDepth(t,i,s,_,o,r,e);return V!=0?(this.distance=0,V):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(p),h.x=a.x,h.y=a.y,h.z=a.z,h.x=-h.x,h.y=-h.y,h.z=-h.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let x=this.s[this.simplexSize],v=this.w1[this.simplexSize];x.x=v.x,x.y=v.y,x.z=v.z;let f=this.w2[this.simplexSize];if(x.x-=f.x,x.y-=f.y,x.z-=f.z,h.x*h.x+h.y*h.y+h.z*h.z<1e-8)throw new Error("!?");let g=o[this.simplexSize];if(g.x*h.x+g.y*h.y+g.z*h.z-(a.x*h.x+a.y*h.y+a.z*h.z)<1e-8)return this.interpolateClosestPoints(),this.distance=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),n!=null&&n._gjkCache!=null&&this.saveCache(n._gjkCache),0;this.simplexSize++,++u}return 2}convexCastImpl(t,i,s,_,n,l,o){this.c1=t,this.c2=i,this.tf1=s,this.tf2=_;let r=this.s,e=this.closest,a=this.dir,h,b,X;if(h=_._positionX-s._positionX,b=_._positionY-s._positionY,X=_._positionZ-s._positionZ,a.x=h,a.y=b,a.z=X,a.x*a.x+a.y*a.y+a.z*a.z<1e-6&&a.init(1,0,0),this.simplexSize=0,this.c1!=null)this.computeWitnessPoint1(!0);else{let V=this.w1[this.simplexSize];V.x=this.tf1._positionX,V.y=this.tf1._positionY,V.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let c=this.s[this.simplexSize],u=this.w1[this.simplexSize];c.x=u.x,c.y=u.y,c.z=u.z;let p=this.w2[this.simplexSize];c.x-=p.x,c.y-=p.y,c.z-=p.z,this.simplexSize=1;let x=0,v=0,f=this.rayX,g=this.rayR;for(f.zero(),g.x=l.x,g.y=l.y,g.z=l.z,g.x-=n.x,g.y-=n.y,g.z-=n.z;x<40;){let V=0;switch(this.simplexSize){case 1:let z=r[0];e.x=z.x,e.y=z.y,e.z=z.z,V=1;break;case 2:let w,S,P,T,C,L,q=r[0];w=q.x,S=q.y,P=q.z;let U=r[1];T=U.x,C=U.y,L=U.z;let Y,E,D;Y=T-w,E=C-S,D=L-P;let Q=Y*w+E*S+D*P;if(Q=-Q/(Y*Y+E*E+D*D),Q<0)e.x=w,e.y=S,e.z=P,V=1;else if(Q>1)e.x=T,e.y=C,e.z=L,V=2;else{let Ht,ri,Tt;Ht=w+Y*Q,ri=S+E*Q,Tt=P+D*Q,e.x=Ht,e.y=ri,e.z=Tt,V=3}break;case 3:let W=r[0],F=r[1],H=r[2],G,J,N,K,O,$,et,st,lt,rt,at,_t,ht,ot,bt,Xt,ft,ut;G=W.x,J=W.y,N=W.z,K=F.x,O=F.y,$=F.z,et=H.x,st=H.y,lt=H.z,rt=K-G,at=O-J,_t=$-N,ht=et-K,ot=st-O,bt=lt-$,Xt=G-et,ft=J-st,ut=N-lt;let xt,zt,gt;xt=at*bt-_t*ot,zt=_t*ht-rt*bt,gt=rt*ot-at*ht;let pt,ct,nt,tt,kt,Bt,Mt,Rt,ci;pt=at*gt-_t*zt,ct=_t*xt-rt*gt,nt=rt*zt-at*xt,tt=ot*gt-bt*zt,kt=bt*xt-ht*gt,Bt=ht*zt-ot*xt,Mt=ft*gt-ut*zt,Rt=ut*xt-Xt*gt,ci=Xt*zt-ft*xt;let Xi=-1,gi,ki,wi,ei=0;if(gi=0,ki=0,wi=0,G*pt+J*ct+N*nt<0){let Ht,ri,Tt,Mi,zi,Pi;Ht=W.x,ri=W.y,Tt=W.z,Mi=F.x,zi=F.y,Pi=F.z;let Vi,ji,Gt;Vi=Mi-Ht,ji=zi-ri,Gt=Pi-Tt;let dt=Vi*Ht+ji*ri+Gt*Tt;dt=-dt/(Vi*Vi+ji*ji+Gt*Gt);let Lt;if(dt<0)e.x=Ht,e.y=ri,e.z=Tt,Lt=1;else if(dt>1)e.x=Mi,e.y=zi,e.z=Pi,Lt=2;else{let Ai,Li,Di;Ai=Ht+Vi*dt,Li=ri+ji*dt,Di=Tt+Gt*dt,e.x=Ai,e.y=Li,e.z=Di,Lt=3}ei=Lt,Xi=e.x*e.x+e.y*e.y+e.z*e.z,gi=e.x,ki=e.y,wi=e.z}if(K*tt+O*kt+$*Bt<0){let Ht,ri,Tt,Mi,zi,Pi;Ht=F.x,ri=F.y,Tt=F.z,Mi=H.x,zi=H.y,Pi=H.z;let Vi,ji,Gt;Vi=Mi-Ht,ji=zi-ri,Gt=Pi-Tt;let dt=Vi*Ht+ji*ri+Gt*Tt;dt=-dt/(Vi*Vi+ji*ji+Gt*Gt);let Lt;if(dt<0)e.x=Ht,e.y=ri,e.z=Tt,Lt=1;else if(dt>1)e.x=Mi,e.y=zi,e.z=Pi,Lt=2;else{let Li,Di,$i;Li=Ht+Vi*dt,Di=ri+ji*dt,$i=Tt+Gt*dt,e.x=Li,e.y=Di,e.z=$i,Lt=3}let Ai=e.x*e.x+e.y*e.y+e.z*e.z;(Xi<0||Ai<Xi)&&(ei=Lt<<1,Xi=Ai,gi=e.x,ki=e.y,wi=e.z)}if(et*Mt+st*Rt+lt*ci<0){let Ht,ri,Tt,Mi,zi,Pi;Ht=W.x,ri=W.y,Tt=W.z,Mi=H.x,zi=H.y,Pi=H.z;let Vi,ji,Gt;Vi=Mi-Ht,ji=zi-ri,Gt=Pi-Tt;let dt=Vi*Ht+ji*ri+Gt*Tt;dt=-dt/(Vi*Vi+ji*ji+Gt*Gt);let Lt;if(dt<0)e.x=Ht,e.y=ri,e.z=Tt,Lt=1;else if(dt>1)e.x=Mi,e.y=zi,e.z=Pi,Lt=2;else{let Li,Di,$i;Li=Ht+Vi*dt,Di=ri+ji*dt,$i=Tt+Gt*dt,e.x=Li,e.y=Di,e.z=$i,Lt=3}let Ai=e.x*e.x+e.y*e.y+e.z*e.z;(Xi<0||Ai<Xi)&&(ei=Lt&1|(Lt&2)<<1,Xi=Ai,gi=e.x,ki=e.y,wi=e.z)}if(Xi>0)e.x=gi,e.y=ki,e.z=wi,V=ei;else{let Ht=xt*xt+zt*zt+gt*gt;Ht>0&&(Ht=1/Math.sqrt(Ht)),xt*=Ht,zt*=Ht,gt*=Ht;let ri=xt*xt+zt*zt+gt*gt;ri=(G*xt+J*zt+N*gt)/ri,gi=xt*ri,ki=zt*ri,wi=gt*ri,e.x=gi,e.y=ki,e.z=wi,V=7}break;case 4:let Nt=r[0],At=r[1],ni=r[2],di=r[3],Oi,Bi,Vt,wt,$t,fi,Zi,it,Ut,ii,j,Jt,Pt,si,_i,St,ai,qi,ui,Yt,yt,vt,yi,Ii,bi,se,me;Oi=Nt.x,Bi=Nt.y,Vt=Nt.z,wt=At.x,$t=At.y,fi=At.z,Zi=ni.x,it=ni.y,Ut=ni.z,ii=di.x,j=di.y,Jt=di.z,Pt=wt-Oi,si=$t-Bi,_i=fi-Vt,St=Zi-Oi,ai=it-Bi,qi=Ut-Vt,ui=ii-Oi,Yt=j-Bi,yt=Jt-Vt,vt=Zi-wt,yi=it-$t,Ii=Ut-fi,bi=ii-wt,se=j-$t,me=Jt-fi;let Ei,he,ve,oi,ce,be,xe,Ye,Ni,Ji,Hi,_e;Ei=si*qi-_i*ai,he=_i*St-Pt*qi,ve=Pt*ai-si*St,oi=ai*yt-qi*Yt,ce=qi*ui-St*yt,be=St*Yt-ai*ui,xe=Yt*_i-yt*si,Ye=yt*Pt-ui*_i,Ni=ui*si-Yt*Pt,Ji=se*Ii-me*yi,Hi=me*vt-bi*Ii,_e=bi*yi-se*vt;let ne=Pt*Ji+si*Hi+_i*_e>0?1:-1,Ki=-1,ie,Ui,Wi,Si=0;if(ie=0,Ui=0,Wi=0,(Oi*Ei+Bi*he+Vt*ve)*ne<0){let Ht,ri,Tt,Mi,zi,Pi,Vi,ji,Gt,dt,Lt,Ai,Li,Di,$i,ae,re,pe;Ht=Nt.x,ri=Nt.y,Tt=Nt.z,Mi=At.x,zi=At.y,Pi=At.z,Vi=ni.x,ji=ni.y,Gt=ni.z,dt=Mi-Ht,Lt=zi-ri,Ai=Pi-Tt,Li=Vi-Mi,Di=ji-zi,$i=Gt-Pi,ae=Ht-Vi,re=ri-ji,pe=Tt-Gt;let ti,Fi,vi;ti=Lt*$i-Ai*Di,Fi=Ai*Li-dt*$i,vi=dt*Di-Lt*Li;let Ti,mi,Ct,jt,hi,qt,mt,Zt,Et;Ti=Lt*vi-Ai*Fi,mi=Ai*ti-dt*vi,Ct=dt*Fi-Lt*ti,jt=Di*vi-$i*Fi,hi=$i*ti-Li*vi,qt=Li*Fi-Di*ti,mt=re*vi-pe*Fi,Zt=pe*ti-ae*vi,Et=ae*Fi-re*ti;let Ft=-1,Wt,Kt,li,Yi=0;if(Wt=0,Kt=0,li=0,Ht*Ti+ri*mi+Tt*Ct<0){let Ot,It,Qt,xi,Ri,ee;Ot=Nt.x,It=Nt.y,Qt=Nt.z,xi=At.x,Ri=At.y,ee=At.z;let oe,Qi,te;oe=xi-Ot,Qi=Ri-It,te=ee-Qt;let Gi=oe*Ot+Qi*It+te*Qt;Gi=-Gi/(oe*oe+Qi*Qi+te*te);let Ci;if(Gi<0)e.x=Ot,e.y=It,e.z=Qt,Ci=1;else if(Gi>1)e.x=xi,e.y=Ri,e.z=ee,Ci=2;else{let le,fe,Xe;le=Ot+oe*Gi,fe=It+Qi*Gi,Xe=Qt+te*Gi,e.x=le,e.y=fe,e.z=Xe,Ci=3}Yi=Ci,Ft=e.x*e.x+e.y*e.y+e.z*e.z,Wt=e.x,Kt=e.y,li=e.z}if(Mi*jt+zi*hi+Pi*qt<0){let Ot,It,Qt,xi,Ri,ee;Ot=At.x,It=At.y,Qt=At.z,xi=ni.x,Ri=ni.y,ee=ni.z;let oe,Qi,te;oe=xi-Ot,Qi=Ri-It,te=ee-Qt;let Gi=oe*Ot+Qi*It+te*Qt;Gi=-Gi/(oe*oe+Qi*Qi+te*te);let Ci;if(Gi<0)e.x=Ot,e.y=It,e.z=Qt,Ci=1;else if(Gi>1)e.x=xi,e.y=Ri,e.z=ee,Ci=2;else{let fe,Xe,Ze;fe=Ot+oe*Gi,Xe=It+Qi*Gi,Ze=Qt+te*Gi,e.x=fe,e.y=Xe,e.z=Ze,Ci=3}let le=e.x*e.x+e.y*e.y+e.z*e.z;(Ft<0||le<Ft)&&(Yi=Ci<<1,Ft=le,Wt=e.x,Kt=e.y,li=e.z)}if(Vi*mt+ji*Zt+Gt*Et<0){let Ot,It,Qt,xi,Ri,ee;Ot=Nt.x,It=Nt.y,Qt=Nt.z,xi=ni.x,Ri=ni.y,ee=ni.z;let oe,Qi,te;oe=xi-Ot,Qi=Ri-It,te=ee-Qt;let Gi=oe*Ot+Qi*It+te*Qt;Gi=-Gi/(oe*oe+Qi*Qi+te*te);let Ci;if(Gi<0)e.x=Ot,e.y=It,e.z=Qt,Ci=1;else if(Gi>1)e.x=xi,e.y=Ri,e.z=ee,Ci=2;else{let fe,Xe,Ze;fe=Ot+oe*Gi,Xe=It+Qi*Gi,Ze=Qt+te*Gi,e.x=fe,e.y=Xe,e.z=Ze,Ci=3}let le=e.x*e.x+e.y*e.y+e.z*e.z;(Ft<0||le<Ft)&&(Yi=Ci&1|(Ci&2)<<1,Ft=le,Wt=e.x,Kt=e.y,li=e.z)}let pi;if(Ft>0)e.x=Wt,e.y=Kt,e.z=li,pi=Yi;else{let Ot=ti*ti+Fi*Fi+vi*vi;Ot>0&&(Ot=1/Math.sqrt(Ot)),ti*=Ot,Fi*=Ot,vi*=Ot;let It=ti*ti+Fi*Fi+vi*vi;It=(Ht*ti+ri*Fi+Tt*vi)/It,Wt=ti*It,Kt=Fi*It,li=vi*It,e.x=Wt,e.y=Kt,e.z=li,pi=7}Si=pi,Ki=e.x*e.x+e.y*e.y+e.z*e.z,ie=e.x,Ui=e.y,Wi=e.z}if((Oi*oi+Bi*ce+Vt*be)*ne<0){let Ht,ri,Tt,Mi,zi,Pi,Vi,ji,Gt,dt,Lt,Ai,Li,Di,$i,ae,re,pe;Ht=Nt.x,ri=Nt.y,Tt=Nt.z,Mi=ni.x,zi=ni.y,Pi=ni.z,Vi=di.x,ji=di.y,Gt=di.z,dt=Mi-Ht,Lt=zi-ri,Ai=Pi-Tt,Li=Vi-Mi,Di=ji-zi,$i=Gt-Pi,ae=Ht-Vi,re=ri-ji,pe=Tt-Gt;let ti,Fi,vi;ti=Lt*$i-Ai*Di,Fi=Ai*Li-dt*$i,vi=dt*Di-Lt*Li;let Ti,mi,Ct,jt,hi,qt,mt,Zt,Et;Ti=Lt*vi-Ai*Fi,mi=Ai*ti-dt*vi,Ct=dt*Fi-Lt*ti,jt=Di*vi-$i*Fi,hi=$i*ti-Li*vi,qt=Li*Fi-Di*ti,mt=re*vi-pe*Fi,Zt=pe*ti-ae*vi,Et=ae*Fi-re*ti;let Ft=-1,Wt,Kt,li,Yi=0;if(Wt=0,Kt=0,li=0,Ht*Ti+ri*mi+Tt*Ct<0){let It,Qt,xi,Ri,ee,oe;It=Nt.x,Qt=Nt.y,xi=Nt.z,Ri=ni.x,ee=ni.y,oe=ni.z;let Qi,te,Gi;Qi=Ri-It,te=ee-Qt,Gi=oe-xi;let Ci=Qi*It+te*Qt+Gi*xi;Ci=-Ci/(Qi*Qi+te*te+Gi*Gi);let le;if(Ci<0)e.x=It,e.y=Qt,e.z=xi,le=1;else if(Ci>1)e.x=Ri,e.y=ee,e.z=oe,le=2;else{let fe,Xe,Ze;fe=It+Qi*Ci,Xe=Qt+te*Ci,Ze=xi+Gi*Ci,e.x=fe,e.y=Xe,e.z=Ze,le=3}Yi=le,Ft=e.x*e.x+e.y*e.y+e.z*e.z,Wt=e.x,Kt=e.y,li=e.z}if(Mi*jt+zi*hi+Pi*qt<0){let It,Qt,xi,Ri,ee,oe;It=ni.x,Qt=ni.y,xi=ni.z,Ri=di.x,ee=di.y,oe=di.z;let Qi,te,Gi;Qi=Ri-It,te=ee-Qt,Gi=oe-xi;let Ci=Qi*It+te*Qt+Gi*xi;Ci=-Ci/(Qi*Qi+te*te+Gi*Gi);let le;if(Ci<0)e.x=It,e.y=Qt,e.z=xi,le=1;else if(Ci>1)e.x=Ri,e.y=ee,e.z=oe,le=2;else{let Xe,Ze,ye;Xe=It+Qi*Ci,Ze=Qt+te*Ci,ye=xi+Gi*Ci,e.x=Xe,e.y=Ze,e.z=ye,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Ft<0||fe<Ft)&&(Yi=le<<1,Ft=fe,Wt=e.x,Kt=e.y,li=e.z)}if(Vi*mt+ji*Zt+Gt*Et<0){let It,Qt,xi,Ri,ee,oe;It=Nt.x,Qt=Nt.y,xi=Nt.z,Ri=di.x,ee=di.y,oe=di.z;let Qi,te,Gi;Qi=Ri-It,te=ee-Qt,Gi=oe-xi;let Ci=Qi*It+te*Qt+Gi*xi;Ci=-Ci/(Qi*Qi+te*te+Gi*Gi);let le;if(Ci<0)e.x=It,e.y=Qt,e.z=xi,le=1;else if(Ci>1)e.x=Ri,e.y=ee,e.z=oe,le=2;else{let Xe,Ze,ye;Xe=It+Qi*Ci,Ze=Qt+te*Ci,ye=xi+Gi*Ci,e.x=Xe,e.y=Ze,e.z=ye,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Ft<0||fe<Ft)&&(Yi=le&1|(le&2)<<1,Ft=fe,Wt=e.x,Kt=e.y,li=e.z)}let pi;if(Ft>0)e.x=Wt,e.y=Kt,e.z=li,pi=Yi;else{let It=ti*ti+Fi*Fi+vi*vi;It>0&&(It=1/Math.sqrt(It)),ti*=It,Fi*=It,vi*=It;let Qt=ti*ti+Fi*Fi+vi*vi;Qt=(Ht*ti+ri*Fi+Tt*vi)/Qt,Wt=ti*Qt,Kt=Fi*Qt,li=vi*Qt,e.x=Wt,e.y=Kt,e.z=li,pi=7}let Ot=e.x*e.x+e.y*e.y+e.z*e.z;(Ki<0||Ot<Ki)&&(Si=pi&1|(pi&6)<<1,Ki=Ot,ie=e.x,Ui=e.y,Wi=e.z)}if((Oi*xe+Bi*Ye+Vt*Ni)*ne<0){let Ht,ri,Tt,Mi,zi,Pi,Vi,ji,Gt,dt,Lt,Ai,Li,Di,$i,ae,re,pe;Ht=Nt.x,ri=Nt.y,Tt=Nt.z,Mi=At.x,zi=At.y,Pi=At.z,Vi=di.x,ji=di.y,Gt=di.z,dt=Mi-Ht,Lt=zi-ri,Ai=Pi-Tt,Li=Vi-Mi,Di=ji-zi,$i=Gt-Pi,ae=Ht-Vi,re=ri-ji,pe=Tt-Gt;let ti,Fi,vi;ti=Lt*$i-Ai*Di,Fi=Ai*Li-dt*$i,vi=dt*Di-Lt*Li;let Ti,mi,Ct,jt,hi,qt,mt,Zt,Et;Ti=Lt*vi-Ai*Fi,mi=Ai*ti-dt*vi,Ct=dt*Fi-Lt*ti,jt=Di*vi-$i*Fi,hi=$i*ti-Li*vi,qt=Li*Fi-Di*ti,mt=re*vi-pe*Fi,Zt=pe*ti-ae*vi,Et=ae*Fi-re*ti;let Ft=-1,Wt,Kt,li,Yi=0;if(Wt=0,Kt=0,li=0,Ht*Ti+ri*mi+Tt*Ct<0){let It,Qt,xi,Ri,ee,oe;It=Nt.x,Qt=Nt.y,xi=Nt.z,Ri=At.x,ee=At.y,oe=At.z;let Qi,te,Gi;Qi=Ri-It,te=ee-Qt,Gi=oe-xi;let Ci=Qi*It+te*Qt+Gi*xi;Ci=-Ci/(Qi*Qi+te*te+Gi*Gi);let le;if(Ci<0)e.x=It,e.y=Qt,e.z=xi,le=1;else if(Ci>1)e.x=Ri,e.y=ee,e.z=oe,le=2;else{let fe,Xe,Ze;fe=It+Qi*Ci,Xe=Qt+te*Ci,Ze=xi+Gi*Ci,e.x=fe,e.y=Xe,e.z=Ze,le=3}Yi=le,Ft=e.x*e.x+e.y*e.y+e.z*e.z,Wt=e.x,Kt=e.y,li=e.z}if(Mi*jt+zi*hi+Pi*qt<0){let It,Qt,xi,Ri,ee,oe;It=At.x,Qt=At.y,xi=At.z,Ri=di.x,ee=di.y,oe=di.z;let Qi,te,Gi;Qi=Ri-It,te=ee-Qt,Gi=oe-xi;let Ci=Qi*It+te*Qt+Gi*xi;Ci=-Ci/(Qi*Qi+te*te+Gi*Gi);let le;if(Ci<0)e.x=It,e.y=Qt,e.z=xi,le=1;else if(Ci>1)e.x=Ri,e.y=ee,e.z=oe,le=2;else{let Xe,Ze,ye;Xe=It+Qi*Ci,Ze=Qt+te*Ci,ye=xi+Gi*Ci,e.x=Xe,e.y=Ze,e.z=ye,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Ft<0||fe<Ft)&&(Yi=le<<1,Ft=fe,Wt=e.x,Kt=e.y,li=e.z)}if(Vi*mt+ji*Zt+Gt*Et<0){let It,Qt,xi,Ri,ee,oe;It=Nt.x,Qt=Nt.y,xi=Nt.z,Ri=di.x,ee=di.y,oe=di.z;let Qi,te,Gi;Qi=Ri-It,te=ee-Qt,Gi=oe-xi;let Ci=Qi*It+te*Qt+Gi*xi;Ci=-Ci/(Qi*Qi+te*te+Gi*Gi);let le;if(Ci<0)e.x=It,e.y=Qt,e.z=xi,le=1;else if(Ci>1)e.x=Ri,e.y=ee,e.z=oe,le=2;else{let Xe,Ze,ye;Xe=It+Qi*Ci,Ze=Qt+te*Ci,ye=xi+Gi*Ci,e.x=Xe,e.y=Ze,e.z=ye,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Ft<0||fe<Ft)&&(Yi=le&1|(le&2)<<1,Ft=fe,Wt=e.x,Kt=e.y,li=e.z)}let pi;if(Ft>0)e.x=Wt,e.y=Kt,e.z=li,pi=Yi;else{let It=ti*ti+Fi*Fi+vi*vi;It>0&&(It=1/Math.sqrt(It)),ti*=It,Fi*=It,vi*=It;let Qt=ti*ti+Fi*Fi+vi*vi;Qt=(Ht*ti+ri*Fi+Tt*vi)/Qt,Wt=ti*Qt,Kt=Fi*Qt,li=vi*Qt,e.x=Wt,e.y=Kt,e.z=li,pi=7}let Ot=e.x*e.x+e.y*e.y+e.z*e.z;(Ki<0||Ot<Ki)&&(Si=pi&3|(pi&4)<<1,Ki=Ot,ie=e.x,Ui=e.y,Wi=e.z)}if((wt*Ji+$t*Hi+fi*_e)*ne<0){let Ht,ri,Tt,Mi,zi,Pi,Vi,ji,Gt,dt,Lt,Ai,Li,Di,$i,ae,re,pe;Ht=At.x,ri=At.y,Tt=At.z,Mi=ni.x,zi=ni.y,Pi=ni.z,Vi=di.x,ji=di.y,Gt=di.z,dt=Mi-Ht,Lt=zi-ri,Ai=Pi-Tt,Li=Vi-Mi,Di=ji-zi,$i=Gt-Pi,ae=Ht-Vi,re=ri-ji,pe=Tt-Gt;let ti,Fi,vi;ti=Lt*$i-Ai*Di,Fi=Ai*Li-dt*$i,vi=dt*Di-Lt*Li;let Ti,mi,Ct,jt,hi,qt,mt,Zt,Et;Ti=Lt*vi-Ai*Fi,mi=Ai*ti-dt*vi,Ct=dt*Fi-Lt*ti,jt=Di*vi-$i*Fi,hi=$i*ti-Li*vi,qt=Li*Fi-Di*ti,mt=re*vi-pe*Fi,Zt=pe*ti-ae*vi,Et=ae*Fi-re*ti;let Ft=-1,Wt,Kt,li,Yi=0;if(Wt=0,Kt=0,li=0,Ht*Ti+ri*mi+Tt*Ct<0){let It,Qt,xi,Ri,ee,oe;It=At.x,Qt=At.y,xi=At.z,Ri=ni.x,ee=ni.y,oe=ni.z;let Qi,te,Gi;Qi=Ri-It,te=ee-Qt,Gi=oe-xi;let Ci=Qi*It+te*Qt+Gi*xi;Ci=-Ci/(Qi*Qi+te*te+Gi*Gi);let le;if(Ci<0)e.x=It,e.y=Qt,e.z=xi,le=1;else if(Ci>1)e.x=Ri,e.y=ee,e.z=oe,le=2;else{let fe,Xe,Ze;fe=It+Qi*Ci,Xe=Qt+te*Ci,Ze=xi+Gi*Ci,e.x=fe,e.y=Xe,e.z=Ze,le=3}Yi=le,Ft=e.x*e.x+e.y*e.y+e.z*e.z,Wt=e.x,Kt=e.y,li=e.z}if(Mi*jt+zi*hi+Pi*qt<0){let It,Qt,xi,Ri,ee,oe;It=ni.x,Qt=ni.y,xi=ni.z,Ri=di.x,ee=di.y,oe=di.z;let Qi,te,Gi;Qi=Ri-It,te=ee-Qt,Gi=oe-xi;let Ci=Qi*It+te*Qt+Gi*xi;Ci=-Ci/(Qi*Qi+te*te+Gi*Gi);let le;if(Ci<0)e.x=It,e.y=Qt,e.z=xi,le=1;else if(Ci>1)e.x=Ri,e.y=ee,e.z=oe,le=2;else{let Xe,Ze,ye;Xe=It+Qi*Ci,Ze=Qt+te*Ci,ye=xi+Gi*Ci,e.x=Xe,e.y=Ze,e.z=ye,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Ft<0||fe<Ft)&&(Yi=le<<1,Ft=fe,Wt=e.x,Kt=e.y,li=e.z)}if(Vi*mt+ji*Zt+Gt*Et<0){let It,Qt,xi,Ri,ee,oe;It=At.x,Qt=At.y,xi=At.z,Ri=di.x,ee=di.y,oe=di.z;let Qi,te,Gi;Qi=Ri-It,te=ee-Qt,Gi=oe-xi;let Ci=Qi*It+te*Qt+Gi*xi;Ci=-Ci/(Qi*Qi+te*te+Gi*Gi);let le;if(Ci<0)e.x=It,e.y=Qt,e.z=xi,le=1;else if(Ci>1)e.x=Ri,e.y=ee,e.z=oe,le=2;else{let Xe,Ze,ye;Xe=It+Qi*Ci,Ze=Qt+te*Ci,ye=xi+Gi*Ci,e.x=Xe,e.y=Ze,e.z=ye,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Ft<0||fe<Ft)&&(Yi=le&1|(le&2)<<1,Ft=fe,Wt=e.x,Kt=e.y,li=e.z)}let pi;if(Ft>0)e.x=Wt,e.y=Kt,e.z=li,pi=Yi;else{let It=ti*ti+Fi*Fi+vi*vi;It>0&&(It=1/Math.sqrt(It)),ti*=It,Fi*=It,vi*=It;let Qt=ti*ti+Fi*Fi+vi*vi;Qt=(Ht*ti+ri*Fi+Tt*vi)/Qt,Wt=ti*Qt,Kt=Fi*Qt,li=vi*Qt,e.x=Wt,e.y=Kt,e.z=li,pi=7}let Ot=e.x*e.x+e.y*e.y+e.z*e.z;(Ki<0||Ot<Ki)&&(Si=pi<<1,Ki=Ot,ie=e.x,Ui=e.y,Wi=e.z)}Ki>0?(e.x=ie,e.y=Ui,e.z=Wi,V=Si):(e.zero(),V=15);break}if(this.shrinkSimplex(V),e.x*e.x+e.y*e.y+e.z*e.z<1e-8){if(v==0||this.simplexSize==4)return o.fraction=v,!1;this.interpolateClosestPoints(),o.fraction=v;let z=o.normal;z.x=a.x,z.y=a.y,z.z=a.z;let w=Math.sqrt(z.x*z.x+z.y*z.y+z.z*z.z);w>0&&(w=1/w),z.x*=w,z.y*=w,z.z*=w;let S=o.position,P=this.closestPoint1;return S.x=P.x,S.y=P.y,S.z=P.z,S.x+=n.x*v,S.y+=n.y*v,S.z+=n.z*v,!0}if(a.x=e.x,a.y=e.y,a.z=e.z,a.x=-a.x,a.y=-a.y,a.z=-a.z,this.c1!=null)this.computeWitnessPoint1(!0);else{let z=this.w1[this.simplexSize];z.x=this.tf1._positionX,z.y=this.tf1._positionY,z.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let Z=this.s[this.simplexSize],I=this.w1[this.simplexSize];Z.x=I.x,Z.y=I.y,Z.z=I.z;let M=this.w2[this.simplexSize];Z.x-=M.x,Z.y-=M.y,Z.z-=M.z;let y=r[this.simplexSize];if(y.x-=f.x,y.y-=f.y,y.z-=f.z,a.x*a.x+a.y*a.y+a.z*a.z<1e-8)throw new Error("!?");let d=r[this.simplexSize],B=d.x*a.x+d.y*a.y+d.z*a.z;if(B<0){if(g.x*a.x+g.y*a.y+g.z*a.z>=0)return!1;let z=B/(g.x*a.x+g.y*a.y+g.z*a.z);if(v+=z,v>=1)return!1;f.x+=g.x*z,f.y+=g.y*z,f.z+=g.z*z;let w=0,S=this.simplexSize+1;for(;w<S;){let P=r[w++],T=-z;P.x+=g.x*T,P.y+=g.y*T,P.z+=g.z*T}}let R=!1,k=0,A=this.simplexSize;for(;k<A;){let z=k++,w=r[z].x-r[this.simplexSize].x,S=r[z].y-r[this.simplexSize].y,P=r[z].z-r[this.simplexSize].z;if(w*w+S*S+P*P<1e-8){R=!0;break}}R||this.simplexSize++,++x}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:let t=this.closestPoint1,i=this.w1[0];t.x=i.x,t.y=i.y,t.z=i.z;let s=this.closestPoint2,_=this.w2[0];s.x=_.x,s.y=_.y,s.z=_.z;break;case 2:let n,l,o,r=this.closest;n=r.x,l=r.y,o=r.z;let e,a,h,b,X,c,u,p,x,v,f,g,V,Z,I,M,y,d,B=this.s[0];e=B.x,a=B.y,h=B.z;let R=this.w1[0];b=R.x,X=R.y,c=R.z;let k=this.w2[0];u=k.x,p=k.y,x=k.z;let A=this.s[1];v=A.x,f=A.y,g=A.z;let z=this.w1[1];V=z.x,Z=z.y,I=z.z;let w=this.w2[1];M=w.x,y=w.y,d=w.z;let S,P,T;S=v-e,P=f-a,T=g-h;let C=S*S+P*P+T*T;C!=0&&(C=1/C);let L,q,U;L=n-e,q=l-a,U=o-h;let Y=(L*S+q*P+U*T)*C,E,D,Q,W,F,H,G,J,N;E=V-b,D=Z-X,Q=I-c,W=b+E*Y,F=X+D*Y,H=c+Q*Y,E=M-u,D=y-p,Q=d-x,G=u+E*Y,J=p+D*Y,N=x+Q*Y;let K=this.closestPoint1;K.x=W,K.y=F,K.z=H;let O=this.closestPoint2;O.x=G,O.y=J,O.z=N;break;case 3:let $,et,st,lt=this.closest;$=lt.x,et=lt.y,st=lt.z;let rt,at,_t,ht,ot,bt,Xt,ft,ut,xt,zt,gt,pt,ct,nt,tt,kt,Bt,Mt,Rt,ci,Xi,gi,ki,wi,ei,Nt,At=this.s[0];rt=At.x,at=At.y,_t=At.z;let ni=this.w1[0];ht=ni.x,ot=ni.y,bt=ni.z;let di=this.w2[0];Xt=di.x,ft=di.y,ut=di.z;let Oi=this.s[1];xt=Oi.x,zt=Oi.y,gt=Oi.z;let Bi=this.w1[1];pt=Bi.x,ct=Bi.y,nt=Bi.z;let Vt=this.w2[1];tt=Vt.x,kt=Vt.y,Bt=Vt.z;let wt=this.s[2];Mt=wt.x,Rt=wt.y,ci=wt.z;let $t=this.w1[2];Xi=$t.x,gi=$t.y,ki=$t.z;let fi=this.w2[2];wi=fi.x,ei=fi.y,Nt=fi.z;let Zi,it,Ut,ii,j,Jt,Pt,si,_i;Zi=xt-rt,it=zt-at,Ut=gt-_t,ii=Mt-rt,j=Rt-at,Jt=ci-_t,Pt=$-rt,si=et-at,_i=st-_t;let St=Zi*Zi+it*it+Ut*Ut,ai=Zi*ii+it*j+Ut*Jt,qi=ii*ii+j*j+Jt*Jt,ui=Zi*Pt+it*si+Ut*_i,Yt=ii*Pt+j*si+Jt*_i,yt=St*qi-ai*ai;yt!=0&&(yt=1/yt);let vt=(ui*qi-Yt*ai)*yt,yi=(-ui*ai+Yt*St)*yt,Ii,bi,se,me,Ei,he,ve,oi,ce;Ii=pt-ht,bi=ct-ot,se=nt-bt,me=ht+Ii*vt,Ei=ot+bi*vt,he=bt+se*vt,Ii=Xi-ht,bi=gi-ot,se=ki-bt,me+=Ii*yi,Ei+=bi*yi,he+=se*yi,Ii=tt-Xt,bi=kt-ft,se=Bt-ut,ve=Xt+Ii*vt,oi=ft+bi*vt,ce=ut+se*vt,Ii=wi-Xt,bi=ei-ft,se=Nt-ut,ve+=Ii*yi,oi+=bi*yi,ce+=se*yi;let be=this.closestPoint1;be.x=me,be.y=Ei,be.z=he;let xe=this.closestPoint2;xe.x=ve,xe.y=oi,xe.z=ce;break;default:throw new Error("!?")}}loadCache(t){let i=this.dir,s=t.prevClosestDir;i.x=s.x,i.y=s.y,i.z=s.z}saveCache(t){let i=t.prevClosestDir,s=this.closest;i.x=s.x,i.y=s.y,i.z=s.z,i.x=-i.x,i.y=-i.y,i.z=-i.z}shrinkSimplex(t){switch(this.simplexSize=t,this.simplexSize=(this.simplexSize&5)+(this.simplexSize>>1&5),this.simplexSize=(this.simplexSize&3)+(this.simplexSize>>2&3),t){case 2:let i=this.s[0],s=this.s[1];i.x=s.x,i.y=s.y,i.z=s.z;let _=this.w1[0],n=this.w1[1];_.x=n.x,_.y=n.y,_.z=n.z;let l=this.w2[0],o=this.w2[1];l.x=o.x,l.y=o.y,l.z=o.z;break;case 4:let r=this.s[0],e=this.s[2];r.x=e.x,r.y=e.y,r.z=e.z;let a=this.w1[0],h=this.w1[2];a.x=h.x,a.y=h.y,a.z=h.z;let b=this.w2[0],X=this.w2[2];b.x=X.x,b.y=X.y,b.z=X.z;break;case 5:let c=this.s[1],u=this.s[2];c.x=u.x,c.y=u.y,c.z=u.z;let p=this.w1[1],x=this.w1[2];p.x=x.x,p.y=x.y,p.z=x.z;let v=this.w2[1],f=this.w2[2];v.x=f.x,v.y=f.y,v.z=f.z;break;case 6:let g=this.s[0],V=this.s[2];g.x=V.x,g.y=V.y,g.z=V.z;let Z=this.w1[0],I=this.w1[2];Z.x=I.x,Z.y=I.y,Z.z=I.z;let M=this.w2[0],y=this.w2[2];M.x=y.x,M.y=y.y,M.z=y.z;break;case 8:let d=this.s[0],B=this.s[3];d.x=B.x,d.y=B.y,d.z=B.z;let R=this.w1[0],k=this.w1[3];R.x=k.x,R.y=k.y,R.z=k.z;let A=this.w2[0],z=this.w2[3];A.x=z.x,A.y=z.y,A.z=z.z;break;case 9:let w=this.s[1],S=this.s[3];w.x=S.x,w.y=S.y,w.z=S.z;let P=this.w1[1],T=this.w1[3];P.x=T.x,P.y=T.y,P.z=T.z;let C=this.w2[1],L=this.w2[3];C.x=L.x,C.y=L.y,C.z=L.z;break;case 10:let q=this.s[0],U=this.s[3];q.x=U.x,q.y=U.y,q.z=U.z;let Y=this.w1[0],E=this.w1[3];Y.x=E.x,Y.y=E.y,Y.z=E.z;let D=this.w2[0],Q=this.w2[3];D.x=Q.x,D.y=Q.y,D.z=Q.z;break;case 11:let W=this.s[2],F=this.s[3];W.x=F.x,W.y=F.y,W.z=F.z;let H=this.w1[2],G=this.w1[3];H.x=G.x,H.y=G.y,H.z=G.z;let J=this.w2[2],N=this.w2[3];J.x=N.x,J.y=N.y,J.z=N.z;break;case 12:let K=this.s[0],O=this.s[2];K.x=O.x,K.y=O.y,K.z=O.z;let $=this.w1[0],et=this.w1[2];$.x=et.x,$.y=et.y,$.z=et.z;let st=this.w2[0],lt=this.w2[2];st.x=lt.x,st.y=lt.y,st.z=lt.z;let rt=this.s[1],at=this.s[3];rt.x=at.x,rt.y=at.y,rt.z=at.z;let _t=this.w1[1],ht=this.w1[3];_t.x=ht.x,_t.y=ht.y,_t.z=ht.z;let ot=this.w2[1],bt=this.w2[3];ot.x=bt.x,ot.y=bt.y,ot.z=bt.z;break;case 13:let Xt=this.s[1],ft=this.s[3];Xt.x=ft.x,Xt.y=ft.y,Xt.z=ft.z;let ut=this.w1[1],xt=this.w1[3];ut.x=xt.x,ut.y=xt.y,ut.z=xt.z;let zt=this.w2[1],gt=this.w2[3];zt.x=gt.x,zt.y=gt.y,zt.z=gt.z;break;case 14:let pt=this.s[0],ct=this.s[3];pt.x=ct.x,pt.y=ct.y,pt.z=ct.z;let nt=this.w1[0],tt=this.w1[3];nt.x=tt.x,nt.y=tt.y,nt.z=tt.z;let kt=this.w2[0],Bt=this.w2[3];kt.x=Bt.x,kt.y=Bt.y,kt.z=Bt.z;break}}computeWitnessPoint1(t){let i,s,_,n,l,o,r=this.dir;n=r.x,l=r.y,o=r.z;let e,a,h,b,X,c;b=this.tf1._rotation00*n+this.tf1._rotation10*l+this.tf1._rotation20*o,X=this.tf1._rotation01*n+this.tf1._rotation11*l+this.tf1._rotation21*o,c=this.tf1._rotation02*n+this.tf1._rotation12*l+this.tf1._rotation22*o,e=b,a=X,h=c;let u,p,x,v=this.dir;if(v.x=e,v.y=a,v.z=h,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){let y=this.dir,d=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z);d>0&&(d=1/d),y.x*=d,y.y*=d,y.z*=d;let B=this.w1[this.simplexSize],R=this.dir,k=this.c1._gjkMargin;B.x+=R.x*k,B.y+=R.y*k,B.z+=R.z*k}let f=this.w1[this.simplexSize];i=f.x,s=f.y,_=f.z;let g,V,Z;g=this.tf1._rotation00*i+this.tf1._rotation01*s+this.tf1._rotation02*_,V=this.tf1._rotation10*i+this.tf1._rotation11*s+this.tf1._rotation12*_,Z=this.tf1._rotation20*i+this.tf1._rotation21*s+this.tf1._rotation22*_,u=g,p=V,x=Z,u+=this.tf1._positionX,p+=this.tf1._positionY,x+=this.tf1._positionZ;let I=this.w1[this.simplexSize];I.x=u,I.y=p,I.z=x;let M=this.dir;M.x=n,M.y=l,M.z=o}computeWitnessPoint2(t){let i,s,_,n,l,o,r=this.dir;n=r.x,l=r.y,o=r.z;let e,a,h,b,X,c;b=this.tf2._rotation00*n+this.tf2._rotation10*l+this.tf2._rotation20*o,X=this.tf2._rotation01*n+this.tf2._rotation11*l+this.tf2._rotation21*o,c=this.tf2._rotation02*n+this.tf2._rotation12*l+this.tf2._rotation22*o,e=b,a=X,h=c,e=-e,a=-a,h=-h;let u,p,x,v=this.dir;if(v.x=e,v.y=a,v.z=h,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){let y=this.dir,d=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z);d>0&&(d=1/d),y.x*=d,y.y*=d,y.z*=d;let B=this.w2[this.simplexSize],R=this.dir,k=this.c2._gjkMargin;B.x+=R.x*k,B.y+=R.y*k,B.z+=R.z*k}let f=this.w2[this.simplexSize];i=f.x,s=f.y,_=f.z;let g,V,Z;g=this.tf2._rotation00*i+this.tf2._rotation01*s+this.tf2._rotation02*_,V=this.tf2._rotation10*i+this.tf2._rotation11*s+this.tf2._rotation12*_,Z=this.tf2._rotation20*i+this.tf2._rotation21*s+this.tf2._rotation22*_,u=g,p=V,x=Z,u+=this.tf2._positionX,p+=this.tf2._positionY,x+=this.tf2._positionZ;let I=this.w2[this.simplexSize];I.x=u,I.y=p,I.z=x;let M=this.dir;M.x=n,M.y=l,M.z=o}pointToTetrahedron(){let t=0;for(;t<3;){let i=this.dir,s=this.baseDirs[t++];i.x=s.x,i.y=s.y,i.z=s.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let _=this.s[this.simplexSize],n=this.w1[this.simplexSize];_.x=n.x,_.y=n.y,_.z=n.z;let l=this.w2[this.simplexSize];if(_.x-=l.x,_.y-=l.y,_.z-=l.z,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;let o=this.dir;o.x=-o.x,o.y=-o.y,o.z=-o.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let r=this.s[this.simplexSize],e=this.w1[this.simplexSize];r.x=e.x,r.y=e.y,r.z=e.z;let a=this.w2[this.simplexSize];if(r.x-=a.x,r.y-=a.y,r.z-=a.z,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}}lineToTetrahedron(){let t,i,s,_=this.dir;t=_.x,i=_.y,s=_.z;let n,l,o,r,e,a,h,b,X,c=this.s[0];n=c.x,l=c.y,o=c.z;let u=this.s[1];r=u.x,e=u.y,a=u.z,h=n-r,b=l-e,X=o-a;let p=0;for(;p<3;){let v,f,g,V=this.baseDirs[p++];v=V.x,f=V.y,g=V.z;let Z,I,M;Z=b*g-X*f,I=X*v-h*g,M=h*f-b*v;let y=this.dir;y.x=Z,y.y=I,y.z=M,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let d=this.s[this.simplexSize],B=this.w1[this.simplexSize];d.x=B.x,d.y=B.y,d.z=B.z;let R=this.w2[this.simplexSize];if(d.x-=R.x,d.y-=R.y,d.z-=R.z,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;let k=this.dir;k.x=-k.x,k.y=-k.y,k.z=-k.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let A=this.s[this.simplexSize],z=this.w1[this.simplexSize];A.x=z.x,A.y=z.y,A.z=z.z;let w=this.w2[this.simplexSize];if(A.x-=w.x,A.y-=w.y,A.z-=w.z,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}let x=this.dir;x.x=t,x.y=i,x.z=s}triangleToTetrahedron(){let t,i,s,_=this.dir;for(t=_.x,i=_.y,s=_.z;;){let l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V=this.s[0];l=V.x,o=V.y,r=V.z;let Z=this.s[1];e=Z.x,a=Z.y,h=Z.z;let I=this.s[2];b=I.x,X=I.y,c=I.z,u=e-l,p=a-o,x=h-r,v=b-l,f=X-o,g=c-r;let M,y,d;M=p*g-x*f,y=x*v-u*g,d=u*f-p*v;let B=this.dir;B.x=M,B.y=y,B.z=d,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let R=this.s[this.simplexSize],k=this.w1[this.simplexSize];R.x=k.x,R.y=k.y,R.z=k.z;let A=this.w2[this.simplexSize];if(R.x-=A.x,R.y-=A.y,R.z-=A.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;let z=this.dir;z.x=-z.x,z.y=-z.y,z.z=-z.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let w=this.s[this.simplexSize],S=this.w1[this.simplexSize];w.x=S.x,w.y=S.y,w.z=S.z;let P=this.w2[this.simplexSize];if(w.x-=P.x,w.y-=P.y,w.z-=P.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}let n=this.dir;n.x=t,n.y=i,n.z=s}isValidTetrahedron(){let t=this.s[2].x-this.s[0].x,i=this.s[2].y-this.s[0].y,s=this.s[2].z-this.s[0].z,_=this.s[3].x-this.s[0].x,n=this.s[3].y-this.s[0].y,l=this.s[3].z-this.s[0].z,o=(this.s[1].x-this.s[0].x)*(i*l-s*n)-(this.s[1].y-this.s[0].y)*(t*l-s*_)+(this.s[1].z-this.s[0].z)*(t*n-i*_);return o>1e-12?!0:o<-1e-12}computeDepth(t,i,s,_,n,l,o){let r=this.polyhedron;for(;r._numTriangles>0;){let y=r._triangleList;r._numTriangles--;let d=y._prev,B=y._next;d!=null&&(d._next=B),B!=null&&(B._prev=d),y==r._triangleList&&(r._triangleList=r._triangleList._next),y==r._triangleListLast&&(r._triangleListLast=r._triangleListLast._prev),y._next=null,y._prev=null,y.removeReferences(),y._next=r._trianglePool,r._trianglePool=y}for(;r._numVertices>0;){let y=r._vertices[--r._numVertices];y.removeReferences(),y._next=r._vertexPool,r._vertexPool=y}let e=this.polyhedron,a=this.polyhedron,h=a._vertexPool;h!=null?(a._vertexPool=h._next,h._next=null):h=new m.collision.narrowphase.detector.gjkepa.EpaVertex;let b=h.init(n[0],l[0],o[0]),X=this.polyhedron,c=X._vertexPool;c!=null?(X._vertexPool=c._next,c._next=null):c=new m.collision.narrowphase.detector.gjkepa.EpaVertex;let u=c.init(n[1],l[1],o[1]),p=this.polyhedron,x=p._vertexPool;x!=null?(p._vertexPool=x._next,x._next=null):x=new m.collision.narrowphase.detector.gjkepa.EpaVertex;let v=x.init(n[2],l[2],o[2]),f=this.polyhedron,g=f._vertexPool;if(g!=null?(f._vertexPool=g._next,g._next=null):g=new m.collision.narrowphase.detector.gjkepa.EpaVertex,!e._init(b,u,v,g.init(n[3],l[3],o[3])))return m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;let V=this.s[0],Z=this.w1[0],I=this.w2[0],M=0;for(;M<40;){let y=this.polyhedron._triangleList,d=1/0,B=null;for(;y!=null;)y._distanceSq<d&&(d=y._distanceSq,B=y),y=y._next;let R=B,k=this.dir,A=R._normal;k.x=A.x,k.y=A.y,k.z=A.z;let z=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);z>0&&(z=1/z),k.x*=z,k.y*=z,k.z*=z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let w=this.s[this.simplexSize],S=this.w1[this.simplexSize];w.x=S.x,w.y=S.y,w.z=S.z;let P=this.w2[this.simplexSize];w.x-=P.x,w.y-=P.y,w.z-=P.z;let T=R._vertices[0],C=R._vertices[1],L=R._vertices[2],q=T.v,U=this.dir,Y=this.dir;if(V.x*Y.x+V.y*Y.y+V.z*Y.z-(q.x*U.x+q.y*U.y+q.z*U.z)<1e-6||M==39){let W=this.closest,F=this.dir;W.x=F.x,W.y=F.y,W.z=F.z;let H=this.dir,G=T.v,J=this.dir,N=(H.x*G.x+H.y*G.y+H.z*G.z)/(J.x*J.x+J.y*J.y+J.z*J.z);W.x*=N,W.y*=N,W.z*=N;let K,O,$,et=this.closest;K=et.x,O=et.y,$=et.z;let st,lt,rt,at,_t,ht,ot,bt,Xt,ft,ut,xt,zt,gt,pt,ct,nt,tt,kt,Bt,Mt,Rt,ci,Xi,gi,ki,wi,ei=T.v;st=ei.x,lt=ei.y,rt=ei.z;let Nt=T.w1;at=Nt.x,_t=Nt.y,ht=Nt.z;let At=T.w2;ot=At.x,bt=At.y,Xt=At.z;let ni=C.v;ft=ni.x,ut=ni.y,xt=ni.z;let di=C.w1;zt=di.x,gt=di.y,pt=di.z;let Oi=C.w2;ct=Oi.x,nt=Oi.y,tt=Oi.z;let Bi=L.v;kt=Bi.x,Bt=Bi.y,Mt=Bi.z;let Vt=L.w1;Rt=Vt.x,ci=Vt.y,Xi=Vt.z;let wt=L.w2;gi=wt.x,ki=wt.y,wi=wt.z;let $t,fi,Zi,it,Ut,ii,j,Jt,Pt;$t=ft-st,fi=ut-lt,Zi=xt-rt,it=kt-st,Ut=Bt-lt,ii=Mt-rt,j=K-st,Jt=O-lt,Pt=$-rt;let si=$t*$t+fi*fi+Zi*Zi,_i=$t*it+fi*Ut+Zi*ii,St=it*it+Ut*Ut+ii*ii,ai=$t*j+fi*Jt+Zi*Pt,qi=it*j+Ut*Jt+ii*Pt,ui=si*St-_i*_i;ui!=0&&(ui=1/ui);let Yt=(ai*St-qi*_i)*ui,yt=(-ai*_i+qi*si)*ui,vt,yi,Ii,bi,se,me,Ei,he,ve;vt=zt-at,yi=gt-_t,Ii=pt-ht,bi=at+vt*Yt,se=_t+yi*Yt,me=ht+Ii*Yt,vt=Rt-at,yi=ci-_t,Ii=Xi-ht,bi+=vt*yt,se+=yi*yt,me+=Ii*yt,vt=ct-ot,yi=nt-bt,Ii=tt-Xt,Ei=ot+vt*Yt,he=bt+yi*Yt,ve=Xt+Ii*Yt,vt=gi-ot,yi=ki-bt,Ii=wi-Xt,Ei+=vt*yt,he+=yi*yt,ve+=Ii*yt;let oi=this.closestPoint1;oi.x=bi,oi.y=se,oi.z=me;let ce=this.closestPoint2;ce.x=Ei,ce.y=he,ce.z=ve;let be=this.closest;return this.depth=Math.sqrt(be.x*be.x+be.y*be.y+be.z*be.z),m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}let E=this.polyhedron,D=E._vertexPool;D!=null?(E._vertexPool=D._next,D._next=null):D=new m.collision.narrowphase.detector.gjkepa.EpaVertex;let Q=D.init(V,Z,I);if(!this.polyhedron._addVertex(Q,R))return m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++M}return m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(t,i,s,_,n){return this.computeClosestPointsImpl(t,i,s,_,n,!0)}computeDistance(t,i,s,_,n){return this.computeClosestPointsImpl(t,i,s,_,n,!1)}convexCast(t,i,s,_,n,l,o){return this.convexCastImpl(t,i,s,_,n,l,o)}rayCast(t,i,s,_,n){let l=this.tempTransform;l._positionX=s.x,l._positionY=s.y,l._positionZ=s.z;let o=this.tl1,r=this.tl2;return o.x=_.x,o.y=_.y,o.z=_.z,o.x-=s.x,o.y-=s.y,o.z-=s.z,r.zero(),this.convexCastImpl(null,t,l,i,o,r,n)}static getInstance(){return m.collision.narrowphase.detector.gjkepa.GjkEpa.instance}};m.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{};m.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{};m.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(t,i,s){let _,n,l,o,r,e;_=t.x,n=t.y,l=t.z,o=i.x,r=i.y,e=i.z;let a,h,b;a=o-_,h=r-n,b=e-l;let X=a*_+h*n+b*l;if(X=-X/(a*a+h*h+b*b),X<0)return s.x=_,s.y=n,s.z=l,1;if(X>1)return s.x=o,s.y=r,s.z=e,2;let c,u,p;return c=_+a*X,u=n+h*X,p=l+b*X,s.x=c,s.y=u,s.z=p,3}static projectOrigin3(t,i,s,_){let n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V,Z;n=t.x,l=t.y,o=t.z,r=i.x,e=i.y,a=i.z,h=s.x,b=s.y,X=s.z,c=r-n,u=e-l,p=a-o,x=h-r,v=b-e,f=X-a,g=n-h,V=l-b,Z=o-X;let I,M,y;I=u*f-p*v,M=p*x-c*f,y=c*v-u*x;let d,B,R,k,A,z,w,S,P;d=u*y-p*M,B=p*I-c*y,R=c*M-u*I,k=v*y-f*M,A=f*I-x*y,z=x*M-v*I,w=V*y-Z*M,S=Z*I-g*y,P=g*M-V*I;let T=-1,C,L,q,U=0;if(C=0,L=0,q=0,n*d+l*B+o*R<0){let D,Q,W,F,H,G;D=t.x,Q=t.y,W=t.z,F=i.x,H=i.y,G=i.z;let J,N,K;J=F-D,N=H-Q,K=G-W;let O=J*D+N*Q+K*W;O=-O/(J*J+N*N+K*K);let $;if(O<0)_.x=D,_.y=Q,_.z=W,$=1;else if(O>1)_.x=F,_.y=H,_.z=G,$=2;else{let et,st,lt;et=D+J*O,st=Q+N*O,lt=W+K*O,_.x=et,_.y=st,_.z=lt,$=3}U=$,T=_.x*_.x+_.y*_.y+_.z*_.z,C=_.x,L=_.y,q=_.z}if(r*k+e*A+a*z<0){let D,Q,W,F,H,G;D=i.x,Q=i.y,W=i.z,F=s.x,H=s.y,G=s.z;let J,N,K;J=F-D,N=H-Q,K=G-W;let O=J*D+N*Q+K*W;O=-O/(J*J+N*N+K*K);let $;if(O<0)_.x=D,_.y=Q,_.z=W,$=1;else if(O>1)_.x=F,_.y=H,_.z=G,$=2;else{let st,lt,rt;st=D+J*O,lt=Q+N*O,rt=W+K*O,_.x=st,_.y=lt,_.z=rt,$=3}let et=_.x*_.x+_.y*_.y+_.z*_.z;(T<0||et<T)&&(U=$<<1,T=et,C=_.x,L=_.y,q=_.z)}if(h*w+b*S+X*P<0){let D,Q,W,F,H,G;D=t.x,Q=t.y,W=t.z,F=s.x,H=s.y,G=s.z;let J,N,K;J=F-D,N=H-Q,K=G-W;let O=J*D+N*Q+K*W;O=-O/(J*J+N*N+K*K);let $;if(O<0)_.x=D,_.y=Q,_.z=W,$=1;else if(O>1)_.x=F,_.y=H,_.z=G,$=2;else{let st,lt,rt;st=D+J*O,lt=Q+N*O,rt=W+K*O,_.x=st,_.y=lt,_.z=rt,$=3}let et=_.x*_.x+_.y*_.y+_.z*_.z;(T<0||et<T)&&(U=$&1|($&2)<<1,T=et,C=_.x,L=_.y,q=_.z)}if(T>0)return _.x=C,_.y=L,_.z=q,U;let Y=I*I+M*M+y*y;Y>0&&(Y=1/Math.sqrt(Y)),I*=Y,M*=Y,y*=Y;let E=I*I+M*M+y*y;return E=(n*I+l*M+o*y)/E,C=I*E,L=M*E,q=y*E,_.x=C,_.y=L,_.z=q,7}static projectOrigin4(t,i,s,_,n){let l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V,Z,I,M,y,d,B,R,k,A,z,w;l=t.x,o=t.y,r=t.z,e=i.x,a=i.y,h=i.z,b=s.x,X=s.y,c=s.z,u=_.x,p=_.y,x=_.z,v=e-l,f=a-o,g=h-r,V=b-l,Z=X-o,I=c-r,M=u-l,y=p-o,d=x-r,B=b-e,R=X-a,k=c-h,A=u-e,z=p-a,w=x-h;let S,P,T,C,L,q,U,Y,E,D,Q,W;S=f*I-g*Z,P=g*V-v*I,T=v*Z-f*V,C=Z*d-I*y,L=I*M-V*d,q=V*y-Z*M,U=y*g-d*f,Y=d*v-M*g,E=M*f-y*v,D=z*k-w*R,Q=w*B-A*k,W=A*R-z*B;let F=v*D+f*Q+g*W>0?1:-1,H=-1,G,J,N,K=0;if(G=0,J=0,N=0,(l*S+o*P+r*T)*F<0){let O,$,et,st,lt,rt,at,_t,ht,ot,bt,Xt,ft,ut,xt,zt,gt,pt;O=t.x,$=t.y,et=t.z,st=i.x,lt=i.y,rt=i.z,at=s.x,_t=s.y,ht=s.z,ot=st-O,bt=lt-$,Xt=rt-et,ft=at-st,ut=_t-lt,xt=ht-rt,zt=O-at,gt=$-_t,pt=et-ht;let ct,nt,tt;ct=bt*xt-Xt*ut,nt=Xt*ft-ot*xt,tt=ot*ut-bt*ft;let kt,Bt,Mt,Rt,ci,Xi,gi,ki,wi;kt=bt*tt-Xt*nt,Bt=Xt*ct-ot*tt,Mt=ot*nt-bt*ct,Rt=ut*tt-xt*nt,ci=xt*ct-ft*tt,Xi=ft*nt-ut*ct,gi=gt*tt-pt*nt,ki=pt*ct-zt*tt,wi=zt*nt-gt*ct;let ei=-1,Nt,At,ni,di=0;if(Nt=0,At=0,ni=0,O*kt+$*Bt+et*Mt<0){let Bi,Vt,wt,$t,fi,Zi;Bi=t.x,Vt=t.y,wt=t.z,$t=i.x,fi=i.y,Zi=i.z;let it,Ut,ii;it=$t-Bi,Ut=fi-Vt,ii=Zi-wt;let j=it*Bi+Ut*Vt+ii*wt;j=-j/(it*it+Ut*Ut+ii*ii);let Jt;if(j<0)n.x=Bi,n.y=Vt,n.z=wt,Jt=1;else if(j>1)n.x=$t,n.y=fi,n.z=Zi,Jt=2;else{let Pt,si,_i;Pt=Bi+it*j,si=Vt+Ut*j,_i=wt+ii*j,n.x=Pt,n.y=si,n.z=_i,Jt=3}di=Jt,ei=n.x*n.x+n.y*n.y+n.z*n.z,Nt=n.x,At=n.y,ni=n.z}if(st*Rt+lt*ci+rt*Xi<0){let Bi,Vt,wt,$t,fi,Zi;Bi=i.x,Vt=i.y,wt=i.z,$t=s.x,fi=s.y,Zi=s.z;let it,Ut,ii;it=$t-Bi,Ut=fi-Vt,ii=Zi-wt;let j=it*Bi+Ut*Vt+ii*wt;j=-j/(it*it+Ut*Ut+ii*ii);let Jt;if(j<0)n.x=Bi,n.y=Vt,n.z=wt,Jt=1;else if(j>1)n.x=$t,n.y=fi,n.z=Zi,Jt=2;else{let si,_i,St;si=Bi+it*j,_i=Vt+Ut*j,St=wt+ii*j,n.x=si,n.y=_i,n.z=St,Jt=3}let Pt=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||Pt<ei)&&(di=Jt<<1,ei=Pt,Nt=n.x,At=n.y,ni=n.z)}if(at*gi+_t*ki+ht*wi<0){let Bi,Vt,wt,$t,fi,Zi;Bi=t.x,Vt=t.y,wt=t.z,$t=s.x,fi=s.y,Zi=s.z;let it,Ut,ii;it=$t-Bi,Ut=fi-Vt,ii=Zi-wt;let j=it*Bi+Ut*Vt+ii*wt;j=-j/(it*it+Ut*Ut+ii*ii);let Jt;if(j<0)n.x=Bi,n.y=Vt,n.z=wt,Jt=1;else if(j>1)n.x=$t,n.y=fi,n.z=Zi,Jt=2;else{let si,_i,St;si=Bi+it*j,_i=Vt+Ut*j,St=wt+ii*j,n.x=si,n.y=_i,n.z=St,Jt=3}let Pt=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||Pt<ei)&&(di=Jt&1|(Jt&2)<<1,ei=Pt,Nt=n.x,At=n.y,ni=n.z)}let Oi;if(ei>0)n.x=Nt,n.y=At,n.z=ni,Oi=di;else{let Bi=ct*ct+nt*nt+tt*tt;Bi>0&&(Bi=1/Math.sqrt(Bi)),ct*=Bi,nt*=Bi,tt*=Bi;let Vt=ct*ct+nt*nt+tt*tt;Vt=(O*ct+$*nt+et*tt)/Vt,Nt=ct*Vt,At=nt*Vt,ni=tt*Vt,n.x=Nt,n.y=At,n.z=ni,Oi=7}K=Oi,H=n.x*n.x+n.y*n.y+n.z*n.z,G=n.x,J=n.y,N=n.z}if((l*C+o*L+r*q)*F<0){let O,$,et,st,lt,rt,at,_t,ht,ot,bt,Xt,ft,ut,xt,zt,gt,pt;O=t.x,$=t.y,et=t.z,st=s.x,lt=s.y,rt=s.z,at=_.x,_t=_.y,ht=_.z,ot=st-O,bt=lt-$,Xt=rt-et,ft=at-st,ut=_t-lt,xt=ht-rt,zt=O-at,gt=$-_t,pt=et-ht;let ct,nt,tt;ct=bt*xt-Xt*ut,nt=Xt*ft-ot*xt,tt=ot*ut-bt*ft;let kt,Bt,Mt,Rt,ci,Xi,gi,ki,wi;kt=bt*tt-Xt*nt,Bt=Xt*ct-ot*tt,Mt=ot*nt-bt*ct,Rt=ut*tt-xt*nt,ci=xt*ct-ft*tt,Xi=ft*nt-ut*ct,gi=gt*tt-pt*nt,ki=pt*ct-zt*tt,wi=zt*nt-gt*ct;let ei=-1,Nt,At,ni,di=0;if(Nt=0,At=0,ni=0,O*kt+$*Bt+et*Mt<0){let Vt,wt,$t,fi,Zi,it;Vt=t.x,wt=t.y,$t=t.z,fi=s.x,Zi=s.y,it=s.z;let Ut,ii,j;Ut=fi-Vt,ii=Zi-wt,j=it-$t;let Jt=Ut*Vt+ii*wt+j*$t;Jt=-Jt/(Ut*Ut+ii*ii+j*j);let Pt;if(Jt<0)n.x=Vt,n.y=wt,n.z=$t,Pt=1;else if(Jt>1)n.x=fi,n.y=Zi,n.z=it,Pt=2;else{let si,_i,St;si=Vt+Ut*Jt,_i=wt+ii*Jt,St=$t+j*Jt,n.x=si,n.y=_i,n.z=St,Pt=3}di=Pt,ei=n.x*n.x+n.y*n.y+n.z*n.z,Nt=n.x,At=n.y,ni=n.z}if(st*Rt+lt*ci+rt*Xi<0){let Vt,wt,$t,fi,Zi,it;Vt=s.x,wt=s.y,$t=s.z,fi=_.x,Zi=_.y,it=_.z;let Ut,ii,j;Ut=fi-Vt,ii=Zi-wt,j=it-$t;let Jt=Ut*Vt+ii*wt+j*$t;Jt=-Jt/(Ut*Ut+ii*ii+j*j);let Pt;if(Jt<0)n.x=Vt,n.y=wt,n.z=$t,Pt=1;else if(Jt>1)n.x=fi,n.y=Zi,n.z=it,Pt=2;else{let _i,St,ai;_i=Vt+Ut*Jt,St=wt+ii*Jt,ai=$t+j*Jt,n.x=_i,n.y=St,n.z=ai,Pt=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(di=Pt<<1,ei=si,Nt=n.x,At=n.y,ni=n.z)}if(at*gi+_t*ki+ht*wi<0){let Vt,wt,$t,fi,Zi,it;Vt=t.x,wt=t.y,$t=t.z,fi=_.x,Zi=_.y,it=_.z;let Ut,ii,j;Ut=fi-Vt,ii=Zi-wt,j=it-$t;let Jt=Ut*Vt+ii*wt+j*$t;Jt=-Jt/(Ut*Ut+ii*ii+j*j);let Pt;if(Jt<0)n.x=Vt,n.y=wt,n.z=$t,Pt=1;else if(Jt>1)n.x=fi,n.y=Zi,n.z=it,Pt=2;else{let _i,St,ai;_i=Vt+Ut*Jt,St=wt+ii*Jt,ai=$t+j*Jt,n.x=_i,n.y=St,n.z=ai,Pt=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(di=Pt&1|(Pt&2)<<1,ei=si,Nt=n.x,At=n.y,ni=n.z)}let Oi;if(ei>0)n.x=Nt,n.y=At,n.z=ni,Oi=di;else{let Vt=ct*ct+nt*nt+tt*tt;Vt>0&&(Vt=1/Math.sqrt(Vt)),ct*=Vt,nt*=Vt,tt*=Vt;let wt=ct*ct+nt*nt+tt*tt;wt=(O*ct+$*nt+et*tt)/wt,Nt=ct*wt,At=nt*wt,ni=tt*wt,n.x=Nt,n.y=At,n.z=ni,Oi=7}let Bi=n.x*n.x+n.y*n.y+n.z*n.z;(H<0||Bi<H)&&(K=Oi&1|(Oi&6)<<1,H=Bi,G=n.x,J=n.y,N=n.z)}if((l*U+o*Y+r*E)*F<0){let O,$,et,st,lt,rt,at,_t,ht,ot,bt,Xt,ft,ut,xt,zt,gt,pt;O=t.x,$=t.y,et=t.z,st=i.x,lt=i.y,rt=i.z,at=_.x,_t=_.y,ht=_.z,ot=st-O,bt=lt-$,Xt=rt-et,ft=at-st,ut=_t-lt,xt=ht-rt,zt=O-at,gt=$-_t,pt=et-ht;let ct,nt,tt;ct=bt*xt-Xt*ut,nt=Xt*ft-ot*xt,tt=ot*ut-bt*ft;let kt,Bt,Mt,Rt,ci,Xi,gi,ki,wi;kt=bt*tt-Xt*nt,Bt=Xt*ct-ot*tt,Mt=ot*nt-bt*ct,Rt=ut*tt-xt*nt,ci=xt*ct-ft*tt,Xi=ft*nt-ut*ct,gi=gt*tt-pt*nt,ki=pt*ct-zt*tt,wi=zt*nt-gt*ct;let ei=-1,Nt,At,ni,di=0;if(Nt=0,At=0,ni=0,O*kt+$*Bt+et*Mt<0){let Vt,wt,$t,fi,Zi,it;Vt=t.x,wt=t.y,$t=t.z,fi=i.x,Zi=i.y,it=i.z;let Ut,ii,j;Ut=fi-Vt,ii=Zi-wt,j=it-$t;let Jt=Ut*Vt+ii*wt+j*$t;Jt=-Jt/(Ut*Ut+ii*ii+j*j);let Pt;if(Jt<0)n.x=Vt,n.y=wt,n.z=$t,Pt=1;else if(Jt>1)n.x=fi,n.y=Zi,n.z=it,Pt=2;else{let si,_i,St;si=Vt+Ut*Jt,_i=wt+ii*Jt,St=$t+j*Jt,n.x=si,n.y=_i,n.z=St,Pt=3}di=Pt,ei=n.x*n.x+n.y*n.y+n.z*n.z,Nt=n.x,At=n.y,ni=n.z}if(st*Rt+lt*ci+rt*Xi<0){let Vt,wt,$t,fi,Zi,it;Vt=i.x,wt=i.y,$t=i.z,fi=_.x,Zi=_.y,it=_.z;let Ut,ii,j;Ut=fi-Vt,ii=Zi-wt,j=it-$t;let Jt=Ut*Vt+ii*wt+j*$t;Jt=-Jt/(Ut*Ut+ii*ii+j*j);let Pt;if(Jt<0)n.x=Vt,n.y=wt,n.z=$t,Pt=1;else if(Jt>1)n.x=fi,n.y=Zi,n.z=it,Pt=2;else{let _i,St,ai;_i=Vt+Ut*Jt,St=wt+ii*Jt,ai=$t+j*Jt,n.x=_i,n.y=St,n.z=ai,Pt=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(di=Pt<<1,ei=si,Nt=n.x,At=n.y,ni=n.z)}if(at*gi+_t*ki+ht*wi<0){let Vt,wt,$t,fi,Zi,it;Vt=t.x,wt=t.y,$t=t.z,fi=_.x,Zi=_.y,it=_.z;let Ut,ii,j;Ut=fi-Vt,ii=Zi-wt,j=it-$t;let Jt=Ut*Vt+ii*wt+j*$t;Jt=-Jt/(Ut*Ut+ii*ii+j*j);let Pt;if(Jt<0)n.x=Vt,n.y=wt,n.z=$t,Pt=1;else if(Jt>1)n.x=fi,n.y=Zi,n.z=it,Pt=2;else{let _i,St,ai;_i=Vt+Ut*Jt,St=wt+ii*Jt,ai=$t+j*Jt,n.x=_i,n.y=St,n.z=ai,Pt=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(di=Pt&1|(Pt&2)<<1,ei=si,Nt=n.x,At=n.y,ni=n.z)}let Oi;if(ei>0)n.x=Nt,n.y=At,n.z=ni,Oi=di;else{let Vt=ct*ct+nt*nt+tt*tt;Vt>0&&(Vt=1/Math.sqrt(Vt)),ct*=Vt,nt*=Vt,tt*=Vt;let wt=ct*ct+nt*nt+tt*tt;wt=(O*ct+$*nt+et*tt)/wt,Nt=ct*wt,At=nt*wt,ni=tt*wt,n.x=Nt,n.y=At,n.z=ni,Oi=7}let Bi=n.x*n.x+n.y*n.y+n.z*n.z;(H<0||Bi<H)&&(K=Oi&3|(Oi&4)<<1,H=Bi,G=n.x,J=n.y,N=n.z)}if((e*D+a*Q+h*W)*F<0){let O,$,et,st,lt,rt,at,_t,ht,ot,bt,Xt,ft,ut,xt,zt,gt,pt;O=i.x,$=i.y,et=i.z,st=s.x,lt=s.y,rt=s.z,at=_.x,_t=_.y,ht=_.z,ot=st-O,bt=lt-$,Xt=rt-et,ft=at-st,ut=_t-lt,xt=ht-rt,zt=O-at,gt=$-_t,pt=et-ht;let ct,nt,tt;ct=bt*xt-Xt*ut,nt=Xt*ft-ot*xt,tt=ot*ut-bt*ft;let kt,Bt,Mt,Rt,ci,Xi,gi,ki,wi;kt=bt*tt-Xt*nt,Bt=Xt*ct-ot*tt,Mt=ot*nt-bt*ct,Rt=ut*tt-xt*nt,ci=xt*ct-ft*tt,Xi=ft*nt-ut*ct,gi=gt*tt-pt*nt,ki=pt*ct-zt*tt,wi=zt*nt-gt*ct;let ei=-1,Nt,At,ni,di=0;if(Nt=0,At=0,ni=0,O*kt+$*Bt+et*Mt<0){let Vt,wt,$t,fi,Zi,it;Vt=i.x,wt=i.y,$t=i.z,fi=s.x,Zi=s.y,it=s.z;let Ut,ii,j;Ut=fi-Vt,ii=Zi-wt,j=it-$t;let Jt=Ut*Vt+ii*wt+j*$t;Jt=-Jt/(Ut*Ut+ii*ii+j*j);let Pt;if(Jt<0)n.x=Vt,n.y=wt,n.z=$t,Pt=1;else if(Jt>1)n.x=fi,n.y=Zi,n.z=it,Pt=2;else{let si,_i,St;si=Vt+Ut*Jt,_i=wt+ii*Jt,St=$t+j*Jt,n.x=si,n.y=_i,n.z=St,Pt=3}di=Pt,ei=n.x*n.x+n.y*n.y+n.z*n.z,Nt=n.x,At=n.y,ni=n.z}if(st*Rt+lt*ci+rt*Xi<0){let Vt,wt,$t,fi,Zi,it;Vt=s.x,wt=s.y,$t=s.z,fi=_.x,Zi=_.y,it=_.z;let Ut,ii,j;Ut=fi-Vt,ii=Zi-wt,j=it-$t;let Jt=Ut*Vt+ii*wt+j*$t;Jt=-Jt/(Ut*Ut+ii*ii+j*j);let Pt;if(Jt<0)n.x=Vt,n.y=wt,n.z=$t,Pt=1;else if(Jt>1)n.x=fi,n.y=Zi,n.z=it,Pt=2;else{let _i,St,ai;_i=Vt+Ut*Jt,St=wt+ii*Jt,ai=$t+j*Jt,n.x=_i,n.y=St,n.z=ai,Pt=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(di=Pt<<1,ei=si,Nt=n.x,At=n.y,ni=n.z)}if(at*gi+_t*ki+ht*wi<0){let Vt,wt,$t,fi,Zi,it;Vt=i.x,wt=i.y,$t=i.z,fi=_.x,Zi=_.y,it=_.z;let Ut,ii,j;Ut=fi-Vt,ii=Zi-wt,j=it-$t;let Jt=Ut*Vt+ii*wt+j*$t;Jt=-Jt/(Ut*Ut+ii*ii+j*j);let Pt;if(Jt<0)n.x=Vt,n.y=wt,n.z=$t,Pt=1;else if(Jt>1)n.x=fi,n.y=Zi,n.z=it,Pt=2;else{let _i,St,ai;_i=Vt+Ut*Jt,St=wt+ii*Jt,ai=$t+j*Jt,n.x=_i,n.y=St,n.z=ai,Pt=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(di=Pt&1|(Pt&2)<<1,ei=si,Nt=n.x,At=n.y,ni=n.z)}let Oi;if(ei>0)n.x=Nt,n.y=At,n.z=ni,Oi=di;else{let Vt=ct*ct+nt*nt+tt*tt;Vt>0&&(Vt=1/Math.sqrt(Vt)),ct*=Vt,nt*=Vt,tt*=Vt;let wt=ct*ct+nt*nt+tt*tt;wt=(O*ct+$*nt+et*tt)/wt,Nt=ct*wt,At=nt*wt,ni=tt*wt,n.x=Nt,n.y=At,n.z=ni,Oi=7}let Bi=n.x*n.x+n.y*n.y+n.z*n.z;(H<0||Bi<H)&&(K=Oi<<1,H=Bi,G=n.x,J=n.y,N=n.z)}return H>0?(n.x=G,n.y=J,n.z=N,K):(n.zero(),15)}};m.common.Mat3=class{constructor(t,i,s,_,n,l,o,r,e){e==null&&(e=1),r==null&&(r=0),o==null&&(o=0),l==null&&(l=0),n==null&&(n=1),_==null&&(_=0),s==null&&(s=0),i==null&&(i=0),t==null&&(t=1),this.e00=t,this.e01=i,this.e02=s,this.e10=_,this.e11=n,this.e12=l,this.e20=o,this.e21=r,this.e22=e,m.common.Mat3.numCreations++}init(t,i,s,_,n,l,o,r,e){return this.e00=t,this.e01=i,this.e02=s,this.e10=_,this.e11=n,this.e12=l,this.e20=o,this.e21=r,this.e22=e,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this}add(t){return new m.common.Mat3(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)}sub(t){return new m.common.Mat3(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)}scale(t){return new m.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)}mul(t){return new m.common.Mat3(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e20*=t,this.e21*=t,this.e22*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,_=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,n=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,l=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,o=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,r=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,e=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e01=i,this.e02=s,this.e10=_,this.e11=n,this.e12=l,this.e20=o,this.e21=r,this.e22=e,this}prependScale(t,i,s){return new m.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*i,this.e11*i,this.e12*i,this.e20*s,this.e21*s,this.e22*s)}appendScale(t,i,s){return new m.common.Mat3(this.e00*t,this.e01*i,this.e02*s,this.e10*t,this.e11*i,this.e12*s,this.e20*t,this.e21*i,this.e22*s)}prependRotation(t,i,s,_){let n=Math.sin(t),l=Math.cos(t),o=1-l,r=i*i*o+l,e=i*s*o-_*n,a=i*_*o+s*n,h=s*i*o+_*n,b=s*s*o+l,X=s*_*o-i*n,c=_*i*o-s*n,u=_*s*o+i*n,p=_*_*o+l;return new m.common.Mat3(r*this.e00+e*this.e10+a*this.e20,r*this.e01+e*this.e11+a*this.e21,r*this.e02+e*this.e12+a*this.e22,h*this.e00+b*this.e10+X*this.e20,h*this.e01+b*this.e11+X*this.e21,h*this.e02+b*this.e12+X*this.e22,c*this.e00+u*this.e10+p*this.e20,c*this.e01+u*this.e11+p*this.e21,c*this.e02+u*this.e12+p*this.e22)}appendRotation(t,i,s,_){let n=Math.sin(t),l=Math.cos(t),o=1-l,r=i*i*o+l,e=i*s*o-_*n,a=i*_*o+s*n,h=s*i*o+_*n,b=s*s*o+l,X=s*_*o-i*n,c=_*i*o-s*n,u=_*s*o+i*n,p=_*_*o+l;return new m.common.Mat3(this.e00*r+this.e01*h+this.e02*c,this.e00*e+this.e01*b+this.e02*u,this.e00*a+this.e01*X+this.e02*p,this.e10*r+this.e11*h+this.e12*c,this.e10*e+this.e11*b+this.e12*u,this.e10*a+this.e11*X+this.e12*p,this.e20*r+this.e21*h+this.e22*c,this.e20*e+this.e21*b+this.e22*u,this.e20*a+this.e21*X+this.e22*p)}prependScaleEq(t,i,s){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e20*=s,this.e21*=s,this.e22*=s,this}appendScaleEq(t,i,s){return this.e00*=t,this.e01*=i,this.e02*=s,this.e10*=t,this.e11*=i,this.e12*=s,this.e20*=t,this.e21*=i,this.e22*=s,this}prependRotationEq(t,i,s,_){let n=Math.sin(t),l=Math.cos(t),o=1-l,r=i*i*o+l,e=i*s*o-_*n,a=i*_*o+s*n,h=s*i*o+_*n,b=s*s*o+l,X=s*_*o-i*n,c=_*i*o-s*n,u=_*s*o+i*n,p=_*_*o+l,x=h*this.e00+b*this.e10+X*this.e20,v=h*this.e01+b*this.e11+X*this.e21,f=h*this.e02+b*this.e12+X*this.e22,g=c*this.e00+u*this.e10+p*this.e20,V=c*this.e01+u*this.e11+p*this.e21,Z=c*this.e02+u*this.e12+p*this.e22;return this.e00=r*this.e00+e*this.e10+a*this.e20,this.e01=r*this.e01+e*this.e11+a*this.e21,this.e02=r*this.e02+e*this.e12+a*this.e22,this.e10=x,this.e11=v,this.e12=f,this.e20=g,this.e21=V,this.e22=Z,this}appendRotationEq(t,i,s,_){let n=Math.sin(t),l=Math.cos(t),o=1-l,r=i*i*o+l,e=i*s*o-_*n,a=i*_*o+s*n,h=s*i*o+_*n,b=s*s*o+l,X=s*_*o-i*n,c=_*i*o-s*n,u=_*s*o+i*n,p=_*_*o+l,x=this.e00*e+this.e01*b+this.e02*u,v=this.e00*a+this.e01*X+this.e02*p,f=this.e10*e+this.e11*b+this.e12*u,g=this.e10*a+this.e11*X+this.e12*p,V=this.e20*e+this.e21*b+this.e22*u,Z=this.e20*a+this.e21*X+this.e22*p;return this.e00=this.e00*r+this.e01*h+this.e02*c,this.e01=x,this.e02=v,this.e10=this.e10*r+this.e11*h+this.e12*c,this.e11=f,this.e12=g,this.e20=this.e20*r+this.e21*h+this.e22*c,this.e21=V,this.e22=Z,this}transpose(){return new m.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){let t=this.e01,i=this.e02,s=this.e12;return this.e01=this.e10,this.e02=this.e20,this.e10=t,this.e12=this.e21,this.e20=i,this.e21=s,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,s=this.e10*this.e21-this.e11*this.e20,_=this.e00*t-this.e01*i+this.e02*s;return _!=0&&(_=1/_),new m.common.Mat3(t*_,-(this.e01*this.e22-this.e02*this.e21)*_,(this.e01*this.e12-this.e02*this.e11)*_,-i*_,(this.e00*this.e22-this.e02*this.e20)*_,-(this.e00*this.e12-this.e02*this.e10)*_,s*_,-(this.e00*this.e21-this.e01*this.e20)*_,(this.e00*this.e11-this.e01*this.e10)*_)}inverseEq(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,s=this.e10*this.e21-this.e11*this.e20,_=this.e00*t-this.e01*i+this.e02*s;_!=0&&(_=1/_);let n=(this.e01*this.e12-this.e02*this.e11)*_,l=(this.e00*this.e22-this.e02*this.e20)*_,o=-(this.e00*this.e12-this.e02*this.e10)*_,r=-(this.e00*this.e21-this.e01*this.e20)*_,e=(this.e00*this.e11-this.e01*this.e10)*_;return this.e00=t*_,this.e01=-(this.e01*this.e22-this.e02*this.e21)*_,this.e02=n,this.e10=-i*_,this.e11=l,this.e12=o,this.e20=s*_,this.e21=r,this.e22=e,this}toArray(t){return t==null&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this}clone(){return new m.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(t){let i=t.x,s=t.y,_=t.z,n=t.w,l=2*i,o=2*s,r=2*_,e=i*l,a=s*o,h=_*r,b=i*o,X=s*r,c=i*r,u=n*l,p=n*o,x=n*r;return this.e00=1-a-h,this.e01=b-x,this.e02=c+p,this.e10=b+x,this.e11=1-e-h,this.e12=X-u,this.e20=c-p,this.e21=X+u,this.e22=1-e-a,this}toQuat(){let t=new m.common.Quat,i=this.e00,s=this.e11,_=this.e22,n=i+s+_,l;return n>0?(l=Math.sqrt(n+1),t.w=.5*l,l=.5/l,t.x=(this.e21-this.e12)*l,t.y=(this.e02-this.e20)*l,t.z=(this.e10-this.e01)*l):i>s?i>_?(l=Math.sqrt(i-s-_+1),t.x=.5*l,l=.5/l,t.y=(this.e01+this.e10)*l,t.z=(this.e02+this.e20)*l,t.w=(this.e21-this.e12)*l):(l=Math.sqrt(_-i-s+1),t.z=.5*l,l=.5/l,t.x=(this.e02+this.e20)*l,t.y=(this.e12+this.e21)*l,t.w=(this.e10-this.e01)*l):s>_?(l=Math.sqrt(s-_-i+1),t.y=.5*l,l=.5/l,t.x=(this.e01+this.e10)*l,t.z=(this.e12+this.e21)*l,t.w=(this.e02-this.e20)*l):(l=Math.sqrt(_-i-s+1),t.z=.5*l,l=.5/l,t.x=(this.e02+this.e20)*l,t.y=(this.e12+this.e21)*l,t.w=(this.e10-this.e01)*l),t}fromEulerXyz(t){let i=Math.sin(t.x),s=Math.sin(t.y),_=Math.sin(t.z),n=Math.cos(t.x),l=Math.cos(t.y),o=Math.cos(t.z);return this.e00=l*o,this.e01=-l*_,this.e02=s,this.e10=n*_+o*i*s,this.e11=n*o-i*s*_,this.e12=-l*i,this.e20=i*_-n*o*s,this.e21=o*i+n*s*_,this.e22=n*l,this}toEulerXyz(){let t=this.e02;if(t<=-1){let i=Math.atan2(this.e21,this.e11);return new m.common.Vec3(i*.5,-1.570796326794895,-i*.5)}if(t>=1){let i=Math.atan2(this.e21,this.e11);return new m.common.Vec3(i*.5,1.570796326794895,i*.5)}return new m.common.Vec3(Math.atan2(-this.e12,this.e22),Math.asin(t),Math.atan2(-this.e01,this.e00))}getRow(t){return t==0?new m.common.Vec3(this.e00,this.e01,this.e02):t==1?new m.common.Vec3(this.e10,this.e11,this.e12):t==2?new m.common.Vec3(this.e20,this.e21,this.e22):null}getCol(t){return t==0?new m.common.Vec3(this.e00,this.e10,this.e20):t==1?new m.common.Vec3(this.e01,this.e11,this.e21):t==2?new m.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(t,i){t==0?i.init(this.e00,this.e01,this.e02):t==1?i.init(this.e10,this.e11,this.e12):t==2?i.init(this.e20,this.e21,this.e22):i.zero()}getColTo(t,i){t==0?i.init(this.e00,this.e10,this.e20):t==1?i.init(this.e01,this.e11,this.e21):t==2?i.init(this.e02,this.e12,this.e22):i.zero()}fromRows(t,i,s){return this.e00=t.x,this.e01=t.y,this.e02=t.z,this.e10=i.x,this.e11=i.y,this.e12=i.z,this.e20=s.x,this.e21=s.y,this.e22=s.z,this}fromCols(t,i,s){return this.e00=t.x,this.e01=i.x,this.e02=s.x,this.e10=t.y,this.e11=i.y,this.e12=s.y,this.e20=t.z,this.e21=i.z,this.e22=s.z,this}toString(){return"Mat3["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+`,
     `+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+`,
     `+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+"]"}};m.common.Mat4=class{constructor(t,i,s,_,n,l,o,r,e,a,h,b,X,c,u,p){p==null&&(p=1),u==null&&(u=0),c==null&&(c=0),X==null&&(X=0),b==null&&(b=0),h==null&&(h=1),a==null&&(a=0),e==null&&(e=0),r==null&&(r=0),o==null&&(o=0),l==null&&(l=1),n==null&&(n=0),_==null&&(_=0),s==null&&(s=0),i==null&&(i=0),t==null&&(t=1),this.e00=t,this.e01=i,this.e02=s,this.e03=_,this.e10=n,this.e11=l,this.e12=o,this.e13=r,this.e20=e,this.e21=a,this.e22=h,this.e23=b,this.e30=X,this.e31=c,this.e32=u,this.e33=p,m.common.Mat4.numCreations++}init(t,i,s,_,n,l,o,r,e,a,h,b,X,c,u,p){return this.e00=t,this.e01=i,this.e02=s,this.e03=_,this.e10=n,this.e11=l,this.e12=o,this.e13=r,this.e20=e,this.e21=a,this.e22=h,this.e23=b,this.e30=X,this.e31=c,this.e32=u,this.e33=p,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}add(t){return new m.common.Mat4(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)}sub(t){return new m.common.Mat4(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)}scale(t){return new m.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)}mul(t){return new m.common.Mat4(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e03+=t.e03,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e13+=t.e13,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this.e23+=t.e23,this.e30+=t.e30,this.e31+=t.e31,this.e32+=t.e32,this.e33+=t.e33,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e03-=t.e03,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e13-=t.e13,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this.e23-=t.e23,this.e30-=t.e30,this.e31-=t.e31,this.e32-=t.e32,this.e33-=t.e33,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e13*=t,this.e20*=t,this.e21*=t,this.e22*=t,this.e23*=t,this.e30*=t,this.e31*=t,this.e32*=t,this.e33*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,_=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,n=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,l=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,o=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,r=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,e=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,a=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,b=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,X=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,c=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,u=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,p=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e01=i,this.e02=s,this.e03=_,this.e10=n,this.e11=l,this.e12=o,this.e13=r,this.e20=e,this.e21=a,this.e22=h,this.e23=b,this.e30=X,this.e31=c,this.e32=u,this.e33=p,this}prependScale(t,i,s){return new m.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*i,this.e11*i,this.e12*i,this.e13*i,this.e20*s,this.e21*s,this.e22*s,this.e23*s,this.e30,this.e31,this.e32,this.e33)}appendScale(t,i,s){return new m.common.Mat4(this.e00*t,this.e01*i,this.e02*s,this.e03,this.e10*t,this.e11*i,this.e12*s,this.e13,this.e20*t,this.e21*i,this.e22*s,this.e23,this.e30*t,this.e31*i,this.e32*s,this.e33)}prependRotation(t,i,s,_){let n=Math.sin(t),l=Math.cos(t),o=1-l,r=i*i*o+l,e=i*s*o-_*n,a=i*_*o+s*n,h=s*i*o+_*n,b=s*s*o+l,X=s*_*o-i*n,c=_*i*o-s*n,u=_*s*o+i*n,p=_*_*o+l;return new m.common.Mat4(r*this.e00+e*this.e10+a*this.e20,r*this.e01+e*this.e11+a*this.e21,r*this.e02+e*this.e12+a*this.e22,r*this.e03+e*this.e13+a*this.e23,h*this.e00+b*this.e10+X*this.e20,h*this.e01+b*this.e11+X*this.e21,h*this.e02+b*this.e12+X*this.e22,h*this.e03+b*this.e13+X*this.e23,c*this.e00+u*this.e10+p*this.e20,c*this.e01+u*this.e11+p*this.e21,c*this.e02+u*this.e12+p*this.e22,c*this.e03+u*this.e13+p*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(t,i,s,_){let n=Math.sin(t),l=Math.cos(t),o=1-l,r=i*i*o+l,e=i*s*o-_*n,a=i*_*o+s*n,h=s*i*o+_*n,b=s*s*o+l,X=s*_*o-i*n,c=_*i*o-s*n,u=_*s*o+i*n,p=_*_*o+l;return new m.common.Mat4(this.e00*r+this.e01*h+this.e02*c,this.e00*e+this.e01*b+this.e02*u,this.e00*a+this.e01*X+this.e02*p,this.e03,this.e10*r+this.e11*h+this.e12*c,this.e10*e+this.e11*b+this.e12*u,this.e10*a+this.e11*X+this.e12*p,this.e13,this.e20*r+this.e21*h+this.e22*c,this.e20*e+this.e21*b+this.e22*u,this.e20*a+this.e21*X+this.e22*p,this.e23,this.e30*r+this.e31*h+this.e32*c,this.e30*e+this.e31*b+this.e32*u,this.e30*a+this.e31*X+this.e32*p,this.e33)}prependTranslation(t,i,s){return new m.common.Mat4(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+i*this.e30,this.e11+i*this.e31,this.e12+i*this.e32,this.e13+i*this.e33,this.e20+s*this.e30,this.e21+s*this.e31,this.e22+s*this.e32,this.e23+s*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(t,i,s){return new m.common.Mat4(this.e00,this.e01,this.e02,this.e00*t+this.e01*i+this.e02*s+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*i+this.e12*s+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*i+this.e22*s+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*i+this.e32*s+this.e33)}prependScaleEq(t,i,s){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e13*=i,this.e20*=s,this.e21*=s,this.e22*=s,this.e23*=s,this}appendScaleEq(t,i,s){return this.e00*=t,this.e01*=i,this.e02*=s,this.e10*=t,this.e11*=i,this.e12*=s,this.e20*=t,this.e21*=i,this.e22*=s,this.e30*=t,this.e31*=i,this.e32*=s,this}prependRotationEq(t,i,s,_){let n=Math.sin(t),l=Math.cos(t),o=1-l,r=i*i*o+l,e=i*s*o-_*n,a=i*_*o+s*n,h=s*i*o+_*n,b=s*s*o+l,X=s*_*o-i*n,c=_*i*o-s*n,u=_*s*o+i*n,p=_*_*o+l,x=h*this.e00+b*this.e10+X*this.e20,v=h*this.e01+b*this.e11+X*this.e21,f=h*this.e02+b*this.e12+X*this.e22,g=h*this.e03+b*this.e13+X*this.e23,V=c*this.e00+u*this.e10+p*this.e20,Z=c*this.e01+u*this.e11+p*this.e21,I=c*this.e02+u*this.e12+p*this.e22,M=c*this.e03+u*this.e13+p*this.e23;return this.e00=r*this.e00+e*this.e10+a*this.e20,this.e01=r*this.e01+e*this.e11+a*this.e21,this.e02=r*this.e02+e*this.e12+a*this.e22,this.e03=r*this.e03+e*this.e13+a*this.e23,this.e10=x,this.e11=v,this.e12=f,this.e13=g,this.e20=V,this.e21=Z,this.e22=I,this.e23=M,this}appendRotationEq(t,i,s,_){let n=Math.sin(t),l=Math.cos(t),o=1-l,r=i*i*o+l,e=i*s*o-_*n,a=i*_*o+s*n,h=s*i*o+_*n,b=s*s*o+l,X=s*_*o-i*n,c=_*i*o-s*n,u=_*s*o+i*n,p=_*_*o+l,x=this.e00*e+this.e01*b+this.e02*u,v=this.e00*a+this.e01*X+this.e02*p,f=this.e10*e+this.e11*b+this.e12*u,g=this.e10*a+this.e11*X+this.e12*p,V=this.e20*e+this.e21*b+this.e22*u,Z=this.e20*a+this.e21*X+this.e22*p,I=this.e30*e+this.e31*b+this.e32*u,M=this.e30*a+this.e31*X+this.e32*p;return this.e00=this.e00*r+this.e01*h+this.e02*c,this.e01=x,this.e02=v,this.e10=this.e10*r+this.e11*h+this.e12*c,this.e11=f,this.e12=g,this.e20=this.e20*r+this.e21*h+this.e22*c,this.e21=V,this.e22=Z,this.e30=this.e30*r+this.e31*h+this.e32*c,this.e31=I,this.e32=M,this}prependTranslationEq(t,i,s){return this.e00+=t*this.e30,this.e01+=t*this.e31,this.e02+=t*this.e32,this.e03+=t*this.e33,this.e10+=i*this.e30,this.e11+=i*this.e31,this.e12+=i*this.e32,this.e13+=i*this.e33,this.e20+=s*this.e30,this.e21+=s*this.e31,this.e22+=s*this.e32,this.e23+=s*this.e33,this}appendTranslationEq(t,i,s){let _=this.e00*t+this.e01*i+this.e02*s+this.e03,n=this.e10*t+this.e11*i+this.e12*s+this.e13,l=this.e20*t+this.e21*i+this.e22*s+this.e23,o=this.e30*t+this.e31*i+this.e32*s+this.e33;return this.e03=_,this.e13=n,this.e23=l,this.e33=o,this}transpose(){return new m.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){let t=this.e01,i=this.e02,s=this.e12,_=this.e03,n=this.e13,l=this.e23;return this.e01=this.e10,this.e02=this.e20,this.e03=this.e30,this.e10=t,this.e12=this.e21,this.e13=this.e31,this.e20=i,this.e21=s,this.e23=this.e32,this.e30=_,this.e31=n,this.e32=l,this}determinant(){let t=this.e20*this.e31-this.e21*this.e30,i=this.e20*this.e32-this.e22*this.e30,s=this.e20*this.e33-this.e23*this.e30,_=this.e21*this.e32-this.e22*this.e31,n=this.e21*this.e33-this.e23*this.e31,l=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*l-this.e12*n+this.e13*_)-this.e01*(this.e10*l-this.e12*s+this.e13*i)+this.e02*(this.e10*n-this.e11*s+this.e13*t)-this.e03*(this.e10*_-this.e11*i+this.e12*t)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,s=this.e00*this.e13-this.e03*this.e10,_=this.e01*this.e12-this.e02*this.e11,n=this.e01*this.e13-this.e03*this.e11,l=this.e02*this.e13-this.e03*this.e12,o=this.e20*this.e31-this.e21*this.e30,r=this.e20*this.e32-this.e22*this.e30,e=this.e20*this.e33-this.e23*this.e30,a=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,b=this.e22*this.e33-this.e23*this.e32,X=this.e11*b-this.e12*h+this.e13*a,c=this.e10*b-this.e12*e+this.e13*r,u=this.e10*h-this.e11*e+this.e13*o,p=this.e10*a-this.e11*r+this.e12*o,x=this.e00*X-this.e01*c+this.e02*u-this.e03*p;return x!=0&&(x=1/x),new m.common.Mat4(X*x,-(this.e01*b-this.e02*h+this.e03*a)*x,(this.e31*l-this.e32*n+this.e33*_)*x,-(this.e21*l-this.e22*n+this.e23*_)*x,-c*x,(this.e00*b-this.e02*e+this.e03*r)*x,-(this.e30*l-this.e32*s+this.e33*i)*x,(this.e20*l-this.e22*s+this.e23*i)*x,u*x,-(this.e00*h-this.e01*e+this.e03*o)*x,(this.e30*n-this.e31*s+this.e33*t)*x,-(this.e20*n-this.e21*s+this.e23*t)*x,-p*x,(this.e00*a-this.e01*r+this.e02*o)*x,-(this.e30*_-this.e31*i+this.e32*t)*x,(this.e20*_-this.e21*i+this.e22*t)*x)}inverseEq(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,s=this.e00*this.e13-this.e03*this.e10,_=this.e01*this.e12-this.e02*this.e11,n=this.e01*this.e13-this.e03*this.e11,l=this.e02*this.e13-this.e03*this.e12,o=this.e20*this.e31-this.e21*this.e30,r=this.e20*this.e32-this.e22*this.e30,e=this.e20*this.e33-this.e23*this.e30,a=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,b=this.e22*this.e33-this.e23*this.e32,X=this.e11*b-this.e12*h+this.e13*a,c=this.e10*b-this.e12*e+this.e13*r,u=this.e10*h-this.e11*e+this.e13*o,p=this.e10*a-this.e11*r+this.e12*o,x=this.e00*X-this.e01*c+this.e02*u-this.e03*p;x!=0&&(x=1/x);let v=(this.e00*b-this.e02*e+this.e03*r)*x,f=-(this.e00*h-this.e01*e+this.e03*o)*x,g=-(this.e20*n-this.e21*s+this.e23*t)*x,V=(this.e00*a-this.e01*r+this.e02*o)*x,Z=-(this.e30*_-this.e31*i+this.e32*t)*x,I=(this.e20*_-this.e21*i+this.e22*t)*x;return this.e00=X*x,this.e01=-(this.e01*b-this.e02*h+this.e03*a)*x,this.e02=(this.e31*l-this.e32*n+this.e33*_)*x,this.e03=-(this.e21*l-this.e22*n+this.e23*_)*x,this.e10=-c*x,this.e11=v,this.e12=-(this.e30*l-this.e32*s+this.e33*i)*x,this.e13=(this.e20*l-this.e22*s+this.e23*i)*x,this.e20=u*x,this.e21=f,this.e22=(this.e30*n-this.e31*s+this.e33*t)*x,this.e23=g,this.e30=-p*x,this.e31=V,this.e32=Z,this.e33=I,this}lookAt(t,i,s,_,n,l,o,r,e){let a=t-_,h=i-n,b=s-l,X=1/Math.sqrt(a*a+h*h+b*b);a*=X,h*=X,b*=X;let c=r*b-e*h,u=e*a-o*b,p=o*h-r*a;X=1/Math.sqrt(c*c+u*u+p*p),c*=X,u*=X,p*=X;let x=h*p-b*u,v=b*c-a*p,f=a*u-h*c;return this.e00=c,this.e01=u,this.e02=p,this.e03=-(c*t+u*i+p*s),this.e10=x,this.e11=v,this.e12=f,this.e13=-(x*t+v*i+f*s),this.e20=a,this.e21=h,this.e22=b,this.e23=-(a*t+h*i+b*s),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(t,i,s,_){let n=1/Math.tan(t*.5),l=_/(s-_);return this.e00=n/i,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=n,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=l,this.e23=s*l,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(t,i,s,_){let n=1/(s-_);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/i,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=n,this.e23=s*n,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(t){return t==null&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this}fromMat3(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=0,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=0,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}fromTransform(t){return this.e00=t._rotation00,this.e01=t._rotation01,this.e02=t._rotation02,this.e10=t._rotation10,this.e11=t._rotation11,this.e12=t._rotation12,this.e20=t._rotation20,this.e21=t._rotation21,this.e22=t._rotation22,this.e03=t._positionX,this.e13=t._positionY,this.e23=t._positionZ,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}clone(){return new m.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+", "+(this.e03>0?(this.e03*1e7+.5|0)/1e7:(this.e03*1e7-.5|0)/1e7)+`,
    `+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+", "+(this.e13>0?(this.e13*1e7+.5|0)/1e7:(this.e13*1e7-.5|0)/1e7)+`,
    `+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+", "+(this.e23>0?(this.e23*1e7+.5|0)/1e7:(this.e23*1e7-.5|0)/1e7)+`,
    `+(this.e30>0?(this.e30*1e7+.5|0)/1e7:(this.e30*1e7-.5|0)/1e7)+", "+(this.e31>0?(this.e31*1e7+.5|0)/1e7:(this.e31*1e7-.5|0)/1e7)+", "+(this.e32>0?(this.e32*1e7+.5|0)/1e7:(this.e32*1e7-.5|0)/1e7)+", "+(this.e33>0?(this.e33*1e7+.5|0)/1e7:(this.e33*1e7-.5|0)/1e7)+"]"}};m.common.MathUtil=class{static abs(t){return t>0?t:-t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static tan(t){return Math.tan(t)}static asin(t){return Math.asin(t)}static acos(t){return Math.acos(t)}static atan(t){return Math.atan(t)}static safeAsin(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)}static safeAcos(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)}static atan2(t,i){return Math.atan2(t,i)}static sqrt(t){return Math.sqrt(t)}static clamp(t,i,s){return t<i?i:t>s?s:t}static rand(){return Math.random()}static randIn(t,i){return t+Math.random()*(i-t)}static randVec3In(t,i){return new m.common.Vec3(t+Math.random()*(i-t),t+Math.random()*(i-t),t+Math.random()*(i-t))}static randVec3(){return new m.common.Vec3(-1+Math.random()*2,-1+Math.random()*2,-1+Math.random()*2)}};m.common.Pool=class{constructor(){this.stackVec3=new Array(256),this.sizeVec3=0,this.stackMat3=new Array(256),this.sizeMat3=0,this.stackMat4=new Array(256),this.sizeMat4=0,this.stackQuat=new Array(256),this.sizeQuat=0}vec3(){return this.sizeVec3==0?new m.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return this.sizeMat3==0?new m.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return this.sizeMat4==0?new m.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return this.sizeQuat==0?new m.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(t,i,s,_){if(t!=null){if(t.zero(),this.sizeVec3==this.stackVec3.length){let n=new Array(this.sizeVec3<<1),l=0,o=this.sizeVec3;for(;l<o;){let r=l++;n[r]=this.stackVec3[r],this.stackVec3[r]=null}this.stackVec3=n}this.stackVec3[this.sizeVec3++]=t}if(i!=null){if(i.e00=1,i.e01=0,i.e02=0,i.e10=0,i.e11=1,i.e12=0,i.e20=0,i.e21=0,i.e22=1,this.sizeMat3==this.stackMat3.length){let n=new Array(this.sizeMat3<<1),l=0,o=this.sizeMat3;for(;l<o;){let r=l++;n[r]=this.stackMat3[r],this.stackMat3[r]=null}this.stackMat3=n}this.stackMat3[this.sizeMat3++]=i}if(s!=null){if(s.e00=1,s.e01=0,s.e02=0,s.e03=0,s.e10=0,s.e11=1,s.e12=0,s.e13=0,s.e20=0,s.e21=0,s.e22=1,s.e23=0,s.e30=0,s.e31=0,s.e32=0,s.e33=1,this.sizeMat4==this.stackMat4.length){let n=new Array(this.sizeMat4<<1),l=0,o=this.sizeMat4;for(;l<o;){let r=l++;n[r]=this.stackMat4[r],this.stackMat4[r]=null}this.stackMat4=n}this.stackMat4[this.sizeMat4++]=s}if(_!=null){if(_.x=0,_.y=0,_.z=0,_.w=1,this.sizeQuat==this.stackQuat.length){let n=new Array(this.sizeQuat<<1),l=0,o=this.sizeQuat;for(;l<o;){let r=l++;n[r]=this.stackQuat[r],this.stackQuat[r]=null}this.stackQuat=n}this.stackQuat[this.sizeQuat++]=_}}disposeVec3(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let i=new Array(this.sizeVec3<<1),s=0,_=this.sizeVec3;for(;s<_;){let n=s++;i[n]=this.stackVec3[n],this.stackVec3[n]=null}this.stackVec3=i}this.stackVec3[this.sizeVec3++]=t}disposeMat3(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){let i=new Array(this.sizeMat3<<1),s=0,_=this.sizeMat3;for(;s<_;){let n=s++;i[n]=this.stackMat3[n],this.stackMat3[n]=null}this.stackMat3=i}this.stackMat3[this.sizeMat3++]=t}disposeMat4(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){let i=new Array(this.sizeMat4<<1),s=0,_=this.sizeMat4;for(;s<_;){let n=s++;i[n]=this.stackMat4[n],this.stackMat4[n]=null}this.stackMat4=i}this.stackMat4[this.sizeMat4++]=t}disposeQuat(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){let i=new Array(this.sizeQuat<<1),s=0,_=this.sizeQuat;for(;s<_;){let n=s++;i[n]=this.stackQuat[n],this.stackQuat[n]=null}this.stackQuat=i}this.stackQuat[this.sizeQuat++]=t}};m.common.Quat=class{constructor(t,i,s,_){_==null&&(_=1),s==null&&(s=0),i==null&&(i=0),t==null&&(t=0),this.x=t,this.y=i,this.z=s,this.w=_,m.common.Quat.numCreations++}identity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}init(t,i,s,_){return this.x=t,this.y=i,this.z=s,this.w=_,this}add(t){return new m.common.Quat(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return new m.common.Quat(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}scale(t){return new m.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new m.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}setArc(t,i){let s=t.x,_=t.y,n=t.z,l=i.x,o=i.y,r=i.z,e=s*l+_*o+n*r;return this.w=Math.sqrt((1+e)*.5),this.w==0?(l=s*s,o=_*_,r=n*n,l<o?l<r?(e=1/Math.sqrt(o+r),this.x=0,this.y=n*e,this.z=-_*e):(e=1/Math.sqrt(l+o),this.z=0,this.x=_*e,this.y=-s*e):o<r?(e=1/Math.sqrt(r+l),this.y=0,this.z=s*e,this.x=-n*e):(e=1/Math.sqrt(l+o),this.z=0,this.x=_*e,this.y=-s*e),this):(e=.5/this.w,this.x=(_*r-n*o)*e,this.y=(n*l-s*r)*e,this.z=(s*o-_*l)*e,this)}slerp(t,i){let s,_,n,l,o=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(o<0?(o=-o,s=-t.x,_=-t.y,n=-t.z,l=-t.w):(s=t.x,_=t.y,n=t.z,l=t.w),o>.999999){let b=new m.common.Quat(this.x+(s-this.x)*i,this.y+(_-this.y)*i,this.z+(n-this.z)*i,this.w+(l-this.w)*i),X=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z+b.w*b.w);return X>0&&(X=1/X),b.x*=X,b.y*=X,b.z*=X,b.w*=X,b}let r=i*Math.acos(o);s-=this.x*o,_-=this.y*o,n-=this.z*o,l-=this.w*o;let e=1/Math.sqrt(s*s+_*_+n*n+l*l);s*=e,_*=e,n*=e,l*=e;let a=Math.sin(r),h=Math.cos(r);return new m.common.Quat(this.x*h+s*a,this.y*h+_*a,this.z*h+n*a,this.w*h+l*a)}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new m.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(t){let i=t.e00,s=t.e11,_=t.e22,n=i+s+_,l;return n>0?(l=Math.sqrt(n+1),this.w=.5*l,l=.5/l,this.x=(t.e21-t.e12)*l,this.y=(t.e02-t.e20)*l,this.z=(t.e10-t.e01)*l):i>s?i>_?(l=Math.sqrt(i-s-_+1),this.x=.5*l,l=.5/l,this.y=(t.e01+t.e10)*l,this.z=(t.e02+t.e20)*l,this.w=(t.e21-t.e12)*l):(l=Math.sqrt(_-i-s+1),this.z=.5*l,l=.5/l,this.x=(t.e02+t.e20)*l,this.y=(t.e12+t.e21)*l,this.w=(t.e10-t.e01)*l):s>_?(l=Math.sqrt(s-_-i+1),this.y=.5*l,l=.5/l,this.x=(t.e01+t.e10)*l,this.z=(t.e12+t.e21)*l,this.w=(t.e02-t.e20)*l):(l=Math.sqrt(_-i-s+1),this.z=.5*l,l=.5/l,this.x=(t.e02+t.e20)*l,this.y=(t.e12+t.e21)*l,this.w=(t.e10-t.e01)*l),this}toMat3(){let t=new m.common.Mat3,i=this.x,s=this.y,_=this.z,n=this.w,l=2*i,o=2*s,r=2*_,e=i*l,a=s*o,h=_*r,b=i*o,X=s*r,c=i*r,u=n*l,p=n*o,x=n*r;return t.e00=1-a-h,t.e01=b-x,t.e02=c+p,t.e10=b+x,t.e11=1-e-h,t.e12=X-u,t.e20=c-p,t.e21=X+u,t.e22=1-e-a,t}toString(){return"Quat["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+` i,
    `+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+` j,
    `+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+` k,
    `+(this.w>0?(this.w*1e7+.5|0)/1e7:(this.w*1e7-.5|0)/1e7)+"]"}};m.dynamics||(m.dynamics={});m.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new m.dynamics.ContactLink,this._link2=new m.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new m.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new m.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new m.dynamics.constraint.contact.Manifold,this._updater=new m.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new m.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(this._detector==null)return;let t=this._touching,i=this._detectorResult;if(this._detector.detect(i,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData),this._touching=i.numPoints>0,this._touching?(this._manifold._buildBasis(i.normal),i.getMaxDepth()>m.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=m.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=m.common.Setting.defaultContactPositionCorrectionAlgorithm,i.incremental?this._updater.incrementalUpdate(i,this._b1._transform,this._b2._transform):this._updater.totalUpdate(i,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){let s=this._s1._contactCallback,_=this._s2._contactCallback;s==_&&(_=null),s?.beginContact(this),_?.beginContact(this)}if(!this._touching&&t){let s=this._s1._contactCallback,_=this._s2._contactCallback;s==_&&(_=null),s?.endContact(this),_?.endContact(this)}if(this._touching){let s=this._s1._contactCallback,_=this._s2._contactCallback;s==_&&(_=null),s?.preSolve(this),_?.preSolve(this)}}_postSolve(){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),t?.postSolve(this),i?.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.ContactManager=class{constructor(t){this._broadPhase=t,this._collisionMatrix=new m.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){let t=this._broadPhase._proxyPairList;for(;t!=null;){let i=t._next;for(;;){let s,_;if(t._p1._id<t._p2._id?(s=t._p1.userData,_=t._p2.userData):(s=t._p2.userData,_=t._p1.userData),!this.shouldCollide(s,_))break;let n=s._rigidBody,l=_._rigidBody,o;n._numContactLinks<l._numContactLinks?o=n._contactLinkList:o=l._contactLinkList;let r=s._id,e=_._id,a=!1;for(;o!=null;){let h=o._contact;if(h._s1._id==r&&h._s2._id==e){h._latest=!0,a=!0;break}o=o._next}if(!a){let h=this._contactPool;h!=null?(this._contactPool=h._next,h._next=null):h=new m.dynamics.Contact;let b=h;this._contactList==null?(this._contactList=b,this._contactListLast=b):(this._contactListLast._next=b,b._prev=this._contactListLast,this._contactListLast=b),b._latest=!0;let X=this._collisionMatrix.detectors[s._geom._type][_._geom._type];b._s1=s,b._s2=_,b._b1=s._rigidBody,b._b2=_._rigidBody,b._touching=!1,b._b1._contactLinkList==null?(b._b1._contactLinkList=b._link1,b._b1._contactLinkListLast=b._link1):(b._b1._contactLinkListLast._next=b._link1,b._link1._prev=b._b1._contactLinkListLast,b._b1._contactLinkListLast=b._link1),b._b2._contactLinkList==null?(b._b2._contactLinkList=b._link2,b._b2._contactLinkListLast=b._link2):(b._b2._contactLinkListLast._next=b._link2,b._link2._prev=b._b2._contactLinkListLast,b._b2._contactLinkListLast=b._link2),b._b1._numContactLinks++,b._b2._numContactLinks++,b._link1._other=b._b2,b._link2._other=b._b1,b._link1._contact=b,b._link2._contact=b,b._detector=X;let c=b._contactConstraint;c._s1=s,c._s2=_,c._b1=c._s1._rigidBody,c._b2=c._s2._rigidBody,c._tf1=c._b1._transform,c._tf2=c._b2._transform,this._numContacts++}break}t=i}}destroyOutdatedContacts(){let t=this._broadPhase._incremental,i=this._contactList;for(;i!=null;){let s=i._next;for(;;){if(i._latest){i._latest=!1,i._shouldBeSkipped=!1;break}if(!t){let b=i._prev,X=i._next;if(b!=null&&(b._next=X),X!=null&&(X._prev=b),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let f=i._s1._contactCallback,g=i._s2._contactCallback;f==g&&(g=null),f?.endContact(i),g?.endContact(i)}let c=i._link1._prev,u=i._link1._next;c!=null&&(c._next=u),u!=null&&(u._prev=c),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let p=i._link2._prev,x=i._link2._next;p!=null&&(p._next=x),x!=null&&(x._prev=p),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let v=i._contactConstraint;v._s1=null,v._s2=null,v._b1=null,v._b2=null,v._tf1=null,v._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}let _=i._s1,n=i._s2,l=_._rigidBody,o=n._rigidBody;if(!(!l._sleeping&&l._type!=1)&&!(!o._sleeping&&o._type!=1)){i._shouldBeSkipped=!0;break}let r=_._aabb,e=n._aabb,a=_._proxy,h=n._proxy;if(!(a._aabbMinX<h._aabbMaxX&&a._aabbMaxX>h._aabbMinX&&a._aabbMinY<h._aabbMaxY&&a._aabbMaxY>h._aabbMinY&&a._aabbMinZ<h._aabbMaxZ&&a._aabbMaxZ>h._aabbMinZ)||!this.shouldCollide(_,n)){let b=i._prev,X=i._next;if(b!=null&&(b._next=X),X!=null&&(X._prev=b),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let f=i._s1._contactCallback,g=i._s2._contactCallback;f==g&&(g=null),f?.endContact(i),g?.endContact(i)}let c=i._link1._prev,u=i._link1._next;c!=null&&(c._next=u),u!=null&&(u._prev=c),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let p=i._link2._prev,x=i._link2._next;p!=null&&(p._next=x),x!=null&&(x._prev=p),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let v=i._contactConstraint;v._s1=null,v._s2=null,v._b1=null,v._b2=null,v._tf1=null,v._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}i._shouldBeSkipped=!(r._minX<e._maxX&&r._maxX>e._minX&&r._minY<e._maxY&&r._maxY>e._minY&&r._minZ<e._maxZ&&r._maxZ>e._minZ);break}i=s}}shouldCollide(t,i){let s=t._rigidBody,_=i._rigidBody;if(s==_||s._type!=0&&_._type!=0||!(t._collisionGroup&i._collisionMask)||!(i._collisionGroup&t._collisionMask))return!1;let n,l;for(s._numJointLinks<_._numJointLinks?(n=s._jointLinkList,l=_):(n=_._jointLinkList,l=s);n!=null;){if(n._other==l&&!n._joint._allowCollision)return!1;n=n._next}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){let t=this._contactList;for(;t!=null;){let i=t._next;t._touching&&t._postSolve(),t=i}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}};m.dynamics.Island=class{constructor(){this.rigidBodies=new Array(m.common.Setting.islandInitialRigidBodyArraySize),this.solvers=new Array(m.common.Setting.islandInitialConstraintArraySize),this.solversSi=new Array(m.common.Setting.islandInitialConstraintArraySize),this.solversNgs=new Array(m.common.Setting.islandInitialConstraintArraySize),this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(t){if(this.numRigidBodies==this.rigidBodies.length){let i=new Array(this.numRigidBodies<<1),s=0,_=this.numRigidBodies;for(;s<_;){let n=s++;i[n]=this.rigidBodies[n],this.rigidBodies[n]=null}this.rigidBodies=i}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t}_addConstraintSolver(t,i){if(this.numSolvers==this.solvers.length){let s=new Array(this.numSolvers<<1),_=0,n=this.numSolvers;for(;_<n;){let l=_++;s[l]=this.solvers[l],this.solvers[l]=null}this.solvers=s}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,i==m.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){let s=new Array(this.numSolversSi<<1),_=0,n=this.numSolversSi;for(;_<n;){let l=_++;s[l]=this.solversSi[l],this.solversSi[l]=null}this.solversSi=s}this.solversSi[this.numSolversSi++]=t}if(i==m.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){let s=new Array(this.numSolversNgs<<1),_=0,n=this.numSolversNgs;for(;_<n;){let l=_++;s[l]=this.solversNgs[l],this.solversNgs[l]=null}this.solversNgs=s}this.solversNgs[this.numSolversNgs++]=t}}_stepSingleRigidBody(t,i){let s=t.dt,_=i._ptransform,n=i._transform;if(_._positionX=n._positionX,_._positionY=n._positionY,_._positionZ=n._positionZ,_._rotation00=n._rotation00,_._rotation01=n._rotation01,_._rotation02=n._rotation02,_._rotation10=n._rotation10,_._rotation11=n._rotation11,_._rotation12=n._rotation12,_._rotation20=n._rotation20,_._rotation21=n._rotation21,_._rotation22=n._rotation22,i._linearContactImpulseX=0,i._linearContactImpulseY=0,i._linearContactImpulseZ=0,i._angularContactImpulseX=0,i._angularContactImpulseY=0,i._angularContactImpulseZ=0,i._autoSleep&&i._velX*i._velX+i._velY*i._velY+i._velZ*i._velZ<m.common.Setting.sleepingVelocityThreshold*m.common.Setting.sleepingVelocityThreshold&&i._angVelX*i._angVelX+i._angVelY*i._angVelY+i._angVelZ*i._angVelZ<m.common.Setting.sleepingAngularVelocityThreshold*m.common.Setting.sleepingAngularVelocityThreshold?(i._sleepTime+=s,i._sleepTime>m.common.Setting.sleepingTimeThreshold&&(i._sleeping=!0,i._sleepTime=0)):i._sleepTime=0,!i._sleeping){if(i._type==0){let o=s*i._linearDamping,r=o*o,e=1/(1+o+r*(.5+o*.16666666666666666+r*.041666666666666664)),a=s*i._angularDamping,h=a*a,b=1/(1+a+h*(.5+a*.16666666666666666+h*.041666666666666664)),X,c,u,p,x,v;X=this.gravityX*i._gravityScale,c=this.gravityY*i._gravityScale,u=this.gravityZ*i._gravityScale,X+=i._forceX*i._invMass,c+=i._forceY*i._invMass,u+=i._forceZ*i._invMass;let f,g,V;f=i._invInertia00*i._torqueX+i._invInertia01*i._torqueY+i._invInertia02*i._torqueZ,g=i._invInertia10*i._torqueX+i._invInertia11*i._torqueY+i._invInertia12*i._torqueZ,V=i._invInertia20*i._torqueX+i._invInertia21*i._torqueY+i._invInertia22*i._torqueZ,p=f,x=g,v=V,i._velX+=X*s,i._velY+=c*s,i._velZ+=u*s,i._velX*=e,i._velY*=e,i._velZ*=e,i._angVelX+=p*s,i._angVelY+=x*s,i._angVelZ+=v*s,i._angVelX*=b,i._angVelY*=b,i._angVelZ*=b}i._integrate(s);let l=i._shapeList;for(;l!=null;){let o=l._next,r=i._ptransform,e=i._transform,a=l._ptransform,h=l._localTransform,b,X,c,u,p,x,v,f,g;b=r._rotation00*h._rotation00+r._rotation01*h._rotation10+r._rotation02*h._rotation20,X=r._rotation00*h._rotation01+r._rotation01*h._rotation11+r._rotation02*h._rotation21,c=r._rotation00*h._rotation02+r._rotation01*h._rotation12+r._rotation02*h._rotation22,u=r._rotation10*h._rotation00+r._rotation11*h._rotation10+r._rotation12*h._rotation20,p=r._rotation10*h._rotation01+r._rotation11*h._rotation11+r._rotation12*h._rotation21,x=r._rotation10*h._rotation02+r._rotation11*h._rotation12+r._rotation12*h._rotation22,v=r._rotation20*h._rotation00+r._rotation21*h._rotation10+r._rotation22*h._rotation20,f=r._rotation20*h._rotation01+r._rotation21*h._rotation11+r._rotation22*h._rotation21,g=r._rotation20*h._rotation02+r._rotation21*h._rotation12+r._rotation22*h._rotation22,a._rotation00=b,a._rotation01=X,a._rotation02=c,a._rotation10=u,a._rotation11=p,a._rotation12=x,a._rotation20=v,a._rotation21=f,a._rotation22=g;let V,Z,I;V=r._rotation00*h._positionX+r._rotation01*h._positionY+r._rotation02*h._positionZ,Z=r._rotation10*h._positionX+r._rotation11*h._positionY+r._rotation12*h._positionZ,I=r._rotation20*h._positionX+r._rotation21*h._positionY+r._rotation22*h._positionZ,a._positionX=V,a._positionY=Z,a._positionZ=I,a._positionX+=r._positionX,a._positionY+=r._positionY,a._positionZ+=r._positionZ;let M=l._transform,y=l._localTransform,d,B,R,k,A,z,w,S,P;d=e._rotation00*y._rotation00+e._rotation01*y._rotation10+e._rotation02*y._rotation20,B=e._rotation00*y._rotation01+e._rotation01*y._rotation11+e._rotation02*y._rotation21,R=e._rotation00*y._rotation02+e._rotation01*y._rotation12+e._rotation02*y._rotation22,k=e._rotation10*y._rotation00+e._rotation11*y._rotation10+e._rotation12*y._rotation20,A=e._rotation10*y._rotation01+e._rotation11*y._rotation11+e._rotation12*y._rotation21,z=e._rotation10*y._rotation02+e._rotation11*y._rotation12+e._rotation12*y._rotation22,w=e._rotation20*y._rotation00+e._rotation21*y._rotation10+e._rotation22*y._rotation20,S=e._rotation20*y._rotation01+e._rotation21*y._rotation11+e._rotation22*y._rotation21,P=e._rotation20*y._rotation02+e._rotation21*y._rotation12+e._rotation22*y._rotation22,M._rotation00=d,M._rotation01=B,M._rotation02=R,M._rotation10=k,M._rotation11=A,M._rotation12=z,M._rotation20=w,M._rotation21=S,M._rotation22=P;let T,C,L;T=e._rotation00*y._positionX+e._rotation01*y._positionY+e._rotation02*y._positionZ,C=e._rotation10*y._positionX+e._rotation11*y._positionY+e._rotation12*y._positionZ,L=e._rotation20*y._positionX+e._rotation21*y._positionY+e._rotation22*y._positionZ,M._positionX=T,M._positionY=C,M._positionZ=L,M._positionX+=e._positionX,M._positionY+=e._positionY,M._positionZ+=e._positionZ;let q,U,Y,E,D,Q;if(l._geom._computeAabb(l._aabb,l._ptransform),q=l._aabb._minX,U=l._aabb._minY,Y=l._aabb._minZ,E=l._aabb._maxX,D=l._aabb._maxY,Q=l._aabb._maxZ,l._geom._computeAabb(l._aabb,l._transform),l._aabb._minX=q<l._aabb._minX?q:l._aabb._minX,l._aabb._minY=U<l._aabb._minY?U:l._aabb._minY,l._aabb._minZ=Y<l._aabb._minZ?Y:l._aabb._minZ,l._aabb._maxX=E>l._aabb._maxX?E:l._aabb._maxX,l._aabb._maxY=D>l._aabb._maxY?D:l._aabb._maxY,l._aabb._maxZ=Q>l._aabb._maxZ?Q:l._aabb._maxZ,l._proxy!=null){let W,F,H;W=l._transform._positionX-l._ptransform._positionX,F=l._transform._positionY-l._ptransform._positionY,H=l._transform._positionZ-l._ptransform._positionZ;let G=l.displacement;G.x=W,G.y=F,G.z=H,l._rigidBody._world._broadPhase.moveProxy(l._proxy,l._aabb,l.displacement)}l=o}}}_step(t,i,s){let _=t.dt,n=!0,l=0,o=this.numRigidBodies;for(;l<o;){let k=this.rigidBodies[l++],A=k._ptransform,z=k._transform;if(A._positionX=z._positionX,A._positionY=z._positionY,A._positionZ=z._positionZ,A._rotation00=z._rotation00,A._rotation01=z._rotation01,A._rotation02=z._rotation02,A._rotation10=z._rotation10,A._rotation11=z._rotation11,A._rotation12=z._rotation12,A._rotation20=z._rotation20,A._rotation21=z._rotation21,A._rotation22=z._rotation22,k._linearContactImpulseX=0,k._linearContactImpulseY=0,k._linearContactImpulseZ=0,k._angularContactImpulseX=0,k._angularContactImpulseY=0,k._angularContactImpulseZ=0,k._sleeping=!1,k._autoSleep&&k._velX*k._velX+k._velY*k._velY+k._velZ*k._velZ<m.common.Setting.sleepingVelocityThreshold*m.common.Setting.sleepingVelocityThreshold&&k._angVelX*k._angVelX+k._angVelY*k._angVelY+k._angVelZ*k._angVelZ<m.common.Setting.sleepingAngularVelocityThreshold*m.common.Setting.sleepingAngularVelocityThreshold?k._sleepTime+=_:k._sleepTime=0,k._sleepTime<m.common.Setting.sleepingTimeThreshold&&(n=!1),k._type==0){let w=_*k._linearDamping,S=w*w,P=1/(1+w+S*(.5+w*.16666666666666666+S*.041666666666666664)),T=_*k._angularDamping,C=T*T,L=1/(1+T+C*(.5+T*.16666666666666666+C*.041666666666666664)),q,U,Y,E,D,Q;q=this.gravityX*k._gravityScale,U=this.gravityY*k._gravityScale,Y=this.gravityZ*k._gravityScale,q+=k._forceX*k._invMass,U+=k._forceY*k._invMass,Y+=k._forceZ*k._invMass;let W,F,H;W=k._invInertia00*k._torqueX+k._invInertia01*k._torqueY+k._invInertia02*k._torqueZ,F=k._invInertia10*k._torqueX+k._invInertia11*k._torqueY+k._invInertia12*k._torqueZ,H=k._invInertia20*k._torqueX+k._invInertia21*k._torqueY+k._invInertia22*k._torqueZ,E=W,D=F,Q=H,k._velX+=q*_,k._velY+=U*_,k._velZ+=Y*_,k._velX*=P,k._velY*=P,k._velZ*=P,k._angVelX+=E*_,k._angVelY+=D*_,k._angVelZ+=Q*_,k._angVelX*=L,k._angVelY*=L,k._angVelZ*=L}}if(n){let k=0,A=this.numRigidBodies;for(;k<A;){let z=this.rigidBodies[k++];z._sleeping=!0,z._sleepTime=0}return}let r=0,e=this.numSolvers;for(;r<e;)this.solvers[r++].preSolveVelocity(t);let a=0,h=this.numSolvers;for(;a<h;)this.solvers[a++].warmStart(t);let b=0;for(;b<i;){++b;let k=0,A=this.numSolvers;for(;k<A;)this.solvers[k++].solveVelocity()}let X=0,c=this.numSolvers;for(;X<c;)this.solvers[X++].postSolveVelocity(t);let u=0,p=this.numRigidBodies;for(;u<p;)this.rigidBodies[u++]._integrate(_);let x=0,v=this.numSolversSi;for(;x<v;)this.solversSi[x++].preSolvePosition(t);let f=0;for(;f<s;){++f;let k=0,A=this.numSolversSi;for(;k<A;)this.solversSi[k++].solvePositionSplitImpulse()}let g=0,V=this.numRigidBodies;for(;g<V;)this.rigidBodies[g++]._integratePseudoVelocity();let Z=0,I=this.numSolversNgs;for(;Z<I;)this.solversNgs[Z++].preSolvePosition(t);let M=0;for(;M<s;){++M;let k=0,A=this.numSolversNgs;for(;k<A;)this.solversNgs[k++].solvePositionNgs(t)}let y=0,d=this.numSolvers;for(;y<d;)this.solvers[y++].postSolve();let B=0,R=this.numRigidBodies;for(;B<R;){let k=this.rigidBodies[B++],A=k._shapeList;for(;A!=null;){let z=A._next,w=k._ptransform,S=k._transform,P=A._ptransform,T=A._localTransform,C,L,q,U,Y,E,D,Q,W;C=w._rotation00*T._rotation00+w._rotation01*T._rotation10+w._rotation02*T._rotation20,L=w._rotation00*T._rotation01+w._rotation01*T._rotation11+w._rotation02*T._rotation21,q=w._rotation00*T._rotation02+w._rotation01*T._rotation12+w._rotation02*T._rotation22,U=w._rotation10*T._rotation00+w._rotation11*T._rotation10+w._rotation12*T._rotation20,Y=w._rotation10*T._rotation01+w._rotation11*T._rotation11+w._rotation12*T._rotation21,E=w._rotation10*T._rotation02+w._rotation11*T._rotation12+w._rotation12*T._rotation22,D=w._rotation20*T._rotation00+w._rotation21*T._rotation10+w._rotation22*T._rotation20,Q=w._rotation20*T._rotation01+w._rotation21*T._rotation11+w._rotation22*T._rotation21,W=w._rotation20*T._rotation02+w._rotation21*T._rotation12+w._rotation22*T._rotation22,P._rotation00=C,P._rotation01=L,P._rotation02=q,P._rotation10=U,P._rotation11=Y,P._rotation12=E,P._rotation20=D,P._rotation21=Q,P._rotation22=W;let F,H,G;F=w._rotation00*T._positionX+w._rotation01*T._positionY+w._rotation02*T._positionZ,H=w._rotation10*T._positionX+w._rotation11*T._positionY+w._rotation12*T._positionZ,G=w._rotation20*T._positionX+w._rotation21*T._positionY+w._rotation22*T._positionZ,P._positionX=F,P._positionY=H,P._positionZ=G,P._positionX+=w._positionX,P._positionY+=w._positionY,P._positionZ+=w._positionZ;let J=A._transform,N=A._localTransform,K,O,$,et,st,lt,rt,at,_t;K=S._rotation00*N._rotation00+S._rotation01*N._rotation10+S._rotation02*N._rotation20,O=S._rotation00*N._rotation01+S._rotation01*N._rotation11+S._rotation02*N._rotation21,$=S._rotation00*N._rotation02+S._rotation01*N._rotation12+S._rotation02*N._rotation22,et=S._rotation10*N._rotation00+S._rotation11*N._rotation10+S._rotation12*N._rotation20,st=S._rotation10*N._rotation01+S._rotation11*N._rotation11+S._rotation12*N._rotation21,lt=S._rotation10*N._rotation02+S._rotation11*N._rotation12+S._rotation12*N._rotation22,rt=S._rotation20*N._rotation00+S._rotation21*N._rotation10+S._rotation22*N._rotation20,at=S._rotation20*N._rotation01+S._rotation21*N._rotation11+S._rotation22*N._rotation21,_t=S._rotation20*N._rotation02+S._rotation21*N._rotation12+S._rotation22*N._rotation22,J._rotation00=K,J._rotation01=O,J._rotation02=$,J._rotation10=et,J._rotation11=st,J._rotation12=lt,J._rotation20=rt,J._rotation21=at,J._rotation22=_t;let ht,ot,bt;ht=S._rotation00*N._positionX+S._rotation01*N._positionY+S._rotation02*N._positionZ,ot=S._rotation10*N._positionX+S._rotation11*N._positionY+S._rotation12*N._positionZ,bt=S._rotation20*N._positionX+S._rotation21*N._positionY+S._rotation22*N._positionZ,J._positionX=ht,J._positionY=ot,J._positionZ=bt,J._positionX+=S._positionX,J._positionY+=S._positionY,J._positionZ+=S._positionZ;let Xt,ft,ut,xt,zt,gt;if(A._geom._computeAabb(A._aabb,A._ptransform),Xt=A._aabb._minX,ft=A._aabb._minY,ut=A._aabb._minZ,xt=A._aabb._maxX,zt=A._aabb._maxY,gt=A._aabb._maxZ,A._geom._computeAabb(A._aabb,A._transform),A._aabb._minX=Xt<A._aabb._minX?Xt:A._aabb._minX,A._aabb._minY=ft<A._aabb._minY?ft:A._aabb._minY,A._aabb._minZ=ut<A._aabb._minZ?ut:A._aabb._minZ,A._aabb._maxX=xt>A._aabb._maxX?xt:A._aabb._maxX,A._aabb._maxY=zt>A._aabb._maxY?zt:A._aabb._maxY,A._aabb._maxZ=gt>A._aabb._maxZ?gt:A._aabb._maxZ,A._proxy!=null){let pt,ct,nt;pt=A._transform._positionX-A._ptransform._positionX,ct=A._transform._positionY-A._ptransform._positionY,nt=A._transform._positionZ-A._ptransform._positionZ;let tt=A.displacement;tt.x=pt,tt.y=ct,tt.z=nt,A._rigidBody._world._broadPhase.moveProxy(A._proxy,A._aabb,A.displacement)}A=z}}}};m.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}};m.dynamics.World=class{constructor(t,i){switch(t==null&&(t=2),t){case 1:this._broadPhase=new m.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new m.collision.broadphase.bvh.BvhBroadPhase;break}this._contactManager=new m.dynamics.ContactManager(this._broadPhase),i==null&&(i=new m.common.Vec3(0,-9.80665,0)),this._gravity=new m.common.Vec3(i.x,i.y,i.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new m.dynamics._World.RayCastWrapper,this._convexCastWrapper=new m.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new m.dynamics._World.AabbTestWrapper,this._island=new m.dynamics.Island,this._solversInIslands=new Array(m.common.Setting.islandInitialConstraintArraySize),this._rigidBodyStack=new Array(m.common.Setting.islandInitialRigidBodyArraySize),this._timeStep=new m.dynamics.TimeStep,this._pool=new m.common.Pool,this._shapeIdCount=0}_updateContacts(){let t=Date.now()/1e3;this._contactManager._updateContacts(),m.dynamics.common.Performance.broadPhaseCollisionTime=(Date.now()/1e3-t)*1e3;let i=Date.now()/1e3,s=this._contactManager._contactList;for(;s!=null;){let _=s._next;s._shouldBeSkipped||s._updateManifold(),s=_}m.dynamics.common.Performance.narrowPhaseCollisionTime=(Date.now()/1e3-i)*1e3}_solveIslands(){let t=Date.now()/1e3;if(m.common.Setting.disableSleeping){let n=this._rigidBodyList;for(;n!=null;)n._sleeping=!1,n._sleepTime=0,n=n._next}if(this._rigidBodyStack.length<this._numRigidBodies){let n=this._rigidBodyStack.length<<1;for(;n<this._numRigidBodies;)n<<=1;this._rigidBodyStack=new Array(n)}this._numIslands=0;let i=this._island,s=this._gravity;i.gravityX=s.x,i.gravityY=s.y,i.gravityZ=s.z;let _=this._rigidBodyList;for(this._numSolversInIslands=0;_!=null;){let n=_._next;for(;!(_._addedToIsland||_._sleeping||_._type==1);){if(_._numContactLinks==0&&_._numJointLinks==0){this._island._stepSingleRigidBody(this._timeStep,_),this._numIslands++;break}this.buildIsland(_),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}_=n}for(this._contactManager._postSolve(),_=this._rigidBodyList;_!=null;)_._addedToIsland=!1,_=_._next;for(_=this._rigidBodyList;_!=null;)_._forceX=0,_._forceY=0,_._forceZ=0,_._torqueX=0,_._torqueY=0,_._torqueZ=0,_=_._next;for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;m.dynamics.common.Performance.dynamicsTime=(Date.now()/1e3-t)*1e3}buildIsland(t){let i=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;i>0;){let s=this._rigidBodyStack[--i];if(this._rigidBodyStack[i]=null,s._type==1)continue;let _=s._contactLinkList;for(;_!=null;){let l=_._next,o=_._contact._contactConstraint,r=_._contact._contactConstraint._solver;if(o.isTouching()&&!r._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let a=new Array(this._numSolversInIslands<<1),h=0,b=this._numSolversInIslands;for(;h<b;){let X=h++;a[X]=this._solversInIslands[X],this._solversInIslands[X]=null}this._solversInIslands=a}this._solversInIslands[this._numSolversInIslands++]=r,this._island._addConstraintSolver(r,o._positionCorrectionAlgorithm);let e=_._other;e._addedToIsland||(this._island._addRigidBody(e),this._rigidBodyStack[i++]=e)}_=l}let n=s._jointLinkList;for(;n!=null;){let l=n._next,o=n._joint,r=o._solver;if(!r._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let a=new Array(this._numSolversInIslands<<1),h=0,b=this._numSolversInIslands;for(;h<b;){let X=h++;a[X]=this._solversInIslands[X],this._solversInIslands[X]=null}this._solversInIslands=a}this._solversInIslands[this._numSolversInIslands++]=r,this._island._addConstraintSolver(r,o._positionCorrectionAlgorithm);let e=n._other;e._addedToIsland||(this._island._addRigidBody(e),this._rigidBodyStack[i++]=e)}n=l}}}_drawBvh(t,i){t.drawBvh&&this._drawBvhNode(t,i._root,0,t.style.bvhNodeColor)}_drawBvhNode(t,i,s,_){if(i!=null){if(s>=t.drawBvhMinLevel&&s<=t.drawBvhMaxLevel){let n=this._pool,l=n.sizeVec3==0?new m.common.Vec3:n.stackVec3[--n.sizeVec3],o=this._pool,r=o.sizeVec3==0?new m.common.Vec3:o.stackVec3[--o.sizeVec3],e=l;e.x=i._aabbMinX,e.y=i._aabbMinY,e.z=i._aabbMinZ;let a=r;a.x=i._aabbMaxX,a.y=i._aabbMaxY,a.z=i._aabbMaxZ,t.aabb(l,r,_);let h=this._pool;if(l!=null){if(l.zero(),h.sizeVec3==h.stackVec3.length){let X=new Array(h.sizeVec3<<1),c=0,u=h.sizeVec3;for(;c<u;){let p=c++;X[p]=h.stackVec3[p],h.stackVec3[p]=null}h.stackVec3=X}h.stackVec3[h.sizeVec3++]=l}let b=this._pool;if(r!=null){if(r.zero(),b.sizeVec3==b.stackVec3.length){let X=new Array(b.sizeVec3<<1),c=0,u=b.sizeVec3;for(;c<u;){let p=c++;X[p]=b.stackVec3[p],b.stackVec3[p]=null}b.stackVec3=X}b.stackVec3[b.sizeVec3++]=r}}this._drawBvhNode(t,i._children[0],s+1,_),this._drawBvhNode(t,i._children[1],s+1,_)}}_drawRigidBodies(t){let i=t.style,s=this._rigidBodyList;for(;s!=null;){let _=s._next;if(t.drawBases){let r=t.style;t.basis(s._transform,r.basisLength,r.basisColorX,r.basisColorY,r.basisColorZ)}let n=null,l=s._type==0;l||(n=s._type==2?i.kinematicShapeColor:i.staticShapeColor);let o=s._shapeList;for(;o!=null;){let r=o._next;if(l&&(o._id&1?n=s._sleeping?i.sleepingShapeColor2:s._sleepTime>m.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor2:i.shapeColor2:n=s._sleeping?i.sleepingShapeColor1:s._sleepTime>m.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor1:i.shapeColor1),t.drawShapes){let e=o._geom,a=o._transform;switch(e._type){case 0:t.sphere(a,e._radius,n);break;case 1:let h=e,b=this._pool,X=b.sizeVec3==0?new m.common.Vec3:b.stackVec3[--b.sizeVec3],c=X;c.x=h._halfExtentsX,c.y=h._halfExtentsY,c.z=h._halfExtentsZ,t.box(a,X,n);let u=this._pool;if(X!=null){if(X.zero(),u.sizeVec3==u.stackVec3.length){let J=new Array(u.sizeVec3<<1),N=0,K=u.sizeVec3;for(;N<K;){let O=N++;J[O]=u.stackVec3[O],u.stackVec3[O]=null}u.stackVec3=J}u.stackVec3[u.sizeVec3++]=X}break;case 2:let p=e;t.cylinder(a,p._radius,p._halfHeight,n);break;case 3:let x=e;t.cone(a,x._radius,x._halfHeight,n);break;case 4:let v=e;t.capsule(a,v._radius,v._halfHeight,n);break;case 5:let f=e,g=f._numVertices,V=this._pool,Z=V.sizeVec3==0?new m.common.Vec3:V.stackVec3[--V.sizeVec3],I=this._pool,M=I.sizeVec3==0?new m.common.Vec3:I.stackVec3[--I.sizeVec3],y=this._pool,d=y.sizeVec3==0?new m.common.Vec3:y.stackVec3[--y.sizeVec3],B=this._pool,R=B.sizeVec3==0?new m.common.Vec3:B.stackVec3[--B.sizeVec3],k=this._pool,A=k.sizeVec3==0?new m.common.Vec3:k.stackVec3[--k.sizeVec3],z=this._pool,w=z.sizeVec3==0?new m.common.Vec3:z.stackVec3[--z.sizeVec3],S=this._pool,P=S.sizeMat3==0?new m.common.Mat3:S.stackMat3[--S.sizeMat3],T=this._pool,C=T.sizeVec3==0?new m.common.Vec3:T.stackVec3[--T.sizeVec3],L=P;L.e00=a._rotation00,L.e01=a._rotation01,L.e02=a._rotation02,L.e10=a._rotation10,L.e11=a._rotation11,L.e12=a._rotation12,L.e20=a._rotation20,L.e21=a._rotation21,L.e22=a._rotation22;let q=C;q.x=a._positionX,q.y=a._positionY,q.z=a._positionZ;let U=0;for(;U<g;){let J=U++,N=f._tmpVertices[J],K=f._vertices[J];N.x=K.x,N.y=K.y,N.z=K.z;let O=N.x*P.e10+N.y*P.e11+N.z*P.e12,$=N.x*P.e20+N.y*P.e21+N.z*P.e22;N.x=N.x*P.e00+N.y*P.e01+N.z*P.e02,N.y=O,N.z=$,N.x+=C.x,N.y+=C.y,N.z+=C.z}if(g>30){let J=0;for(;J<g;){let N=J++,K=f._tmpVertices[N];Z.x=K.x,Z.y=K.y,Z.z=K.z;let O=f._tmpVertices[(N+1)%g];M.x=O.x,M.y=O.y,M.z=O.z,t.line(Z,M,n)}}else if(this._debugDraw.wireframe||g>10){let J=0;for(;J<g;){let N=J++,K=f._tmpVertices[N];Z.x=K.x,Z.y=K.y,Z.z=K.z;let O=0;for(;O<N;){let $=f._tmpVertices[O++];M.x=$.x,M.y=$.y,M.z=$.z,t.line(Z,M,n)}}}else{let J=0;for(;J<g;){let N=J++,K=f._tmpVertices[N];Z.x=K.x,Z.y=K.y,Z.z=K.z;let O=0;for(;O<N;){let $=O++,et=f._tmpVertices[$];M.x=et.x,M.y=et.y,M.z=et.z;let st=0;for(;st<$;){let lt=f._tmpVertices[st++];d.x=lt.x,d.y=lt.y,d.z=lt.z,R.x=M.x,R.y=M.y,R.z=M.z;let rt=R;rt.x-=Z.x,rt.y-=Z.y,rt.z-=Z.z,A.x=d.x,A.y=d.y,A.z=d.z;let at=A;at.x-=Z.x,at.y-=Z.y,at.z-=Z.z,w.x=R.x,w.y=R.y,w.z=R.z;let _t=w,ht=_t.z*A.x-_t.x*A.z,ot=_t.x*A.y-_t.y*A.x;_t.x=_t.y*A.z-_t.z*A.y,_t.y=ht,_t.z=ot;let bt=Math.sqrt(_t.x*_t.x+_t.y*_t.y+_t.z*_t.z);bt>0&&(bt=1/bt),_t.x*=bt,_t.y*=bt,_t.z*=bt,t.triangle(Z,M,d,w,w,w,n),w.x=-w.x,w.y=-w.y,w.z=-w.z,t.triangle(Z,d,M,w,w,w,n)}}}}let Y=this._pool;if(Z!=null){if(Z.zero(),Y.sizeVec3==Y.stackVec3.length){let J=new Array(Y.sizeVec3<<1),N=0,K=Y.sizeVec3;for(;N<K;){let O=N++;J[O]=Y.stackVec3[O],Y.stackVec3[O]=null}Y.stackVec3=J}Y.stackVec3[Y.sizeVec3++]=Z}let E=this._pool;if(M!=null){if(M.zero(),E.sizeVec3==E.stackVec3.length){let J=new Array(E.sizeVec3<<1),N=0,K=E.sizeVec3;for(;N<K;){let O=N++;J[O]=E.stackVec3[O],E.stackVec3[O]=null}E.stackVec3=J}E.stackVec3[E.sizeVec3++]=M}let D=this._pool;if(d!=null){if(d.zero(),D.sizeVec3==D.stackVec3.length){let J=new Array(D.sizeVec3<<1),N=0,K=D.sizeVec3;for(;N<K;){let O=N++;J[O]=D.stackVec3[O],D.stackVec3[O]=null}D.stackVec3=J}D.stackVec3[D.sizeVec3++]=d}let Q=this._pool;if(R!=null){if(R.zero(),Q.sizeVec3==Q.stackVec3.length){let J=new Array(Q.sizeVec3<<1),N=0,K=Q.sizeVec3;for(;N<K;){let O=N++;J[O]=Q.stackVec3[O],Q.stackVec3[O]=null}Q.stackVec3=J}Q.stackVec3[Q.sizeVec3++]=R}let W=this._pool;if(A!=null){if(A.zero(),W.sizeVec3==W.stackVec3.length){let J=new Array(W.sizeVec3<<1),N=0,K=W.sizeVec3;for(;N<K;){let O=N++;J[O]=W.stackVec3[O],W.stackVec3[O]=null}W.stackVec3=J}W.stackVec3[W.sizeVec3++]=A}let F=this._pool;if(w!=null){if(w.zero(),F.sizeVec3==F.stackVec3.length){let J=new Array(F.sizeVec3<<1),N=0,K=F.sizeVec3;for(;N<K;){let O=N++;J[O]=F.stackVec3[O],F.stackVec3[O]=null}F.stackVec3=J}F.stackVec3[F.sizeVec3++]=w}let H=this._pool;if(P!=null){if(P.e00=1,P.e01=0,P.e02=0,P.e10=0,P.e11=1,P.e12=0,P.e20=0,P.e21=0,P.e22=1,H.sizeMat3==H.stackMat3.length){let J=new Array(H.sizeMat3<<1),N=0,K=H.sizeMat3;for(;N<K;){let O=N++;J[O]=H.stackMat3[O],H.stackMat3[O]=null}H.stackMat3=J}H.stackMat3[H.sizeMat3++]=P}let G=this._pool;if(C!=null){if(C.zero(),G.sizeVec3==G.stackVec3.length){let J=new Array(G.sizeVec3<<1),N=0,K=G.sizeVec3;for(;N<K;){let O=N++;J[O]=G.stackVec3[O],G.stackVec3[O]=null}G.stackVec3=J}G.stackVec3[G.sizeVec3++]=C}break}}if(t.drawAabbs){let e=o._aabb,a=i.aabbColor,h=this._pool,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this._pool,c=X.sizeVec3==0?new m.common.Vec3:X.stackVec3[--X.sizeVec3],u=b;u.x=e._minX,u.y=e._minY,u.z=e._minZ;let p=c;p.x=e._maxX,p.y=e._maxY,p.z=e._maxZ,t.aabb(b,c,a);let x=this._pool;if(b!=null){if(b.zero(),x.sizeVec3==x.stackVec3.length){let f=new Array(x.sizeVec3<<1),g=0,V=x.sizeVec3;for(;g<V;){let Z=g++;f[Z]=x.stackVec3[Z],x.stackVec3[Z]=null}x.stackVec3=f}x.stackVec3[x.sizeVec3++]=b}let v=this._pool;if(c!=null){if(c.zero(),v.sizeVec3==v.stackVec3.length){let f=new Array(v.sizeVec3<<1),g=0,V=v.sizeVec3;for(;g<V;){let Z=g++;f[Z]=v.stackVec3[Z],v.stackVec3[Z]=null}v.stackVec3=f}v.stackVec3[v.sizeVec3++]=c}}o=r}s=_}}_drawConstraints(t){let i=t.style;if(t.drawPairs||t.drawContacts){let s=this._contactManager._contactList;for(;s!=null;){let _=s._next;if(t.drawPairs){let n=i.pairColor,l=this._pool,o=l.sizeVec3==0?new m.common.Vec3:l.stackVec3[--l.sizeVec3],r=this._pool,e=r.sizeVec3==0?new m.common.Vec3:r.stackVec3[--r.sizeVec3],a=o;a.x=s._s1._transform._positionX,a.y=s._s1._transform._positionY,a.z=s._s1._transform._positionZ;let h=e;h.x=s._s2._transform._positionX,h.y=s._s2._transform._positionY,h.z=s._s2._transform._positionZ,t.line(o,e,n);let b=this._pool;if(o!=null){if(o.zero(),b.sizeVec3==b.stackVec3.length){let c=new Array(b.sizeVec3<<1),u=0,p=b.sizeVec3;for(;u<p;){let x=u++;c[x]=b.stackVec3[x],b.stackVec3[x]=null}b.stackVec3=c}b.stackVec3[b.sizeVec3++]=o}let X=this._pool;if(e!=null){if(e.zero(),X.sizeVec3==X.stackVec3.length){let c=new Array(X.sizeVec3<<1),u=0,p=X.sizeVec3;for(;u<p;){let x=u++;c[x]=X.stackVec3[x],X.stackVec3[x]=null}X.stackVec3=c}X.stackVec3[X.sizeVec3++]=e}}if(t.drawContacts){let n=s._contactConstraint,l=s._contactConstraint._manifold._points,o=0,r=s._contactConstraint._manifold._numPoints;for(;o<r;){let e=l[o++],a=t.style,h=this._pool,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this._pool,c=X.sizeVec3==0?new m.common.Vec3:X.stackVec3[--X.sizeVec3],u=this._pool,p=u.sizeVec3==0?new m.common.Vec3:u.stackVec3[--u.sizeVec3],x=this._pool,v=x.sizeVec3==0?new m.common.Vec3:x.stackVec3[--x.sizeVec3],f=this._pool,g=f.sizeVec3==0?new m.common.Vec3:f.stackVec3[--f.sizeVec3],V=b;V.x=e._pos1X,V.y=e._pos1Y,V.z=e._pos1Z;let Z=c;Z.x=e._pos2X,Z.y=e._pos2Y,Z.z=e._pos2Z;let I=p;I.x=n._manifold._normalX,I.y=n._manifold._normalY,I.z=n._manifold._normalZ;let M=v;M.x=n._manifold._tangentX,M.y=n._manifold._tangentY,M.z=n._manifold._tangentZ;let y=g;if(y.x=n._manifold._binormalX,y.y=n._manifold._binormalY,y.z=n._manifold._binormalZ,e._disabled)t.point(b,a.disabledContactColor),t.point(c,a.disabledContactColor),t.line(b,c,a.disabledContactColor);else if(e._warmStarted){let S;switch(e._id&3){case 0:S=a.contactColor;break;case 1:S=a.contactColor2;break;case 2:S=a.contactColor3;break;default:S=a.contactColor4}t.point(b,S),t.point(c,S),t.line(b,c,a.contactColor)}else t.point(b,a.newContactColor),t.point(c,a.newContactColor),t.line(b,c,a.newContactColor);c.x=b.x,c.y=b.y,c.z=b.z;let d=c,B=a.contactNormalLength;if(d.x+=p.x*B,d.y+=p.y*B,d.z+=p.z*B,t.line(b,c,a.contactNormalColor),t.drawContactBases){c.x=b.x,c.y=b.y,c.z=b.z;let S=c,P=a.contactTangentLength;S.x+=v.x*P,S.y+=v.y*P,S.z+=v.z*P,t.line(b,c,a.contactTangentColor),c.x=b.x,c.y=b.y,c.z=b.z;let T=c,C=a.contactBinormalLength;T.x+=g.x*C,T.y+=g.y*C,T.z+=g.z*C,t.line(b,c,a.contactBinormalColor)}let R=this._pool;if(b!=null){if(b.zero(),R.sizeVec3==R.stackVec3.length){let S=new Array(R.sizeVec3<<1),P=0,T=R.sizeVec3;for(;P<T;){let C=P++;S[C]=R.stackVec3[C],R.stackVec3[C]=null}R.stackVec3=S}R.stackVec3[R.sizeVec3++]=b}let k=this._pool;if(c!=null){if(c.zero(),k.sizeVec3==k.stackVec3.length){let S=new Array(k.sizeVec3<<1),P=0,T=k.sizeVec3;for(;P<T;){let C=P++;S[C]=k.stackVec3[C],k.stackVec3[C]=null}k.stackVec3=S}k.stackVec3[k.sizeVec3++]=c}let A=this._pool;if(p!=null){if(p.zero(),A.sizeVec3==A.stackVec3.length){let S=new Array(A.sizeVec3<<1),P=0,T=A.sizeVec3;for(;P<T;){let C=P++;S[C]=A.stackVec3[C],A.stackVec3[C]=null}A.stackVec3=S}A.stackVec3[A.sizeVec3++]=p}let z=this._pool;if(v!=null){if(v.zero(),z.sizeVec3==z.stackVec3.length){let S=new Array(z.sizeVec3<<1),P=0,T=z.sizeVec3;for(;P<T;){let C=P++;S[C]=z.stackVec3[C],z.stackVec3[C]=null}z.stackVec3=S}z.stackVec3[z.sizeVec3++]=v}let w=this._pool;if(g!=null){if(g.zero(),w.sizeVec3==w.stackVec3.length){let S=new Array(w.sizeVec3<<1),P=0,T=w.sizeVec3;for(;P<T;){let C=P++;S[C]=w.stackVec3[C],w.stackVec3[C]=null}w.stackVec3=S}w.stackVec3[w.sizeVec3++]=g}}}s=_}}if(t.drawJoints){let s=this._jointList;for(;s!=null;){let _=s._next,n=this._pool,l=n.sizeVec3==0?new m.common.Vec3:n.stackVec3[--n.sizeVec3],o=this._pool,r=o.sizeVec3==0?new m.common.Vec3:o.stackVec3[--o.sizeVec3],e=l;e.x=s._b1._transform._positionX,e.y=s._b1._transform._positionY,e.z=s._b1._transform._positionZ;let a=r;a.x=s._b2._transform._positionX,a.y=s._b2._transform._positionY,a.z=s._b2._transform._positionZ;let h=this._pool,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this._pool,c=X.sizeVec3==0?new m.common.Vec3:X.stackVec3[--X.sizeVec3],u=this._pool,p=u.sizeVec3==0?new m.common.Vec3:u.stackVec3[--u.sizeVec3],x=this._pool,v=x.sizeVec3==0?new m.common.Vec3:x.stackVec3[--x.sizeVec3],f=this._pool,g=f.sizeVec3==0?new m.common.Vec3:f.stackVec3[--f.sizeVec3],V=this._pool,Z=V.sizeVec3==0?new m.common.Vec3:V.stackVec3[--V.sizeVec3],I=this._pool,M=I.sizeVec3==0?new m.common.Vec3:I.stackVec3[--I.sizeVec3],y=this._pool,d=y.sizeVec3==0?new m.common.Vec3:y.stackVec3[--y.sizeVec3],B=b;B.x=s._anchor1X,B.y=s._anchor1Y,B.z=s._anchor1Z;let R=c;R.x=s._anchor2X,R.y=s._anchor2Y,R.z=s._anchor2Z;let k=p;k.x=s._basisX1X,k.y=s._basisX1Y,k.z=s._basisX1Z;let A=v;A.x=s._basisY1X,A.y=s._basisY1Y,A.z=s._basisY1Z;let z=g;z.x=s._basisZ1X,z.y=s._basisZ1Y,z.z=s._basisZ1Z;let w=Z;w.x=s._basisX2X,w.y=s._basisX2Y,w.z=s._basisX2Z;let S=M;S.x=s._basisY2X,S.y=s._basisY2Y,S.z=s._basisY2Z;let P=d;if(P.x=s._basisZ2X,P.y=s._basisZ2Y,P.z=s._basisZ2Z,t.line(l,b,t.style.jointLineColor),t.line(r,c,t.style.jointLineColor),t.drawJointLimits)switch(s._type){case 0:break;case 1:let F=s._lm;this._drawRotationalLimit(t,b,v,g,M,t.style.jointRotationalConstraintRadius,F.lowerLimit,F.upperLimit,t.style.jointLineColor);break;case 2:let H=s,G=t.style.jointLineColor,J=H._rotLm,N=H._translLm;this._drawRotationalLimit(t,c,v,g,M,t.style.jointRotationalConstraintRadius,J.lowerLimit,J.upperLimit,G),this._drawTranslationalLimit(t,b,p,N.lowerLimit,N.upperLimit,G);break;case 3:let K=s._lm;this._drawTranslationalLimit(t,b,p,K.lowerLimit,K.upperLimit,t.style.jointLineColor);break;case 4:let O=s,$=t.style.jointRotationalConstraintRadius,et=t.style.jointLineColor,st=O._lm1,lt=O._lm2;this._drawRotationalLimit(t,b,v,g,v,$,O._angleX-st.upperLimit,O._angleX-st.lowerLimit,et),this._drawRotationalLimit(t,c,Z,M,Z,$,lt.lowerLimit-O._angleZ,lt.upperLimit-O._angleZ,et);break;case 5:let rt=s,at=t.style.jointRotationalConstraintRadius,_t=t.style.jointLineColor,ht=rt._twistLm;this._drawRotationalLimit(t,c,M,d,M,at,ht.lowerLimit-rt._twistAngle,ht.upperLimit-rt._twistAngle,_t),this._drawEllipseOnSphere(t,b,p,v,g,rt._maxSwingAngle1,rt._maxSwingAngle2,at,_t);let ot=this._pool,bt=ot.sizeVec3==0?new m.common.Vec3:ot.stackVec3[--ot.sizeVec3];bt.x=c.x,bt.y=c.y,bt.z=c.z;let Xt=bt;Xt.x+=Z.x*at,Xt.y+=Z.y*at,Xt.z+=Z.z*at,t.line(c,Xt,_t);let ft=this._pool;if(Xt!=null){if(Xt.zero(),ft.sizeVec3==ft.stackVec3.length){let ei=new Array(ft.sizeVec3<<1),Nt=0,At=ft.sizeVec3;for(;Nt<At;){let ni=Nt++;ei[ni]=ft.stackVec3[ni],ft.stackVec3[ni]=null}ft.stackVec3=ei}ft.stackVec3[ft.sizeVec3++]=Xt}break;case 6:let ut=s,xt=t.style.jointRotationalConstraintRadius,zt=t.style.jointLineColor,gt=ut._rotLms[0],pt=ut._rotLms[1],ct=ut._rotLms[2];this._drawTranslationalLimit3D(t,b,p,v,g,ut._translLms[0],ut._translLms[1],ut._translLms[2],zt);let nt=this._pool,tt=nt.sizeVec3==0?new m.common.Vec3:nt.stackVec3[--nt.sizeVec3],kt=tt;kt.x=ut._axisYX,kt.y=ut._axisYY,kt.z=ut._axisYZ;let Bt=this._pool,Mt=Bt.sizeVec3==0?new m.common.Vec3:Bt.stackVec3[--Bt.sizeVec3];Mt.x=p.x,Mt.y=p.y,Mt.z=p.z;let Rt=Mt,ci=this._pool,Xi=ci.sizeVec3==0?new m.common.Vec3:ci.stackVec3[--ci.sizeVec3];Xi.x=p.x,Xi.y=p.y,Xi.z=p.z;let gi=Xi,ki=gi.z*tt.x-gi.x*tt.z,wi=gi.x*tt.y-gi.y*tt.x;gi.x=gi.y*tt.z-gi.z*tt.y,gi.y=ki,gi.z=wi,this._drawRotationalLimit(t,c,v,g,v,xt,ut._angleX-gt.upperLimit,ut._angleX-gt.lowerLimit,zt),this._drawRotationalLimit(t,c,Rt,gi,Rt,xt,pt.lowerLimit-ut._angleY,pt.upperLimit-ut._angleY,zt),this._drawRotationalLimit(t,c,Z,M,Z,xt,ct.lowerLimit-ut._angleZ,ct.upperLimit-ut._angleZ,zt);break}t.line(b,c,t.style.jointErrorColor);let T=this._pool;if(l!=null){if(l.zero(),T.sizeVec3==T.stackVec3.length){let F=new Array(T.sizeVec3<<1),H=0,G=T.sizeVec3;for(;H<G;){let J=H++;F[J]=T.stackVec3[J],T.stackVec3[J]=null}T.stackVec3=F}T.stackVec3[T.sizeVec3++]=l}let C=this._pool;if(r!=null){if(r.zero(),C.sizeVec3==C.stackVec3.length){let F=new Array(C.sizeVec3<<1),H=0,G=C.sizeVec3;for(;H<G;){let J=H++;F[J]=C.stackVec3[J],C.stackVec3[J]=null}C.stackVec3=F}C.stackVec3[C.sizeVec3++]=r}let L=this._pool;if(b!=null){if(b.zero(),L.sizeVec3==L.stackVec3.length){let F=new Array(L.sizeVec3<<1),H=0,G=L.sizeVec3;for(;H<G;){let J=H++;F[J]=L.stackVec3[J],L.stackVec3[J]=null}L.stackVec3=F}L.stackVec3[L.sizeVec3++]=b}let q=this._pool;if(c!=null){if(c.zero(),q.sizeVec3==q.stackVec3.length){let F=new Array(q.sizeVec3<<1),H=0,G=q.sizeVec3;for(;H<G;){let J=H++;F[J]=q.stackVec3[J],q.stackVec3[J]=null}q.stackVec3=F}q.stackVec3[q.sizeVec3++]=c}let U=this._pool;if(p!=null){if(p.zero(),U.sizeVec3==U.stackVec3.length){let F=new Array(U.sizeVec3<<1),H=0,G=U.sizeVec3;for(;H<G;){let J=H++;F[J]=U.stackVec3[J],U.stackVec3[J]=null}U.stackVec3=F}U.stackVec3[U.sizeVec3++]=p}let Y=this._pool;if(v!=null){if(v.zero(),Y.sizeVec3==Y.stackVec3.length){let F=new Array(Y.sizeVec3<<1),H=0,G=Y.sizeVec3;for(;H<G;){let J=H++;F[J]=Y.stackVec3[J],Y.stackVec3[J]=null}Y.stackVec3=F}Y.stackVec3[Y.sizeVec3++]=v}let E=this._pool;if(g!=null){if(g.zero(),E.sizeVec3==E.stackVec3.length){let F=new Array(E.sizeVec3<<1),H=0,G=E.sizeVec3;for(;H<G;){let J=H++;F[J]=E.stackVec3[J],E.stackVec3[J]=null}E.stackVec3=F}E.stackVec3[E.sizeVec3++]=g}let D=this._pool;if(Z!=null){if(Z.zero(),D.sizeVec3==D.stackVec3.length){let F=new Array(D.sizeVec3<<1),H=0,G=D.sizeVec3;for(;H<G;){let J=H++;F[J]=D.stackVec3[J],D.stackVec3[J]=null}D.stackVec3=F}D.stackVec3[D.sizeVec3++]=Z}let Q=this._pool;if(M!=null){if(M.zero(),Q.sizeVec3==Q.stackVec3.length){let F=new Array(Q.sizeVec3<<1),H=0,G=Q.sizeVec3;for(;H<G;){let J=H++;F[J]=Q.stackVec3[J],Q.stackVec3[J]=null}Q.stackVec3=F}Q.stackVec3[Q.sizeVec3++]=M}let W=this._pool;if(d!=null){if(d.zero(),W.sizeVec3==W.stackVec3.length){let F=new Array(W.sizeVec3<<1),H=0,G=W.sizeVec3;for(;H<G;){let J=H++;F[J]=W.stackVec3[J],W.stackVec3[J]=null}W.stackVec3=F}W.stackVec3[W.sizeVec3++]=d}s=_}}}_drawRotationalLimit(t,i,s,_,n,l,o,r,e){if(o!=r){let a=this._pool,h=a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3];h.x=i.x,h.y=i.y,h.z=i.z;let b=h;b.x+=n.x*l,b.y+=n.y*l,b.z+=n.z*l,t.line(i,b,e);let X=this._pool;if(b!=null){if(b.zero(),X.sizeVec3==X.stackVec3.length){let c=new Array(X.sizeVec3<<1),u=0,p=X.sizeVec3;for(;u<p;){let x=u++;c[x]=X.stackVec3[x],X.stackVec3[x]=null}X.stackVec3=c}X.stackVec3[X.sizeVec3++]=b}o>r?t.ellipse(i,s,_,l,l,e):t.arc(i,s,_,l,l,o,r,!0,e)}}_drawTranslationalLimit(t,i,s,_,n,l){if(_<n){let o=this._pool,r=o.sizeVec3==0?new m.common.Vec3:o.stackVec3[--o.sizeVec3];r.x=i.x,r.y=i.y,r.z=i.z;let e=r;e.x+=s.x*_,e.y+=s.y*_,e.z+=s.z*_;let a=this._pool,h=a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3];h.x=i.x,h.y=i.y,h.z=i.z;let b=h;b.x+=s.x*n,b.y+=s.y*n,b.z+=s.z*n,t.line(e,b,l);let X=this._pool;if(e!=null){if(e.zero(),X.sizeVec3==X.stackVec3.length){let u=new Array(X.sizeVec3<<1),p=0,x=X.sizeVec3;for(;p<x;){let v=p++;u[v]=X.stackVec3[v],X.stackVec3[v]=null}X.stackVec3=u}X.stackVec3[X.sizeVec3++]=e}let c=this._pool;if(b!=null){if(b.zero(),c.sizeVec3==c.stackVec3.length){let u=new Array(c.sizeVec3<<1),p=0,x=c.sizeVec3;for(;p<x;){let v=p++;u[v]=c.stackVec3[v],c.stackVec3[v]=null}c.stackVec3=u}c.stackVec3[c.sizeVec3++]=b}}}_drawTranslationalLimit3D(t,i,s,_,n,l,o,r,e){let a=l.lowerLimit,h=l.upperLimit,b=o.lowerLimit,X=o.upperLimit,c=r.lowerLimit,u=r.upperLimit,p=this._pool;p.sizeVec3==0?new m.common.Vec3:--p.sizeVec3;let x=this._pool;x.sizeVec3==0?new m.common.Vec3:--x.sizeVec3;let v=this._pool,f=v.sizeVec3==0?new m.common.Vec3:v.stackVec3[--v.sizeVec3];f.x=i.x,f.y=i.y,f.z=i.z;let g=f;g.x+=s.x*a,g.y+=s.y*a,g.z+=s.z*a,g.x+=_.x*b,g.y+=_.y*b,g.z+=_.z*b,g.x+=n.x*c,g.y+=n.y*c,g.z+=n.z*c;let V=this._pool,Z=V.sizeVec3==0?new m.common.Vec3:V.stackVec3[--V.sizeVec3];Z.x=i.x,Z.y=i.y,Z.z=i.z;let I=Z;I.x+=s.x*a,I.y+=s.y*a,I.z+=s.z*a,I.x+=_.x*b,I.y+=_.y*b,I.z+=_.z*b,I.x+=n.x*u,I.y+=n.y*u,I.z+=n.z*u;let M=this._pool,y=M.sizeVec3==0?new m.common.Vec3:M.stackVec3[--M.sizeVec3];y.x=i.x,y.y=i.y,y.z=i.z;let d=y;d.x+=s.x*a,d.y+=s.y*a,d.z+=s.z*a,d.x+=_.x*X,d.y+=_.y*X,d.z+=_.z*X,d.x+=n.x*c,d.y+=n.y*c,d.z+=n.z*c;let B=this._pool,R=B.sizeVec3==0?new m.common.Vec3:B.stackVec3[--B.sizeVec3];R.x=i.x,R.y=i.y,R.z=i.z;let k=R;k.x+=s.x*a,k.y+=s.y*a,k.z+=s.z*a,k.x+=_.x*X,k.y+=_.y*X,k.z+=_.z*X,k.x+=n.x*u,k.y+=n.y*u,k.z+=n.z*u;let A=this._pool,z=A.sizeVec3==0?new m.common.Vec3:A.stackVec3[--A.sizeVec3];z.x=i.x,z.y=i.y,z.z=i.z;let w=z;w.x+=s.x*h,w.y+=s.y*h,w.z+=s.z*h,w.x+=_.x*b,w.y+=_.y*b,w.z+=_.z*b,w.x+=n.x*c,w.y+=n.y*c,w.z+=n.z*c;let S=this._pool,P=S.sizeVec3==0?new m.common.Vec3:S.stackVec3[--S.sizeVec3];P.x=i.x,P.y=i.y,P.z=i.z;let T=P;T.x+=s.x*h,T.y+=s.y*h,T.z+=s.z*h,T.x+=_.x*b,T.y+=_.y*b,T.z+=_.z*b,T.x+=n.x*u,T.y+=n.y*u,T.z+=n.z*u;let C=this._pool,L=C.sizeVec3==0?new m.common.Vec3:C.stackVec3[--C.sizeVec3];L.x=i.x,L.y=i.y,L.z=i.z;let q=L;q.x+=s.x*h,q.y+=s.y*h,q.z+=s.z*h,q.x+=_.x*X,q.y+=_.y*X,q.z+=_.z*X,q.x+=n.x*c,q.y+=n.y*c,q.z+=n.z*c;let U=this._pool,Y=U.sizeVec3==0?new m.common.Vec3:U.stackVec3[--U.sizeVec3];Y.x=i.x,Y.y=i.y,Y.z=i.z;let E=Y;E.x+=s.x*h,E.y+=s.y*h,E.z+=s.z*h,E.x+=_.x*X,E.y+=_.y*X,E.z+=_.z*X,E.x+=n.x*u,E.y+=n.y*u,E.z+=n.z*u,t.line(g,w,e),t.line(d,q,e),t.line(I,T,e),t.line(k,E,e),t.line(g,d,e),t.line(w,q,e),t.line(I,k,e),t.line(T,E,e),t.line(g,I,e),t.line(w,T,e),t.line(d,k,e),t.line(q,E,e);let D=this._pool;if(g!=null){if(g.zero(),D.sizeVec3==D.stackVec3.length){let K=new Array(D.sizeVec3<<1),O=0,$=D.sizeVec3;for(;O<$;){let et=O++;K[et]=D.stackVec3[et],D.stackVec3[et]=null}D.stackVec3=K}D.stackVec3[D.sizeVec3++]=g}let Q=this._pool;if(I!=null){if(I.zero(),Q.sizeVec3==Q.stackVec3.length){let K=new Array(Q.sizeVec3<<1),O=0,$=Q.sizeVec3;for(;O<$;){let et=O++;K[et]=Q.stackVec3[et],Q.stackVec3[et]=null}Q.stackVec3=K}Q.stackVec3[Q.sizeVec3++]=I}let W=this._pool;if(d!=null){if(d.zero(),W.sizeVec3==W.stackVec3.length){let K=new Array(W.sizeVec3<<1),O=0,$=W.sizeVec3;for(;O<$;){let et=O++;K[et]=W.stackVec3[et],W.stackVec3[et]=null}W.stackVec3=K}W.stackVec3[W.sizeVec3++]=d}let F=this._pool;if(k!=null){if(k.zero(),F.sizeVec3==F.stackVec3.length){let K=new Array(F.sizeVec3<<1),O=0,$=F.sizeVec3;for(;O<$;){let et=O++;K[et]=F.stackVec3[et],F.stackVec3[et]=null}F.stackVec3=K}F.stackVec3[F.sizeVec3++]=k}let H=this._pool;if(w!=null){if(w.zero(),H.sizeVec3==H.stackVec3.length){let K=new Array(H.sizeVec3<<1),O=0,$=H.sizeVec3;for(;O<$;){let et=O++;K[et]=H.stackVec3[et],H.stackVec3[et]=null}H.stackVec3=K}H.stackVec3[H.sizeVec3++]=w}let G=this._pool;if(T!=null){if(T.zero(),G.sizeVec3==G.stackVec3.length){let K=new Array(G.sizeVec3<<1),O=0,$=G.sizeVec3;for(;O<$;){let et=O++;K[et]=G.stackVec3[et],G.stackVec3[et]=null}G.stackVec3=K}G.stackVec3[G.sizeVec3++]=T}let J=this._pool;if(q!=null){if(q.zero(),J.sizeVec3==J.stackVec3.length){let K=new Array(J.sizeVec3<<1),O=0,$=J.sizeVec3;for(;O<$;){let et=O++;K[et]=J.stackVec3[et],J.stackVec3[et]=null}J.stackVec3=K}J.stackVec3[J.sizeVec3++]=q}let N=this._pool;if(E!=null){if(E.zero(),N.sizeVec3==N.stackVec3.length){let K=new Array(N.sizeVec3<<1),O=0,$=N.sizeVec3;for(;O<$;){let et=O++;K[et]=N.stackVec3[et],N.stackVec3[et]=null}N.stackVec3=K}N.stackVec3[N.sizeVec3++]=E}}_drawEllipseOnSphere(t,i,s,_,n,l,o,r,e){let a=0,h=this._pool,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this._pool,c=X.sizeQuat==0?new m.common.Quat:X.stackQuat[--X.sizeQuat],u=this._pool,p=u.sizeMat3==0?new m.common.Mat3:u.stackMat3[--u.sizeMat3],x=this._pool,v=x.sizeVec3==0?new m.common.Vec3:x.stackVec3[--x.sizeVec3],f=0;for(;f<17;){let M=f++,y=Math.cos(a)*l,d=Math.sin(a)*o,B=Math.sqrt(y*y+d*d),R=Math.sin(B*.5),k=Math.cos(B*.5),A=b.zero();A.x+=_.x*y,A.y+=_.y*y,A.z+=_.z*y,A.x+=n.x*d,A.y+=n.y*d,A.z+=n.z*d;let z=1/B*R;b.x*=z,b.y*=z,b.z*=z,c.x=b.x,c.y=b.y,c.z=b.z,c.w=k;let w=c.x,S=c.y,P=c.z,T=c.w,C=2*w,L=2*S,q=2*P,U=w*C,Y=S*L,E=P*q,D=w*L,Q=S*q,W=w*q,F=T*C,H=T*L,G=T*q;p.e00=1-Y-E,p.e01=D-G,p.e02=W+H,p.e10=D+G,p.e11=1-U-E,p.e12=Q-F,p.e20=W-H,p.e21=Q+F,p.e22=1-U-Y;let J=this._pool,N=J.sizeVec3==0?new m.common.Vec3:J.stackVec3[--J.sizeVec3];N.x+=s.x*r,N.y+=s.y*r,N.z+=s.z*r;let K=N,O=K.x*p.e10+K.y*p.e11+K.z*p.e12,$=K.x*p.e20+K.y*p.e21+K.z*p.e22;K.x=K.x*p.e00+K.y*p.e01+K.z*p.e02,K.y=O,K.z=$,K.x+=i.x,K.y+=i.y,K.z+=i.z,M>=1&&t.line(v,K,e);let et=this._pool;if(v!=null){if(v.zero(),et.sizeVec3==et.stackVec3.length){let st=new Array(et.sizeVec3<<1),lt=0,rt=et.sizeVec3;for(;lt<rt;){let at=lt++;st[at]=et.stackVec3[at],et.stackVec3[at]=null}et.stackVec3=st}et.stackVec3[et.sizeVec3++]=v}v=K,a+=.39269908169872375}let g=this._pool;if(b!=null){if(b.zero(),g.sizeVec3==g.stackVec3.length){let M=new Array(g.sizeVec3<<1),y=0,d=g.sizeVec3;for(;y<d;){let B=y++;M[B]=g.stackVec3[B],g.stackVec3[B]=null}g.stackVec3=M}g.stackVec3[g.sizeVec3++]=b}let V=this._pool;if(c!=null){if(c.x=0,c.y=0,c.z=0,c.w=1,V.sizeQuat==V.stackQuat.length){let M=new Array(V.sizeQuat<<1),y=0,d=V.sizeQuat;for(;y<d;){let B=y++;M[B]=V.stackQuat[B],V.stackQuat[B]=null}V.stackQuat=M}V.stackQuat[V.sizeQuat++]=c}let Z=this._pool;if(p!=null){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,Z.sizeMat3==Z.stackMat3.length){let M=new Array(Z.sizeMat3<<1),y=0,d=Z.sizeMat3;for(;y<d;){let B=y++;M[B]=Z.stackMat3[B],Z.stackMat3[B]=null}Z.stackMat3=M}Z.stackMat3[Z.sizeMat3++]=p}let I=this._pool;if(v!=null){if(v.zero(),I.sizeVec3==I.stackVec3.length){let M=new Array(I.sizeVec3<<1),y=0,d=I.sizeVec3;for(;y<d;){let B=y++;M[B]=I.stackVec3[B],I.stackVec3[B]=null}I.stackVec3=M}I.stackVec3[I.sizeVec3++]=v}}step(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;let i=Date.now()/1e3;this._updateContacts(),this._solveIslands(),m.dynamics.common.Performance.totalTime=(Date.now()/1e3-i)*1e3}addRigidBody(t){if(t._world!=null)throw new Error("A rigid body cannot belong to multiple worlds.");this._rigidBodyList==null?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;let i=t._shapeList;for(;i!=null;){let s=i._next;i._proxy=this._broadPhase.createProxy(i,i._aabb),i._id=this._shapeIdCount++,this._numShapes++,i=s}this._numRigidBodies++}removeRigidBody(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");let i=t._prev,s=t._next;i!=null&&(i._next=s),s!=null&&(s._prev=i),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;let _=t._shapeList;for(;_!=null;){let n=_._next;this._broadPhase.destroyProxy(_._proxy),_._proxy=null,_._id=-1;let l=_._rigidBody._contactLinkList;for(;l!=null;){let o=l._next,r=l._contact;if(r._s1==_||r._s2==_){let e=l._other;e._sleeping=!1,e._sleepTime=0;let a=this._contactManager,h=r._prev,b=r._next;if(h!=null&&(h._next=b),b!=null&&(b._prev=h),r==a._contactList&&(a._contactList=a._contactList._next),r==a._contactListLast&&(a._contactListLast=a._contactListLast._prev),r._next=null,r._prev=null,r._touching){let v=r._s1._contactCallback,f=r._s2._contactCallback;v==f&&(f=null),v?.endContact(r),f?.endContact(r)}let X=r._link1._prev,c=r._link1._next;X!=null&&(X._next=c),c!=null&&(c._prev=X),r._link1==r._b1._contactLinkList&&(r._b1._contactLinkList=r._b1._contactLinkList._next),r._link1==r._b1._contactLinkListLast&&(r._b1._contactLinkListLast=r._b1._contactLinkListLast._prev),r._link1._next=null,r._link1._prev=null;let u=r._link2._prev,p=r._link2._next;u!=null&&(u._next=p),p!=null&&(p._prev=u),r._link2==r._b2._contactLinkList&&(r._b2._contactLinkList=r._b2._contactLinkList._next),r._link2==r._b2._contactLinkListLast&&(r._b2._contactLinkListLast=r._b2._contactLinkListLast._prev),r._link2._next=null,r._link2._prev=null,r._b1._numContactLinks--,r._b2._numContactLinks--,r._link1._other=null,r._link2._other=null,r._link1._contact=null,r._link2._contact=null,r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._touching=!1,r._cachedDetectorData._clear(),r._manifold._clear(),r._detector=null;let x=r._contactConstraint;x._s1=null,x._s2=null,x._b1=null,x._b2=null,x._tf1=null,x._tf2=null,r._next=a._contactPool,a._contactPool=r,a._numContacts--}l=o}this._numShapes--,_=n}this._numRigidBodies--}addJoint(t){if(t._world!=null)throw new Error("A joint cannot belong to multiple worlds.");this._jointList==null?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,t._b1._jointLinkList==null?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),t._b2._jointLinkList==null?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;let i=t._b1;i._sleeping=!1,i._sleepTime=0;let s=t._b2;s._sleeping=!1,s._sleepTime=0,t._syncAnchors(),this._numJoints++}removeJoint(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");let i=t._prev,s=t._next;i!=null&&(i._next=s),s!=null&&(s._prev=i),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;let _=t._link1._prev,n=t._link1._next;_!=null&&(_._next=n),n!=null&&(n._prev=_),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;let l=t._link2._prev,o=t._link2._next;l!=null&&(l._next=o),o!=null&&(o._prev=l),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;let r=t._b1;r._sleeping=!1,r._sleepTime=0;let e=t._b2;e._sleeping=!1,e._sleepTime=0,this._numJoints--}setDebugDraw(t){this._debugDraw=t}getDebugDraw(){return this._debugDraw}debugDraw(){this._debugDraw!=null&&(this._broadPhase._type==2&&this._drawBvh(this._debugDraw,this._broadPhase._tree),this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw))}rayCast(t,i,s){let _=this._rayCastWrapper.begin;_.x=t.x,_.y=t.y,_.z=t.z;let n=this._rayCastWrapper.end;n.x=i.x,n.y=i.y,n.z=i.z,this._rayCastWrapper.callback=s,this._broadPhase.rayCast(t,i,this._rayCastWrapper)}convexCast(t,i,s,_){this._convexCastWrapper.convex=t;let n=this._convexCastWrapper.begin;n._positionX=i._positionX,n._positionY=i._positionY,n._positionZ=i._positionZ,n._rotation00=i._rotation00,n._rotation01=i._rotation01,n._rotation02=i._rotation02,n._rotation10=i._rotation10,n._rotation11=i._rotation11,n._rotation12=i._rotation12,n._rotation20=i._rotation20,n._rotation21=i._rotation21,n._rotation22=i._rotation22;let l=this._convexCastWrapper.translation;l.x=s.x,l.y=s.y,l.z=s.z,this._convexCastWrapper.callback=_,this._broadPhase.convexCast(t,i,s,this._convexCastWrapper)}aabbTest(t,i){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=i,this._broadPhase.aabbTest(t,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(t){this._numVelocityIterations=t}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(t){this._numPositionIterations=t}getGravity(){return this._gravity}setGravity(t){let i=this._gravity;i.x=t.x,i.y=t.y,i.z=t.z}};m.dynamics._World||(m.dynamics._World={});m.dynamics._World.RayCastWrapper=class extends m.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new m.collision.geometry.RayCastHit,this.begin=new m.common.Vec3,this.end=new m.common.Vec3,this.callback=null}process(t){let i=t.userData;i._geom.rayCast(this.begin,this.end,i._transform,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}};m.dynamics._World.ConvexCastWrapper=class extends m.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new m.collision.geometry.RayCastHit,this.begin=new m.common.Transform,this.translation=new m.common.Vec3,this.zero=new m.common.Vec3,this.callback=null,this.convex=null}process(t){let i=t.userData,s=i._geom._type;s<0||s>5||m.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,i._geom,this.begin,i._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}};m.dynamics._World.AabbTestWrapper=class extends m.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new m.collision.geometry.Aabb,this._callback=null}process(t){let i=t.userData,s=i._aabb;s._minX<this._aabb._maxX&&s._maxX>this._aabb._minX&&s._minY<this._aabb._maxY&&s._maxY>this._aabb._minY&&s._minZ<this._aabb._maxZ&&s._maxZ>this._aabb._minZ&&this._callback.process(i)}};m.dynamics.callback||(m.dynamics.callback={});m.dynamics.callback.AabbTestCallback=class{constructor(){}process(t){}};m.dynamics.callback.ContactCallback=class{constructor(){}beginContact(t){}preSolve(t){}postSolve(t){}endContact(t){}};m.dynamics.callback.RayCastCallback=class{constructor(){}process(t,i){}};m.dynamics.callback.RayCastClosest=class extends m.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new m.common.Vec3,this.normal=new m.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(t,i){if(i.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=i.fraction;let s=this.position,_=i.position;s.x=_.x,s.y=_.y,s.z=_.z;let n=this.normal,l=i.normal;n.x=l.x,n.y=l.y,n.z=l.z}}};m.dynamics.common||(m.dynamics.common={});m.dynamics.common.DebugDraw=class{constructor(){this.p=new m.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1,this.sphereCoords=new Array(5),this.tmpSphereVerts=new Array(5),this.tmpSphereNorms=new Array(5);let t=0;for(;t<5;){let s=t++,_=s==0||s==4?1:8;this.sphereCoords[s]=new Array(_),this.tmpSphereVerts[s]=new Array(_),this.tmpSphereNorms[s]=new Array(_);let n=0;for(;n<8;){let l=n++,o=s*.7853981633974475,r=l*.7853981633974475;this.sphereCoords[s][l]=new m.common.Vec3(Math.sin(o)*Math.cos(r),Math.cos(o),-Math.sin(o)*Math.sin(r)),this.tmpSphereVerts[s][l]=new m.common.Vec3,this.tmpSphereNorms[s][l]=new m.common.Vec3}}this.circleCoords=new Array(8),this.circleCoordsShift=new Array(8),this.tmpCircleVerts1=new Array(8),this.tmpCircleVerts2=new Array(8),this.tmpCircleNorms=new Array(8);let i=0;for(;i<8;){let s=i++;this.circleCoords[s]=new m.common.Vec3(Math.cos(s*.7853981633974475),0,-Math.sin(s*.7853981633974475)),this.circleCoordsShift[s]=new m.common.Vec3(Math.cos((s+.5)*.7853981633974475),0,-Math.sin((s+.5)*.7853981633974475)),this.tmpCircleVerts1[s]=new m.common.Vec3,this.tmpCircleVerts2[s]=new m.common.Vec3,this.tmpCircleNorms[s]=new m.common.Vec3}this.style=new m.dynamics.common.DebugDrawStyle}aabb(t,i,s){let _=this.p,n=(_.sizeVec3==0?new m.common.Vec3:_.stackVec3[--_.sizeVec3]).init(t.x,t.y,t.z),l=this.p,o=(l.sizeVec3==0?new m.common.Vec3:l.stackVec3[--l.sizeVec3]).init(t.x,t.y,i.z),r=this.p,e=(r.sizeVec3==0?new m.common.Vec3:r.stackVec3[--r.sizeVec3]).init(t.x,i.y,t.z),a=this.p,h=(a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3]).init(t.x,i.y,i.z),b=this.p,X=(b.sizeVec3==0?new m.common.Vec3:b.stackVec3[--b.sizeVec3]).init(i.x,t.y,t.z),c=this.p,u=(c.sizeVec3==0?new m.common.Vec3:c.stackVec3[--c.sizeVec3]).init(i.x,t.y,i.z),p=this.p,x=(p.sizeVec3==0?new m.common.Vec3:p.stackVec3[--p.sizeVec3]).init(i.x,i.y,t.z),v=this.p,f=(v.sizeVec3==0?new m.common.Vec3:v.stackVec3[--v.sizeVec3]).init(i.x,i.y,i.z);this.line(n,o,s),this.line(e,h,s),this.line(X,u,s),this.line(x,f,s),this.line(n,e,s),this.line(o,h,s),this.line(X,x,s),this.line(u,f,s),this.line(n,X,s),this.line(o,u,s),this.line(e,x,s),this.line(h,f,s);let g=this.p;if(n!=null){if(n.zero(),g.sizeVec3==g.stackVec3.length){let R=new Array(g.sizeVec3<<1),k=0,A=g.sizeVec3;for(;k<A;){let z=k++;R[z]=g.stackVec3[z],g.stackVec3[z]=null}g.stackVec3=R}g.stackVec3[g.sizeVec3++]=n}let V=this.p;if(o!=null){if(o.zero(),V.sizeVec3==V.stackVec3.length){let R=new Array(V.sizeVec3<<1),k=0,A=V.sizeVec3;for(;k<A;){let z=k++;R[z]=V.stackVec3[z],V.stackVec3[z]=null}V.stackVec3=R}V.stackVec3[V.sizeVec3++]=o}let Z=this.p;if(e!=null){if(e.zero(),Z.sizeVec3==Z.stackVec3.length){let R=new Array(Z.sizeVec3<<1),k=0,A=Z.sizeVec3;for(;k<A;){let z=k++;R[z]=Z.stackVec3[z],Z.stackVec3[z]=null}Z.stackVec3=R}Z.stackVec3[Z.sizeVec3++]=e}let I=this.p;if(h!=null){if(h.zero(),I.sizeVec3==I.stackVec3.length){let R=new Array(I.sizeVec3<<1),k=0,A=I.sizeVec3;for(;k<A;){let z=k++;R[z]=I.stackVec3[z],I.stackVec3[z]=null}I.stackVec3=R}I.stackVec3[I.sizeVec3++]=h}let M=this.p;if(X!=null){if(X.zero(),M.sizeVec3==M.stackVec3.length){let R=new Array(M.sizeVec3<<1),k=0,A=M.sizeVec3;for(;k<A;){let z=k++;R[z]=M.stackVec3[z],M.stackVec3[z]=null}M.stackVec3=R}M.stackVec3[M.sizeVec3++]=X}let y=this.p;if(u!=null){if(u.zero(),y.sizeVec3==y.stackVec3.length){let R=new Array(y.sizeVec3<<1),k=0,A=y.sizeVec3;for(;k<A;){let z=k++;R[z]=y.stackVec3[z],y.stackVec3[z]=null}y.stackVec3=R}y.stackVec3[y.sizeVec3++]=u}let d=this.p;if(x!=null){if(x.zero(),d.sizeVec3==d.stackVec3.length){let R=new Array(d.sizeVec3<<1),k=0,A=d.sizeVec3;for(;k<A;){let z=k++;R[z]=d.stackVec3[z],d.stackVec3[z]=null}d.stackVec3=R}d.stackVec3[d.sizeVec3++]=x}let B=this.p;if(f!=null){if(f.zero(),B.sizeVec3==B.stackVec3.length){let R=new Array(B.sizeVec3<<1),k=0,A=B.sizeVec3;for(;k<A;){let z=k++;R[z]=B.stackVec3[z],B.stackVec3[z]=null}B.stackVec3=R}B.stackVec3[B.sizeVec3++]=f}}basis(t,i,s,_,n){let l=this.p,o=l.sizeVec3==0?new m.common.Vec3:l.stackVec3[--l.sizeVec3],r=this.p,e=r.sizeMat3==0?new m.common.Mat3:r.stackMat3[--r.sizeMat3],a=this.p,h=a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3],b=this.p,X=b.sizeVec3==0?new m.common.Vec3:b.stackVec3[--b.sizeVec3],c=this.p,u=c.sizeVec3==0?new m.common.Vec3:c.stackVec3[--c.sizeVec3],p=o;p.x=t._positionX,p.y=t._positionY,p.z=t._positionZ;let x=e;x.e00=t._rotation00,x.e01=t._rotation01,x.e02=t._rotation02,x.e10=t._rotation10,x.e11=t._rotation11,x.e12=t._rotation12,x.e20=t._rotation20,x.e21=t._rotation21,x.e22=t._rotation22,h.init(e.e00,e.e10,e.e20),X.init(e.e01,e.e11,e.e21),u.init(e.e02,e.e12,e.e22),h.x*=i,h.y*=i,h.z*=i;let v=h;v.x+=o.x,v.y+=o.y,v.z+=o.z,X.x*=i,X.y*=i,X.z*=i;let f=X;f.x+=o.x,f.y+=o.y,f.z+=o.z,u.x*=i,u.y*=i,u.z*=i;let g=u;g.x+=o.x,g.y+=o.y,g.z+=o.z,this.line(o,h,s),this.line(o,X,_),this.line(o,u,n);let V=this.p;if(o!=null){if(o.zero(),V.sizeVec3==V.stackVec3.length){let d=new Array(V.sizeVec3<<1),B=0,R=V.sizeVec3;for(;B<R;){let k=B++;d[k]=V.stackVec3[k],V.stackVec3[k]=null}V.stackVec3=d}V.stackVec3[V.sizeVec3++]=o}let Z=this.p;if(e!=null){if(e.e00=1,e.e01=0,e.e02=0,e.e10=0,e.e11=1,e.e12=0,e.e20=0,e.e21=0,e.e22=1,Z.sizeMat3==Z.stackMat3.length){let d=new Array(Z.sizeMat3<<1),B=0,R=Z.sizeMat3;for(;B<R;){let k=B++;d[k]=Z.stackMat3[k],Z.stackMat3[k]=null}Z.stackMat3=d}Z.stackMat3[Z.sizeMat3++]=e}let I=this.p;if(h!=null){if(h.zero(),I.sizeVec3==I.stackVec3.length){let d=new Array(I.sizeVec3<<1),B=0,R=I.sizeVec3;for(;B<R;){let k=B++;d[k]=I.stackVec3[k],I.stackVec3[k]=null}I.stackVec3=d}I.stackVec3[I.sizeVec3++]=h}let M=this.p;if(X!=null){if(X.zero(),M.sizeVec3==M.stackVec3.length){let d=new Array(M.sizeVec3<<1),B=0,R=M.sizeVec3;for(;B<R;){let k=B++;d[k]=M.stackVec3[k],M.stackVec3[k]=null}M.stackVec3=d}M.stackVec3[M.sizeVec3++]=X}let y=this.p;if(u!=null){if(u.zero(),y.sizeVec3==y.stackVec3.length){let d=new Array(y.sizeVec3<<1),B=0,R=y.sizeVec3;for(;B<R;){let k=B++;d[k]=y.stackVec3[k],y.stackVec3[k]=null}y.stackVec3=d}y.stackVec3[y.sizeVec3++]=u}}ellipse(t,i,s,_,n,l){this.arc(t,i,s,_,n,0,6.28318530717958,!1,l)}arc(t,i,s,_,n,l,o,r,e){let a=this.p,h=a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3];h.x=i.x,h.y=i.y,h.z=i.z;let b=h;b.x*=_,b.y*=_,b.z*=_;let X=this.p,c=X.sizeVec3==0?new m.common.Vec3:X.stackVec3[--X.sizeVec3];c.x=s.x,c.y=s.y,c.z=s.z;let u=c;u.x*=n,u.y*=n,u.z*=n;let p=o-l;p<0&&(p=-p);let x=p/.5235987755982984+.5|0;x==0&&(x=1);let v=l,f=(o-l)/x,g=this.p,V=g.sizeVec3==0?new m.common.Vec3:g.stackVec3[--g.sizeVec3];V.x=t.x,V.y=t.y,V.z=t.z;let Z=V,I=Math.cos(l);Z.x+=b.x*I,Z.y+=b.y*I,Z.z+=b.z*I;let M=Math.sin(l);Z.x+=u.x*M,Z.y+=u.y*M,Z.z+=u.z*M;let y=Z;r&&this.line(t,Z,e);let d=0,B=x;for(;d<B;){++d,v+=f;let z=this.p,w=z.sizeVec3==0?new m.common.Vec3:z.stackVec3[--z.sizeVec3];w.x=t.x,w.y=t.y,w.z=t.z;let S=w,P=Math.cos(v);S.x+=b.x*P,S.y+=b.y*P,S.z+=b.z*P;let T=Math.sin(v);S.x+=u.x*T,S.y+=u.y*T,S.z+=u.z*T,this.line(y,S,e);let C=this.p;if(y!=null){if(y.zero(),C.sizeVec3==C.stackVec3.length){let L=new Array(C.sizeVec3<<1),q=0,U=C.sizeVec3;for(;q<U;){let Y=q++;L[Y]=C.stackVec3[Y],C.stackVec3[Y]=null}C.stackVec3=L}C.stackVec3[C.sizeVec3++]=y}y=S}r&&this.line(t,y,e);let R=this.p;if(y!=null){if(y.zero(),R.sizeVec3==R.stackVec3.length){let z=new Array(R.sizeVec3<<1),w=0,S=R.sizeVec3;for(;w<S;){let P=w++;z[P]=R.stackVec3[P],R.stackVec3[P]=null}R.stackVec3=z}R.stackVec3[R.sizeVec3++]=y}let k=this.p;if(b!=null){if(b.zero(),k.sizeVec3==k.stackVec3.length){let z=new Array(k.sizeVec3<<1),w=0,S=k.sizeVec3;for(;w<S;){let P=w++;z[P]=k.stackVec3[P],k.stackVec3[P]=null}k.stackVec3=z}k.stackVec3[k.sizeVec3++]=b}let A=this.p;if(u!=null){if(u.zero(),A.sizeVec3==A.stackVec3.length){let z=new Array(A.sizeVec3<<1),w=0,S=A.sizeVec3;for(;w<S;){let P=w++;z[P]=A.stackVec3[P],A.stackVec3[P]=null}A.stackVec3=z}A.stackVec3[A.sizeVec3++]=u}}cone(t,i,s,_){let n=this.p,l=n.sizeVec3==0?new m.common.Vec3:n.stackVec3[--n.sizeVec3],o=this.p,r=o.sizeVec3==0?new m.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,a=e.sizeVec3==0?new m.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this.p,c=X.sizeMat3==0?new m.common.Mat3:X.stackMat3[--X.sizeMat3],u=b;u.x=t._positionX,u.y=t._positionY,u.z=t._positionZ;let p=c;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,l.init(c.e00,c.e10,c.e20),r.init(c.e01,c.e11,c.e21),a.init(c.e02,c.e12,c.e22);let x=this.p,v=x.sizeVec3==0?new m.common.Vec3:x.stackVec3[--x.sizeVec3];v.x=b.x,v.y=b.y,v.z=b.z;let f=v;f.x+=r.x*s,f.y+=r.y*s,f.z+=r.z*s;let g=this.p,V=g.sizeVec3==0?new m.common.Vec3:g.stackVec3[--g.sizeVec3];V.x=b.x,V.y=b.y,V.z=b.z;let Z=V,I=-s;if(Z.x+=r.x*I,Z.y+=r.y*I,Z.z+=r.z*I,this.wireframe){let z=this.p,w=z.sizeVec3==0?new m.common.Vec3:z.stackVec3[--z.sizeVec3];w.x=Z.x,w.y=Z.y,w.z=Z.z;let S=w,P=-i;S.x+=l.x*P,S.y+=l.y*P,S.z+=l.z*P,S.x+=a.x*0,S.y+=a.y*0,S.z+=a.z*0;let T=this.p,C=T.sizeVec3==0?new m.common.Vec3:T.stackVec3[--T.sizeVec3];C.x=Z.x,C.y=Z.y,C.z=Z.z;let L=C;L.x+=l.x*i,L.y+=l.y*i,L.z+=l.z*i,L.x+=a.x*0,L.y+=a.y*0,L.z+=a.z*0;let q=this.p,U=q.sizeVec3==0?new m.common.Vec3:q.stackVec3[--q.sizeVec3];U.x=Z.x,U.y=Z.y,U.z=Z.z;let Y=U;Y.x+=l.x*0,Y.y+=l.y*0,Y.z+=l.z*0;let E=-i;Y.x+=a.x*E,Y.y+=a.y*E,Y.z+=a.z*E;let D=this.p,Q=D.sizeVec3==0?new m.common.Vec3:D.stackVec3[--D.sizeVec3];Q.x=Z.x,Q.y=Z.y,Q.z=Z.z;let W=Q;W.x+=l.x*0,W.y+=l.y*0,W.z+=l.z*0,W.x+=a.x*i,W.y+=a.y*i,W.z+=a.z*i,this.ellipse(Z,l,a,i,i,_),this.line(f,S,_),this.line(f,L,_),this.line(f,Y,_),this.line(f,W,_);let F=this.p;if(S!=null){if(S.zero(),F.sizeVec3==F.stackVec3.length){let N=new Array(F.sizeVec3<<1),K=0,O=F.sizeVec3;for(;K<O;){let $=K++;N[$]=F.stackVec3[$],F.stackVec3[$]=null}F.stackVec3=N}F.stackVec3[F.sizeVec3++]=S}let H=this.p;if(L!=null){if(L.zero(),H.sizeVec3==H.stackVec3.length){let N=new Array(H.sizeVec3<<1),K=0,O=H.sizeVec3;for(;K<O;){let $=K++;N[$]=H.stackVec3[$],H.stackVec3[$]=null}H.stackVec3=N}H.stackVec3[H.sizeVec3++]=L}let G=this.p;if(Y!=null){if(Y.zero(),G.sizeVec3==G.stackVec3.length){let N=new Array(G.sizeVec3<<1),K=0,O=G.sizeVec3;for(;K<O;){let $=K++;N[$]=G.stackVec3[$],G.stackVec3[$]=null}G.stackVec3=N}G.stackVec3[G.sizeVec3++]=Y}let J=this.p;if(W!=null){if(W.zero(),J.sizeVec3==J.stackVec3.length){let N=new Array(J.sizeVec3<<1),K=0,O=J.sizeVec3;for(;K<O;){let $=K++;N[$]=J.stackVec3[$],J.stackVec3[$]=null}J.stackVec3=N}J.stackVec3[J.sizeVec3++]=W}}else{let z=1/Math.sqrt(i*i+4*s*s),w=2*s*z,S=i*z,P=0;for(;P<8;){let C=P++,L=this.tmpCircleNorms[C],q=this.circleCoords[C];L.x=q.x,L.y=q.y,L.z=q.z,L.x*=w,L.y*=w,L.z*=w,L.y+=S;let U=this.tmpCircleNorms[C],Y=U.x*c.e10+U.y*c.e11+U.z*c.e12,E=U.x*c.e20+U.y*c.e21+U.z*c.e22;U.x=U.x*c.e00+U.y*c.e01+U.z*c.e02,U.y=Y,U.z=E;let D=this.tmpCircleVerts1[C],Q=this.circleCoordsShift[C];D.x=Q.x,D.y=Q.y,D.z=Q.z,D.x*=w,D.y*=w,D.z*=w,D.y+=S;let W=this.tmpCircleVerts1[C],F=W.x*c.e10+W.y*c.e11+W.z*c.e12,H=W.x*c.e20+W.y*c.e21+W.z*c.e22;W.x=W.x*c.e00+W.y*c.e01+W.z*c.e02,W.y=F,W.z=H;let G=this.tmpCircleVerts2[C],J=this.circleCoords[C];G.x=J.x,G.y=J.y,G.z=J.z;let N=G.x*c.e10+G.y*c.e11+G.z*c.e12,K=G.x*c.e20+G.y*c.e21+G.z*c.e22;G.x=G.x*c.e00+G.y*c.e01+G.z*c.e02,G.y=N,G.z=K,G.x*=i,G.y*=i,G.z*=i,G.x+=b.x,G.y+=b.y,G.z+=b.z;let O=this.tmpCircleVerts2[C],$=-s;O.x+=r.x*$,O.y+=r.y*$,O.z+=r.z*$}let T=0;for(;T<8;){let C=T++,L=this.tmpCircleVerts2[C],q=this.tmpCircleVerts2[(C+1)%8],U=this.tmpCircleVerts1[C];this.triangle(f,L,q,U,this.tmpCircleNorms[C],this.tmpCircleNorms[(C+1)%8],_),L=this.tmpCircleVerts2[(C+1)%8],q=this.tmpCircleVerts2[C];let Y=this.p,E=Y.sizeVec3==0?new m.common.Vec3:Y.stackVec3[--Y.sizeVec3];E.x=r.x,E.y=r.y,E.z=r.z;let D=E;D.x=-D.x,D.y=-D.y,D.z=-D.z,this.triangle(Z,L,q,D,D,D,_);let Q=this.p;if(D!=null){if(D.zero(),Q.sizeVec3==Q.stackVec3.length){let W=new Array(Q.sizeVec3<<1),F=0,H=Q.sizeVec3;for(;F<H;){let G=F++;W[G]=Q.stackVec3[G],Q.stackVec3[G]=null}Q.stackVec3=W}Q.stackVec3[Q.sizeVec3++]=D}}}let M=this.p;if(f!=null){if(f.zero(),M.sizeVec3==M.stackVec3.length){let z=new Array(M.sizeVec3<<1),w=0,S=M.sizeVec3;for(;w<S;){let P=w++;z[P]=M.stackVec3[P],M.stackVec3[P]=null}M.stackVec3=z}M.stackVec3[M.sizeVec3++]=f}let y=this.p;if(Z!=null){if(Z.zero(),y.sizeVec3==y.stackVec3.length){let z=new Array(y.sizeVec3<<1),w=0,S=y.sizeVec3;for(;w<S;){let P=w++;z[P]=y.stackVec3[P],y.stackVec3[P]=null}y.stackVec3=z}y.stackVec3[y.sizeVec3++]=Z}let d=this.p;if(b!=null){if(b.zero(),d.sizeVec3==d.stackVec3.length){let z=new Array(d.sizeVec3<<1),w=0,S=d.sizeVec3;for(;w<S;){let P=w++;z[P]=d.stackVec3[P],d.stackVec3[P]=null}d.stackVec3=z}d.stackVec3[d.sizeVec3++]=b}let B=this.p;if(c!=null){if(c.e00=1,c.e01=0,c.e02=0,c.e10=0,c.e11=1,c.e12=0,c.e20=0,c.e21=0,c.e22=1,B.sizeMat3==B.stackMat3.length){let z=new Array(B.sizeMat3<<1),w=0,S=B.sizeMat3;for(;w<S;){let P=w++;z[P]=B.stackMat3[P],B.stackMat3[P]=null}B.stackMat3=z}B.stackMat3[B.sizeMat3++]=c}let R=this.p;if(l!=null){if(l.zero(),R.sizeVec3==R.stackVec3.length){let z=new Array(R.sizeVec3<<1),w=0,S=R.sizeVec3;for(;w<S;){let P=w++;z[P]=R.stackVec3[P],R.stackVec3[P]=null}R.stackVec3=z}R.stackVec3[R.sizeVec3++]=l}let k=this.p;if(r!=null){if(r.zero(),k.sizeVec3==k.stackVec3.length){let z=new Array(k.sizeVec3<<1),w=0,S=k.sizeVec3;for(;w<S;){let P=w++;z[P]=k.stackVec3[P],k.stackVec3[P]=null}k.stackVec3=z}k.stackVec3[k.sizeVec3++]=r}let A=this.p;if(a!=null){if(a.zero(),A.sizeVec3==A.stackVec3.length){let z=new Array(A.sizeVec3<<1),w=0,S=A.sizeVec3;for(;w<S;){let P=w++;z[P]=A.stackVec3[P],A.stackVec3[P]=null}A.stackVec3=z}A.stackVec3[A.sizeVec3++]=a}}cylinder(t,i,s,_){let n=this.p,l=n.sizeVec3==0?new m.common.Vec3:n.stackVec3[--n.sizeVec3],o=this.p,r=o.sizeVec3==0?new m.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,a=e.sizeVec3==0?new m.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this.p,c=X.sizeMat3==0?new m.common.Mat3:X.stackMat3[--X.sizeMat3],u=b;u.x=t._positionX,u.y=t._positionY,u.z=t._positionZ;let p=c;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,l.init(c.e00,c.e10,c.e20),r.init(c.e01,c.e11,c.e21),a.init(c.e02,c.e12,c.e22);let x=this.p,v=x.sizeVec3==0?new m.common.Vec3:x.stackVec3[--x.sizeVec3];v.x=b.x,v.y=b.y,v.z=b.z;let f=v;f.x+=r.x*s,f.y+=r.y*s,f.z+=r.z*s;let g=this.p,V=g.sizeVec3==0?new m.common.Vec3:g.stackVec3[--g.sizeVec3];V.x=b.x,V.y=b.y,V.z=b.z;let Z=V,I=-s;if(Z.x+=r.x*I,Z.y+=r.y*I,Z.z+=r.z*I,this.wireframe){let z=this.p,w=z.sizeVec3==0?new m.common.Vec3:z.stackVec3[--z.sizeVec3];w.x=f.x,w.y=f.y,w.z=f.z;let S=w,P=-i;S.x+=l.x*P,S.y+=l.y*P,S.z+=l.z*P,S.x+=a.x*0,S.y+=a.y*0,S.z+=a.z*0;let T=this.p,C=T.sizeVec3==0?new m.common.Vec3:T.stackVec3[--T.sizeVec3];C.x=f.x,C.y=f.y,C.z=f.z;let L=C;L.x+=l.x*i,L.y+=l.y*i,L.z+=l.z*i,L.x+=a.x*0,L.y+=a.y*0,L.z+=a.z*0;let q=this.p,U=q.sizeVec3==0?new m.common.Vec3:q.stackVec3[--q.sizeVec3];U.x=f.x,U.y=f.y,U.z=f.z;let Y=U;Y.x+=l.x*0,Y.y+=l.y*0,Y.z+=l.z*0;let E=-i;Y.x+=a.x*E,Y.y+=a.y*E,Y.z+=a.z*E;let D=this.p,Q=D.sizeVec3==0?new m.common.Vec3:D.stackVec3[--D.sizeVec3];Q.x=f.x,Q.y=f.y,Q.z=f.z;let W=Q;W.x+=l.x*0,W.y+=l.y*0,W.z+=l.z*0,W.x+=a.x*i,W.y+=a.y*i,W.z+=a.z*i;let F=this.p,H=F.sizeVec3==0?new m.common.Vec3:F.stackVec3[--F.sizeVec3];H.x=Z.x,H.y=Z.y,H.z=Z.z;let G=H,J=-i;G.x+=l.x*J,G.y+=l.y*J,G.z+=l.z*J,G.x+=a.x*0,G.y+=a.y*0,G.z+=a.z*0;let N=this.p,K=N.sizeVec3==0?new m.common.Vec3:N.stackVec3[--N.sizeVec3];K.x=Z.x,K.y=Z.y,K.z=Z.z;let O=K;O.x+=l.x*i,O.y+=l.y*i,O.z+=l.z*i,O.x+=a.x*0,O.y+=a.y*0,O.z+=a.z*0;let $=this.p,et=$.sizeVec3==0?new m.common.Vec3:$.stackVec3[--$.sizeVec3];et.x=Z.x,et.y=Z.y,et.z=Z.z;let st=et;st.x+=l.x*0,st.y+=l.y*0,st.z+=l.z*0;let lt=-i;st.x+=a.x*lt,st.y+=a.y*lt,st.z+=a.z*lt;let rt=this.p,at=rt.sizeVec3==0?new m.common.Vec3:rt.stackVec3[--rt.sizeVec3];at.x=Z.x,at.y=Z.y,at.z=Z.z;let _t=at;_t.x+=l.x*0,_t.y+=l.y*0,_t.z+=l.z*0,_t.x+=a.x*i,_t.y+=a.y*i,_t.z+=a.z*i,this.ellipse(f,l,a,i,i,_),this.ellipse(Z,l,a,i,i,_),this.line(S,G,_),this.line(L,O,_),this.line(Y,st,_),this.line(W,_t,_);let ht=this.p;if(S!=null){if(S.zero(),ht.sizeVec3==ht.stackVec3.length){let gt=new Array(ht.sizeVec3<<1),pt=0,ct=ht.sizeVec3;for(;pt<ct;){let nt=pt++;gt[nt]=ht.stackVec3[nt],ht.stackVec3[nt]=null}ht.stackVec3=gt}ht.stackVec3[ht.sizeVec3++]=S}let ot=this.p;if(L!=null){if(L.zero(),ot.sizeVec3==ot.stackVec3.length){let gt=new Array(ot.sizeVec3<<1),pt=0,ct=ot.sizeVec3;for(;pt<ct;){let nt=pt++;gt[nt]=ot.stackVec3[nt],ot.stackVec3[nt]=null}ot.stackVec3=gt}ot.stackVec3[ot.sizeVec3++]=L}let bt=this.p;if(Y!=null){if(Y.zero(),bt.sizeVec3==bt.stackVec3.length){let gt=new Array(bt.sizeVec3<<1),pt=0,ct=bt.sizeVec3;for(;pt<ct;){let nt=pt++;gt[nt]=bt.stackVec3[nt],bt.stackVec3[nt]=null}bt.stackVec3=gt}bt.stackVec3[bt.sizeVec3++]=Y}let Xt=this.p;if(W!=null){if(W.zero(),Xt.sizeVec3==Xt.stackVec3.length){let gt=new Array(Xt.sizeVec3<<1),pt=0,ct=Xt.sizeVec3;for(;pt<ct;){let nt=pt++;gt[nt]=Xt.stackVec3[nt],Xt.stackVec3[nt]=null}Xt.stackVec3=gt}Xt.stackVec3[Xt.sizeVec3++]=W}let ft=this.p;if(G!=null){if(G.zero(),ft.sizeVec3==ft.stackVec3.length){let gt=new Array(ft.sizeVec3<<1),pt=0,ct=ft.sizeVec3;for(;pt<ct;){let nt=pt++;gt[nt]=ft.stackVec3[nt],ft.stackVec3[nt]=null}ft.stackVec3=gt}ft.stackVec3[ft.sizeVec3++]=G}let ut=this.p;if(O!=null){if(O.zero(),ut.sizeVec3==ut.stackVec3.length){let gt=new Array(ut.sizeVec3<<1),pt=0,ct=ut.sizeVec3;for(;pt<ct;){let nt=pt++;gt[nt]=ut.stackVec3[nt],ut.stackVec3[nt]=null}ut.stackVec3=gt}ut.stackVec3[ut.sizeVec3++]=O}let xt=this.p;if(st!=null){if(st.zero(),xt.sizeVec3==xt.stackVec3.length){let gt=new Array(xt.sizeVec3<<1),pt=0,ct=xt.sizeVec3;for(;pt<ct;){let nt=pt++;gt[nt]=xt.stackVec3[nt],xt.stackVec3[nt]=null}xt.stackVec3=gt}xt.stackVec3[xt.sizeVec3++]=st}let zt=this.p;if(_t!=null){if(_t.zero(),zt.sizeVec3==zt.stackVec3.length){let gt=new Array(zt.sizeVec3<<1),pt=0,ct=zt.sizeVec3;for(;pt<ct;){let nt=pt++;gt[nt]=zt.stackVec3[nt],zt.stackVec3[nt]=null}zt.stackVec3=gt}zt.stackVec3[zt.sizeVec3++]=_t}}else{let z=0;for(;z<8;){let S=z++,P=this.tmpCircleNorms[S],T=this.circleCoords[S];P.x=T.x,P.y=T.y,P.z=T.z;let C=P.x*c.e10+P.y*c.e11+P.z*c.e12,L=P.x*c.e20+P.y*c.e21+P.z*c.e22;P.x=P.x*c.e00+P.y*c.e01+P.z*c.e02,P.y=C,P.z=L;let q=this.tmpCircleVerts1[S],U=this.tmpCircleNorms[S];q.x=U.x,q.y=U.y,q.z=U.z,q.x*=i,q.y*=i,q.z*=i,q.x+=b.x,q.y+=b.y,q.z+=b.z;let Y=this.tmpCircleVerts2[S],E=this.tmpCircleVerts1[S];Y.x=E.x,Y.y=E.y,Y.z=E.z;let D=this.tmpCircleVerts1[S];D.x+=r.x*s,D.y+=r.y*s,D.z+=r.z*s;let Q=this.tmpCircleVerts2[S],W=-s;Q.x+=r.x*W,Q.y+=r.y*W,Q.z+=r.z*W}let w=0;for(;w<8;){let S=w++,P,T=this.tmpCircleVerts1[S],C=this.tmpCircleVerts1[(S+1)%8],L=r;this.triangle(f,T,C,L,L,L,_),T=this.tmpCircleVerts2[(S+1)%8],C=this.tmpCircleVerts2[S];let q=this.p,U=q.sizeVec3==0?new m.common.Vec3:q.stackVec3[--q.sizeVec3];U.x=r.x,U.y=r.y,U.z=r.z;let Y=U;Y.x=-Y.x,Y.y=-Y.y,Y.z=-Y.z,this.triangle(Z,T,C,Y,Y,Y,_);let E=this.p;if(Y!=null){if(Y.zero(),E.sizeVec3==E.stackVec3.length){let Q=new Array(E.sizeVec3<<1),W=0,F=E.sizeVec3;for(;W<F;){let H=W++;Q[H]=E.stackVec3[H],E.stackVec3[H]=null}E.stackVec3=Q}E.stackVec3[E.sizeVec3++]=Y}P=this.tmpCircleVerts1[S],T=this.tmpCircleVerts2[S],C=this.tmpCircleVerts2[(S+1)%8],L=this.tmpCircleNorms[S];let D=this.tmpCircleNorms[(S+1)%8];this.rect(P,T,C,this.tmpCircleVerts1[(S+1)%8],L,L,D,D,_)}}let M=this.p;if(f!=null){if(f.zero(),M.sizeVec3==M.stackVec3.length){let z=new Array(M.sizeVec3<<1),w=0,S=M.sizeVec3;for(;w<S;){let P=w++;z[P]=M.stackVec3[P],M.stackVec3[P]=null}M.stackVec3=z}M.stackVec3[M.sizeVec3++]=f}let y=this.p;if(Z!=null){if(Z.zero(),y.sizeVec3==y.stackVec3.length){let z=new Array(y.sizeVec3<<1),w=0,S=y.sizeVec3;for(;w<S;){let P=w++;z[P]=y.stackVec3[P],y.stackVec3[P]=null}y.stackVec3=z}y.stackVec3[y.sizeVec3++]=Z}let d=this.p;if(b!=null){if(b.zero(),d.sizeVec3==d.stackVec3.length){let z=new Array(d.sizeVec3<<1),w=0,S=d.sizeVec3;for(;w<S;){let P=w++;z[P]=d.stackVec3[P],d.stackVec3[P]=null}d.stackVec3=z}d.stackVec3[d.sizeVec3++]=b}let B=this.p;if(c!=null){if(c.e00=1,c.e01=0,c.e02=0,c.e10=0,c.e11=1,c.e12=0,c.e20=0,c.e21=0,c.e22=1,B.sizeMat3==B.stackMat3.length){let z=new Array(B.sizeMat3<<1),w=0,S=B.sizeMat3;for(;w<S;){let P=w++;z[P]=B.stackMat3[P],B.stackMat3[P]=null}B.stackMat3=z}B.stackMat3[B.sizeMat3++]=c}let R=this.p;if(l!=null){if(l.zero(),R.sizeVec3==R.stackVec3.length){let z=new Array(R.sizeVec3<<1),w=0,S=R.sizeVec3;for(;w<S;){let P=w++;z[P]=R.stackVec3[P],R.stackVec3[P]=null}R.stackVec3=z}R.stackVec3[R.sizeVec3++]=l}let k=this.p;if(r!=null){if(r.zero(),k.sizeVec3==k.stackVec3.length){let z=new Array(k.sizeVec3<<1),w=0,S=k.sizeVec3;for(;w<S;){let P=w++;z[P]=k.stackVec3[P],k.stackVec3[P]=null}k.stackVec3=z}k.stackVec3[k.sizeVec3++]=r}let A=this.p;if(a!=null){if(a.zero(),A.sizeVec3==A.stackVec3.length){let z=new Array(A.sizeVec3<<1),w=0,S=A.sizeVec3;for(;w<S;){let P=w++;z[P]=A.stackVec3[P],A.stackVec3[P]=null}A.stackVec3=z}A.stackVec3[A.sizeVec3++]=a}}capsule(t,i,s,_){let n=this.p,l=n.sizeVec3==0?new m.common.Vec3:n.stackVec3[--n.sizeVec3],o=this.p,r=o.sizeVec3==0?new m.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,a=e.sizeVec3==0?new m.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this.p,c=X.sizeMat3==0?new m.common.Mat3:X.stackMat3[--X.sizeMat3],u=b;u.x=t._positionX,u.y=t._positionY,u.z=t._positionZ;let p=c;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,l.init(c.e00,c.e10,c.e20),r.init(c.e01,c.e11,c.e21),a.init(c.e02,c.e12,c.e22);let x=this.tmpSphereVerts,v=this.tmpSphereNorms,f=0;for(;f<5;){let T=f++,C=this.tmpSphereVerts[T].length,L=0;for(;L<C;){let q=L++,U=v[T][q],Y=this.sphereCoords[T][q];U.x=Y.x,U.y=Y.y,U.z=Y.z;let E=U.x*c.e10+U.y*c.e11+U.z*c.e12,D=U.x*c.e20+U.y*c.e21+U.z*c.e22;U.x=U.x*c.e00+U.y*c.e01+U.z*c.e02,U.y=E,U.z=D}}let g=0;for(;g<4;){let T=g++;if(T==0){let L=0;for(;L<3;){let q=L++,U=this.tmpSphereVerts[q].length,Y=0;for(;Y<U;){let E=Y++,D=x[q][E],Q=v[q][E];D.x=Q.x,D.y=Q.y,D.z=Q.z,D.x*=i,D.y*=i,D.z*=i,D.x+=b.x,D.y+=b.y,D.z+=b.z,D.x+=r.x*s,D.y+=r.y*s,D.z+=r.z*s}}}if(T==2){let L=2;for(;L<5;){let q=L++,U=this.tmpSphereVerts[q].length,Y=0;for(;Y<U;){let E=Y++,D=x[q][E],Q=v[q][E];D.x=Q.x,D.y=Q.y,D.z=Q.z,D.x*=i,D.y*=i,D.z*=i,D.x+=b.x,D.y+=b.y,D.z+=b.z;let W=-s;D.x+=r.x*W,D.y+=r.y*W,D.z+=r.z*W}}}let C=0;for(;C<8;){let L=C++,q,U,Y,E,D,Q,W,F;T==0?this.wireframe?(q=x[0][0],U=x[1][L],this.line(q,U,_)):(q=x[0][0],U=x[1][L],Y=x[1][(L+1)%8],D=v[0][0],Q=v[1][L],W=v[1][(L+1)%8],this.triangle(q,U,Y,D,Q,W,_)):T==3?this.wireframe?(q=x[4][0],U=x[T][(L+1)%8],Y=x[T][L],this.line(q,U,_),this.line(U,Y,_)):(q=x[4][0],U=x[T][(L+1)%8],Y=x[T][L],D=v[4][0],Q=v[T][(L+1)%8],W=v[T][L],this.triangle(q,U,Y,D,Q,W,_)):this.wireframe?(q=x[T][L],U=x[T][(L+1)%8],Y=x[T+1][L],this.line(q,U,_),this.line(q,Y,_)):(q=x[T][L],U=x[T][(L+1)%8],Y=x[T+1][L],E=x[T+1][(L+1)%8],D=v[T][L],Q=v[T][(L+1)%8],W=v[T+1][L],F=v[T+1][(L+1)%8],this.rect(q,Y,E,U,D,W,F,Q,_))}}let V=this.p,Z=V.sizeVec3==0?new m.common.Vec3:V.stackVec3[--V.sizeVec3];Z.x=b.x,Z.y=b.y,Z.z=b.z;let I=Z;I.x+=r.x*s,I.y+=r.y*s,I.z+=r.z*s;let M=this.p,y=M.sizeVec3==0?new m.common.Vec3:M.stackVec3[--M.sizeVec3];y.x=b.x,y.y=b.y,y.z=b.z;let d=y,B=-s;if(d.x+=r.x*B,d.y+=r.y*B,d.z+=r.z*B,this.wireframe){let T=this.p,C=T.sizeVec3==0?new m.common.Vec3:T.stackVec3[--T.sizeVec3];C.x=I.x,C.y=I.y,C.z=I.z;let L=C,q=-i;L.x+=l.x*q,L.y+=l.y*q,L.z+=l.z*q,L.x+=a.x*0,L.y+=a.y*0,L.z+=a.z*0;let U=this.p,Y=U.sizeVec3==0?new m.common.Vec3:U.stackVec3[--U.sizeVec3];Y.x=I.x,Y.y=I.y,Y.z=I.z;let E=Y;E.x+=l.x*i,E.y+=l.y*i,E.z+=l.z*i,E.x+=a.x*0,E.y+=a.y*0,E.z+=a.z*0;let D=this.p,Q=D.sizeVec3==0?new m.common.Vec3:D.stackVec3[--D.sizeVec3];Q.x=I.x,Q.y=I.y,Q.z=I.z;let W=Q;W.x+=l.x*0,W.y+=l.y*0,W.z+=l.z*0;let F=-i;W.x+=a.x*F,W.y+=a.y*F,W.z+=a.z*F;let H=this.p,G=H.sizeVec3==0?new m.common.Vec3:H.stackVec3[--H.sizeVec3];G.x=I.x,G.y=I.y,G.z=I.z;let J=G;J.x+=l.x*0,J.y+=l.y*0,J.z+=l.z*0,J.x+=a.x*i,J.y+=a.y*i,J.z+=a.z*i;let N=this.p,K=N.sizeVec3==0?new m.common.Vec3:N.stackVec3[--N.sizeVec3];K.x=d.x,K.y=d.y,K.z=d.z;let O=K,$=-i;O.x+=l.x*$,O.y+=l.y*$,O.z+=l.z*$,O.x+=a.x*0,O.y+=a.y*0,O.z+=a.z*0;let et=this.p,st=et.sizeVec3==0?new m.common.Vec3:et.stackVec3[--et.sizeVec3];st.x=d.x,st.y=d.y,st.z=d.z;let lt=st;lt.x+=l.x*i,lt.y+=l.y*i,lt.z+=l.z*i,lt.x+=a.x*0,lt.y+=a.y*0,lt.z+=a.z*0;let rt=this.p,at=rt.sizeVec3==0?new m.common.Vec3:rt.stackVec3[--rt.sizeVec3];at.x=d.x,at.y=d.y,at.z=d.z;let _t=at;_t.x+=l.x*0,_t.y+=l.y*0,_t.z+=l.z*0;let ht=-i;_t.x+=a.x*ht,_t.y+=a.y*ht,_t.z+=a.z*ht;let ot=this.p,bt=ot.sizeVec3==0?new m.common.Vec3:ot.stackVec3[--ot.sizeVec3];bt.x=d.x,bt.y=d.y,bt.z=d.z;let Xt=bt;Xt.x+=l.x*0,Xt.y+=l.y*0,Xt.z+=l.z*0,Xt.x+=a.x*i,Xt.y+=a.y*i,Xt.z+=a.z*i,this.ellipse(I,l,a,i,i,_),this.ellipse(d,l,a,i,i,_),this.line(L,O,_),this.line(E,lt,_),this.line(W,_t,_),this.line(J,Xt,_);let ft=this.p;if(L!=null){if(L.zero(),ft.sizeVec3==ft.stackVec3.length){let tt=new Array(ft.sizeVec3<<1),kt=0,Bt=ft.sizeVec3;for(;kt<Bt;){let Mt=kt++;tt[Mt]=ft.stackVec3[Mt],ft.stackVec3[Mt]=null}ft.stackVec3=tt}ft.stackVec3[ft.sizeVec3++]=L}let ut=this.p;if(E!=null){if(E.zero(),ut.sizeVec3==ut.stackVec3.length){let tt=new Array(ut.sizeVec3<<1),kt=0,Bt=ut.sizeVec3;for(;kt<Bt;){let Mt=kt++;tt[Mt]=ut.stackVec3[Mt],ut.stackVec3[Mt]=null}ut.stackVec3=tt}ut.stackVec3[ut.sizeVec3++]=E}let xt=this.p;if(W!=null){if(W.zero(),xt.sizeVec3==xt.stackVec3.length){let tt=new Array(xt.sizeVec3<<1),kt=0,Bt=xt.sizeVec3;for(;kt<Bt;){let Mt=kt++;tt[Mt]=xt.stackVec3[Mt],xt.stackVec3[Mt]=null}xt.stackVec3=tt}xt.stackVec3[xt.sizeVec3++]=W}let zt=this.p;if(J!=null){if(J.zero(),zt.sizeVec3==zt.stackVec3.length){let tt=new Array(zt.sizeVec3<<1),kt=0,Bt=zt.sizeVec3;for(;kt<Bt;){let Mt=kt++;tt[Mt]=zt.stackVec3[Mt],zt.stackVec3[Mt]=null}zt.stackVec3=tt}zt.stackVec3[zt.sizeVec3++]=J}let gt=this.p;if(O!=null){if(O.zero(),gt.sizeVec3==gt.stackVec3.length){let tt=new Array(gt.sizeVec3<<1),kt=0,Bt=gt.sizeVec3;for(;kt<Bt;){let Mt=kt++;tt[Mt]=gt.stackVec3[Mt],gt.stackVec3[Mt]=null}gt.stackVec3=tt}gt.stackVec3[gt.sizeVec3++]=O}let pt=this.p;if(lt!=null){if(lt.zero(),pt.sizeVec3==pt.stackVec3.length){let tt=new Array(pt.sizeVec3<<1),kt=0,Bt=pt.sizeVec3;for(;kt<Bt;){let Mt=kt++;tt[Mt]=pt.stackVec3[Mt],pt.stackVec3[Mt]=null}pt.stackVec3=tt}pt.stackVec3[pt.sizeVec3++]=lt}let ct=this.p;if(_t!=null){if(_t.zero(),ct.sizeVec3==ct.stackVec3.length){let tt=new Array(ct.sizeVec3<<1),kt=0,Bt=ct.sizeVec3;for(;kt<Bt;){let Mt=kt++;tt[Mt]=ct.stackVec3[Mt],ct.stackVec3[Mt]=null}ct.stackVec3=tt}ct.stackVec3[ct.sizeVec3++]=_t}let nt=this.p;if(Xt!=null){if(Xt.zero(),nt.sizeVec3==nt.stackVec3.length){let tt=new Array(nt.sizeVec3<<1),kt=0,Bt=nt.sizeVec3;for(;kt<Bt;){let Mt=kt++;tt[Mt]=nt.stackVec3[Mt],nt.stackVec3[Mt]=null}nt.stackVec3=tt}nt.stackVec3[nt.sizeVec3++]=Xt}}else{let T=0;for(;T<8;){let L=T++,q=this.tmpCircleNorms[L],U=this.circleCoords[L];q.x=U.x,q.y=U.y,q.z=U.z;let Y=q.x*c.e10+q.y*c.e11+q.z*c.e12,E=q.x*c.e20+q.y*c.e21+q.z*c.e22;q.x=q.x*c.e00+q.y*c.e01+q.z*c.e02,q.y=Y,q.z=E;let D=this.tmpCircleVerts1[L],Q=this.tmpCircleNorms[L];D.x=Q.x,D.y=Q.y,D.z=Q.z,D.x*=i,D.y*=i,D.z*=i,D.x+=b.x,D.y+=b.y,D.z+=b.z;let W=this.tmpCircleVerts2[L],F=this.tmpCircleVerts1[L];W.x=F.x,W.y=F.y,W.z=F.z;let H=this.tmpCircleVerts1[L];H.x+=r.x*s,H.y+=r.y*s,H.z+=r.z*s;let G=this.tmpCircleVerts2[L],J=-s;G.x+=r.x*J,G.y+=r.y*J,G.z+=r.z*J}let C=0;for(;C<8;){let L=C++,q=this.tmpCircleNorms[L],U=this.tmpCircleNorms[(L+1)%8];this.rect(this.tmpCircleVerts1[L],this.tmpCircleVerts2[L],this.tmpCircleVerts2[(L+1)%8],this.tmpCircleVerts1[(L+1)%8],q,q,U,U,_)}}let R=this.p;if(I!=null){if(I.zero(),R.sizeVec3==R.stackVec3.length){let T=new Array(R.sizeVec3<<1),C=0,L=R.sizeVec3;for(;C<L;){let q=C++;T[q]=R.stackVec3[q],R.stackVec3[q]=null}R.stackVec3=T}R.stackVec3[R.sizeVec3++]=I}let k=this.p;if(d!=null){if(d.zero(),k.sizeVec3==k.stackVec3.length){let T=new Array(k.sizeVec3<<1),C=0,L=k.sizeVec3;for(;C<L;){let q=C++;T[q]=k.stackVec3[q],k.stackVec3[q]=null}k.stackVec3=T}k.stackVec3[k.sizeVec3++]=d}let A=this.p;if(b!=null){if(b.zero(),A.sizeVec3==A.stackVec3.length){let T=new Array(A.sizeVec3<<1),C=0,L=A.sizeVec3;for(;C<L;){let q=C++;T[q]=A.stackVec3[q],A.stackVec3[q]=null}A.stackVec3=T}A.stackVec3[A.sizeVec3++]=b}let z=this.p;if(c!=null){if(c.e00=1,c.e01=0,c.e02=0,c.e10=0,c.e11=1,c.e12=0,c.e20=0,c.e21=0,c.e22=1,z.sizeMat3==z.stackMat3.length){let T=new Array(z.sizeMat3<<1),C=0,L=z.sizeMat3;for(;C<L;){let q=C++;T[q]=z.stackMat3[q],z.stackMat3[q]=null}z.stackMat3=T}z.stackMat3[z.sizeMat3++]=c}let w=this.p;if(l!=null){if(l.zero(),w.sizeVec3==w.stackVec3.length){let T=new Array(w.sizeVec3<<1),C=0,L=w.sizeVec3;for(;C<L;){let q=C++;T[q]=w.stackVec3[q],w.stackVec3[q]=null}w.stackVec3=T}w.stackVec3[w.sizeVec3++]=l}let S=this.p;if(r!=null){if(r.zero(),S.sizeVec3==S.stackVec3.length){let T=new Array(S.sizeVec3<<1),C=0,L=S.sizeVec3;for(;C<L;){let q=C++;T[q]=S.stackVec3[q],S.stackVec3[q]=null}S.stackVec3=T}S.stackVec3[S.sizeVec3++]=r}let P=this.p;if(a!=null){if(a.zero(),P.sizeVec3==P.stackVec3.length){let T=new Array(P.sizeVec3<<1),C=0,L=P.sizeVec3;for(;C<L;){let q=C++;T[q]=P.stackVec3[q],P.stackVec3[q]=null}P.stackVec3=T}P.stackVec3[P.sizeVec3++]=a}}sphere(t,i,s){let _=this.p,n=_.sizeVec3==0?new m.common.Vec3:_.stackVec3[--_.sizeVec3],l=this.p,o=l.sizeMat3==0?new m.common.Mat3:l.stackMat3[--l.sizeMat3],r=n;r.x=t._positionX,r.y=t._positionY,r.z=t._positionZ;let e=o;e.e00=t._rotation00,e.e01=t._rotation01,e.e02=t._rotation02,e.e10=t._rotation10,e.e11=t._rotation11,e.e12=t._rotation12,e.e20=t._rotation20,e.e21=t._rotation21,e.e22=t._rotation22;let a=this.tmpSphereVerts,h=this.tmpSphereNorms,b=0;for(;b<5;){let p=b++,x=this.tmpSphereVerts[p].length,v=0;for(;v<x;){let f=v++,g=h[p][f],V=this.sphereCoords[p][f];g.x=V.x,g.y=V.y,g.z=V.z;let Z=g.x*o.e10+g.y*o.e11+g.z*o.e12,I=g.x*o.e20+g.y*o.e21+g.z*o.e22;g.x=g.x*o.e00+g.y*o.e01+g.z*o.e02,g.y=Z,g.z=I;let M=a[p][f],y=h[p][f];M.x=y.x,M.y=y.y,M.z=y.z,M.x*=i,M.y*=i,M.z*=i,M.x+=n.x,M.y+=n.y,M.z+=n.z}}let X=0;for(;X<4;){let p=X++,x=0;for(;x<8;){let v=x++,f,g,V,Z,I,M,y,d;p==0?this.wireframe?(f=a[0][0],g=a[1][v],this.line(f,g,s)):(f=a[0][0],g=a[1][v],V=a[1][(v+1)%8],I=h[0][0],M=h[1][v],y=h[1][(v+1)%8],this.triangle(f,g,V,I,M,y,s)):p==3?this.wireframe?(f=a[4][0],g=a[p][(v+1)%8],V=a[p][v],this.line(f,g,s),this.line(g,V,s)):(f=a[4][0],g=a[p][(v+1)%8],V=a[p][v],I=h[4][0],M=h[p][(v+1)%8],y=h[p][v],this.triangle(f,g,V,I,M,y,s)):this.wireframe?(f=a[p][v],g=a[p][(v+1)%8],V=a[p+1][v],this.line(f,g,s),this.line(f,V,s)):(f=a[p][v],g=a[p][(v+1)%8],V=a[p+1][v],Z=a[p+1][(v+1)%8],I=h[p][v],M=h[p][(v+1)%8],y=h[p+1][v],d=h[p+1][(v+1)%8],this.rect(f,V,Z,g,I,y,d,M,s))}}let c=this.p;if(n!=null){if(n.zero(),c.sizeVec3==c.stackVec3.length){let p=new Array(c.sizeVec3<<1),x=0,v=c.sizeVec3;for(;x<v;){let f=x++;p[f]=c.stackVec3[f],c.stackVec3[f]=null}c.stackVec3=p}c.stackVec3[c.sizeVec3++]=n}let u=this.p;if(o!=null){if(o.e00=1,o.e01=0,o.e02=0,o.e10=0,o.e11=1,o.e12=0,o.e20=0,o.e21=0,o.e22=1,u.sizeMat3==u.stackMat3.length){let p=new Array(u.sizeMat3<<1),x=0,v=u.sizeMat3;for(;x<v;){let f=x++;p[f]=u.stackMat3[f],u.stackMat3[f]=null}u.stackMat3=p}u.stackMat3[u.sizeMat3++]=o}}box(t,i,s){let _=this.p,n=_.sizeVec3==0?new m.common.Vec3:_.stackVec3[--_.sizeVec3],l=this.p,o=l.sizeVec3==0?new m.common.Vec3:l.stackVec3[--l.sizeVec3],r=this.p,e=r.sizeVec3==0?new m.common.Vec3:r.stackVec3[--r.sizeVec3],a=this.p,h=a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3],b=this.p,X=b.sizeMat3==0?new m.common.Mat3:b.stackMat3[--b.sizeMat3],c=h;c.x=t._positionX,c.y=t._positionY,c.z=t._positionZ;let u=X;u.e00=t._rotation00,u.e01=t._rotation01,u.e02=t._rotation02,u.e10=t._rotation10,u.e11=t._rotation11,u.e12=t._rotation12,u.e20=t._rotation20,u.e21=t._rotation21,u.e22=t._rotation22,n.init(X.e00,X.e10,X.e20),o.init(X.e01,X.e11,X.e21),e.init(X.e02,X.e12,X.e22);let p=i.x,x=i.y,v=i.z,f=this.p,g=f.sizeVec3==0?new m.common.Vec3:f.stackVec3[--f.sizeVec3];g.x=h.x,g.y=h.y,g.z=h.z;let V=g,Z=-p;V.x+=n.x*Z,V.y+=n.y*Z,V.z+=n.z*Z;let I=-x;V.x+=o.x*I,V.y+=o.y*I,V.z+=o.z*I;let M=-v;V.x+=e.x*M,V.y+=e.y*M,V.z+=e.z*M;let y=this.p,d=y.sizeVec3==0?new m.common.Vec3:y.stackVec3[--y.sizeVec3];d.x=h.x,d.y=h.y,d.z=h.z;let B=d,R=-p;B.x+=n.x*R,B.y+=n.y*R,B.z+=n.z*R;let k=-x;B.x+=o.x*k,B.y+=o.y*k,B.z+=o.z*k,B.x+=e.x*v,B.y+=e.y*v,B.z+=e.z*v;let A=this.p,z=A.sizeVec3==0?new m.common.Vec3:A.stackVec3[--A.sizeVec3];z.x=h.x,z.y=h.y,z.z=h.z;let w=z,S=-p;w.x+=n.x*S,w.y+=n.y*S,w.z+=n.z*S,w.x+=o.x*x,w.y+=o.y*x,w.z+=o.z*x;let P=-v;w.x+=e.x*P,w.y+=e.y*P,w.z+=e.z*P;let T=this.p,C=T.sizeVec3==0?new m.common.Vec3:T.stackVec3[--T.sizeVec3];C.x=h.x,C.y=h.y,C.z=h.z;let L=C,q=-p;L.x+=n.x*q,L.y+=n.y*q,L.z+=n.z*q,L.x+=o.x*x,L.y+=o.y*x,L.z+=o.z*x,L.x+=e.x*v,L.y+=e.y*v,L.z+=e.z*v;let U=this.p,Y=U.sizeVec3==0?new m.common.Vec3:U.stackVec3[--U.sizeVec3];Y.x=h.x,Y.y=h.y,Y.z=h.z;let E=Y;E.x+=n.x*p,E.y+=n.y*p,E.z+=n.z*p;let D=-x;E.x+=o.x*D,E.y+=o.y*D,E.z+=o.z*D;let Q=-v;E.x+=e.x*Q,E.y+=e.y*Q,E.z+=e.z*Q;let W=this.p,F=W.sizeVec3==0?new m.common.Vec3:W.stackVec3[--W.sizeVec3];F.x=h.x,F.y=h.y,F.z=h.z;let H=F;H.x+=n.x*p,H.y+=n.y*p,H.z+=n.z*p;let G=-x;H.x+=o.x*G,H.y+=o.y*G,H.z+=o.z*G,H.x+=e.x*v,H.y+=e.y*v,H.z+=e.z*v;let J=this.p,N=J.sizeVec3==0?new m.common.Vec3:J.stackVec3[--J.sizeVec3];N.x=h.x,N.y=h.y,N.z=h.z;let K=N;K.x+=n.x*p,K.y+=n.y*p,K.z+=n.z*p,K.x+=o.x*x,K.y+=o.y*x,K.z+=o.z*x;let O=-v;K.x+=e.x*O,K.y+=e.y*O,K.z+=e.z*O;let $=this.p,et=$.sizeVec3==0?new m.common.Vec3:$.stackVec3[--$.sizeVec3];et.x=h.x,et.y=h.y,et.z=h.z;let st=et;if(st.x+=n.x*p,st.y+=n.y*p,st.z+=n.z*p,st.x+=o.x*x,st.y+=o.y*x,st.z+=o.z*x,st.x+=e.x*v,st.y+=e.y*v,st.z+=e.z*v,this.wireframe)this.line(V,B,s),this.line(w,L,s),this.line(E,H,s),this.line(K,st,s),this.line(V,w,s),this.line(B,L,s),this.line(E,K,s),this.line(H,st,s),this.line(V,E,s),this.line(B,H,s),this.line(w,K,s),this.line(L,st,s);else{let pt=this.p,ct=pt.sizeVec3==0?new m.common.Vec3:pt.stackVec3[--pt.sizeVec3];ct.x=n.x,ct.y=n.y,ct.z=n.z;let nt=ct;nt.x=-nt.x,nt.y=-nt.y,nt.z=-nt.z;let tt=this.p,kt=tt.sizeVec3==0?new m.common.Vec3:tt.stackVec3[--tt.sizeVec3];kt.x=o.x,kt.y=o.y,kt.z=o.z;let Bt=kt;Bt.x=-Bt.x,Bt.y=-Bt.y,Bt.z=-Bt.z;let Mt=this.p,Rt=Mt.sizeVec3==0?new m.common.Vec3:Mt.stackVec3[--Mt.sizeVec3];Rt.x=e.x,Rt.y=e.y,Rt.z=e.z;let ci=Rt;ci.x=-ci.x,ci.y=-ci.y,ci.z=-ci.z,this.rect(V,B,L,w,nt,nt,nt,nt,s),this.rect(E,K,st,H,n,n,n,n,s),this.rect(V,E,H,B,Bt,Bt,Bt,Bt,s),this.rect(w,L,st,K,o,o,o,o,s),this.rect(V,w,K,E,ci,ci,ci,ci,s),this.rect(B,H,st,L,e,e,e,e,s);let Xi=this.p;if(nt!=null){if(nt.zero(),Xi.sizeVec3==Xi.stackVec3.length){let wi=new Array(Xi.sizeVec3<<1),ei=0,Nt=Xi.sizeVec3;for(;ei<Nt;){let At=ei++;wi[At]=Xi.stackVec3[At],Xi.stackVec3[At]=null}Xi.stackVec3=wi}Xi.stackVec3[Xi.sizeVec3++]=nt}let gi=this.p;if(Bt!=null){if(Bt.zero(),gi.sizeVec3==gi.stackVec3.length){let wi=new Array(gi.sizeVec3<<1),ei=0,Nt=gi.sizeVec3;for(;ei<Nt;){let At=ei++;wi[At]=gi.stackVec3[At],gi.stackVec3[At]=null}gi.stackVec3=wi}gi.stackVec3[gi.sizeVec3++]=Bt}let ki=this.p;if(ci!=null){if(ci.zero(),ki.sizeVec3==ki.stackVec3.length){let wi=new Array(ki.sizeVec3<<1),ei=0,Nt=ki.sizeVec3;for(;ei<Nt;){let At=ei++;wi[At]=ki.stackVec3[At],ki.stackVec3[At]=null}ki.stackVec3=wi}ki.stackVec3[ki.sizeVec3++]=ci}}let lt=this.p;if(V!=null){if(V.zero(),lt.sizeVec3==lt.stackVec3.length){let pt=new Array(lt.sizeVec3<<1),ct=0,nt=lt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=lt.stackVec3[tt],lt.stackVec3[tt]=null}lt.stackVec3=pt}lt.stackVec3[lt.sizeVec3++]=V}let rt=this.p;if(B!=null){if(B.zero(),rt.sizeVec3==rt.stackVec3.length){let pt=new Array(rt.sizeVec3<<1),ct=0,nt=rt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=rt.stackVec3[tt],rt.stackVec3[tt]=null}rt.stackVec3=pt}rt.stackVec3[rt.sizeVec3++]=B}let at=this.p;if(w!=null){if(w.zero(),at.sizeVec3==at.stackVec3.length){let pt=new Array(at.sizeVec3<<1),ct=0,nt=at.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=at.stackVec3[tt],at.stackVec3[tt]=null}at.stackVec3=pt}at.stackVec3[at.sizeVec3++]=w}let _t=this.p;if(L!=null){if(L.zero(),_t.sizeVec3==_t.stackVec3.length){let pt=new Array(_t.sizeVec3<<1),ct=0,nt=_t.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=_t.stackVec3[tt],_t.stackVec3[tt]=null}_t.stackVec3=pt}_t.stackVec3[_t.sizeVec3++]=L}let ht=this.p;if(E!=null){if(E.zero(),ht.sizeVec3==ht.stackVec3.length){let pt=new Array(ht.sizeVec3<<1),ct=0,nt=ht.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=ht.stackVec3[tt],ht.stackVec3[tt]=null}ht.stackVec3=pt}ht.stackVec3[ht.sizeVec3++]=E}let ot=this.p;if(H!=null){if(H.zero(),ot.sizeVec3==ot.stackVec3.length){let pt=new Array(ot.sizeVec3<<1),ct=0,nt=ot.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=ot.stackVec3[tt],ot.stackVec3[tt]=null}ot.stackVec3=pt}ot.stackVec3[ot.sizeVec3++]=H}let bt=this.p;if(K!=null){if(K.zero(),bt.sizeVec3==bt.stackVec3.length){let pt=new Array(bt.sizeVec3<<1),ct=0,nt=bt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=bt.stackVec3[tt],bt.stackVec3[tt]=null}bt.stackVec3=pt}bt.stackVec3[bt.sizeVec3++]=K}let Xt=this.p;if(st!=null){if(st.zero(),Xt.sizeVec3==Xt.stackVec3.length){let pt=new Array(Xt.sizeVec3<<1),ct=0,nt=Xt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=Xt.stackVec3[tt],Xt.stackVec3[tt]=null}Xt.stackVec3=pt}Xt.stackVec3[Xt.sizeVec3++]=st}let ft=this.p;if(h!=null){if(h.zero(),ft.sizeVec3==ft.stackVec3.length){let pt=new Array(ft.sizeVec3<<1),ct=0,nt=ft.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=ft.stackVec3[tt],ft.stackVec3[tt]=null}ft.stackVec3=pt}ft.stackVec3[ft.sizeVec3++]=h}let ut=this.p;if(X!=null){if(X.e00=1,X.e01=0,X.e02=0,X.e10=0,X.e11=1,X.e12=0,X.e20=0,X.e21=0,X.e22=1,ut.sizeMat3==ut.stackMat3.length){let pt=new Array(ut.sizeMat3<<1),ct=0,nt=ut.sizeMat3;for(;ct<nt;){let tt=ct++;pt[tt]=ut.stackMat3[tt],ut.stackMat3[tt]=null}ut.stackMat3=pt}ut.stackMat3[ut.sizeMat3++]=X}let xt=this.p;if(n!=null){if(n.zero(),xt.sizeVec3==xt.stackVec3.length){let pt=new Array(xt.sizeVec3<<1),ct=0,nt=xt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=xt.stackVec3[tt],xt.stackVec3[tt]=null}xt.stackVec3=pt}xt.stackVec3[xt.sizeVec3++]=n}let zt=this.p;if(o!=null){if(o.zero(),zt.sizeVec3==zt.stackVec3.length){let pt=new Array(zt.sizeVec3<<1),ct=0,nt=zt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=zt.stackVec3[tt],zt.stackVec3[tt]=null}zt.stackVec3=pt}zt.stackVec3[zt.sizeVec3++]=o}let gt=this.p;if(e!=null){if(e.zero(),gt.sizeVec3==gt.stackVec3.length){let pt=new Array(gt.sizeVec3<<1),ct=0,nt=gt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=gt.stackVec3[tt],gt.stackVec3[tt]=null}gt.stackVec3=pt}gt.stackVec3[gt.sizeVec3++]=e}}rect(t,i,s,_,n,l,o,r,e){this.triangle(t,i,s,n,l,o,e),this.triangle(t,s,_,n,o,r,e)}point(t,i){}triangle(t,i,s,_,n,l,o){}line(t,i,s){}};m.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new m.common.Vec3(0,0,1),this.basisColorY=new m.common.Vec3(0,1,0),this.basisColorX=new m.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new m.common.Vec3(1,.1,.1),this.jointLineColor=new m.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new m.common.Vec3(.2,.2,1),this.contactTangentColor=new m.common.Vec3(.1,.8,.1),this.contactNormalColor=new m.common.Vec3(1,.1,.1),this.disabledContactColor=new m.common.Vec3(.5,.1,.1),this.newContactColor=new m.common.Vec3(1,1,.1),this.contactColor4=new m.common.Vec3(.8,.1,1),this.contactColor3=new m.common.Vec3(.1,.8,.6),this.contactColor2=new m.common.Vec3(1,.6,.1),this.contactColor=new m.common.Vec3(1,.1,.1),this.pairColor=new m.common.Vec3(1,1,.1),this.bvhNodeColor=new m.common.Vec3(.4,.4,.4),this.aabbColor=new m.common.Vec3(1,.1,.1),this.kinematicShapeColor=new m.common.Vec3(1,.5,.1),this.staticShapeColor=new m.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new m.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new m.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new m.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new m.common.Vec3(.5,.25,.6),this.shapeColor2=new m.common.Vec3(1,.8,.1),this.shapeColor1=new m.common.Vec3(.7,.2,.4)}};m.dynamics.common.Performance=class{};m.dynamics.constraint||(m.dynamics.constraint={});m.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(t){}warmStart(t){}solveVelocity(){}postSolveVelocity(t){}preSolvePosition(t){}solvePositionSplitImpulse(){}solvePositionNgs(t){}postSolve(){}};m.dynamics.constraint.PositionCorrectionAlgorithm=class{};m.dynamics.constraint.contact||(m.dynamics.constraint.contact={});m.dynamics.constraint.contact.ContactConstraint=class{constructor(t){this._solver=new m.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=t}_getVelocitySolverInfo(t,i){i.b1=this._b1,i.b2=this._b2;let s,_,n,l,o,r,e,a,h;s=this._manifold._normalX,_=this._manifold._normalY,n=this._manifold._normalZ,l=this._manifold._tangentX,o=this._manifold._tangentY,r=this._manifold._tangentZ,e=this._manifold._binormalX,a=this._manifold._binormalY,h=this._manifold._binormalZ;let b=Math.sqrt(this._s1._friction*this._s2._friction),X=Math.sqrt(this._s1._restitution*this._s2._restitution),c=this._manifold._numPoints;i.numRows=0;let u=0;for(;u<c;){let p=this._manifold._points[u++];if(p._depth<0){p._disabled=!0;let g=p._impulse;g.impulseN=0,g.impulseT=0,g.impulseB=0,g.impulseP=0,g.impulseLX=0,g.impulseLY=0,g.impulseLZ=0;continue}else p._disabled=!1;let x=i.rows[i.numRows++];x.friction=b,x.cfm=0;let v=x.jacobianN;v.lin1X=s,v.lin1Y=_,v.lin1Z=n,v.lin2X=s,v.lin2Y=_,v.lin2Z=n,v.ang1X=p._relPos1Y*n-p._relPos1Z*_,v.ang1Y=p._relPos1Z*s-p._relPos1X*n,v.ang1Z=p._relPos1X*_-p._relPos1Y*s,v.ang2X=p._relPos2Y*n-p._relPos2Z*_,v.ang2Y=p._relPos2Z*s-p._relPos2X*n,v.ang2Z=p._relPos2X*_-p._relPos2Y*s,v=x.jacobianT,v.lin1X=l,v.lin1Y=o,v.lin1Z=r,v.lin2X=l,v.lin2Y=o,v.lin2Z=r,v.ang1X=p._relPos1Y*r-p._relPos1Z*o,v.ang1Y=p._relPos1Z*l-p._relPos1X*r,v.ang1Z=p._relPos1X*o-p._relPos1Y*l,v.ang2X=p._relPos2Y*r-p._relPos2Z*o,v.ang2Y=p._relPos2Z*l-p._relPos2X*r,v.ang2Z=p._relPos2X*o-p._relPos2Y*l,v=x.jacobianB,v.lin1X=e,v.lin1Y=a,v.lin1Z=h,v.lin2X=e,v.lin2Y=a,v.lin2Z=h,v.ang1X=p._relPos1Y*h-p._relPos1Z*a,v.ang1Y=p._relPos1Z*e-p._relPos1X*h,v.ang1Z=p._relPos1X*a-p._relPos1Y*e,v.ang2X=p._relPos2Y*h-p._relPos2Z*a,v.ang2Y=p._relPos2Z*e-p._relPos2X*h,v.ang2Z=p._relPos2X*a-p._relPos2Y*e,v=x.jacobianN;let f=v.lin1X*this._b1._velX+v.lin1Y*this._b1._velY+v.lin1Z*this._b1._velZ+(v.ang1X*this._b1._angVelX+v.ang1Y*this._b1._angVelY+v.ang1Z*this._b1._angVelZ)-(v.lin2X*this._b2._velX+v.lin2Y*this._b2._velY+v.lin2Z*this._b2._velZ+(v.ang2X*this._b2._angVelX+v.ang2Y*this._b2._angVelY+v.ang2Z*this._b2._angVelZ));if(f<-m.common.Setting.contactEnableBounceThreshold&&!p._warmStarted?x.rhs=-f*X:x.rhs=0,this._positionCorrectionAlgorithm==m.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&p._depth>m.common.Setting.linearSlop){let g=(p._depth-m.common.Setting.linearSlop)*m.common.Setting.velocityBaumgarte*t.invDt;x.rhs<g&&(x.rhs=g)}if(!p._warmStarted){let g=p._impulse;g.impulseN=0,g.impulseT=0,g.impulseB=0,g.impulseP=0,g.impulseLX=0,g.impulseLY=0,g.impulseLZ=0}x.impulse=p._impulse}}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2;let i,s,_;i=this._manifold._normalX,s=this._manifold._normalY,_=this._manifold._normalZ;let n=this._manifold._numPoints;t.numRows=0;let l=0;for(;l<n;){let o=this._manifold._points[l++];if(o._disabled)continue;let r=t.rows[t.numRows++],e=r.jacobianN;e.lin1X=i,e.lin1Y=s,e.lin1Z=_,e.lin2X=i,e.lin2Y=s,e.lin2Z=_,e.ang1X=o._relPos1Y*_-o._relPos1Z*s,e.ang1Y=o._relPos1Z*i-o._relPos1X*_,e.ang1Z=o._relPos1X*s-o._relPos1Y*i,e.ang2X=o._relPos2Y*_-o._relPos2Z*s,e.ang2Y=o._relPos2Z*i-o._relPos2X*_,e.ang2Z=o._relPos2X*s-o._relPos2Y*i,r.rhs=o._depth-m.common.Setting.linearSlop,r.rhs<0&&(r.rhs=0),r.impulse=o._impulse}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){let t=0,i=this._manifold._numPoints;for(;t<i;)if(this._manifold._points[t++]._depth>=0)return!0;return!1}};m.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}};m.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0,this._points=new Array(m.common.Setting.maxManifoldPoints);let t=0,i=m.common.Setting.maxManifoldPoints;for(;t<i;)this._points[t++]=new m.dynamics.constraint.contact.ManifoldPoint}_clear(){let t=0,i=this._numPoints;for(;t<i;){let s=this._points[t++];s._localPos1X=0,s._localPos1Y=0,s._localPos1Z=0,s._localPos2X=0,s._localPos2Y=0,s._localPos2Z=0,s._relPos1X=0,s._relPos1Y=0,s._relPos1Z=0,s._relPos2X=0,s._relPos2Y=0,s._relPos2Z=0,s._pos1X=0,s._pos1Y=0,s._pos1Z=0,s._pos2X=0,s._pos2Y=0,s._pos2Z=0,s._depth=0;let _=s._impulse;_.impulseN=0,_.impulseT=0,_.impulseB=0,_.impulseP=0,_.impulseLX=0,_.impulseLY=0,_.impulseLZ=0,s._warmStarted=!1,s._disabled=!1,s._id=-1}this._numPoints=0}_buildBasis(t){this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;let i=t.x,s=t.y,_=t.z,n=i*i,l=s*s,o=_*_,r,e,a,h,b,X;if(n<l)if(n<o){let c=1/Math.sqrt(l+o);r=0,e=-_*c,a=s*c,h=s*a-_*e,b=-i*a,X=i*e}else{let c=1/Math.sqrt(n+l);r=-s*c,e=i*c,a=0,h=-_*e,b=_*r,X=i*e-s*r}else if(l<o){let c=1/Math.sqrt(n+o);r=_*c,e=0,a=-i*c,h=s*a,b=_*r-i*a,X=-s*r}else{let c=1/Math.sqrt(n+l);r=-s*c,e=i*c,a=0,h=-_*e,b=_*r,X=i*e-s*r}this._tangentX=r,this._tangentY=e,this._tangentZ=a,this._binormalX=h,this._binormalY=b,this._binormalZ=X}_updateDepthsAndPositions(t,i){let s=0,_=this._numPoints;for(;s<_;){let n=this._points[s++],l,o,r;l=t._rotation00*n._localPos1X+t._rotation01*n._localPos1Y+t._rotation02*n._localPos1Z,o=t._rotation10*n._localPos1X+t._rotation11*n._localPos1Y+t._rotation12*n._localPos1Z,r=t._rotation20*n._localPos1X+t._rotation21*n._localPos1Y+t._rotation22*n._localPos1Z,n._relPos1X=l,n._relPos1Y=o,n._relPos1Z=r;let e,a,h;e=i._rotation00*n._localPos2X+i._rotation01*n._localPos2Y+i._rotation02*n._localPos2Z,a=i._rotation10*n._localPos2X+i._rotation11*n._localPos2Y+i._rotation12*n._localPos2Z,h=i._rotation20*n._localPos2X+i._rotation21*n._localPos2Y+i._rotation22*n._localPos2Z,n._relPos2X=e,n._relPos2Y=a,n._relPos2Z=h,n._pos1X=n._relPos1X+t._positionX,n._pos1Y=n._relPos1Y+t._positionY,n._pos1Z=n._relPos1Z+t._positionZ,n._pos2X=n._relPos2X+i._positionX,n._pos2Y=n._relPos2Y+i._positionY,n._pos2Z=n._relPos2Z+i._positionZ;let b,X,c;b=n._pos1X-n._pos2X,X=n._pos1Y-n._pos2Y,c=n._pos1Z-n._pos2Z,n._depth=-(b*this._normalX+X*this._normalY+c*this._normalZ)}}getNormal(){let t=new m.common.Vec3;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,t}getNormalTo(t){t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){let t=new m.common.Vec3;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,t}getTangentTo(t){t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){let t=new m.common.Vec3;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,t}getBinormalTo(t){t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}};m.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new m.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){let t=new m.common.Vec3;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,t}getPosition1To(t){t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){let t=new m.common.Vec3;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,t}getPosition2To(t){t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}};m.dynamics.constraint.contact.ManifoldUpdater=class{constructor(t){this._manifold=t,this.numOldPoints=0,this.oldPoints=new Array(m.common.Setting.maxManifoldPoints);let i=0,s=m.common.Setting.maxManifoldPoints;for(;i<s;)this.oldPoints[i++]=new m.dynamics.constraint.contact.ManifoldPoint}removeOutdatedPoints(){let t=this._manifold._numPoints;for(;--t>=0;){let i=this._manifold._points[t],s,_,n;s=i._pos1X-i._pos2X,_=i._pos1Y-i._pos2Y,n=i._pos1Z-i._pos2Z;let l=this._manifold._normalX*s+this._manifold._normalY*_+this._manifold._normalZ*n;if(l>m.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}if(s+=this._manifold._normalX*-l,_+=this._manifold._normalY*-l,n+=this._manifold._normalZ*-l,s*s+_*_+n*n>m.common.Setting.contactPersistenceThreshold*m.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}}}removeManifoldPoint(t){let i=--this._manifold._numPoints;if(t!=i){let n=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[i],this._manifold._points[i]=n}let s=this._manifold._points[i];s._localPos1X=0,s._localPos1Y=0,s._localPos1Z=0,s._localPos2X=0,s._localPos2Y=0,s._localPos2Z=0,s._relPos1X=0,s._relPos1Y=0,s._relPos1Z=0,s._relPos2X=0,s._relPos2Y=0,s._relPos2Z=0,s._pos1X=0,s._pos1Y=0,s._pos1Z=0,s._pos2X=0,s._pos2Y=0,s._pos2Z=0,s._depth=0;let _=s._impulse;_.impulseN=0,_.impulseT=0,_.impulseB=0,_.impulseP=0,_.impulseLX=0,_.impulseLY=0,_.impulseLZ=0,s._warmStarted=!1,s._disabled=!1,s._id=-1}addManifoldPoint(t,i,s){let _=this._manifold._numPoints;if(_==m.common.Setting.maxManifoldPoints){let u=this.computeTargetIndex(t,i,s),p=this._manifold._points[u],x=t.position1;p._pos1X=x.x,p._pos1Y=x.y,p._pos1Z=x.z;let v=t.position2;p._pos2X=v.x,p._pos2Y=v.y,p._pos2Z=v.z,p._relPos1X=p._pos1X-i._positionX,p._relPos1Y=p._pos1Y-i._positionY,p._relPos1Z=p._pos1Z-i._positionZ,p._relPos2X=p._pos2X-s._positionX,p._relPos2Y=p._pos2Y-s._positionY,p._relPos2Z=p._pos2Z-s._positionZ;let f,g,V;f=i._rotation00*p._relPos1X+i._rotation10*p._relPos1Y+i._rotation20*p._relPos1Z,g=i._rotation01*p._relPos1X+i._rotation11*p._relPos1Y+i._rotation21*p._relPos1Z,V=i._rotation02*p._relPos1X+i._rotation12*p._relPos1Y+i._rotation22*p._relPos1Z,p._localPos1X=f,p._localPos1Y=g,p._localPos1Z=V;let Z,I,M;Z=s._rotation00*p._relPos2X+s._rotation10*p._relPos2Y+s._rotation20*p._relPos2Z,I=s._rotation01*p._relPos2X+s._rotation11*p._relPos2Y+s._rotation21*p._relPos2Z,M=s._rotation02*p._relPos2X+s._rotation12*p._relPos2Y+s._rotation22*p._relPos2Z,p._localPos2X=Z,p._localPos2Y=I,p._localPos2Z=M,p._depth=t.depth;let y=p._impulse;y.impulseN=0,y.impulseT=0,y.impulseB=0,y.impulseP=0,y.impulseLX=0,y.impulseLY=0,y.impulseLZ=0,p._id=t.id,p._warmStarted=!1,p._disabled=!1;return}let n=this._manifold._points[_],l=t.position1;n._pos1X=l.x,n._pos1Y=l.y,n._pos1Z=l.z;let o=t.position2;n._pos2X=o.x,n._pos2Y=o.y,n._pos2Z=o.z,n._relPos1X=n._pos1X-i._positionX,n._relPos1Y=n._pos1Y-i._positionY,n._relPos1Z=n._pos1Z-i._positionZ,n._relPos2X=n._pos2X-s._positionX,n._relPos2Y=n._pos2Y-s._positionY,n._relPos2Z=n._pos2Z-s._positionZ;let r,e,a;r=i._rotation00*n._relPos1X+i._rotation10*n._relPos1Y+i._rotation20*n._relPos1Z,e=i._rotation01*n._relPos1X+i._rotation11*n._relPos1Y+i._rotation21*n._relPos1Z,a=i._rotation02*n._relPos1X+i._rotation12*n._relPos1Y+i._rotation22*n._relPos1Z,n._localPos1X=r,n._localPos1Y=e,n._localPos1Z=a;let h,b,X;h=s._rotation00*n._relPos2X+s._rotation10*n._relPos2Y+s._rotation20*n._relPos2Z,b=s._rotation01*n._relPos2X+s._rotation11*n._relPos2Y+s._rotation21*n._relPos2Z,X=s._rotation02*n._relPos2X+s._rotation12*n._relPos2Y+s._rotation22*n._relPos2Z,n._localPos2X=h,n._localPos2Y=b,n._localPos2Z=X,n._depth=t.depth;let c=n._impulse;c.impulseN=0,c.impulseT=0,c.impulseB=0,c.impulseP=0,c.impulseLX=0,c.impulseLY=0,c.impulseLZ=0,n._id=t.id,n._warmStarted=!1,n._disabled=!1,this._manifold._numPoints++}computeTargetIndex(t,i,s){let _=this._manifold._points[0],n=this._manifold._points[1],l=this._manifold._points[2],o=this._manifold._points[3],r=_._depth,e=0;n._depth>r&&(r=n._depth,e=1),l._depth>r&&(r=l._depth,e=2),o._depth>r&&(e=3);let a,h,b,X=t.position1;a=X.x,h=X.y,b=X.z,a-=i._positionX,h-=i._positionY,b-=i._positionZ;let c=n._relPos1X,u=n._relPos1Y,p=n._relPos1Z,x=l._relPos1X,v=l._relPos1Y,f=l._relPos1Z,g=o._relPos1X,V=o._relPos1Y,Z=o._relPos1Z,I,M,y,d,B,R,k,A,z,w,S,P,T,C,L,q,U,Y;I=x-c,M=v-u,y=f-p,d=a-g,B=h-V,R=b-Z,k=g-c,A=V-u,z=Z-p,w=a-x,S=h-v,P=b-f,T=a-c,C=h-u,L=b-p,q=g-x,U=V-v,Y=Z-f;let E,D,Q,W,F,H,G,J,N;E=M*R-y*B,D=y*d-I*R,Q=I*B-M*d,W=A*P-z*S,F=z*w-k*P,H=k*S-A*w,G=C*Y-L*U,J=L*q-T*Y,N=T*U-C*q;let K=E*E+D*D+Q*Q,O=W*W+F*F+H*H,$=G*G+J*J+N*N,et=_._relPos1X,st=_._relPos1Y,lt=_._relPos1Z,rt=l._relPos1X,at=l._relPos1Y,_t=l._relPos1Z,ht=o._relPos1X,ot=o._relPos1Y,bt=o._relPos1Z,Xt,ft,ut,xt,zt,gt,pt,ct,nt,tt,kt,Bt,Mt,Rt,ci,Xi,gi,ki;Xt=rt-et,ft=at-st,ut=_t-lt,xt=a-ht,zt=h-ot,gt=b-bt,pt=ht-et,ct=ot-st,nt=bt-lt,tt=a-rt,kt=h-at,Bt=b-_t,Mt=a-et,Rt=h-st,ci=b-lt,Xi=ht-rt,gi=ot-at,ki=bt-_t;let wi,ei,Nt,At,ni,di,Oi,Bi,Vt;wi=ft*gt-ut*zt,ei=ut*xt-Xt*gt,Nt=Xt*zt-ft*xt,At=ct*Bt-nt*kt,ni=nt*tt-pt*Bt,di=pt*kt-ct*tt,Oi=Rt*ki-ci*gi,Bi=ci*Xi-Mt*ki,Vt=Mt*gi-Rt*Xi;let wt=wi*wi+ei*ei+Nt*Nt,$t=At*At+ni*ni+di*di,fi=Oi*Oi+Bi*Bi+Vt*Vt,Zi=wt>$t?wt>fi?wt:fi:$t>fi?$t:fi,it=_._relPos1X,Ut=_._relPos1Y,ii=_._relPos1Z,j=n._relPos1X,Jt=n._relPos1Y,Pt=n._relPos1Z,si=o._relPos1X,_i=o._relPos1Y,St=o._relPos1Z,ai,qi,ui,Yt,yt,vt,yi,Ii,bi,se,me,Ei,he,ve,oi,ce,be,xe;ai=j-it,qi=Jt-Ut,ui=Pt-ii,Yt=a-si,yt=h-_i,vt=b-St,yi=si-it,Ii=_i-Ut,bi=St-ii,se=a-j,me=h-Jt,Ei=b-Pt,he=a-it,ve=h-Ut,oi=b-ii,ce=si-j,be=_i-Jt,xe=St-Pt;let Ye,Ni,Ji,Hi,_e,ne,Ki,ie,Ui;Ye=qi*vt-ui*yt,Ni=ui*Yt-ai*vt,Ji=ai*yt-qi*Yt,Hi=Ii*Ei-bi*me,_e=bi*se-yi*Ei,ne=yi*me-Ii*se,Ki=ve*xe-oi*be,ie=oi*ce-he*xe,Ui=he*be-ve*ce;let Wi=Ye*Ye+Ni*Ni+Ji*Ji,Si=Hi*Hi+_e*_e+ne*ne,Ht=Ki*Ki+ie*ie+Ui*Ui,ri=Wi>Si?Wi>Ht?Wi:Ht:Si>Ht?Si:Ht,Tt=_._relPos1X,Mi=_._relPos1Y,zi=_._relPos1Z,Pi=n._relPos1X,Vi=n._relPos1Y,ji=n._relPos1Z,Gt=l._relPos1X,dt=l._relPos1Y,Lt=l._relPos1Z,Ai,Li,Di,$i,ae,re,pe,ti,Fi,vi,Ti,mi,Ct,jt,hi,qt,mt,Zt;Ai=Pi-Tt,Li=Vi-Mi,Di=ji-zi,$i=a-Gt,ae=h-dt,re=b-Lt,pe=Gt-Tt,ti=dt-Mi,Fi=Lt-zi,vi=a-Pi,Ti=h-Vi,mi=b-ji,Ct=a-Tt,jt=h-Mi,hi=b-zi,qt=Gt-Pi,mt=dt-Vi,Zt=Lt-ji;let Et,Ft,Wt,Kt,li,Yi,pi,Ot,It;Et=Li*re-Di*ae,Ft=Di*$i-Ai*re,Wt=Ai*ae-Li*$i,Kt=ti*mi-Fi*Ti,li=Fi*vi-pe*mi,Yi=pe*Ti-ti*vi,pi=jt*Zt-hi*mt,Ot=hi*qt-Ct*Zt,It=Ct*mt-jt*qt;let Qt=Et*Et+Ft*Ft+Wt*Wt,xi=Kt*Kt+li*li+Yi*Yi,Ri=pi*pi+Ot*Ot+It*It,ee=Qt>xi?Qt>Ri?Qt:Ri:xi>Ri?xi:Ri,oe=K>O?K>$?K:$:O>$?O:$,Qi=0;return(Zi>oe&&e!=1||e==0)&&(oe=Zi,Qi=1),ri>oe&&e!=2&&(oe=ri,Qi=2),ee>oe&&e!=3&&(Qi=3),Qi}computeRelativePositions(t,i){let s=this._manifold._numPoints,_=0;for(;_<s;){let n=this._manifold._points[_++],l,o,r;l=t._rotation00*n._localPos1X+t._rotation01*n._localPos1Y+t._rotation02*n._localPos1Z,o=t._rotation10*n._localPos1X+t._rotation11*n._localPos1Y+t._rotation12*n._localPos1Z,r=t._rotation20*n._localPos1X+t._rotation21*n._localPos1Y+t._rotation22*n._localPos1Z,n._relPos1X=l,n._relPos1Y=o,n._relPos1Z=r;let e,a,h;e=i._rotation00*n._localPos2X+i._rotation01*n._localPos2Y+i._rotation02*n._localPos2Z,a=i._rotation10*n._localPos2X+i._rotation11*n._localPos2Y+i._rotation12*n._localPos2Z,h=i._rotation20*n._localPos2X+i._rotation21*n._localPos2Y+i._rotation22*n._localPos2Z,n._relPos2X=e,n._relPos2Y=a,n._relPos2Z=h,n._warmStarted=!0}}findNearestContactPointIndex(t,i,s){let _=m.common.Setting.contactPersistenceThreshold*m.common.Setting.contactPersistenceThreshold,n=-1,l=0,o=this._manifold._numPoints;for(;l<o;){let r=l++,e=this._manifold._points[r],a,h,b,X,c,u,p=t.position1;a=p.x,h=p.y,b=p.z;let x=t.position2;X=x.x,c=x.y,u=x.z,a-=i._positionX,h-=i._positionY,b-=i._positionZ,X-=s._positionX,c-=s._positionY,u-=s._positionZ;let v,f,g,V,Z,I;v=e._relPos1X-a,f=e._relPos1Y-h,g=e._relPos1Z-b,V=e._relPos2X-X,Z=e._relPos2Y-c,I=e._relPos2Z-u;let M=v*v+f*f+g*g,y=V*V+Z*Z+I*I,d=M<y?M:y;d<_&&(_=d,n=r)}return n}totalUpdate(t,i,s){this.numOldPoints=this._manifold._numPoints;let _=0,n=this.numOldPoints;for(;_<n;){let r=_++,e=this.oldPoints[r],a=this._manifold._points[r];e._localPos1X=a._localPos1X,e._localPos1Y=a._localPos1Y,e._localPos1Z=a._localPos1Z,e._localPos2X=a._localPos2X,e._localPos2Y=a._localPos2Y,e._localPos2Z=a._localPos2Z,e._relPos1X=a._relPos1X,e._relPos1Y=a._relPos1Y,e._relPos1Z=a._relPos1Z,e._relPos2X=a._relPos2X,e._relPos2Y=a._relPos2Y,e._relPos2Z=a._relPos2Z,e._pos1X=a._pos1X,e._pos1Y=a._pos1Y,e._pos1Z=a._pos1Z,e._pos2X=a._pos2X,e._pos2Y=a._pos2Y,e._pos2Z=a._pos2Z,e._depth=a._depth,e._impulse.copyFrom(a._impulse),e._id=a._id,e._warmStarted=a._warmStarted,e._disabled=!1}let l=t.numPoints;this._manifold._numPoints=l;let o=0;for(;o<l;){let r=o++,e=this._manifold._points[r],a=t.points[r],h=a.position1;e._pos1X=h.x,e._pos1Y=h.y,e._pos1Z=h.z;let b=a.position2;e._pos2X=b.x,e._pos2Y=b.y,e._pos2Z=b.z,e._relPos1X=e._pos1X-i._positionX,e._relPos1Y=e._pos1Y-i._positionY,e._relPos1Z=e._pos1Z-i._positionZ,e._relPos2X=e._pos2X-s._positionX,e._relPos2Y=e._pos2Y-s._positionY,e._relPos2Z=e._pos2Z-s._positionZ;let X,c,u;X=i._rotation00*e._relPos1X+i._rotation10*e._relPos1Y+i._rotation20*e._relPos1Z,c=i._rotation01*e._relPos1X+i._rotation11*e._relPos1Y+i._rotation21*e._relPos1Z,u=i._rotation02*e._relPos1X+i._rotation12*e._relPos1Y+i._rotation22*e._relPos1Z,e._localPos1X=X,e._localPos1Y=c,e._localPos1Z=u;let p,x,v;p=s._rotation00*e._relPos2X+s._rotation10*e._relPos2Y+s._rotation20*e._relPos2Z,x=s._rotation01*e._relPos2X+s._rotation11*e._relPos2Y+s._rotation21*e._relPos2Z,v=s._rotation02*e._relPos2X+s._rotation12*e._relPos2Y+s._rotation22*e._relPos2Z,e._localPos2X=p,e._localPos2Y=x,e._localPos2Z=v,e._depth=a.depth;let f=e._impulse;f.impulseN=0,f.impulseT=0,f.impulseB=0,f.impulseP=0,f.impulseLX=0,f.impulseLY=0,f.impulseLZ=0,e._id=a.id,e._warmStarted=!1,e._disabled=!1;let g=0,V=this.numOldPoints;for(;g<V;){let Z=this.oldPoints[g++];if(e._id==Z._id){e._impulse.copyFrom(Z._impulse),e._warmStarted=!0;break}}}}incrementalUpdate(t,i,s){this._manifold._updateDepthsAndPositions(i,s);let _=0,n=this._manifold._numPoints;for(;_<n;)this._manifold._points[_++]._warmStarted=!0;let l=t.points[0],o=this.findNearestContactPointIndex(l,i,s);if(o==-1)this.addManifoldPoint(l,i,s);else{let r=this._manifold._points[o],e=l.position1;r._pos1X=e.x,r._pos1Y=e.y,r._pos1Z=e.z;let a=l.position2;r._pos2X=a.x,r._pos2Y=a.y,r._pos2Z=a.z,r._relPos1X=r._pos1X-i._positionX,r._relPos1Y=r._pos1Y-i._positionY,r._relPos1Z=r._pos1Z-i._positionZ,r._relPos2X=r._pos2X-s._positionX,r._relPos2Y=r._pos2Y-s._positionY,r._relPos2Z=r._pos2Z-s._positionZ;let h,b,X;h=i._rotation00*r._relPos1X+i._rotation10*r._relPos1Y+i._rotation20*r._relPos1Z,b=i._rotation01*r._relPos1X+i._rotation11*r._relPos1Y+i._rotation21*r._relPos1Z,X=i._rotation02*r._relPos1X+i._rotation12*r._relPos1Y+i._rotation22*r._relPos1Z,r._localPos1X=h,r._localPos1Y=b,r._localPos1Z=X;let c,u,p;c=s._rotation00*r._relPos2X+s._rotation10*r._relPos2Y+s._rotation20*r._relPos2Z,u=s._rotation01*r._relPos2X+s._rotation11*r._relPos2Y+s._rotation21*r._relPos2Z,p=s._rotation02*r._relPos2X+s._rotation12*r._relPos2Y+s._rotation22*r._relPos2Z,r._localPos2X=c,r._localPos2Y=u,r._localPos2Z=p,r._depth=l.depth}this.removeOutdatedPoints()}};m.dynamics.constraint.info||(m.dynamics.constraint.info={});m.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,(!(this.lin1X==0&&this.lin1Y==0&&this.lin1Z==0)||!(this.lin2X==0&&this.lin2Y==0&&this.lin2Z==0))&&(this.flag|=1),(!(this.ang1X==0&&this.ang1Y==0&&this.ang1Z==0)||!(this.ang2X==0&&this.ang2Y==0&&this.ang2Z==0))&&(this.flag|=2)}};m.dynamics.constraint.info.contact||(m.dynamics.constraint.info.contact={});m.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(m.common.Setting.maxManifoldPoints);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new m.dynamics.constraint.info.contact.ContactSolverInfoRow}};m.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new m.dynamics.constraint.info.JacobianRow,this.jacobianT=new m.dynamics.constraint.info.JacobianRow,this.jacobianB=new m.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}};m.dynamics.constraint.info.joint||(m.dynamics.constraint.info.joint={});m.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(m.common.Setting.maxJacobianRows);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new m.dynamics.constraint.info.joint.JointSolverInfoRow}};m.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new m.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}};m.dynamics.constraint.joint||(m.dynamics.constraint.joint={});m.dynamics.constraint.joint.BasisTracker=class{constructor(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}};m.dynamics.constraint.joint.Joint=class{constructor(t,i){switch(this._link1=new m.dynamics.constraint.joint.JointLink(this),this._link2=new m.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=m.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=i,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new m.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new m.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this);break}let s=t.localAnchor1;this._localAnchor1X=s.x,this._localAnchor1Y=s.y,this._localAnchor1Z=s.z;let _=t.localAnchor2;this._localAnchor2X=_.x,this._localAnchor2Y=_.y,this._localAnchor2Z=_.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0,this._impulses=new Array(m.common.Setting.maxJacobianRows);let n=0,l=m.common.Setting.maxJacobianRows;for(;n<l;)this._impulses[n++]=new m.dynamics.constraint.joint.JointImpulse}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let G=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;G>0&&(G=1/Math.sqrt(G)),this._localBasisX1X*=G,this._localBasisX1Y*=G,this._localBasisX1Z*=G}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let G=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;G>0&&(G=1/Math.sqrt(G)),this._localBasisX2X*=G,this._localBasisX2Y*=G,this._localBasisX2Z*=G}let t,i,s,_,n,l,o,r,e,a,h,b,X,c=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(c<-.999999999){let G,J,N,K=this._localBasisX1X,O=this._localBasisX1Y,$=this._localBasisX1Z,et=K*K,st=O*O,lt=$*$,rt;et<st?et<lt?(rt=1/Math.sqrt(st+lt),G=0,J=$*rt,N=-O*rt):(rt=1/Math.sqrt(et+st),G=O*rt,J=-K*rt,N=0):st<lt?(rt=1/Math.sqrt(lt+et),G=-$*rt,J=0,N=K*rt):(rt=1/Math.sqrt(et+st),G=O*rt,J=-K*rt,N=0),t=G,i=J,s=N,_=0}else{let G,J,N;G=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,J=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,N=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let K=Math.sqrt((1+c)*.5);c=.5/K,G*=c,J*=c,N*=c,t=G,i=J,s=N,_=K}let u=t,p=i,x=s,v=_,f=2*u,g=2*p,V=2*x,Z=u*f,I=p*g,M=x*V,y=u*g,d=p*V,B=u*V,R=v*f,k=v*g,A=v*V;n=1-I-M,l=y-A,o=B+k,r=y+A,e=1-Z-M,a=d-R,h=B-k,b=d+R,X=1-Z-I;let z=this._localBasisX1X,w=this._localBasisX1Y,S=this._localBasisX1Z,P=z*z,T=w*w,C=S*S,L;P<T?P<C?(L=1/Math.sqrt(T+C),this._localBasisY1X=0,this._localBasisY1Y=S*L,this._localBasisY1Z=-w*L):(L=1/Math.sqrt(P+T),this._localBasisY1X=w*L,this._localBasisY1Y=-z*L,this._localBasisY1Z=0):T<C?(L=1/Math.sqrt(C+P),this._localBasisY1X=-S*L,this._localBasisY1Y=0,this._localBasisY1Z=z*L):(L=1/Math.sqrt(P+T),this._localBasisY1X=w*L,this._localBasisY1Y=-z*L,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;let q,U,Y;q=n*this._localBasisX1X+l*this._localBasisX1Y+o*this._localBasisX1Z,U=r*this._localBasisX1X+e*this._localBasisX1Y+a*this._localBasisX1Z,Y=h*this._localBasisX1X+b*this._localBasisX1Y+X*this._localBasisX1Z,this._localBasisX2X=q,this._localBasisX2Y=U,this._localBasisX2Z=Y;let E,D,Q;E=n*this._localBasisY1X+l*this._localBasisY1Y+o*this._localBasisY1Z,D=r*this._localBasisY1X+e*this._localBasisY1Y+a*this._localBasisY1Z,Q=h*this._localBasisY1X+b*this._localBasisY1Y+X*this._localBasisY1Z,this._localBasisY2X=E,this._localBasisY2Y=D,this._localBasisY2Z=Q;let W,F,H;W=n*this._localBasisZ1X+l*this._localBasisZ1Y+o*this._localBasisZ1Z,F=r*this._localBasisZ1X+e*this._localBasisZ1Y+a*this._localBasisZ1Z,H=h*this._localBasisZ1X+b*this._localBasisZ1Y+X*this._localBasisZ1Z,this._localBasisZ2X=W,this._localBasisZ2Y=F,this._localBasisZ2Z=H}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t=this._localBasisX1X,i=this._localBasisX1Y,s=this._localBasisX1Z,_=t*t,n=i*i,l=s*s,o;_<n?_<l?(o=1/Math.sqrt(n+l),this._localBasisY1X=0,this._localBasisY1Y=s*o,this._localBasisY1Z=-i*o):(o=1/Math.sqrt(_+n),this._localBasisY1X=i*o,this._localBasisY1Y=-t*o,this._localBasisY1Z=0):n<l?(o=1/Math.sqrt(l+_),this._localBasisY1X=-s*o,this._localBasisY1Y=0,this._localBasisY1Z=t*o):(o=1/Math.sqrt(_+n),this._localBasisY1X=i*o,this._localBasisY1Y=-t*o,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){let t=this._localBasisX2X,i=this._localBasisX2Y,s=this._localBasisX2Z,_=t*t,n=i*i,l=s*s,o;_<n?_<l?(o=1/Math.sqrt(n+l),this._localBasisY2X=0,this._localBasisY2Y=s*o,this._localBasisY2Z=-i*o):(o=1/Math.sqrt(_+n),this._localBasisY2X=i*o,this._localBasisY2Y=-t*o,this._localBasisY2Z=0):n<l?(o=1/Math.sqrt(l+_),this._localBasisY2X=-s*o,this._localBasisY2Y=0,this._localBasisY2Z=t*o):(o=1/Math.sqrt(_+n),this._localBasisY2X=i*o,this._localBasisY2Y=-t*o,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let D=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;D>0&&(D=1/Math.sqrt(D)),this._localBasisX1X*=D,this._localBasisX1Y*=D,this._localBasisX1Z*=D}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{let D=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;D>0&&(D=1/Math.sqrt(D)),this._localBasisZ2X*=D,this._localBasisZ2Y*=D,this._localBasisZ2Z*=D}let t=this._b1._transform,i=this._b2._transform,s,_,n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g;v=t._rotation00*this._localBasisX1X+t._rotation01*this._localBasisX1Y+t._rotation02*this._localBasisX1Z,f=t._rotation10*this._localBasisX1X+t._rotation11*this._localBasisX1Y+t._rotation12*this._localBasisX1Z,g=t._rotation20*this._localBasisX1X+t._rotation21*this._localBasisX1Y+t._rotation22*this._localBasisX1Z,s=v,_=f,n=g;let V,Z,I;if(V=i._rotation00*this._localBasisZ2X+i._rotation01*this._localBasisZ2Y+i._rotation02*this._localBasisZ2Z,Z=i._rotation10*this._localBasisZ2X+i._rotation11*this._localBasisZ2Y+i._rotation12*this._localBasisZ2Z,I=i._rotation20*this._localBasisZ2X+i._rotation21*this._localBasisZ2Y+i._rotation22*this._localBasisZ2Z,u=V,p=Z,x=I,e=p*n-x*_,a=x*s-u*n,h=u*_-p*s,e*e+a*a+h*h==0){let D=s,Q=_,W=n,F=D*D,H=Q*Q,G=W*W,J;F<H?F<G?(J=1/Math.sqrt(H+G),e=0,a=W*J,h=-Q*J):(J=1/Math.sqrt(F+H),e=Q*J,a=-D*J,h=0):H<G?(J=1/Math.sqrt(G+F),e=-W*J,a=0,h=D*J):(J=1/Math.sqrt(F+H),e=Q*J,a=-D*J,h=0)}l=_*h-n*a,o=n*e-s*h,r=s*a-_*e,b=a*x-h*p,X=h*u-e*x,c=e*p-a*u;let M,y,d;M=t._rotation00*s+t._rotation10*_+t._rotation20*n,y=t._rotation01*s+t._rotation11*_+t._rotation21*n,d=t._rotation02*s+t._rotation12*_+t._rotation22*n,this._localBasisX1X=M,this._localBasisX1Y=y,this._localBasisX1Z=d;let B,R,k;B=t._rotation00*e+t._rotation10*a+t._rotation20*h,R=t._rotation01*e+t._rotation11*a+t._rotation21*h,k=t._rotation02*e+t._rotation12*a+t._rotation22*h,this._localBasisY1X=B,this._localBasisY1Y=R,this._localBasisY1Z=k;let A,z,w;A=t._rotation00*l+t._rotation10*o+t._rotation20*r,z=t._rotation01*l+t._rotation11*o+t._rotation21*r,w=t._rotation02*l+t._rotation12*o+t._rotation22*r,this._localBasisZ1X=A,this._localBasisZ1Y=z,this._localBasisZ1Z=w;let S,P,T;S=i._rotation00*b+i._rotation10*X+i._rotation20*c,P=i._rotation01*b+i._rotation11*X+i._rotation21*c,T=i._rotation02*b+i._rotation12*X+i._rotation22*c,this._localBasisX2X=S,this._localBasisX2Y=P,this._localBasisX2Z=T;let C,L,q;C=i._rotation00*e+i._rotation10*a+i._rotation20*h,L=i._rotation01*e+i._rotation11*a+i._rotation21*h,q=i._rotation02*e+i._rotation12*a+i._rotation22*h,this._localBasisY2X=C,this._localBasisY2Y=L,this._localBasisY2Z=q;let U,Y,E;U=i._rotation00*u+i._rotation10*p+i._rotation20*x,Y=i._rotation01*u+i._rotation11*p+i._rotation21*x,E=i._rotation02*u+i._rotation12*p+i._rotation22*x,this._localBasisZ2X=U,this._localBasisZ2Y=Y,this._localBasisZ2Z=E}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let Y=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;Y>0&&(Y=1/Math.sqrt(Y)),this._localBasisX1X*=Y,this._localBasisX1Y*=Y,this._localBasisX1Z*=Y}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let Y=this._localBasisX1X,E=this._localBasisX1Y,D=this._localBasisX1Z,Q=Y*Y,W=E*E,F=D*D,H;Q<W?Q<F?(H=1/Math.sqrt(W+F),this._localBasisY1X=0,this._localBasisY1Y=D*H,this._localBasisY1Z=-E*H):(H=1/Math.sqrt(Q+W),this._localBasisY1X=E*H,this._localBasisY1Y=-Y*H,this._localBasisY1Z=0):W<F?(H=1/Math.sqrt(F+Q),this._localBasisY1X=-D*H,this._localBasisY1Y=0,this._localBasisY1Z=Y*H):(H=1/Math.sqrt(Q+W),this._localBasisY1X=E*H,this._localBasisY1Y=-Y*H,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let Y=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;Y>0&&(Y=1/Math.sqrt(Y)),this._localBasisZ1X*=Y,this._localBasisZ1Y*=Y,this._localBasisZ1Z*=Y,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}let t,i,s,_,n,l,o,r,e,a,h,b,X,c=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(c<-.999999999){let Y,E,D,Q=this._localBasisX1X,W=this._localBasisX1Y,F=this._localBasisX1Z,H=Q*Q,G=W*W,J=F*F,N;H<G?H<J?(N=1/Math.sqrt(G+J),Y=0,E=F*N,D=-W*N):(N=1/Math.sqrt(H+G),Y=W*N,E=-Q*N,D=0):G<J?(N=1/Math.sqrt(J+H),Y=-F*N,E=0,D=Q*N):(N=1/Math.sqrt(H+G),Y=W*N,E=-Q*N,D=0),t=Y,i=E,s=D,_=0}else{let Y,E,D;Y=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,E=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,D=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let Q=Math.sqrt((1+c)*.5);c=.5/Q,Y*=c,E*=c,D*=c,t=Y,i=E,s=D,_=Q}let u=t,p=i,x=s,v=_,f=2*u,g=2*p,V=2*x,Z=u*f,I=p*g,M=x*V,y=u*g,d=p*V,B=u*V,R=v*f,k=v*g,A=v*V;n=1-I-M,l=y-A,o=B+k,r=y+A,e=1-Z-M,a=d-R,h=B-k,b=d+R,X=1-Z-I;let z,w,S;z=n*this._localBasisX1X+l*this._localBasisX1Y+o*this._localBasisX1Z,w=r*this._localBasisX1X+e*this._localBasisX1Y+a*this._localBasisX1Z,S=h*this._localBasisX1X+b*this._localBasisX1Y+X*this._localBasisX1Z,this._localBasisX2X=z,this._localBasisX2Y=w,this._localBasisX2Z=S;let P,T,C;P=n*this._localBasisY1X+l*this._localBasisY1Y+o*this._localBasisY1Z,T=r*this._localBasisY1X+e*this._localBasisY1Y+a*this._localBasisY1Z,C=h*this._localBasisY1X+b*this._localBasisY1Y+X*this._localBasisY1Z,this._localBasisY2X=P,this._localBasisY2Y=T,this._localBasisY2Z=C;let L,q,U;L=n*this._localBasisZ1X+l*this._localBasisZ1Y+o*this._localBasisZ1Z,q=r*this._localBasisZ1X+e*this._localBasisZ1Y+a*this._localBasisZ1Z,U=h*this._localBasisZ1X+b*this._localBasisZ1Y+X*this._localBasisZ1Z,this._localBasisZ2X=L,this._localBasisZ2Y=q,this._localBasisZ2Z=U}setSolverInfoRowLinear(t,i,s,_,n,l,o){let r,e,a=m.common.Setting.linearSlop;if(o)r=0,e=1;else{if(n.frequency>0){a=0;let p=6.28318530717958*n.frequency,x=n.dampingRatio;x<m.common.Setting.minSpringDamperDampingRatio&&(x=m.common.Setting.minSpringDamperDampingRatio);let v=l.dt,f=2*x*p,g=p*p;n.useSymplecticEuler?(r=1/(v*f),e=g/f):(r=1/(v*(v*g+f)),e=g/(v*g+f))}else r=0,e=this.getErp(l,!1);s.motorForce>0?(t.motorSpeed=s.motorSpeed,t.motorMaxImpulse=s.motorForce*l.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let h=s.lowerLimit,b=s.upperLimit,X,c,u;h>b?(X=0,c=0,u=0):h==b?(X=-1/0,c=1/0,u=i-h):i<h?(X=-1/0,c=0,u=i-h+a,u>0&&(u=0)):i>b?(X=0,c=1/0,u=i-b-a,u<0&&(u=0)):(X=0,c=0,u=0),t.minImpulse=X,t.maxImpulse=c,t.cfm=r*(_==0?0:1/_),t.rhs=u*e}setSolverInfoRowAngular(t,i,s,_,n,l,o){let r,e,a=m.common.Setting.angularSlop;if(o)r=0,e=1;else{if(n.frequency>0){a=0;let x=6.28318530717958*n.frequency,v=n.dampingRatio;v<m.common.Setting.minSpringDamperDampingRatio&&(v=m.common.Setting.minSpringDamperDampingRatio);let f=l.dt,g=2*v*x,V=x*x;n.useSymplecticEuler?(r=1/(f*g),e=V/g):(r=1/(f*(f*V+g)),e=V/(f*V+g))}else r=0,e=this.getErp(l,!1);s.motorTorque>0?(t.motorSpeed=s.motorSpeed,t.motorMaxImpulse=s.motorTorque*l.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let h=s.lowerLimit,b=s.upperLimit,X=(h+b)*.5;i-=X,i=((i+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,i+=X;let c,u,p;h>b?(c=0,u=0,p=0):h==b?(c=-1/0,u=1/0,p=i-h):i<h?(c=-1/0,u=0,p=i-h+a,p>0&&(p=0)):i>b?(c=0,u=1/0,p=i-b-a,p<0&&(p=0)):(c=0,u=0,p=0),t.minImpulse=c,t.maxImpulse=u,t.cfm=r*(_==0?0:1/_),t.rhs=p*e}getErp(t,i){return i?1:this._positionCorrectionAlgorithm==m.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*m.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(t,i,s){let _,n,l,o,r,e,a,h,b;a=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*s,h=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*s,b=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*s,_=a,n=h,l=b;let X,c,u;X=this._b2._invInertia00*t+this._b2._invInertia01*i+this._b2._invInertia02*s,c=this._b2._invInertia10*t+this._b2._invInertia11*i+this._b2._invInertia12*s,u=this._b2._invInertia20*t+this._b2._invInertia21*i+this._b2._invInertia22*s,o=X,r=c,e=u;let p=_*t+n*i+l*s,x=o*t+r*i+e*s;if(p>0){let v=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+s*this._relativeAnchor1Z,f=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z-v*v;f>0&&(this._b1._invMass>0?p=1/(1/p+this._b1._mass*f):p=0)}if(x>0){let v=t*this._relativeAnchor2X+i*this._relativeAnchor2Y+s*this._relativeAnchor2Z,f=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z-v*v;f>0&&(this._b2._invMass>0?x=1/(1/x+this._b2._mass*f):x=0)}return p+x==0?0:1/(p+x)}computeEffectiveInertiaMoment2(t,i,s,_,n,l){let o,r,e,a,h,b,X,c,u;X=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*s,c=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*s,u=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*s,o=X,r=c,e=u;let p,x,v;p=this._b2._invInertia00*_+this._b2._invInertia01*n+this._b2._invInertia02*l,x=this._b2._invInertia10*_+this._b2._invInertia11*n+this._b2._invInertia12*l,v=this._b2._invInertia20*_+this._b2._invInertia21*n+this._b2._invInertia22*l,a=p,h=x,b=v;let f=o*t+r*i+e*s,g=a*_+h*n+b*l;if(f>0){let V=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,Z=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+s*this._relativeAnchor1Z,I=V*V-Z*Z;I>0&&(this._b1._invMass>0?f=1/(1/f+this._b1._mass*I):f=0)}if(g>0){let V=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,Z=_*this._relativeAnchor2X+n*this._relativeAnchor2Y+l*this._relativeAnchor2Z,I=V*V-Z*Z;I>0&&(this._b2._invMass>0?g=1/(1/g+this._b2._mass*I):g=0)}return f+g==0?0:1/(f+g)}_syncAnchors(){let t=this._b1._transform,i=this._b2._transform,s,_,n;s=t._rotation00*this._localAnchor1X+t._rotation01*this._localAnchor1Y+t._rotation02*this._localAnchor1Z,_=t._rotation10*this._localAnchor1X+t._rotation11*this._localAnchor1Y+t._rotation12*this._localAnchor1Z,n=t._rotation20*this._localAnchor1X+t._rotation21*this._localAnchor1Y+t._rotation22*this._localAnchor1Z,this._relativeAnchor1X=s,this._relativeAnchor1Y=_,this._relativeAnchor1Z=n;let l,o,r;l=i._rotation00*this._localAnchor2X+i._rotation01*this._localAnchor2Y+i._rotation02*this._localAnchor2Z,o=i._rotation10*this._localAnchor2X+i._rotation11*this._localAnchor2Y+i._rotation12*this._localAnchor2Z,r=i._rotation20*this._localAnchor2X+i._rotation21*this._localAnchor2Y+i._rotation22*this._localAnchor2Z,this._relativeAnchor2X=l,this._relativeAnchor2Y=o,this._relativeAnchor2Z=r,this._anchor1X=this._relativeAnchor1X+t._positionX,this._anchor1Y=this._relativeAnchor1Y+t._positionY,this._anchor1Z=this._relativeAnchor1Z+t._positionZ,this._anchor2X=this._relativeAnchor2X+i._positionX,this._anchor2Y=this._relativeAnchor2Y+i._positionY,this._anchor2Z=this._relativeAnchor2Z+i._positionZ;let e,a,h;e=t._rotation00*this._localBasisX1X+t._rotation01*this._localBasisX1Y+t._rotation02*this._localBasisX1Z,a=t._rotation10*this._localBasisX1X+t._rotation11*this._localBasisX1Y+t._rotation12*this._localBasisX1Z,h=t._rotation20*this._localBasisX1X+t._rotation21*this._localBasisX1Y+t._rotation22*this._localBasisX1Z,this._basisX1X=e,this._basisX1Y=a,this._basisX1Z=h;let b,X,c;b=t._rotation00*this._localBasisY1X+t._rotation01*this._localBasisY1Y+t._rotation02*this._localBasisY1Z,X=t._rotation10*this._localBasisY1X+t._rotation11*this._localBasisY1Y+t._rotation12*this._localBasisY1Z,c=t._rotation20*this._localBasisY1X+t._rotation21*this._localBasisY1Y+t._rotation22*this._localBasisY1Z,this._basisY1X=b,this._basisY1Y=X,this._basisY1Z=c;let u,p,x;u=t._rotation00*this._localBasisZ1X+t._rotation01*this._localBasisZ1Y+t._rotation02*this._localBasisZ1Z,p=t._rotation10*this._localBasisZ1X+t._rotation11*this._localBasisZ1Y+t._rotation12*this._localBasisZ1Z,x=t._rotation20*this._localBasisZ1X+t._rotation21*this._localBasisZ1Y+t._rotation22*this._localBasisZ1Z,this._basisZ1X=u,this._basisZ1Y=p,this._basisZ1Z=x;let v,f,g;v=i._rotation00*this._localBasisX2X+i._rotation01*this._localBasisX2Y+i._rotation02*this._localBasisX2Z,f=i._rotation10*this._localBasisX2X+i._rotation11*this._localBasisX2Y+i._rotation12*this._localBasisX2Z,g=i._rotation20*this._localBasisX2X+i._rotation21*this._localBasisX2Y+i._rotation22*this._localBasisX2Z,this._basisX2X=v,this._basisX2Y=f,this._basisX2Z=g;let V,Z,I;V=i._rotation00*this._localBasisY2X+i._rotation01*this._localBasisY2Y+i._rotation02*this._localBasisY2Z,Z=i._rotation10*this._localBasisY2X+i._rotation11*this._localBasisY2Y+i._rotation12*this._localBasisY2Z,I=i._rotation20*this._localBasisY2X+i._rotation21*this._localBasisY2Y+i._rotation22*this._localBasisY2Z,this._basisY2X=V,this._basisY2Y=Z,this._basisY2Z=I;let M,y,d;M=i._rotation00*this._localBasisZ2X+i._rotation01*this._localBasisZ2Y+i._rotation02*this._localBasisZ2Z,y=i._rotation10*this._localBasisZ2X+i._rotation11*this._localBasisZ2Y+i._rotation12*this._localBasisZ2Z,d=i._rotation20*this._localBasisZ2X+i._rotation21*this._localBasisZ2Y+i._rotation22*this._localBasisZ2Z,this._basisZ2X=M,this._basisZ2Y=y,this._basisZ2Z=d}_getVelocitySolverInfo(t,i){i.b1=this._b1,i.b2=this._b2,i.numRows=0}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_checkDestruction(){let t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;if(this._breakForce>0&&this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ>this._breakForce*this._breakForce){this._world.removeJoint(this);return}if(this._breakTorque>0&&t>this._breakTorque*this._breakTorque){this._world.removeJoint(this);return}}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){let t=new m.common.Vec3;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,t}getAnchor2(){let t=new m.common.Vec3;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,t}getAnchor1To(t){t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(t){t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){let t=new m.common.Vec3;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,t}getLocalAnchor2(){let t=new m.common.Vec3;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,t}getLocalAnchor1To(t){t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(t){t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){let t=new m.common.Mat3,i,s,_,n,l,o,r,e,a;return i=this._basisX1X,s=this._basisY1X,_=this._basisZ1X,n=this._basisX1Y,l=this._basisY1Y,o=this._basisZ1Y,r=this._basisX1Z,e=this._basisY1Z,a=this._basisZ1Z,t.e00=i,t.e01=s,t.e02=_,t.e10=n,t.e11=l,t.e12=o,t.e20=r,t.e21=e,t.e22=a,t}getBasis2(){let t=new m.common.Mat3,i,s,_,n,l,o,r,e,a;return i=this._basisX2X,s=this._basisY2X,_=this._basisZ2X,n=this._basisX2Y,l=this._basisY2Y,o=this._basisZ2Y,r=this._basisX2Z,e=this._basisY2Z,a=this._basisZ2Z,t.e00=i,t.e01=s,t.e02=_,t.e10=n,t.e11=l,t.e12=o,t.e20=r,t.e21=e,t.e22=a,t}getBasis1To(t){let i,s,_,n,l,o,r,e,a;i=this._basisX1X,s=this._basisY1X,_=this._basisZ1X,n=this._basisX1Y,l=this._basisY1Y,o=this._basisZ1Y,r=this._basisX1Z,e=this._basisY1Z,a=this._basisZ1Z,t.e00=i,t.e01=s,t.e02=_,t.e10=n,t.e11=l,t.e12=o,t.e20=r,t.e21=e,t.e22=a}getBasis2To(t){let i,s,_,n,l,o,r,e,a;i=this._basisX2X,s=this._basisY2X,_=this._basisZ2X,n=this._basisX2Y,l=this._basisY2Y,o=this._basisZ2Y,r=this._basisX2Z,e=this._basisY2Z,a=this._basisZ2Z,t.e00=i,t.e01=s,t.e02=_,t.e10=n,t.e11=l,t.e12=o,t.e20=r,t.e21=e,t.e22=a}getAllowCollision(){return this._allowCollision}setAllowCollision(t){this._allowCollision=t}getBreakForce(){return this._breakForce}setBreakForce(t){this._breakForce=t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t}getAppliedForce(){let t=new m.common.Vec3;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,t}getAppliedForceTo(t){t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){let t=new m.common.Vec3;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,t}getAppliedTorqueTo(t){t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.constraint.joint.CylindricalJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,2);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new m.dynamics.constraint.joint.BasisTracker(this),this._translSd=t.translationalSpringDamper.clone(),this._translLm=t.translationalLimitMotor.clone(),this._rotSd=t.rotationalSpringDamper.clone(),this._rotLm=t.rotationalLimitMotor.clone()}getInfo(t,i,s){let _=this.getErp(i,s),n=this.linearErrorY*_,l=this.linearErrorZ*_,o=this.angularErrorY*_,r=this.angularErrorZ*_,e,a=1/(this._b1._invMass+this._b2._invMass),h=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!s){let M=this._impulses[0],y=t.rows[t.numRows++],d=y.jacobian;d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=M,this.setSolverInfoRowLinear(y,this.translation,this._translLm,a,this._translSd,i,s),e=y.jacobian,e.lin1X=this._basis.xX,e.lin1Y=this._basis.xY,e.lin1Z=this._basis.xZ,e.lin2X=this._basis.xX,e.lin2Y=this._basis.xY,e.lin2Z=this._basis.xZ,e.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,e.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,e.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,e.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,e.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,e.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let b=this._impulses[1],X=t.rows[t.numRows++],c=X.jacobian;c.lin1X=0,c.lin1Y=0,c.lin1Z=0,c.lin2X=0,c.lin2Y=0,c.lin2Z=0,c.ang1X=0,c.ang1Y=0,c.ang1Z=0,c.ang2X=0,c.ang2Y=0,c.ang2Z=0,X.rhs=0,X.cfm=0,X.minImpulse=0,X.maxImpulse=0,X.motorSpeed=0,X.motorMaxImpulse=0,X.impulse=null,X.impulse=b,X.rhs=n,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,e=X.jacobian,e.lin1X=this._basis.yX,e.lin1Y=this._basis.yY,e.lin1Z=this._basis.yZ,e.lin2X=this._basis.yX,e.lin2Y=this._basis.yY,e.lin2Z=this._basis.yZ,e.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,e.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,e.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,e.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,e.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,e.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let u=this._impulses[2],p=t.rows[t.numRows++],x=p.jacobian;if(x.lin1X=0,x.lin1Y=0,x.lin1Z=0,x.lin2X=0,x.lin2Y=0,x.lin2Z=0,x.ang1X=0,x.ang1Y=0,x.ang1Z=0,x.ang2X=0,x.ang2Y=0,x.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=u,p.rhs=l,p.cfm=0,p.minImpulse=-1/0,p.maxImpulse=1/0,e=p.jacobian,e.lin1X=this._basis.zX,e.lin1Y=this._basis.zY,e.lin1Z=this._basis.zZ,e.lin2X=this._basis.zX,e.lin2Y=this._basis.zY,e.lin2Z=this._basis.zZ,e.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,e.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,e.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,e.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,e.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,e.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!s){let M=this._impulses[3],y=t.rows[t.numRows++],d=y.jacobian;d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=M,this.setSolverInfoRowAngular(y,this.angle,this._rotLm,h,this._rotSd,i,s),e=y.jacobian,e.ang1X=this._basis.xX,e.ang1Y=this._basis.xY,e.ang1Z=this._basis.xZ,e.ang2X=this._basis.xX,e.ang2Y=this._basis.xY,e.ang2Z=this._basis.xZ}let v=this._impulses[4],f=t.rows[t.numRows++],g=f.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=v,f.rhs=o,f.cfm=0,f.minImpulse=-1/0,f.maxImpulse=1/0,e=f.jacobian,e.ang1X=this._basis.yX,e.ang1Y=this._basis.yY,e.ang1Z=this._basis.yZ,e.ang2X=this._basis.yX,e.ang2Y=this._basis.yY,e.ang2Z=this._basis.yZ;let V=this._impulses[5],Z=t.rows[t.numRows++],I=Z.jacobian;I.lin1X=0,I.lin1Y=0,I.lin1Z=0,I.lin2X=0,I.lin2Y=0,I.lin2Z=0,I.ang1X=0,I.ang1Y=0,I.ang1Z=0,I.ang2X=0,I.ang2Y=0,I.ang2Z=0,Z.rhs=0,Z.cfm=0,Z.minImpulse=0,Z.maxImpulse=0,Z.motorSpeed=0,Z.motorMaxImpulse=0,Z.impulse=null,Z.impulse=V,Z.rhs=r,Z.cfm=0,Z.minImpulse=-1/0,Z.maxImpulse=1/0,e=Z.jacobian,e.ang1X=this._basis.zX,e.ang1Y=this._basis.zY,e.ang1Z=this._basis.zZ,e.ang2X=this._basis.zX,e.ang2Y=this._basis.zY,e.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t=this._basis,i=t.joint._b1._invMass,s=t.joint._b2._invMass,_,n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V,Z,I,M,y,d,B,R,k,A,z,w,S,P,T,C,L,q,U,Y=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(Y<-.999999999){let St,ai,qi,ui=t.joint._basisX1X,Yt=t.joint._basisX1Y,yt=t.joint._basisX1Z,vt=ui*ui,yi=Yt*Yt,Ii=yt*yt,bi;vt<yi?vt<Ii?(bi=1/Math.sqrt(yi+Ii),St=0,ai=yt*bi,qi=-Yt*bi):(bi=1/Math.sqrt(vt+yi),St=Yt*bi,ai=-ui*bi,qi=0):yi<Ii?(bi=1/Math.sqrt(Ii+vt),St=-yt*bi,ai=0,qi=ui*bi):(bi=1/Math.sqrt(vt+yi),St=Yt*bi,ai=-ui*bi,qi=0),_=St,n=ai,l=qi,o=0}else{let St,ai,qi;St=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,ai=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,qi=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let ui=Math.sqrt((1+Y)*.5);Y=.5/ui,St*=Y,ai*=Y,qi*=Y,_=St,n=ai,l=qi,o=ui}r=0,e=0,a=0,h=1;let E,D,Q,W,F,H,G,J;E=r,D=e,Q=a,W=h,F=_,H=n,G=l,J=o;let N=E*F+D*H+Q*G+W*J;if(N<0&&(N=-N,F=-F,H=-H,G=-G,J=-J),N>.999999){let St,ai,qi,ui;St=F-E,ai=H-D,qi=G-Q,ui=J-W,F=E+St*(i/(i+s)),H=D+ai*(i/(i+s)),G=Q+qi*(i/(i+s)),J=W+ui*(i/(i+s));let Yt=F*F+H*H+G*G+J*J;Yt>1e-32&&(Yt=1/Math.sqrt(Yt)),b=F*Yt,X=H*Yt,c=G*Yt,u=J*Yt}else{let St=i/(i+s)*Math.acos(N);F+=E*-N,H+=D*-N,G+=Q*-N,J+=W*-N;let ai=F*F+H*H+G*G+J*J;ai>1e-32&&(ai=1/Math.sqrt(ai)),F*=ai,H*=ai,G*=ai,J*=ai;let qi=Math.sin(St),ui=Math.cos(St);E*=ui,D*=ui,Q*=ui,W*=ui,b=E+F*qi,X=D+H*qi,c=Q+G*qi,u=W+J*qi}let K=b,O=X,$=c,et=u,st=2*K,lt=2*O,rt=2*$,at=K*st,_t=O*lt,ht=$*rt,ot=K*lt,bt=O*rt,Xt=K*rt,ft=et*st,ut=et*lt,xt=et*rt;p=1-_t-ht,x=ot-xt,v=Xt+ut,f=ot+xt,g=1-at-ht,V=bt-ft,Z=Xt-ut,I=bt+ft,M=1-at-_t;let zt,gt,pt;zt=p*t.joint._basisX1X+x*t.joint._basisX1Y+v*t.joint._basisX1Z,gt=f*t.joint._basisX1X+g*t.joint._basisX1Y+V*t.joint._basisX1Z,pt=Z*t.joint._basisX1X+I*t.joint._basisX1Y+M*t.joint._basisX1Z,y=zt,d=gt,B=pt,P=t.xX,T=t.xY,C=t.xZ,L=t.yX,q=t.yY,U=t.yZ;let ct=P*y+T*d+C*B;if(ct<-.999999999){let St,ai,qi,ui=P,Yt=T,yt=C,vt=ui*ui,yi=Yt*Yt,Ii=yt*yt,bi;vt<yi?vt<Ii?(bi=1/Math.sqrt(yi+Ii),St=0,ai=yt*bi,qi=-Yt*bi):(bi=1/Math.sqrt(vt+yi),St=Yt*bi,ai=-ui*bi,qi=0):yi<Ii?(bi=1/Math.sqrt(Ii+vt),St=-yt*bi,ai=0,qi=ui*bi):(bi=1/Math.sqrt(vt+yi),St=Yt*bi,ai=-ui*bi,qi=0),b=St,X=ai,c=qi,u=0}else{let St,ai,qi;St=T*B-C*d,ai=C*y-P*B,qi=P*d-T*y;let ui=Math.sqrt((1+ct)*.5);ct=.5/ui,St*=ct,ai*=ct,qi*=ct,b=St,X=ai,c=qi,u=ui}let nt=b,tt=X,kt=c,Bt=u,Mt=2*nt,Rt=2*tt,ci=2*kt,Xi=nt*Mt,gi=tt*Rt,ki=kt*ci,wi=nt*Rt,ei=tt*ci,Nt=nt*ci,At=Bt*Mt,ni=Bt*Rt,di=Bt*ci;p=1-gi-ki,x=wi-di,v=Nt+ni,f=wi+di,g=1-Xi-ki,V=ei-At,Z=Nt-ni,I=ei+At,M=1-Xi-gi;let Oi,Bi,Vt;if(Oi=p*L+x*q+v*U,Bi=f*L+g*q+V*U,Vt=Z*L+I*q+M*U,R=Oi,k=Bi,A=Vt,z=d*A-B*k,w=B*R-y*A,S=y*k-d*R,z*z+w*w+S*S>1e-6){let St=z*z+w*w+S*S;St>0&&(St=1/Math.sqrt(St)),z*=St,w*=St,S*=St}else{let St=y,ai=d,qi=B,ui=St*St,Yt=ai*ai,yt=qi*qi,vt;ui<Yt?ui<yt?(vt=1/Math.sqrt(Yt+yt),z=0,w=qi*vt,S=-ai*vt):(vt=1/Math.sqrt(ui+Yt),z=ai*vt,w=-St*vt,S=0):Yt<yt?(vt=1/Math.sqrt(yt+ui),z=-qi*vt,w=0,S=St*vt):(vt=1/Math.sqrt(ui+Yt),z=ai*vt,w=-St*vt,S=0)}R=w*B-S*d,k=S*y-z*B,A=z*d-w*y,t.xX=y,t.xY=d,t.xZ=B,t.yX=R,t.yY=k,t.yZ=A,t.zX=z,t.zY=w,t.zZ=S;let wt,$t,fi;wt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,$t=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,fi=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let Zi=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,it=Zi<=-1?3.14159265358979:Zi>=1?0:Math.acos(Zi),Ut=wt*wt+$t*$t+fi*fi;Ut>0&&(Ut=1/Math.sqrt(Ut)),wt*=Ut,$t*=Ut,fi*=Ut,wt*=it,$t*=it,fi*=it,this.angularErrorY=wt*this._basis.yX+$t*this._basis.yY+fi*this._basis.yZ,this.angularErrorZ=wt*this._basis.zX+$t*this._basis.zY+fi*this._basis.zZ;let ii,j,Jt;ii=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,j=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Jt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,Zi=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=Zi<=-1?3.14159265358979:Zi>=1?0:Math.acos(Zi),ii*this._basis.xX+j*this._basis.xY+Jt*this._basis.xZ<0&&(this.angle=-this.angle);let Pt,si,_i;Pt=this._anchor2X-this._anchor1X,si=this._anchor2Y-this._anchor1Y,_i=this._anchor2Z-this._anchor1Z,this.translation=Pt*this._basis.xX+si*this._basis.xY+_i*this._basis.xZ,this.linearErrorY=Pt*this._basis.yX+si*this._basis.yY+_i*this._basis.yZ,this.linearErrorZ=Pt*this._basis.zX+si*this._basis.zY+_i*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new m.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new m.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new m.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}};m.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new m.common.Vec3,this.localAnchor2=new m.common.Vec3,this.allowCollision=!1,this.solverType=m.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=m.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(t,i,s){this.rigidBody1=t,this.rigidBody2=i;let _=this.rigidBody1,n=this.localAnchor1,l,o,r;l=s.x,o=s.y,r=s.z,l-=_._transform._positionX,o-=_._transform._positionY,r-=_._transform._positionZ;let e,a,h;e=_._transform._rotation00*l+_._transform._rotation10*o+_._transform._rotation20*r,a=_._transform._rotation01*l+_._transform._rotation11*o+_._transform._rotation21*r,h=_._transform._rotation02*l+_._transform._rotation12*o+_._transform._rotation22*r,l=e,o=a,r=h,n.x=l,n.y=o,n.z=r;let b=this.rigidBody2,X=this.localAnchor2,c,u,p;c=s.x,u=s.y,p=s.z,c-=b._transform._positionX,u-=b._transform._positionY,p-=b._transform._positionZ;let x,v,f;x=b._transform._rotation00*c+b._transform._rotation10*u+b._transform._rotation20*p,v=b._transform._rotation01*c+b._transform._rotation11*u+b._transform._rotation21*p,f=b._transform._rotation02*c+b._transform._rotation12*u+b._transform._rotation22*p,c=x,u=v,p=f,X.x=c,X.y=u,X.z=p}};m.dynamics.constraint.joint.CylindricalJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new m.common.Vec3(1,0,0),this.localAxis2=new m.common.Vec3(1,0,0),this.translationalLimitMotor=new m.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new m.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new m.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new m.dynamics.constraint.joint.SpringDamper}init(t,i,s,_){this._init(t,i,s);let n=this.localAxis1,l,o,r;l=_.x,o=_.y,r=_.z;let e,a,h;e=t._transform._rotation00*l+t._transform._rotation10*o+t._transform._rotation20*r,a=t._transform._rotation01*l+t._transform._rotation11*o+t._transform._rotation21*r,h=t._transform._rotation02*l+t._transform._rotation12*o+t._transform._rotation22*r,l=e,o=a,r=h,n.x=l,n.y=o,n.z=r;let b=this.localAxis2,X,c,u;X=_.x,c=_.y,u=_.z;let p,x,v;return p=i._transform._rotation00*X+i._transform._rotation10*c+i._transform._rotation20*u,x=i._transform._rotation01*X+i._transform._rotation11*c+i._transform._rotation21*u,v=i._transform._rotation02*X+i._transform._rotation12*c+i._transform._rotation22*u,X=p,c=x,u=v,b.x=X,b.y=c,b.z=u,this}};m.dynamics.constraint.joint.GenericJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,m.dynamics.constraint.joint.JointType.GENERIC);let i,s=t.localBasis1;if(s.e00*(s.e11*s.e22-s.e12*s.e21)-s.e01*(s.e10*s.e22-s.e12*s.e20)+s.e02*(s.e10*s.e21-s.e11*s.e20)<0)i=!0;else{let M=t.localBasis2;i=M.e00*(M.e11*M.e22-M.e12*M.e21)-M.e01*(M.e10*M.e22-M.e12*M.e20)+M.e02*(M.e10*M.e21-M.e11*M.e20)<0}i&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");let _,n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V,Z=t.localBasis1;_=Z.e00,n=Z.e01,l=Z.e02,o=Z.e10,r=Z.e11,e=Z.e12,a=Z.e20,h=Z.e21,b=Z.e22;let I=t.localBasis2;X=I.e00,c=I.e01,u=I.e02,p=I.e10,x=I.e11,v=I.e12,f=I.e20,g=I.e21,V=I.e22,this._localBasisX1X=_,this._localBasisX1Y=o,this._localBasisX1Z=a,this._localBasisY1X=n,this._localBasisY1Y=r,this._localBasisY1Z=h,this._localBasisZ1X=l,this._localBasisZ1Y=e,this._localBasisZ1Z=b,this._localBasisX2X=X,this._localBasisX2Y=p,this._localBasisX2Z=f,this._localBasisY2X=c,this._localBasisY2Y=x,this._localBasisY2Z=g,this._localBasisZ2X=u,this._localBasisZ2Y=v,this._localBasisZ2Z=V,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._translLms=new Array(3),this._translSds=new Array(3),this._rotLms=new Array(3),this._rotSds=new Array(3),this._translLms[0]=t.translationalLimitMotors[0].clone(),this._translLms[1]=t.translationalLimitMotors[1].clone(),this._translLms[2]=t.translationalLimitMotors[2].clone(),this._translSds[0]=t.translationalSpringDampers[0].clone(),this._translSds[1]=t.translationalSpringDampers[1].clone(),this._translSds[2]=t.translationalSpringDampers[2].clone(),this._rotLms[0]=t.rotationalLimitMotors[0].clone(),this._rotLms[1]=t.rotationalLimitMotors[1].clone(),this._rotLms[2]=t.rotationalLimitMotors[2].clone(),this._rotSds[0]=t.rotationalSpringDampers[0].clone(),this._rotSds[1]=t.rotationalSpringDampers[1].clone(),this._rotSds[2]=t.rotationalSpringDampers[2].clone()}getInfo(t,i,s){let _,n=1/(this._b1._invMass+this._b2._invMass),l=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),o=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),r=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!s){let e=this._impulses[0],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowLinear(a,this.translationX,this._translLms[0],n,this._translSds[0],i,s),_=a.jacobian,_.lin1X=this._basisX1X,_.lin1Y=this._basisX1Y,_.lin1Z=this._basisX1Z,_.lin2X=this._basisX1X,_.lin2Y=this._basisX1Y,_.lin2Z=this._basisX1Z,_.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,_.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,_.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,_.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,_.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,_.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!s){let e=this._impulses[1],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowLinear(a,this.translationY,this._translLms[1],n,this._translSds[1],i,s),_=a.jacobian,_.lin1X=this._basisY1X,_.lin1Y=this._basisY1Y,_.lin1Z=this._basisY1Z,_.lin2X=this._basisY1X,_.lin2Y=this._basisY1Y,_.lin2Z=this._basisY1Z,_.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,_.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,_.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,_.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,_.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,_.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!s){let e=this._impulses[2],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowLinear(a,this.translationZ,this._translLms[2],n,this._translSds[2],i,s),_=a.jacobian,_.lin1X=this._basisZ1X,_.lin1Y=this._basisZ1Y,_.lin1Z=this._basisZ1Z,_.lin2X=this._basisZ1X,_.lin2Y=this._basisZ1Y,_.lin2Z=this._basisZ1Z,_.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,_.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,_.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,_.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,_.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,_.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!s)){let e=this._impulses[3],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowAngular(a,this._angleX,this._rotLms[0],l,this._rotSds[0],i,s),_=a.jacobian,_.ang1X=this._axisXX,_.ang1Y=this._axisXY,_.ang1Z=this._axisXZ,_.ang2X=this._axisXX,_.ang2Y=this._axisXY,_.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!s)){let e=this._impulses[4],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowAngular(a,this._angleY,this._rotLms[1],o,this._rotSds[1],i,s),_=a.jacobian,_.ang1X=this._axisYX,_.ang1Y=this._axisYY,_.ang1Z=this._axisYZ,_.ang2X=this._axisYX,_.ang2Y=this._axisYY,_.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!s)){let e=this._impulses[5],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowAngular(a,this._angleZ,this._rotLms[2],r,this._rotSds[2],i,s),_=a.jacobian,_.ang1X=this._axisZX,_.ang1Y=this._axisZY,_.ang1Z=this._axisZZ,_.ang2X=this._axisZX,_.ang2Y=this._axisZY,_.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors();let t,i,s,_,n,l,o,r,e;t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,o=this._basisZ2X,r=this._basisZ2Y,e=this._basisZ2Z,_=r*s-e*i,n=e*t-o*s,l=o*i-r*t,this._axisXX=n*e-l*r,this._axisXY=l*o-_*e,this._axisXZ=_*r-n*o,this._axisYX=_,this._axisYY=n,this._axisYZ=l,this._axisZX=i*l-s*n,this._axisZY=s*_-t*l,this._axisZZ=t*n-i*_;let a=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;a>0&&(a=1/Math.sqrt(a)),this._axisXX*=a,this._axisXY*=a,this._axisXZ*=a;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let b=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;b>0&&(b=1/Math.sqrt(b)),this._axisZX*=b,this._axisZY*=b,this._axisZZ*=b,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;let X,c,u,p,x,v,f,g,V,Z,I,M,y,d,B,R,k,A;X=this._basisX1X,c=this._basisY1X,u=this._basisZ1X,p=this._basisX1Y,x=this._basisY1Y,v=this._basisZ1Y,f=this._basisX1Z,g=this._basisY1Z,V=this._basisZ1Z,Z=this._basisX2X,I=this._basisY2X,M=this._basisZ2X,y=this._basisX2Y,d=this._basisY2Y,B=this._basisZ2Y,R=this._basisX2Z,k=this._basisY2Z,A=this._basisZ2Z;let z,w,S,P,T,C,L,q,U,Y,E,D,Q,W;q=X*Z+p*y+f*R,U=X*I+p*d+f*k,Y=X*M+p*B+f*A,E=c*I+x*d+g*k,D=c*M+x*B+g*A,Q=u*I+v*d+V*k,W=u*M+v*B+V*A,z=q,w=U,S=Y,P=E,T=D,C=Q,L=W;let F,H,G,J=S;if(J<=-1){let $=Math.atan2(C,P);F=$*.5,H=-1.570796326794895,G=-$*.5}else if(J>=1){let $=Math.atan2(C,P);F=$*.5,H=1.570796326794895,G=$*.5}else F=Math.atan2(-T,L),H=Math.asin(J),G=Math.atan2(-w,z);this._angleX=F,this._angleY=H,this._angleZ=G;let N,K,O;N=this._anchor2X-this._anchor1X,K=this._anchor2Y-this._anchor1Y,O=this._anchor2Z-this._anchor1Z,this.translationX=N*this._basisX1X+K*this._basisX1Y+O*this._basisX1Z,this.translationY=N*this._basisY1X+K*this._basisY1Y+O*this._basisY1Z,this.translationZ=N*this._basisZ1X+K*this._basisZ1Y+O*this._basisZ1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxisX(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxisY(){let t=new m.common.Vec3;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,t}getAxisZ(){let t=new m.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._translSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new m.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new m.common.Vec3(this.translationX,this.translationY,this.translationZ)}};m.dynamics.constraint.joint.GenericJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new m.common.Mat3,this.localBasis2=new m.common.Mat3;let t=[];t.push(new m.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),t.push(new m.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),t.push(new m.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),this.translationalLimitMotors=t;let i=[];i.push(new m.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),i.push(new m.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),i.push(new m.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),this.rotationalLimitMotors=i,this.translationalSpringDampers=[new m.dynamics.constraint.joint.SpringDamper,new m.dynamics.constraint.joint.SpringDamper,new m.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new m.dynamics.constraint.joint.SpringDamper,new m.dynamics.constraint.joint.SpringDamper,new m.dynamics.constraint.joint.SpringDamper]}init(t,i,s,_,n){this._init(t,i,s);let l=t._transform,o=i._transform,r,e,a,h,b,X,c,u,p,x,v,f,g,V,Z,I,M,y,d,B,R,k,A,z,w,S,P,T,C,L,q,U,Y,E,D,Q;r=_.e00,e=_.e01,a=_.e02,h=_.e10,b=_.e11,X=_.e12,c=_.e20,u=_.e21,p=_.e22,x=n.e00,v=n.e01,f=n.e02,g=n.e10,V=n.e11,Z=n.e12,I=n.e20,M=n.e21,y=n.e22;let W,F,H,G,J,N,K,O,$;W=l._rotation00*r+l._rotation10*h+l._rotation20*c,F=l._rotation00*e+l._rotation10*b+l._rotation20*u,H=l._rotation00*a+l._rotation10*X+l._rotation20*p,G=l._rotation01*r+l._rotation11*h+l._rotation21*c,J=l._rotation01*e+l._rotation11*b+l._rotation21*u,N=l._rotation01*a+l._rotation11*X+l._rotation21*p,K=l._rotation02*r+l._rotation12*h+l._rotation22*c,O=l._rotation02*e+l._rotation12*b+l._rotation22*u,$=l._rotation02*a+l._rotation12*X+l._rotation22*p,d=W,B=F,R=H,k=G,A=J,z=N,w=K,S=O,P=$;let et,st,lt,rt,at,_t,ht,ot,bt;et=o._rotation00*x+o._rotation10*g+o._rotation20*I,st=o._rotation00*v+o._rotation10*V+o._rotation20*M,lt=o._rotation00*f+o._rotation10*Z+o._rotation20*y,rt=o._rotation01*x+o._rotation11*g+o._rotation21*I,at=o._rotation01*v+o._rotation11*V+o._rotation21*M,_t=o._rotation01*f+o._rotation11*Z+o._rotation21*y,ht=o._rotation02*x+o._rotation12*g+o._rotation22*I,ot=o._rotation02*v+o._rotation12*V+o._rotation22*M,bt=o._rotation02*f+o._rotation12*Z+o._rotation22*y,T=et,C=st,L=lt,q=rt,U=at,Y=_t,E=ht,D=ot,Q=bt;let Xt=this.localBasis1;Xt.e00=d,Xt.e01=B,Xt.e02=R,Xt.e10=k,Xt.e11=A,Xt.e12=z,Xt.e20=w,Xt.e21=S,Xt.e22=P;let ft=this.localBasis2;return ft.e00=T,ft.e01=C,ft.e02=L,ft.e10=q,ft.e11=U,ft.e12=Y,ft.e20=E,ft.e21=D,ft.e22=Q,this}};m.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}};m.dynamics.constraint.joint.JointLink=class{constructor(t){this._joint=t}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.constraint.joint.JointMacro=class{};m.dynamics.constraint.joint.JointType=class{};m.dynamics.constraint.joint.PrismaticJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,m.dynamics.constraint.joint.JointType.PRISMATIC);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this._basis=new m.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,s){let _=this.getErp(i,s),n=this.linearErrorY*_,l=this.linearErrorZ*_,o=this.angularErrorX*_,r=this.angularErrorY*_,e=this.angularErrorZ*_,a;if(this._sd.frequency<=0||!s){let d=this._impulses[0],B=t.rows[t.numRows++],R=B.jacobian;R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=d,this.setSolverInfoRowLinear(B,this.translation,this._lm,1/(this._b1._invMass+this._b2._invMass),this._sd,i,s),a=B.jacobian,a.lin1X=this._basis.xX,a.lin1Y=this._basis.xY,a.lin1Z=this._basis.xZ,a.lin2X=this._basis.xX,a.lin2Y=this._basis.xY,a.lin2Z=this._basis.xZ,a.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,a.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,a.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,a.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,a.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,a.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let h=this._impulses[1],b=t.rows[t.numRows++],X=b.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,b.rhs=0,b.cfm=0,b.minImpulse=0,b.maxImpulse=0,b.motorSpeed=0,b.motorMaxImpulse=0,b.impulse=null,b.impulse=h,b.rhs=n,b.cfm=0,b.minImpulse=-1/0,b.maxImpulse=1/0,a=b.jacobian,a.lin1X=this._basis.yX,a.lin1Y=this._basis.yY,a.lin1Z=this._basis.yZ,a.lin2X=this._basis.yX,a.lin2Y=this._basis.yY,a.lin2Z=this._basis.yZ,a.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,a.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,a.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,a.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,a.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,a.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let c=this._impulses[2],u=t.rows[t.numRows++],p=u.jacobian;p.lin1X=0,p.lin1Y=0,p.lin1Z=0,p.lin2X=0,p.lin2Y=0,p.lin2Z=0,p.ang1X=0,p.ang1Y=0,p.ang1Z=0,p.ang2X=0,p.ang2Y=0,p.ang2Z=0,u.rhs=0,u.cfm=0,u.minImpulse=0,u.maxImpulse=0,u.motorSpeed=0,u.motorMaxImpulse=0,u.impulse=null,u.impulse=c,u.rhs=l,u.cfm=0,u.minImpulse=-1/0,u.maxImpulse=1/0,a=u.jacobian,a.lin1X=this._basis.zX,a.lin1Y=this._basis.zY,a.lin1Z=this._basis.zZ,a.lin2X=this._basis.zX,a.lin2Y=this._basis.zY,a.lin2Z=this._basis.zZ,a.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,a.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,a.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,a.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,a.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,a.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;let x=this._impulses[3],v=t.rows[t.numRows++],f=v.jacobian;f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=x,v.rhs=o,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,a=v.jacobian,a.ang1X=1,a.ang1Y=0,a.ang1Z=0,a.ang2X=1,a.ang2Y=0,a.ang2Z=0;let g=this._impulses[4],V=t.rows[t.numRows++],Z=V.jacobian;Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=0,Z.ang1Y=0,Z.ang1Z=0,Z.ang2X=0,Z.ang2Y=0,Z.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=g,V.rhs=r,V.cfm=0,V.minImpulse=-1/0,V.maxImpulse=1/0,a=V.jacobian,a.ang1X=0,a.ang1Y=1,a.ang1Z=0,a.ang2X=0,a.ang2Y=1,a.ang2Z=0;let I=this._impulses[5],M=t.rows[t.numRows++],y=M.jacobian;y.lin1X=0,y.lin1Y=0,y.lin1Z=0,y.lin2X=0,y.lin2Y=0,y.lin2Z=0,y.ang1X=0,y.ang1Y=0,y.ang1Z=0,y.ang2X=0,y.ang2Y=0,y.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=I,M.rhs=e,M.cfm=0,M.minImpulse=-1/0,M.maxImpulse=1/0,a=M.jacobian,a.ang1X=0,a.ang1Y=0,a.ang1Z=1,a.ang2X=0,a.ang2Y=0,a.ang2Z=1}_syncAnchors(){super._syncAnchors();let t=this._basis,i=t.joint._b1._invMass,s=t.joint._b2._invMass,_,n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V,Z,I,M,y,d,B,R,k,A,z,w,S,P,T,C,L,q,U,Y=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(Y<-.999999999){let dt,Lt,Ai,Li=t.joint._basisX1X,Di=t.joint._basisX1Y,$i=t.joint._basisX1Z,ae=Li*Li,re=Di*Di,pe=$i*$i,ti;ae<re?ae<pe?(ti=1/Math.sqrt(re+pe),dt=0,Lt=$i*ti,Ai=-Di*ti):(ti=1/Math.sqrt(ae+re),dt=Di*ti,Lt=-Li*ti,Ai=0):re<pe?(ti=1/Math.sqrt(pe+ae),dt=-$i*ti,Lt=0,Ai=Li*ti):(ti=1/Math.sqrt(ae+re),dt=Di*ti,Lt=-Li*ti,Ai=0),_=dt,n=Lt,l=Ai,o=0}else{let dt,Lt,Ai;dt=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,Lt=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,Ai=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let Li=Math.sqrt((1+Y)*.5);Y=.5/Li,dt*=Y,Lt*=Y,Ai*=Y,_=dt,n=Lt,l=Ai,o=Li}r=0,e=0,a=0,h=1;let E,D,Q,W,F,H,G,J;E=r,D=e,Q=a,W=h,F=_,H=n,G=l,J=o;let N=E*F+D*H+Q*G+W*J;if(N<0&&(N=-N,F=-F,H=-H,G=-G,J=-J),N>.999999){let dt,Lt,Ai,Li;dt=F-E,Lt=H-D,Ai=G-Q,Li=J-W,F=E+dt*(i/(i+s)),H=D+Lt*(i/(i+s)),G=Q+Ai*(i/(i+s)),J=W+Li*(i/(i+s));let Di=F*F+H*H+G*G+J*J;Di>1e-32&&(Di=1/Math.sqrt(Di)),b=F*Di,X=H*Di,c=G*Di,u=J*Di}else{let dt=i/(i+s)*Math.acos(N);F+=E*-N,H+=D*-N,G+=Q*-N,J+=W*-N;let Lt=F*F+H*H+G*G+J*J;Lt>1e-32&&(Lt=1/Math.sqrt(Lt)),F*=Lt,H*=Lt,G*=Lt,J*=Lt;let Ai=Math.sin(dt),Li=Math.cos(dt);E*=Li,D*=Li,Q*=Li,W*=Li,b=E+F*Ai,X=D+H*Ai,c=Q+G*Ai,u=W+J*Ai}let K=b,O=X,$=c,et=u,st=2*K,lt=2*O,rt=2*$,at=K*st,_t=O*lt,ht=$*rt,ot=K*lt,bt=O*rt,Xt=K*rt,ft=et*st,ut=et*lt,xt=et*rt;p=1-_t-ht,x=ot-xt,v=Xt+ut,f=ot+xt,g=1-at-ht,V=bt-ft,Z=Xt-ut,I=bt+ft,M=1-at-_t;let zt,gt,pt;zt=p*t.joint._basisX1X+x*t.joint._basisX1Y+v*t.joint._basisX1Z,gt=f*t.joint._basisX1X+g*t.joint._basisX1Y+V*t.joint._basisX1Z,pt=Z*t.joint._basisX1X+I*t.joint._basisX1Y+M*t.joint._basisX1Z,y=zt,d=gt,B=pt,P=t.xX,T=t.xY,C=t.xZ,L=t.yX,q=t.yY,U=t.yZ;let ct=P*y+T*d+C*B;if(ct<-.999999999){let dt,Lt,Ai,Li=P,Di=T,$i=C,ae=Li*Li,re=Di*Di,pe=$i*$i,ti;ae<re?ae<pe?(ti=1/Math.sqrt(re+pe),dt=0,Lt=$i*ti,Ai=-Di*ti):(ti=1/Math.sqrt(ae+re),dt=Di*ti,Lt=-Li*ti,Ai=0):re<pe?(ti=1/Math.sqrt(pe+ae),dt=-$i*ti,Lt=0,Ai=Li*ti):(ti=1/Math.sqrt(ae+re),dt=Di*ti,Lt=-Li*ti,Ai=0),b=dt,X=Lt,c=Ai,u=0}else{let dt,Lt,Ai;dt=T*B-C*d,Lt=C*y-P*B,Ai=P*d-T*y;let Li=Math.sqrt((1+ct)*.5);ct=.5/Li,dt*=ct,Lt*=ct,Ai*=ct,b=dt,X=Lt,c=Ai,u=Li}let nt=b,tt=X,kt=c,Bt=u,Mt=2*nt,Rt=2*tt,ci=2*kt,Xi=nt*Mt,gi=tt*Rt,ki=kt*ci,wi=nt*Rt,ei=tt*ci,Nt=nt*ci,At=Bt*Mt,ni=Bt*Rt,di=Bt*ci;p=1-gi-ki,x=wi-di,v=Nt+ni,f=wi+di,g=1-Xi-ki,V=ei-At,Z=Nt-ni,I=ei+At,M=1-Xi-gi;let Oi,Bi,Vt;if(Oi=p*L+x*q+v*U,Bi=f*L+g*q+V*U,Vt=Z*L+I*q+M*U,R=Oi,k=Bi,A=Vt,z=d*A-B*k,w=B*R-y*A,S=y*k-d*R,z*z+w*w+S*S>1e-6){let dt=z*z+w*w+S*S;dt>0&&(dt=1/Math.sqrt(dt)),z*=dt,w*=dt,S*=dt}else{let dt=y,Lt=d,Ai=B,Li=dt*dt,Di=Lt*Lt,$i=Ai*Ai,ae;Li<Di?Li<$i?(ae=1/Math.sqrt(Di+$i),z=0,w=Ai*ae,S=-Lt*ae):(ae=1/Math.sqrt(Li+Di),z=Lt*ae,w=-dt*ae,S=0):Di<$i?(ae=1/Math.sqrt($i+Li),z=-Ai*ae,w=0,S=dt*ae):(ae=1/Math.sqrt(Li+Di),z=Lt*ae,w=-dt*ae,S=0)}R=w*B-S*d,k=S*y-z*B,A=z*d-w*y,t.xX=y,t.xY=d,t.xZ=B,t.yX=R,t.yY=k,t.yZ=A,t.zX=z,t.zY=w,t.zZ=S;let wt,$t,fi,Zi,it,Ut,ii,j,Jt,Pt,si,_i,St,ai,qi,ui,Yt,yt;wt=this._basisX1X,$t=this._basisY1X,fi=this._basisZ1X,Zi=this._basisX1Y,it=this._basisY1Y,Ut=this._basisZ1Y,ii=this._basisX1Z,j=this._basisY1Z,Jt=this._basisZ1Z,Pt=this._basisX2X,si=this._basisY2X,_i=this._basisZ2X,St=this._basisX2Y,ai=this._basisY2Y,qi=this._basisZ2Y,ui=this._basisX2Z,Yt=this._basisY2Z,yt=this._basisZ2Z;let vt,yi,Ii,bi,se,me,Ei,he,ve,oi,ce,be,xe,Ye,Ni,Ji,Hi,_e;oi=Pt*wt+si*$t+_i*fi,ce=Pt*Zi+si*it+_i*Ut,be=Pt*ii+si*j+_i*Jt,xe=St*wt+ai*$t+qi*fi,Ye=St*Zi+ai*it+qi*Ut,Ni=St*ii+ai*j+qi*Jt,Ji=ui*wt+Yt*$t+yt*fi,Hi=ui*Zi+Yt*it+yt*Ut,_e=ui*ii+Yt*j+yt*Jt,vt=oi,yi=ce,Ii=be,bi=xe,se=Ye,me=Ni,Ei=Ji,he=Hi,ve=_e;let ne,Ki,ie,Ui,Wi=vt,Si=se,Ht=ve,ri=Wi+Si+Ht,Tt;ri>0?(Tt=Math.sqrt(ri+1),Ui=.5*Tt,Tt=.5/Tt,ne=(he-me)*Tt,Ki=(Ii-Ei)*Tt,ie=(bi-yi)*Tt):Wi>Si?Wi>Ht?(Tt=Math.sqrt(Wi-Si-Ht+1),ne=.5*Tt,Tt=.5/Tt,Ki=(yi+bi)*Tt,ie=(Ii+Ei)*Tt,Ui=(he-me)*Tt):(Tt=Math.sqrt(Ht-Wi-Si+1),ie=.5*Tt,Tt=.5/Tt,ne=(Ii+Ei)*Tt,Ki=(me+he)*Tt,Ui=(bi-yi)*Tt):Si>Ht?(Tt=Math.sqrt(Si-Ht-Wi+1),Ki=.5*Tt,Tt=.5/Tt,ne=(yi+bi)*Tt,ie=(me+he)*Tt,Ui=(Ii-Ei)*Tt):(Tt=Math.sqrt(Ht-Wi-Si+1),ie=.5*Tt,Tt=.5/Tt,ne=(Ii+Ei)*Tt,Ki=(me+he)*Tt,Ui=(bi-yi)*Tt);let Mi=Ui,zi=(Mi<=-1?3.14159265358979:Mi>=1?0:Math.acos(Mi))*2;this.angularErrorX=ne,this.angularErrorY=Ki,this.angularErrorZ=ie;let Pi=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Pi>0&&(Pi=1/Math.sqrt(Pi)),this.angularErrorX*=Pi,this.angularErrorY*=Pi,this.angularErrorZ*=Pi,this.angularErrorX*=zi,this.angularErrorY*=zi,this.angularErrorZ*=zi;let Vi,ji,Gt;Vi=this._anchor2X-this._anchor1X,ji=this._anchor2Y-this._anchor1Y,Gt=this._anchor2Z-this._anchor1Z,this.translation=Vi*this._basis.xX+ji*this._basis.xY+Gt*this._basis.xZ,this.linearErrorY=Vi*this._basis.yX+ji*this._basis.yY+Gt*this._basis.yZ,this.linearErrorZ=Vi*this._basis.zX+ji*this._basis.zY+Gt*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new m.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new m.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new m.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}};m.dynamics.constraint.joint.PrismaticJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new m.common.Vec3(1,0,0),this.localAxis2=new m.common.Vec3(1,0,0),this.limitMotor=new m.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new m.dynamics.constraint.joint.SpringDamper}init(t,i,s,_){this._init(t,i,s);let n=this.localAxis1,l,o,r;l=_.x,o=_.y,r=_.z;let e,a,h;e=t._transform._rotation00*l+t._transform._rotation10*o+t._transform._rotation20*r,a=t._transform._rotation01*l+t._transform._rotation11*o+t._transform._rotation21*r,h=t._transform._rotation02*l+t._transform._rotation12*o+t._transform._rotation22*r,l=e,o=a,r=h,n.x=l,n.y=o,n.z=r;let b=this.localAxis2,X,c,u;X=_.x,c=_.y,u=_.z;let p,x,v;return p=i._transform._rotation00*X+i._transform._rotation10*c+i._transform._rotation20*u,x=i._transform._rotation01*X+i._transform._rotation11*c+i._transform._rotation21*u,v=i._transform._rotation02*X+i._transform._rotation12*c+i._transform._rotation22*u,X=p,c=x,u=v,b.x=X,b.y=c,b.z=u,this}};m.dynamics.constraint.joint.RagdollJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,m.dynamics.constraint.joint.JointType.RAGDOLL);let i=t.localTwistAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localSwingAxis1;this._localBasisY1X=s.x,this._localBasisY1Y=s.y,this._localBasisY1Z=s.z;let _=t.localTwistAxis2;this._localBasisX2X=_.x,this._localBasisX2Y=_.y,this._localBasisX2Z=_.z,this.buildLocalBasesFromXY1X2(),this._twistSd=t.twistSpringDamper.clone(),this._twistLm=t.twistLimitMotor.clone(),this._swingSd=t.swingSpringDamper.clone(),this._maxSwingAngle1=t.maxSwingAngle1,this._maxSwingAngle2=t.maxSwingAngle2,this._maxSwingAngle1<m.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=m.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<m.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=m.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new m.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(t,i,s){let _=this.getErp(i,s),n,l,o;n=this.linearErrorX*_,l=this.linearErrorY*_,o=this.linearErrorZ*_;let r,e,a,h,b,X,c,u,p,x,v,f,g,V,Z,I,M,y;r=0,e=-this._relativeAnchor1Z,a=this._relativeAnchor1Y,h=this._relativeAnchor1Z,b=0,X=-this._relativeAnchor1X,c=-this._relativeAnchor1Y,u=this._relativeAnchor1X,p=0,x=0,v=-this._relativeAnchor2Z,f=this._relativeAnchor2Y,g=this._relativeAnchor2Z,V=0,Z=-this._relativeAnchor2X,I=-this._relativeAnchor2Y,M=this._relativeAnchor2X,y=0,r=-r,e=-e,a=-a,h=-h,b=-b,X=-X,c=-c,u=-u,p=-p,x=-x,v=-v,f=-f,g=-g,V=-V,Z=-Z,I=-I,M=-M,y=-y;let d=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),B=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),R=this._impulses[0],k=t.rows[t.numRows++],A=k.jacobian;A.lin1X=0,A.lin1Y=0,A.lin1Z=0,A.lin2X=0,A.lin2Y=0,A.lin2Z=0,A.ang1X=0,A.ang1Y=0,A.ang1Z=0,A.ang2X=0,A.ang2Y=0,A.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=R,k.rhs=n,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0;let z=k.jacobian;z.lin1X=1,z.lin1Y=0,z.lin1Z=0,z.lin2X=1,z.lin2Y=0,z.lin2Z=0,z.ang1X=r,z.ang1Y=e,z.ang1Z=a,z.ang2X=x,z.ang2Y=v,z.ang2Z=f;let w=this._impulses[1],S=t.rows[t.numRows++],P=S.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=w,S.rhs=l,S.cfm=0,S.minImpulse=-1/0,S.maxImpulse=1/0,z=S.jacobian,z.lin1X=0,z.lin1Y=1,z.lin1Z=0,z.lin2X=0,z.lin2Y=1,z.lin2Z=0,z.ang1X=h,z.ang1Y=b,z.ang1Z=X,z.ang2X=g,z.ang2Y=V,z.ang2Z=Z;let T=this._impulses[2],C=t.rows[t.numRows++],L=C.jacobian;if(L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,C.rhs=0,C.cfm=0,C.minImpulse=0,C.maxImpulse=0,C.motorSpeed=0,C.motorMaxImpulse=0,C.impulse=null,C.impulse=T,C.rhs=o,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0,z=C.jacobian,z.lin1X=0,z.lin1Y=0,z.lin1Z=1,z.lin2X=0,z.lin2Y=0,z.lin2Z=1,z.ang1X=c,z.ang1Y=u,z.ang1Z=p,z.ang2X=I,z.ang2Y=M,z.ang2Z=y,this.swingError>0&&(this._swingSd.frequency<=0||!s)){let q=this._impulses[3],U=t.rows[t.numRows++],Y=U.jacobian;Y.lin1X=0,Y.lin1Y=0,Y.lin1Z=0,Y.lin2X=0,Y.lin2Y=0,Y.lin2Z=0,Y.ang1X=0,Y.ang1Y=0,Y.ang1Z=0,Y.ang2X=0,Y.ang2Y=0,Y.ang2Z=0,U.rhs=0,U.cfm=0,U.minImpulse=0,U.maxImpulse=0,U.motorSpeed=0,U.motorMaxImpulse=0,U.impulse=null,U.impulse=q,this.setSolverInfoRowAngular(U,this.swingError,this.dummySwingLm,d,this._swingSd,i,s),z=U.jacobian,z.ang1X=this.swingAxisX,z.ang1Y=this.swingAxisY,z.ang1Z=this.swingAxisZ,z.ang2X=this.swingAxisX,z.ang2Y=this.swingAxisY,z.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!s){let q=this._impulses[4],U=t.rows[t.numRows++],Y=U.jacobian;Y.lin1X=0,Y.lin1Y=0,Y.lin1Z=0,Y.lin2X=0,Y.lin2Y=0,Y.lin2Z=0,Y.ang1X=0,Y.ang1Y=0,Y.ang1Z=0,Y.ang2X=0,Y.ang2Y=0,Y.ang2Z=0,U.rhs=0,U.cfm=0,U.minImpulse=0,U.maxImpulse=0,U.motorSpeed=0,U.motorMaxImpulse=0,U.impulse=null,U.impulse=q,this.setSolverInfoRowAngular(U,this._twistAngle,this._twistLm,B,this._twistSd,i,s),z=U.jacobian,z.ang1X=this.twistAxisX,z.ang1Y=this.twistAxisY,z.ang1Z=this.twistAxisZ,z.ang2X=this.twistAxisX,z.ang2Y=this.twistAxisY,z.ang2Z=this.twistAxisZ}}_syncAnchors(){super._syncAnchors();let t,i,s,_,n,l;t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,_=this._basisX2X,n=this._basisX2Y,l=this._basisX2Z;let o,r,e,a,h,b,X,c,u;o=this._basisX1X,r=this._basisY1X,e=this._basisZ1X,a=this._basisX1Y,h=this._basisY1Y,b=this._basisZ1Y,X=this._basisX1Z,c=this._basisY1Z,u=this._basisZ1Z;let p,x,v,f,g,V,Z,I,M,y,d,B,R,k,A,z,w=t*_+i*n+s*l;if(w<-.999999999){let zt,gt,pt,ct=t,nt=i,tt=s,kt=ct*ct,Bt=nt*nt,Mt=tt*tt,Rt;kt<Bt?kt<Mt?(Rt=1/Math.sqrt(Bt+Mt),zt=0,gt=tt*Rt,pt=-nt*Rt):(Rt=1/Math.sqrt(kt+Bt),zt=nt*Rt,gt=-ct*Rt,pt=0):Bt<Mt?(Rt=1/Math.sqrt(Mt+kt),zt=-tt*Rt,gt=0,pt=ct*Rt):(Rt=1/Math.sqrt(kt+Bt),zt=nt*Rt,gt=-ct*Rt,pt=0),p=zt,x=gt,v=pt,f=0}else{let zt,gt,pt;zt=i*l-s*n,gt=s*_-t*l,pt=t*n-i*_;let ct=Math.sqrt((1+w)*.5);w=.5/ct,zt*=w,gt*=w,pt*=w,p=zt,x=gt,v=pt,f=ct}let S=p,P=x,T=v,C=f,L=2*S,q=2*P,U=2*T,Y=S*L,E=P*q,D=T*U,Q=S*q,W=P*U,F=S*U,H=C*L,G=C*q,J=C*U;g=1-E-D,V=Q-J,Z=F+G,I=Q+J,M=1-Y-D,y=W-H,d=F-G,B=W+H,R=1-Y-E,this._swingAngle=(f<=-1?3.14159265358979:f>=1?0:Math.acos(f))*2,k=p,A=x,z=v;let N,K,O,$,et,st;$=g*this._basisY2X+I*this._basisY2Y+d*this._basisY2Z,et=V*this._basisY2X+M*this._basisY2Y+B*this._basisY2Z,st=Z*this._basisY2X+y*this._basisY2Y+R*this._basisY2Z,N=$,K=et,O=st,this._twistAngle=Math.atan2(this._basisZ1X*N+this._basisZ1Y*K+this._basisZ1Z*O,this._basisY1X*N+this._basisY1Y*K+this._basisY1Z*O),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;let lt=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;lt>0&&(lt=1/Math.sqrt(lt)),this.twistAxisX*=lt,this.twistAxisY*=lt,this.twistAxisZ*=lt;let rt=Math.sqrt(k*k+A*A+z*z);rt>0&&(rt=1/rt),k*=rt*this._swingAngle,A*=rt*this._swingAngle,z*=rt*this._swingAngle;let at,_t;at=r*k+h*A+c*z,_t=e*k+b*A+u*z,A=at,z=_t;let ht=A,ot=z,bt=this._maxSwingAngle1,Xt=this._maxSwingAngle2,ft=1/(bt*bt),ut=1/(Xt*Xt),xt=ht*ht*ft+ot*ot*ut;if(xt==0)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{let zt=Math.sqrt(1/xt),gt=ht*zt,pt=ot*zt,ct=gt*ft,nt=pt*ut;rt=1/Math.sqrt(ct*ct+nt*nt),ct*=rt,nt*=rt;let tt=(ht-gt)*ct+(ot-pt)*nt;if(tt>0){this.swingError=tt,this.swingAxisX=0,this.swingAxisY=ct,this.swingAxisZ=nt;let kt,Bt,Mt;kt=o*this.swingAxisX+r*this.swingAxisY+e*this.swingAxisZ,Bt=a*this.swingAxisX+h*this.swingAxisY+b*this.swingAxisZ,Mt=X*this.swingAxisX+c*this.swingAxisY+u*this.swingAxisZ,this.swingAxisX=kt,this.swingAxisY=Bt,this.swingAxisZ=Mt;let Rt,ci,Xi;Rt=g*this.swingAxisX+V*this.swingAxisY+Z*this.swingAxisZ,ci=I*this.swingAxisX+M*this.swingAxisY+y*this.swingAxisZ,Xi=d*this.swingAxisX+B*this.swingAxisY+R*this.swingAxisZ,this.swingAxisX=Rt,this.swingAxisY=ci,this.swingAxisZ=Xi}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new m.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new m.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new m.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){let t=new m.common.Vec3;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,t}getSwingAxisTo(t){t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}};m.dynamics.constraint.joint.RagdollJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new m.common.Vec3(1,0,0),this.localTwistAxis2=new m.common.Vec3(1,0,0),this.localSwingAxis1=new m.common.Vec3(0,1,0),this.twistSpringDamper=new m.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new m.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new m.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(t,i,s,_,n){this._init(t,i,s);let l=this.localTwistAxis1,o,r,e;o=_.x,r=_.y,e=_.z;let a,h,b;a=t._transform._rotation00*o+t._transform._rotation10*r+t._transform._rotation20*e,h=t._transform._rotation01*o+t._transform._rotation11*r+t._transform._rotation21*e,b=t._transform._rotation02*o+t._transform._rotation12*r+t._transform._rotation22*e,o=a,r=h,e=b,l.x=o,l.y=r,l.z=e;let X=this.localTwistAxis2,c,u,p;c=_.x,u=_.y,p=_.z;let x,v,f;x=i._transform._rotation00*c+i._transform._rotation10*u+i._transform._rotation20*p,v=i._transform._rotation01*c+i._transform._rotation11*u+i._transform._rotation21*p,f=i._transform._rotation02*c+i._transform._rotation12*u+i._transform._rotation22*p,c=x,u=v,p=f,X.x=c,X.y=u,X.z=p;let g=this.localSwingAxis1,V,Z,I;V=n.x,Z=n.y,I=n.z;let M,y,d;return M=t._transform._rotation00*V+t._transform._rotation10*Z+t._transform._rotation20*I,y=t._transform._rotation01*V+t._transform._rotation11*Z+t._transform._rotation21*I,d=t._transform._rotation02*V+t._transform._rotation12*Z+t._transform._rotation22*I,V=M,Z=y,I=d,g.x=V,g.y=Z,g.z=I,this}};m.dynamics.constraint.joint.RevoluteJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,1);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new m.dynamics.constraint.joint.BasisTracker(this),this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,s){let _=this.getErp(i,s),n,l,o;n=this.linearErrorX*_,l=this.linearErrorY*_,o=this.linearErrorZ*_;let r=this.angularErrorY*_,e=this.angularErrorZ*_,a,h,b,X,c,u,p,x,v,f,g,V,Z,I,M,y,d,B;a=0,h=-this._relativeAnchor1Z,b=this._relativeAnchor1Y,X=this._relativeAnchor1Z,c=0,u=-this._relativeAnchor1X,p=-this._relativeAnchor1Y,x=this._relativeAnchor1X,v=0,f=0,g=-this._relativeAnchor2Z,V=this._relativeAnchor2Y,Z=this._relativeAnchor2Z,I=0,M=-this._relativeAnchor2X,y=-this._relativeAnchor2Y,d=this._relativeAnchor2X,B=0,a=-a,h=-h,b=-b,X=-X,c=-c,u=-u,p=-p,x=-x,v=-v,f=-f,g=-g,V=-V,Z=-Z,I=-I,M=-M,y=-y,d=-d,B=-B;let R=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),k=this._impulses[0],A=t.rows[t.numRows++],z=A.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=k,A.rhs=n,A.cfm=0,A.minImpulse=-1/0,A.maxImpulse=1/0;let w=A.jacobian;w.lin1X=1,w.lin1Y=0,w.lin1Z=0,w.lin2X=1,w.lin2Y=0,w.lin2Z=0,w.ang1X=a,w.ang1Y=h,w.ang1Z=b,w.ang2X=f,w.ang2Y=g,w.ang2Z=V;let S=this._impulses[1],P=t.rows[t.numRows++],T=P.jacobian;T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=S,P.rhs=l,P.cfm=0,P.minImpulse=-1/0,P.maxImpulse=1/0,w=P.jacobian,w.lin1X=0,w.lin1Y=1,w.lin1Z=0,w.lin2X=0,w.lin2Y=1,w.lin2Z=0,w.ang1X=X,w.ang1Y=c,w.ang1Z=u,w.ang2X=Z,w.ang2Y=I,w.ang2Z=M;let C=this._impulses[2],L=t.rows[t.numRows++],q=L.jacobian;if(q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,L.rhs=0,L.cfm=0,L.minImpulse=0,L.maxImpulse=0,L.motorSpeed=0,L.motorMaxImpulse=0,L.impulse=null,L.impulse=C,L.rhs=o,L.cfm=0,L.minImpulse=-1/0,L.maxImpulse=1/0,w=L.jacobian,w.lin1X=0,w.lin1Y=0,w.lin1Z=1,w.lin2X=0,w.lin2Y=0,w.lin2Z=1,w.ang1X=p,w.ang1Y=x,w.ang1Z=v,w.ang2X=y,w.ang2Y=d,w.ang2Z=B,this._sd.frequency<=0||!s){let F=this._impulses[3],H=t.rows[t.numRows++],G=H.jacobian;G.lin1X=0,G.lin1Y=0,G.lin1Z=0,G.lin2X=0,G.lin2Y=0,G.lin2Z=0,G.ang1X=0,G.ang1Y=0,G.ang1Z=0,G.ang2X=0,G.ang2Y=0,G.ang2Z=0,H.rhs=0,H.cfm=0,H.minImpulse=0,H.maxImpulse=0,H.motorSpeed=0,H.motorMaxImpulse=0,H.impulse=null,H.impulse=F,this.setSolverInfoRowAngular(H,this.angle,this._lm,R,this._sd,i,s),w=H.jacobian,w.ang1X=this._basis.xX,w.ang1Y=this._basis.xY,w.ang1Z=this._basis.xZ,w.ang2X=this._basis.xX,w.ang2Y=this._basis.xY,w.ang2Z=this._basis.xZ}let U=this._impulses[4],Y=t.rows[t.numRows++],E=Y.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=U,Y.rhs=r,Y.cfm=0,Y.minImpulse=-1/0,Y.maxImpulse=1/0,w=Y.jacobian,w.ang1X=this._basis.yX,w.ang1Y=this._basis.yY,w.ang1Z=this._basis.yZ,w.ang2X=this._basis.yX,w.ang2Y=this._basis.yY,w.ang2Z=this._basis.yZ;let D=this._impulses[5],Q=t.rows[t.numRows++],W=Q.jacobian;W.lin1X=0,W.lin1Y=0,W.lin1Z=0,W.lin2X=0,W.lin2Y=0,W.lin2Z=0,W.ang1X=0,W.ang1Y=0,W.ang1Z=0,W.ang2X=0,W.ang2Y=0,W.ang2Z=0,Q.rhs=0,Q.cfm=0,Q.minImpulse=0,Q.maxImpulse=0,Q.motorSpeed=0,Q.motorMaxImpulse=0,Q.impulse=null,Q.impulse=D,Q.rhs=e,Q.cfm=0,Q.minImpulse=-1/0,Q.maxImpulse=1/0,w=Q.jacobian,w.ang1X=this._basis.zX,w.ang1Y=this._basis.zY,w.ang1Z=this._basis.zZ,w.ang2X=this._basis.zX,w.ang2Y=this._basis.zY,w.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t=this._basis,i=t.joint._b1._invMass,s=t.joint._b2._invMass,_,n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V,Z,I,M,y,d,B,R,k,A,z,w,S,P,T,C,L,q,U,Y=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(Y<-.999999999){let Pt,si,_i,St=t.joint._basisX1X,ai=t.joint._basisX1Y,qi=t.joint._basisX1Z,ui=St*St,Yt=ai*ai,yt=qi*qi,vt;ui<Yt?ui<yt?(vt=1/Math.sqrt(Yt+yt),Pt=0,si=qi*vt,_i=-ai*vt):(vt=1/Math.sqrt(ui+Yt),Pt=ai*vt,si=-St*vt,_i=0):Yt<yt?(vt=1/Math.sqrt(yt+ui),Pt=-qi*vt,si=0,_i=St*vt):(vt=1/Math.sqrt(ui+Yt),Pt=ai*vt,si=-St*vt,_i=0),_=Pt,n=si,l=_i,o=0}else{let Pt,si,_i;Pt=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,si=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,_i=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let St=Math.sqrt((1+Y)*.5);Y=.5/St,Pt*=Y,si*=Y,_i*=Y,_=Pt,n=si,l=_i,o=St}r=0,e=0,a=0,h=1;let E,D,Q,W,F,H,G,J;E=r,D=e,Q=a,W=h,F=_,H=n,G=l,J=o;let N=E*F+D*H+Q*G+W*J;if(N<0&&(N=-N,F=-F,H=-H,G=-G,J=-J),N>.999999){let Pt,si,_i,St;Pt=F-E,si=H-D,_i=G-Q,St=J-W,F=E+Pt*(i/(i+s)),H=D+si*(i/(i+s)),G=Q+_i*(i/(i+s)),J=W+St*(i/(i+s));let ai=F*F+H*H+G*G+J*J;ai>1e-32&&(ai=1/Math.sqrt(ai)),b=F*ai,X=H*ai,c=G*ai,u=J*ai}else{let Pt=i/(i+s)*Math.acos(N);F+=E*-N,H+=D*-N,G+=Q*-N,J+=W*-N;let si=F*F+H*H+G*G+J*J;si>1e-32&&(si=1/Math.sqrt(si)),F*=si,H*=si,G*=si,J*=si;let _i=Math.sin(Pt),St=Math.cos(Pt);E*=St,D*=St,Q*=St,W*=St,b=E+F*_i,X=D+H*_i,c=Q+G*_i,u=W+J*_i}let K=b,O=X,$=c,et=u,st=2*K,lt=2*O,rt=2*$,at=K*st,_t=O*lt,ht=$*rt,ot=K*lt,bt=O*rt,Xt=K*rt,ft=et*st,ut=et*lt,xt=et*rt;p=1-_t-ht,x=ot-xt,v=Xt+ut,f=ot+xt,g=1-at-ht,V=bt-ft,Z=Xt-ut,I=bt+ft,M=1-at-_t;let zt,gt,pt;zt=p*t.joint._basisX1X+x*t.joint._basisX1Y+v*t.joint._basisX1Z,gt=f*t.joint._basisX1X+g*t.joint._basisX1Y+V*t.joint._basisX1Z,pt=Z*t.joint._basisX1X+I*t.joint._basisX1Y+M*t.joint._basisX1Z,y=zt,d=gt,B=pt,P=t.xX,T=t.xY,C=t.xZ,L=t.yX,q=t.yY,U=t.yZ;let ct=P*y+T*d+C*B;if(ct<-.999999999){let Pt,si,_i,St=P,ai=T,qi=C,ui=St*St,Yt=ai*ai,yt=qi*qi,vt;ui<Yt?ui<yt?(vt=1/Math.sqrt(Yt+yt),Pt=0,si=qi*vt,_i=-ai*vt):(vt=1/Math.sqrt(ui+Yt),Pt=ai*vt,si=-St*vt,_i=0):Yt<yt?(vt=1/Math.sqrt(yt+ui),Pt=-qi*vt,si=0,_i=St*vt):(vt=1/Math.sqrt(ui+Yt),Pt=ai*vt,si=-St*vt,_i=0),b=Pt,X=si,c=_i,u=0}else{let Pt,si,_i;Pt=T*B-C*d,si=C*y-P*B,_i=P*d-T*y;let St=Math.sqrt((1+ct)*.5);ct=.5/St,Pt*=ct,si*=ct,_i*=ct,b=Pt,X=si,c=_i,u=St}let nt=b,tt=X,kt=c,Bt=u,Mt=2*nt,Rt=2*tt,ci=2*kt,Xi=nt*Mt,gi=tt*Rt,ki=kt*ci,wi=nt*Rt,ei=tt*ci,Nt=nt*ci,At=Bt*Mt,ni=Bt*Rt,di=Bt*ci;p=1-gi-ki,x=wi-di,v=Nt+ni,f=wi+di,g=1-Xi-ki,V=ei-At,Z=Nt-ni,I=ei+At,M=1-Xi-gi;let Oi,Bi,Vt;if(Oi=p*L+x*q+v*U,Bi=f*L+g*q+V*U,Vt=Z*L+I*q+M*U,R=Oi,k=Bi,A=Vt,z=d*A-B*k,w=B*R-y*A,S=y*k-d*R,z*z+w*w+S*S>1e-6){let Pt=z*z+w*w+S*S;Pt>0&&(Pt=1/Math.sqrt(Pt)),z*=Pt,w*=Pt,S*=Pt}else{let Pt=y,si=d,_i=B,St=Pt*Pt,ai=si*si,qi=_i*_i,ui;St<ai?St<qi?(ui=1/Math.sqrt(ai+qi),z=0,w=_i*ui,S=-si*ui):(ui=1/Math.sqrt(St+ai),z=si*ui,w=-Pt*ui,S=0):ai<qi?(ui=1/Math.sqrt(qi+St),z=-_i*ui,w=0,S=Pt*ui):(ui=1/Math.sqrt(St+ai),z=si*ui,w=-Pt*ui,S=0)}R=w*B-S*d,k=S*y-z*B,A=z*d-w*y,t.xX=y,t.xY=d,t.xZ=B,t.yX=R,t.yY=k,t.yZ=A,t.zX=z,t.zY=w,t.zZ=S;let wt,$t,fi;wt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,$t=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,fi=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let Zi=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,it=Zi<=-1?3.14159265358979:Zi>=1?0:Math.acos(Zi),Ut=wt*wt+$t*$t+fi*fi;Ut>0&&(Ut=1/Math.sqrt(Ut)),wt*=Ut,$t*=Ut,fi*=Ut,wt*=it,$t*=it,fi*=it,this.angularErrorY=wt*this._basis.yX+$t*this._basis.yY+fi*this._basis.yZ,this.angularErrorZ=wt*this._basis.zX+$t*this._basis.zY+fi*this._basis.zZ;let ii,j,Jt;ii=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,j=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Jt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,Zi=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=Zi<=-1?3.14159265358979:Zi>=1?0:Math.acos(Zi),ii*this._basis.xX+j*this._basis.xY+Jt*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new m.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new m.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new m.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}};m.dynamics.constraint.joint.RevoluteJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new m.common.Vec3(1,0,0),this.localAxis2=new m.common.Vec3(1,0,0),this.springDamper=new m.dynamics.constraint.joint.SpringDamper,this.limitMotor=new m.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,s,_){this._init(t,i,s);let n=this.localAxis1,l,o,r;l=_.x,o=_.y,r=_.z;let e,a,h;e=t._transform._rotation00*l+t._transform._rotation10*o+t._transform._rotation20*r,a=t._transform._rotation01*l+t._transform._rotation11*o+t._transform._rotation21*r,h=t._transform._rotation02*l+t._transform._rotation12*o+t._transform._rotation22*r,l=e,o=a,r=h,n.x=l,n.y=o,n.z=r;let b=this.localAxis2,X,c,u;X=_.x,c=_.y,u=_.z;let p,x,v;return p=i._transform._rotation00*X+i._transform._rotation10*c+i._transform._rotation20*u,x=i._transform._rotation01*X+i._transform._rotation11*c+i._transform._rotation21*u,v=i._transform._rotation02*X+i._transform._rotation12*c+i._transform._rotation22*u,X=p,c=x,u=v,b.x=X,b.y=c,b.z=u,this}};m.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorTorque=i,this}clone(){let t=new m.dynamics.constraint.joint.RotationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}};m.dynamics.constraint.joint.SphericalJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,0),this._sd=t.springDamper.clone()}getInfo(t,i,s){if(this._sd.frequency>0&&s)return;let _,n,l;_=this._anchor2X-this._anchor1X,n=this._anchor2Y-this._anchor1Y,l=this._anchor2Z-this._anchor1Z;let o,r;if(this._sd.frequency>0){let Y=6.28318530717958*this._sd.frequency,E=this._sd.dampingRatio;E<m.common.Setting.minSpringDamperDampingRatio&&(E=m.common.Setting.minSpringDamperDampingRatio);let D=i.dt,Q=2*E*Y,W=Y*Y;this._sd.useSymplecticEuler?(o=1/(D*Q),r=W/Q):(o=1/(D*(D*W+Q)),r=W/(D*W+Q)),o*=this._b1._invMass+this._b2._invMass}else o=0,r=this.getErp(i,s);let e,a,h;e=_*r,a=n*r,h=l*r;let b,X,c,u,p,x,v,f,g,V,Z,I,M,y,d,B,R,k;b=0,X=-this._relativeAnchor1Z,c=this._relativeAnchor1Y,u=this._relativeAnchor1Z,p=0,x=-this._relativeAnchor1X,v=-this._relativeAnchor1Y,f=this._relativeAnchor1X,g=0,V=0,Z=-this._relativeAnchor2Z,I=this._relativeAnchor2Y,M=this._relativeAnchor2Z,y=0,d=-this._relativeAnchor2X,B=-this._relativeAnchor2Y,R=this._relativeAnchor2X,k=0,b=-b,X=-X,c=-c,u=-u,p=-p,x=-x,v=-v,f=-f,g=-g,V=-V,Z=-Z,I=-I,M=-M,y=-y,d=-d,B=-B,R=-R,k=-k;let A=this._impulses[0],z=t.rows[t.numRows++],w=z.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=A,z.rhs=e,z.cfm=o,z.minImpulse=-1/0,z.maxImpulse=1/0;let S=z.jacobian;S.lin1X=1,S.lin1Y=0,S.lin1Z=0,S.lin2X=1,S.lin2Y=0,S.lin2Z=0,S.ang1X=b,S.ang1Y=X,S.ang1Z=c,S.ang2X=V,S.ang2Y=Z,S.ang2Z=I;let P=this._impulses[1],T=t.rows[t.numRows++],C=T.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=P,T.rhs=a,T.cfm=o,T.minImpulse=-1/0,T.maxImpulse=1/0,S=T.jacobian,S.lin1X=0,S.lin1Y=1,S.lin1Z=0,S.lin2X=0,S.lin2Y=1,S.lin2Z=0,S.ang1X=u,S.ang1Y=p,S.ang1Z=x,S.ang2X=M,S.ang2Y=y,S.ang2Z=d;let L=this._impulses[2],q=t.rows[t.numRows++],U=q.jacobian;U.lin1X=0,U.lin1Y=0,U.lin1Z=0,U.lin2X=0,U.lin2Y=0,U.lin2Z=0,U.ang1X=0,U.ang1Y=0,U.ang1Z=0,U.ang2X=0,U.ang2Y=0,U.ang2Z=0,q.rhs=0,q.cfm=0,q.minImpulse=0,q.maxImpulse=0,q.motorSpeed=0,q.motorMaxImpulse=0,q.impulse=null,q.impulse=L,q.rhs=h,q.cfm=o,q.minImpulse=-1/0,q.maxImpulse=1/0,S=q.jacobian,S.lin1X=0,S.lin1Y=0,S.lin1Z=1,S.lin2X=0,S.lin2Y=0,S.lin2Z=1,S.ang1X=v,S.ang1Y=f,S.ang1Z=g,S.ang2X=B,S.ang2Y=R,S.ang2Z=k}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getSpringDamper(){return this._sd}};m.dynamics.constraint.joint.SphericalJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new m.dynamics.constraint.joint.SpringDamper}init(t,i,s){return this._init(t,i,s),this}};m.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(t,i){return this.frequency=t,this.dampingRatio=i,this}setSymplecticEuler(t){return this.useSymplecticEuler=t,this}clone(){let t=new m.dynamics.constraint.joint.SpringDamper;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}};m.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorForce=i,this}clone(){let t=new m.dynamics.constraint.joint.TranslationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}};m.dynamics.constraint.joint.UniversalJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,m.dynamics.constraint.joint.JointType.UNIVERSAL);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisZ2X=s.x,this._localBasisZ2Y=s.y,this._localBasisZ2Z=s.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=t.springDamper1.clone(),this._sd2=t.springDamper2.clone(),this._lm1=t.limitMotor1.clone(),this._lm2=t.limitMotor2.clone()}getInfo(t,i,s){let _=this.getErp(i,s),n,l,o;n=this.linearErrorX*_,l=this.linearErrorY*_,o=this.linearErrorZ*_;let r=this._angleY*_,e,a,h,b,X,c,u,p,x,v,f,g,V,Z,I,M,y,d;e=0,a=-this._relativeAnchor1Z,h=this._relativeAnchor1Y,b=this._relativeAnchor1Z,X=0,c=-this._relativeAnchor1X,u=-this._relativeAnchor1Y,p=this._relativeAnchor1X,x=0,v=0,f=-this._relativeAnchor2Z,g=this._relativeAnchor2Y,V=this._relativeAnchor2Z,Z=0,I=-this._relativeAnchor2X,M=-this._relativeAnchor2Y,y=this._relativeAnchor2X,d=0,e=-e,a=-a,h=-h,b=-b,X=-X,c=-c,u=-u,p=-p,x=-x,v=-v,f=-f,g=-g,V=-V,Z=-Z,I=-I,M=-M,y=-y,d=-d;let B=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),R=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),k=this._impulses[0],A=t.rows[t.numRows++],z=A.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=k,A.rhs=n,A.cfm=0,A.minImpulse=-1/0,A.maxImpulse=1/0;let w=A.jacobian;w.lin1X=1,w.lin1Y=0,w.lin1Z=0,w.lin2X=1,w.lin2Y=0,w.lin2Z=0,w.ang1X=e,w.ang1Y=a,w.ang1Z=h,w.ang2X=v,w.ang2Y=f,w.ang2Z=g;let S=this._impulses[1],P=t.rows[t.numRows++],T=P.jacobian;T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=S,P.rhs=l,P.cfm=0,P.minImpulse=-1/0,P.maxImpulse=1/0,w=P.jacobian,w.lin1X=0,w.lin1Y=1,w.lin1Z=0,w.lin2X=0,w.lin2Y=1,w.lin2Z=0,w.ang1X=b,w.ang1Y=X,w.ang1Z=c,w.ang2X=V,w.ang2Y=Z,w.ang2Z=I;let C=this._impulses[2],L=t.rows[t.numRows++],q=L.jacobian;if(q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,L.rhs=0,L.cfm=0,L.minImpulse=0,L.maxImpulse=0,L.motorSpeed=0,L.motorMaxImpulse=0,L.impulse=null,L.impulse=C,L.rhs=o,L.cfm=0,L.minImpulse=-1/0,L.maxImpulse=1/0,w=L.jacobian,w.lin1X=0,w.lin1Y=0,w.lin1Z=1,w.lin2X=0,w.lin2Y=0,w.lin2Z=1,w.ang1X=u,w.ang1Y=p,w.ang1Z=x,w.ang2X=M,w.ang2Y=y,w.ang2Z=d,!this.xSingular&&(this._sd1.frequency<=0||!s)){let U=this._impulses[3],Y=t.rows[t.numRows++],E=Y.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=U,this.setSolverInfoRowAngular(Y,this._angleX,this._lm1,B,this._sd1,i,s),w=Y.jacobian,w.ang1X=this._axisXX,w.ang1Y=this._axisXY,w.ang1Z=this._axisXZ,w.ang2X=this._axisXX,w.ang2Y=this._axisXY,w.ang2Z=this._axisXZ}if(!this.ySingular){let U=this._impulses[4],Y=t.rows[t.numRows++],E=Y.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=U,Y.rhs=r,Y.cfm=0,Y.minImpulse=-1/0,Y.maxImpulse=1/0,w=Y.jacobian,w.ang1X=this._axisYX,w.ang1Y=this._axisYY,w.ang1Z=this._axisYZ,w.ang2X=this._axisYX,w.ang2Y=this._axisYY,w.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!s)){let U=this._impulses[5],Y=t.rows[t.numRows++],E=Y.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=U,this.setSolverInfoRowAngular(Y,this._angleZ,this._lm2,R,this._sd2,i,s),w=Y.jacobian,w.ang1X=this._axisZX,w.ang1Y=this._axisZY,w.ang1Z=this._axisZZ,w.ang2X=this._axisZX,w.ang2Y=this._axisZY,w.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors();let t,i,s,_,n,l,o,r,e;t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,o=this._basisZ2X,r=this._basisZ2Y,e=this._basisZ2Z,_=r*s-e*i,n=e*t-o*s,l=o*i-r*t,this._axisXX=n*e-l*r,this._axisXY=l*o-_*e,this._axisXZ=_*r-n*o,this._axisYX=_,this._axisYY=n,this._axisYZ=l,this._axisZX=i*l-s*n,this._axisZY=s*_-t*l,this._axisZZ=t*n-i*_;let a=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;a>0&&(a=1/Math.sqrt(a)),this._axisXX*=a,this._axisXY*=a,this._axisXZ*=a;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let b=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;b>0&&(b=1/Math.sqrt(b)),this._axisZX*=b,this._axisZY*=b,this._axisZZ*=b,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;let X,c,u,p,x,v,f,g,V,Z,I,M,y,d,B,R,k,A;X=this._basisX1X,c=this._basisY1X,u=this._basisZ1X,p=this._basisX1Y,x=this._basisY1Y,v=this._basisZ1Y,f=this._basisX1Z,g=this._basisY1Z,V=this._basisZ1Z,Z=this._basisX2X,I=this._basisY2X,M=this._basisZ2X,y=this._basisX2Y,d=this._basisY2Y,B=this._basisZ2Y,R=this._basisX2Z,k=this._basisY2Z,A=this._basisZ2Z;let z,w,S,P,T,C,L,q,U,Y,E,D,Q,W;q=X*Z+p*y+f*R,U=X*I+p*d+f*k,Y=X*M+p*B+f*A,E=c*I+x*d+g*k,D=c*M+x*B+g*A,Q=u*I+v*d+V*k,W=u*M+v*B+V*A,z=q,w=U,S=Y,P=E,T=D,C=Q,L=W;let F,H,G,J=S;if(J<=-1){let N=Math.atan2(C,P);F=N*.5,H=-1.570796326794895,G=-N*.5}else if(J>=1){let N=Math.atan2(C,P);F=N*.5,H=1.570796326794895,G=N*.5}else F=Math.atan2(-T,L),H=Math.asin(J),G=Math.atan2(-w,z);this._angleX=F,this._angleY=H,this._angleZ=G,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new m.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){let t=new m.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new m.common.Vec3;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}};m.dynamics.constraint.joint.UniversalJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new m.common.Vec3(1,0,0),this.localAxis2=new m.common.Vec3(1,0,0),this.springDamper1=new m.dynamics.constraint.joint.SpringDamper,this.springDamper2=new m.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new m.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new m.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,s,_,n){this._init(t,i,s);let l=this.localAxis1,o,r,e;o=_.x,r=_.y,e=_.z;let a,h,b;a=t._transform._rotation00*o+t._transform._rotation10*r+t._transform._rotation20*e,h=t._transform._rotation01*o+t._transform._rotation11*r+t._transform._rotation21*e,b=t._transform._rotation02*o+t._transform._rotation12*r+t._transform._rotation22*e,o=a,r=h,e=b,l.x=o,l.y=r,l.z=e;let X=this.localAxis2,c,u,p;c=n.x,u=n.y,p=n.z;let x,v,f;return x=i._transform._rotation00*c+i._transform._rotation10*u+i._transform._rotation20*p,v=i._transform._rotation01*c+i._transform._rotation11*u+i._transform._rotation21*p,f=i._transform._rotation02*c+i._transform._rotation12*u+i._transform._rotation22*p,c=x,u=v,p=f,X.x=c,X.y=u,X.z=p,this}};m.dynamics.constraint.solver||(m.dynamics.constraint.solver={});m.dynamics.constraint.solver.ConstraintSolverType=class{};m.dynamics.constraint.solver.common||(m.dynamics.constraint.solver.common={});m.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}};m.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}};m.dynamics.constraint.solver.direct||(m.dynamics.constraint.solver.direct={});m.dynamics.constraint.solver.direct.Boundary=class{constructor(t){this.iBounded=new Array(t),this.iUnbounded=new Array(t),this.signs=new Array(t),this.b=new Array(t),this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(t){this.numBounded=t.numBounded;let i=0,s=this.numBounded;for(;i<s;){let l=i++;this.iBounded[l]=t.iBounded[l],this.signs[l]=t.signs[l]}this.numUnbounded=t.numUnbounded,this.matrixId=0;let _=0,n=this.numUnbounded;for(;_<n;){let l=_++,o=t.iUnbounded[l];this.iUnbounded[l]=o,this.matrixId|=1<<o}}computeImpulses(t,i,s,_,n,l,o){let r=0,e=this.numUnbounded;for(;r<e;){let I=this.iUnbounded[r++],M=t.rows[I];this.b[I]=M.rhs*l-s[I]-M.cfm*_[I]}let a=i._invMassWithoutCfm,h=0,b=this.numBounded;for(;h<b;){let I=h++,M=this.iBounded[I],y=this.signs[I],d=t.rows[M],B=(y<0?d.minImpulse:y>0?d.maxImpulse:0)-_[M];if(n[M]=B,B!=0){let R=0,k=this.numUnbounded;for(;R<k;){let A=this.iUnbounded[R++];this.b[A]-=a[M][A]*B}}}let X=this.iUnbounded,c=this.numUnbounded,u=0,p=0;for(;p<c;)u|=1<<X[p++];let x;i._cacheComputed[u]||(i.computeSubmatrix(u,X,c),i._cacheComputed[u]=!0),x=i._cachedSubmatrices[u];let v=!0,f=0,g=this.numUnbounded;for(;f<g;){let I=f++,M=this.iUnbounded[I],y=t.rows[M],d=_[M],B=d,R=0,k=this.numUnbounded;for(;R<k;){let A=R++;B+=this.b[this.iUnbounded[A]]*x[I][A]}if(B<y.minImpulse-m.common.Setting.directMlcpSolverEps||B>y.maxImpulse+m.common.Setting.directMlcpSolverEps){v=!1;break}n[M]=B-d}if(o)return!0;if(!v)return!1;let V=0,Z=this.numBounded;for(;V<Z;){let I=V++,M=this.iBounded[I],y=t.rows[M],d=this.signs[I],B=0,R=_[M]+n[M],k=s[M],A=0,z=t.numRows;for(;A<z;){let w=A++;k+=a[M][w]*n[w]}if(B=y.rhs*l-k-y.cfm*R,d<0&&B>m.common.Setting.directMlcpSolverEps||d>0&&B<-m.common.Setting.directMlcpSolverEps){v=!1;break}}return v}};m.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(t){this.size=t,this.numBounded=0,this.iBounded=new Array(t),this.signs=new Array(t),this.numUnbounded=0,this.iUnbounded=new Array(t)}};m.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(t){this.maxRows=t,this.numBoundaries=0,this.boundaries=new Array(1<<t),this.bbInfo=new m.dynamics.constraint.solver.direct.BoundaryBuildInfo(t)}buildBoundariesRecursive(t,i){if(i==t.numRows){this.boundaries[this.numBoundaries]==null&&(this.boundaries[this.numBoundaries]=new m.dynamics.constraint.solver.direct.Boundary(this.maxRows)),this.boundaries[this.numBoundaries++].init(this.bbInfo);return}let s=t.rows[i],_=s.minImpulse>-1/0,n=s.maxImpulse<1/0;if(s.minImpulse==0&&s.maxImpulse==0){let o=this.bbInfo;o.iBounded[o.numBounded]=i,o.signs[o.numBounded]=0,o.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--;return}let l=this.bbInfo;if(l.iUnbounded[l.numUnbounded]=i,l.numUnbounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numUnbounded--,_){let o=this.bbInfo;o.iBounded[o.numBounded]=i,o.signs[o.numBounded]=-1,o.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}if(n){let o=this.bbInfo;o.iBounded[o.numBounded]=i,o.signs[o.numBounded]=1,o.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}}buildBoundaries(t){this.numBoundaries=0;let i=this.bbInfo;i.numBounded=0,i.numUnbounded=0,this.buildBoundariesRecursive(t,0)}};m.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(t){this.n=t,this.indices=new Array(t),this.tmpIndices=new Array(t);let i=0;for(;i<t;){let s=i++;this.indices[s]=s}}getIndex(t){return this.indices[t]}select(t){let i=0;for(;this.indices[i]!=t;)++i;for(;i>0;){let s=this.indices[i];this.indices[i]=this.indices[i-1],this.indices[i-1]=s,--i}}setSize(t){let i=0,s=0,_=0,n=this.n;for(;_<n;){let o=this.indices[_++];o<t?(this.tmpIndices[i]=o,++i):(this.tmpIndices[t+s]=o,++s)}let l=this.indices;this.indices=this.tmpIndices,this.tmpIndices=l}};m.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends m.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new m.dynamics.constraint.info.joint.JointSolverInfo;let i=m.common.Setting.maxJacobianRows;this.massMatrix=new m.dynamics.constraint.solver.direct.MassMatrix(i),this.boundaryBuilder=new m.dynamics.constraint.solver.direct.BoundaryBuilder(i),this.massData=new Array(i);let s=0,_=this.massData.length;for(;s<_;)this.massData[s++]=new m.dynamics.constraint.solver.common.JointSolverMassDataRow;let n=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new m.dynamics.constraint.solver.direct.BoundarySelector(n),this.posBoundarySelector=new m.dynamics.constraint.solver.direct.BoundarySelector(n),this.relVels=new Array(i),this.impulses=new Array(i),this.dImpulses=new Array(i),this.dTotalImpulses=new Array(i);let l=0;for(;l<i;){let o=l++;this.relVels[o]=0,this.impulses[o]=0,this.dImpulses[o]=0,this.dTotalImpulses[o]=0}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let _=this.velBoundarySelector,n=this.boundaryBuilder.numBoundaries,l=0,o=0,r=0,e=_.n;for(;r<e;){let h=_.indices[r++];h<n?(_.tmpIndices[l]=h,++l):(_.tmpIndices[n+o]=h,++o)}let a=_.indices;_.indices=_.tmpIndices,_.tmpIndices=a}warmStart(t){let i=this.joint._positionCorrectionAlgorithm==m.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?m.common.Setting.jointWarmStartingFactorForBaungarte:m.common.Setting.jointWarmStartingFactor;if(i*=t.dtRatio,i<=0){let Z=0,I=this.info.numRows;for(;Z<I;){let M=this.info.rows[Z++].impulse;M.impulse=0,M.impulseM=0,M.impulseP=0}return}let s=0,_=this.info.numRows;for(;s<_;){let Z=s++,I=this.info.rows[Z],M=I.impulse,y=M.impulse*i;if(y<I.minImpulse?y=I.minImpulse:y>I.maxImpulse&&(y=I.maxImpulse),M.impulse=y,I.motorMaxImpulse>0){let d=M.impulseM*i,B=I.motorMaxImpulse;d<-B?d=-B:d>B&&(d=B),M.impulseM=d}else M.impulseM=0;this.dImpulses[Z]=M.impulse+M.impulseM}let n=this.dImpulses,l=!1,o=!1,r,e,a,h,b,X,c,u,p,x,v,f;r=this._b1._velX,e=this._b1._velY,a=this._b1._velZ,h=this._b2._velX,b=this._b2._velY,X=this._b2._velZ,c=this._b1._angVelX,u=this._b1._angVelY,p=this._b1._angVelZ,x=this._b2._angVelX,v=this._b2._angVelY,f=this._b2._angVelZ;let g=0,V=this.info.numRows;for(;g<V;){let Z=g++,I=this.info.rows[Z].jacobian,M=this.massData[Z],y=n[Z];I.flag&1&&(r+=M.invMLin1X*y,e+=M.invMLin1Y*y,a+=M.invMLin1Z*y,h+=M.invMLin2X*-y,b+=M.invMLin2Y*-y,X+=M.invMLin2Z*-y,l=!0),I.flag&2&&(c+=M.invMAng1X*y,u+=M.invMAng1Y*y,p+=M.invMAng1Z*y,x+=M.invMAng2X*-y,v+=M.invMAng2Y*-y,f+=M.invMAng2Z*-y,o=!0)}l&&(this._b1._velX=r,this._b1._velY=e,this._b1._velZ=a,this._b2._velX=h,this._b2._velY=b,this._b2._velZ=X),o&&(this._b1._angVelX=c,this._b1._angVelY=u,this._b1._angVelZ=p,this._b2._angVelX=x,this._b2._angVelY=v,this._b2._angVelZ=f)}solveVelocity(){let t=this.info.numRows,i,s,_,n,l,o,r,e,a,h,b,X;i=this._b1._velX,s=this._b1._velY,_=this._b1._velZ,n=this._b2._velX,l=this._b2._velY,o=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,a=this._b1._angVelZ,h=this._b2._angVelX,b=this._b2._angVelY,X=this._b2._angVelZ;let c=0;for(;c<t;){let g=c++,V=this.info.rows[g],Z=V.jacobian,I=0;I+=i*Z.lin1X+s*Z.lin1Y+_*Z.lin1Z,I-=n*Z.lin2X+l*Z.lin2Y+o*Z.lin2Z,I+=r*Z.ang1X+e*Z.ang1Y+a*Z.ang1Z,I-=h*Z.ang2X+b*Z.ang2Y+X*Z.ang2Z,this.relVels[g]=I,this.impulses[g]=V.impulse.impulse,this.dTotalImpulses[g]=0}let u=this.massMatrix._invMassWithoutCfm,p=0;for(;p<t;){let g=p++,V=this.info.rows[g],Z=V.impulse;if(V.motorMaxImpulse>0){let I=Z.impulseM,M=I+this.massData[g].massWithoutCfm*(-V.motorSpeed-this.relVels[g]),y=V.motorMaxImpulse;M<-y?M=-y:M>y&&(M=y),Z.impulseM=M;let d=M-I;this.dTotalImpulses[g]=d;let B=0;for(;B<t;){let R=B++;this.relVels[R]+=d*u[g][R]}}}let x=!1,v=0,f=this.boundaryBuilder.numBoundaries;for(;v<f;){let g=this.velBoundarySelector.indices[v++];if(this.boundaryBuilder.boundaries[g].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){let V=0;for(;V<t;){let E=V++,D=this.dImpulses[E];this.info.rows[E].impulse.impulse+=D,this.dTotalImpulses[E]+=D}let Z=this.dTotalImpulses,I=!1,M=!1,y,d,B,R,k,A,z,w,S,P,T,C;y=this._b1._velX,d=this._b1._velY,B=this._b1._velZ,R=this._b2._velX,k=this._b2._velY,A=this._b2._velZ,z=this._b1._angVelX,w=this._b1._angVelY,S=this._b1._angVelZ,P=this._b2._angVelX,T=this._b2._angVelY,C=this._b2._angVelZ;let L=0,q=this.info.numRows;for(;L<q;){let E=L++,D=this.info.rows[E].jacobian,Q=this.massData[E],W=Z[E];D.flag&1&&(y+=Q.invMLin1X*W,d+=Q.invMLin1Y*W,B+=Q.invMLin1Z*W,R+=Q.invMLin2X*-W,k+=Q.invMLin2Y*-W,A+=Q.invMLin2Z*-W,I=!0),D.flag&2&&(z+=Q.invMAng1X*W,w+=Q.invMAng1Y*W,S+=Q.invMAng1Z*W,P+=Q.invMAng2X*-W,T+=Q.invMAng2Y*-W,C+=Q.invMAng2Z*-W,M=!0)}I&&(this._b1._velX=y,this._b1._velY=d,this._b1._velZ=B,this._b2._velX=R,this._b2._velY=k,this._b2._velZ=A),M&&(this._b1._angVelX=z,this._b1._angVelY=w,this._b1._angVelZ=S,this._b2._angVelX=P,this._b2._angVelY=T,this._b2._angVelZ=C);let U=this.velBoundarySelector,Y=0;for(;U.indices[Y]!=g;)++Y;for(;Y>0;){let E=U.indices[Y];U.indices[Y]=U.indices[Y-1],U.indices[Y-1]=E,--Y}x=!0;break}}if(!x){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)");return}}postSolveVelocity(t){let i,s,_,n,l,o;i=0,s=0,_=0,n=0,l=0,o=0;let r=0,e=this.info.numRows;for(;r<e;){let a=this.info.rows[r++],h=a.impulse,b=a.jacobian;b.flag&1?(i+=b.lin1X*h.impulse,s+=b.lin1Y*h.impulse,_+=b.lin1Z*h.impulse):b.flag&2&&(n+=b.ang1X*h.impulse,l+=b.ang1Y*h.impulse,o+=b.ang1Z*h.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=s*t.invDt,this.joint._appliedForceZ=_*t.invDt,this.joint._appliedTorqueX=n*t.invDt,this.joint._appliedTorqueY=l*t.invDt,this.joint._appliedTorqueZ=o*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let _=this.posBoundarySelector,n=this.boundaryBuilder.numBoundaries,l=0,o=0,r=0,e=_.n;for(;r<e;){let X=_.indices[r++];X<n?(_.tmpIndices[l]=X,++l):(_.tmpIndices[n+o]=X,++o)}let a=_.indices;_.indices=_.tmpIndices,_.tmpIndices=a;let h=0,b=this.info.numRows;for(;h<b;)this.info.rows[h++].impulse.impulseP=0}solvePositionSplitImpulse(){let t=this.info.numRows,i,s,_,n,l,o,r,e,a,h,b,X;i=this._b1._pseudoVelX,s=this._b1._pseudoVelY,_=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,l=this._b2._pseudoVelY,o=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,e=this._b1._angPseudoVelY,a=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,b=this._b2._angPseudoVelY,X=this._b2._angPseudoVelZ;let c=0;for(;c<t;){let v=c++,f=this.info.rows[v],g=f.jacobian,V=0;V+=i*g.lin1X+s*g.lin1Y+_*g.lin1Z,V-=n*g.lin2X+l*g.lin2Y+o*g.lin2Z,V+=r*g.ang1X+e*g.ang1Y+a*g.ang1Z,V-=h*g.ang2X+b*g.ang2Y+X*g.ang2Z,this.relVels[v]=V,this.impulses[v]=f.impulse.impulseP}let u=!1,p=0,x=this.boundaryBuilder.numBoundaries;for(;p<x;){let v=this.posBoundarySelector.indices[p++];if(this.boundaryBuilder.boundaries[v].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,m.common.Setting.positionSplitImpulseBaumgarte,!1)){let f=0;for(;f<t;){let U=f++;this.info.rows[U].impulse.impulseP+=this.dImpulses[U]}let g=this.dImpulses,V=!1,Z=!1,I,M,y,d,B,R,k,A,z,w,S,P;I=this._b1._pseudoVelX,M=this._b1._pseudoVelY,y=this._b1._pseudoVelZ,d=this._b2._pseudoVelX,B=this._b2._pseudoVelY,R=this._b2._pseudoVelZ,k=this._b1._angPseudoVelX,A=this._b1._angPseudoVelY,z=this._b1._angPseudoVelZ,w=this._b2._angPseudoVelX,S=this._b2._angPseudoVelY,P=this._b2._angPseudoVelZ;let T=0,C=this.info.numRows;for(;T<C;){let U=T++,Y=this.info.rows[U].jacobian,E=this.massData[U],D=g[U];Y.flag&1&&(I+=E.invMLin1X*D,M+=E.invMLin1Y*D,y+=E.invMLin1Z*D,d+=E.invMLin2X*-D,B+=E.invMLin2Y*-D,R+=E.invMLin2Z*-D,V=!0),Y.flag&2&&(k+=E.invMAng1X*D,A+=E.invMAng1Y*D,z+=E.invMAng1Z*D,w+=E.invMAng2X*-D,S+=E.invMAng2Y*-D,P+=E.invMAng2Z*-D,Z=!0)}V&&(this._b1._pseudoVelX=I,this._b1._pseudoVelY=M,this._b1._pseudoVelZ=y,this._b2._pseudoVelX=d,this._b2._pseudoVelY=B,this._b2._pseudoVelZ=R),Z&&(this._b1._angPseudoVelX=k,this._b1._angPseudoVelY=A,this._b1._angPseudoVelZ=z,this._b2._angPseudoVelX=w,this._b2._angPseudoVelY=S,this._b2._angPseudoVelZ=P);let L=this.posBoundarySelector,q=0;for(;L.indices[q]!=v;)++q;for(;q>0;){let U=L.indices[q];L.indices[q]=L.indices[q-1],L.indices[q-1]=U,--q}u=!0;break}}if(!u){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)");return}}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let _=this.posBoundarySelector,n=this.boundaryBuilder.numBoundaries,l=0,o=0,r=0,e=_.n;for(;r<e;){let p=_.indices[r++];p<n?(_.tmpIndices[l]=p,++l):(_.tmpIndices[n+o]=p,++o)}let a=_.indices;_.indices=_.tmpIndices,_.tmpIndices=a;let h=this.info.numRows,b=0;for(;b<h;){let p=b++,x=this.info.rows[p].impulse;this.relVels[p]=0,this.impulses[p]=x.impulseP}let X=!1,c=0,u=this.boundaryBuilder.numBoundaries;for(;c<u;){let p=this.posBoundarySelector.indices[c++];if(this.boundaryBuilder.boundaries[p].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,m.common.Setting.positionNgsBaumgarte,!1)){let x=0;for(;x<h;){let L=x++;this.info.rows[L].impulse.impulseP+=this.dImpulses[L]}let v=this.dImpulses,f=!1,g=!1,V,Z,I,M,y,d,B,R,k,A,z,w;V=0,Z=0,I=0,M=0,y=0,d=0,B=0,R=0,k=0,A=0,z=0,w=0;let S=0,P=this.info.numRows;for(;S<P;){let L=S++,q=this.info.rows[L].jacobian,U=this.massData[L],Y=v[L];q.flag&1&&(V+=U.invMLin1X*Y,Z+=U.invMLin1Y*Y,I+=U.invMLin1Z*Y,M+=U.invMLin2X*-Y,y+=U.invMLin2Y*-Y,d+=U.invMLin2Z*-Y,f=!0),q.flag&2&&(B+=U.invMAng1X*Y,R+=U.invMAng1Y*Y,k+=U.invMAng1Z*Y,A+=U.invMAng2X*-Y,z+=U.invMAng2Y*-Y,w+=U.invMAng2Z*-Y,g=!0)}if(f){let L=this._b1;L._transform._positionX+=V,L._transform._positionY+=Z,L._transform._positionZ+=I;let q=this._b2;q._transform._positionX+=M,q._transform._positionY+=y,q._transform._positionZ+=d}if(g){let L=this._b1,q=Math.sqrt(B*B+R*R+k*k),U=q*.5,Y,E;if(U<.5){let ti=U*U;Y=.5*(1-ti*.16666666666666666+ti*ti*.008333333333333333),E=1-ti*.5+ti*ti*.041666666666666664}else Y=Math.sin(U)/q,E=Math.cos(U);let D,Q,W;D=B*Y,Q=R*Y,W=k*Y;let F,H,G,J;F=D,H=Q,G=W,J=E;let N,K,O,$,et=L._transform._rotation00,st=L._transform._rotation11,lt=L._transform._rotation22,rt=et+st+lt,at;rt>0?(at=Math.sqrt(rt+1),$=.5*at,at=.5/at,N=(L._transform._rotation21-L._transform._rotation12)*at,K=(L._transform._rotation02-L._transform._rotation20)*at,O=(L._transform._rotation10-L._transform._rotation01)*at):et>st?et>lt?(at=Math.sqrt(et-st-lt+1),N=.5*at,at=.5/at,K=(L._transform._rotation01+L._transform._rotation10)*at,O=(L._transform._rotation02+L._transform._rotation20)*at,$=(L._transform._rotation21-L._transform._rotation12)*at):(at=Math.sqrt(lt-et-st+1),O=.5*at,at=.5/at,N=(L._transform._rotation02+L._transform._rotation20)*at,K=(L._transform._rotation12+L._transform._rotation21)*at,$=(L._transform._rotation10-L._transform._rotation01)*at):st>lt?(at=Math.sqrt(st-lt-et+1),K=.5*at,at=.5/at,N=(L._transform._rotation01+L._transform._rotation10)*at,O=(L._transform._rotation12+L._transform._rotation21)*at,$=(L._transform._rotation02-L._transform._rotation20)*at):(at=Math.sqrt(lt-et-st+1),O=.5*at,at=.5/at,N=(L._transform._rotation02+L._transform._rotation20)*at,K=(L._transform._rotation12+L._transform._rotation21)*at,$=(L._transform._rotation10-L._transform._rotation01)*at),N=J*N+F*$+H*O-G*K,K=J*K-F*O+H*$+G*N,O=J*O+F*K-H*N+G*$,$=J*$-F*N-H*K-G*O;let _t=N*N+K*K+O*O+$*$;_t>1e-32&&(_t=1/Math.sqrt(_t)),N*=_t,K*=_t,O*=_t,$*=_t;let ht=N,ot=K,bt=O,Xt=$,ft=2*ht,ut=2*ot,xt=2*bt,zt=ht*ft,gt=ot*ut,pt=bt*xt,ct=ht*ut,nt=ot*xt,tt=ht*xt,kt=Xt*ft,Bt=Xt*ut,Mt=Xt*xt;L._transform._rotation00=1-gt-pt,L._transform._rotation01=ct-Mt,L._transform._rotation02=tt+Bt,L._transform._rotation10=ct+Mt,L._transform._rotation11=1-zt-pt,L._transform._rotation12=nt-kt,L._transform._rotation20=tt-Bt,L._transform._rotation21=nt+kt,L._transform._rotation22=1-zt-gt;let Rt,ci,Xi,gi,ki,wi,ei,Nt,At;Rt=L._transform._rotation00*L._invLocalInertia00+L._transform._rotation01*L._invLocalInertia10+L._transform._rotation02*L._invLocalInertia20,ci=L._transform._rotation00*L._invLocalInertia01+L._transform._rotation01*L._invLocalInertia11+L._transform._rotation02*L._invLocalInertia21,Xi=L._transform._rotation00*L._invLocalInertia02+L._transform._rotation01*L._invLocalInertia12+L._transform._rotation02*L._invLocalInertia22,gi=L._transform._rotation10*L._invLocalInertia00+L._transform._rotation11*L._invLocalInertia10+L._transform._rotation12*L._invLocalInertia20,ki=L._transform._rotation10*L._invLocalInertia01+L._transform._rotation11*L._invLocalInertia11+L._transform._rotation12*L._invLocalInertia21,wi=L._transform._rotation10*L._invLocalInertia02+L._transform._rotation11*L._invLocalInertia12+L._transform._rotation12*L._invLocalInertia22,ei=L._transform._rotation20*L._invLocalInertia00+L._transform._rotation21*L._invLocalInertia10+L._transform._rotation22*L._invLocalInertia20,Nt=L._transform._rotation20*L._invLocalInertia01+L._transform._rotation21*L._invLocalInertia11+L._transform._rotation22*L._invLocalInertia21,At=L._transform._rotation20*L._invLocalInertia02+L._transform._rotation21*L._invLocalInertia12+L._transform._rotation22*L._invLocalInertia22,L._invInertia00=Rt,L._invInertia01=ci,L._invInertia02=Xi,L._invInertia10=gi,L._invInertia11=ki,L._invInertia12=wi,L._invInertia20=ei,L._invInertia21=Nt,L._invInertia22=At;let ni,di,Oi,Bi,Vt,wt,$t,fi,Zi;ni=L._invInertia00*L._transform._rotation00+L._invInertia01*L._transform._rotation01+L._invInertia02*L._transform._rotation02,di=L._invInertia00*L._transform._rotation10+L._invInertia01*L._transform._rotation11+L._invInertia02*L._transform._rotation12,Oi=L._invInertia00*L._transform._rotation20+L._invInertia01*L._transform._rotation21+L._invInertia02*L._transform._rotation22,Bi=L._invInertia10*L._transform._rotation00+L._invInertia11*L._transform._rotation01+L._invInertia12*L._transform._rotation02,Vt=L._invInertia10*L._transform._rotation10+L._invInertia11*L._transform._rotation11+L._invInertia12*L._transform._rotation12,wt=L._invInertia10*L._transform._rotation20+L._invInertia11*L._transform._rotation21+L._invInertia12*L._transform._rotation22,$t=L._invInertia20*L._transform._rotation00+L._invInertia21*L._transform._rotation01+L._invInertia22*L._transform._rotation02,fi=L._invInertia20*L._transform._rotation10+L._invInertia21*L._transform._rotation11+L._invInertia22*L._transform._rotation12,Zi=L._invInertia20*L._transform._rotation20+L._invInertia21*L._transform._rotation21+L._invInertia22*L._transform._rotation22,L._invInertia00=ni,L._invInertia01=di,L._invInertia02=Oi,L._invInertia10=Bi,L._invInertia11=Vt,L._invInertia12=wt,L._invInertia20=$t,L._invInertia21=fi,L._invInertia22=Zi,L._invInertia00*=L._rotFactor.x,L._invInertia01*=L._rotFactor.x,L._invInertia02*=L._rotFactor.x,L._invInertia10*=L._rotFactor.y,L._invInertia11*=L._rotFactor.y,L._invInertia12*=L._rotFactor.y,L._invInertia20*=L._rotFactor.z,L._invInertia21*=L._rotFactor.z,L._invInertia22*=L._rotFactor.z;let it=this._b2,Ut=Math.sqrt(A*A+z*z+w*w),ii=Ut*.5,j,Jt;if(ii<.5){let ti=ii*ii;j=.5*(1-ti*.16666666666666666+ti*ti*.008333333333333333),Jt=1-ti*.5+ti*ti*.041666666666666664}else j=Math.sin(ii)/Ut,Jt=Math.cos(ii);let Pt,si,_i;Pt=A*j,si=z*j,_i=w*j;let St,ai,qi,ui;St=Pt,ai=si,qi=_i,ui=Jt;let Yt,yt,vt,yi,Ii=it._transform._rotation00,bi=it._transform._rotation11,se=it._transform._rotation22,me=Ii+bi+se,Ei;me>0?(Ei=Math.sqrt(me+1),yi=.5*Ei,Ei=.5/Ei,Yt=(it._transform._rotation21-it._transform._rotation12)*Ei,yt=(it._transform._rotation02-it._transform._rotation20)*Ei,vt=(it._transform._rotation10-it._transform._rotation01)*Ei):Ii>bi?Ii>se?(Ei=Math.sqrt(Ii-bi-se+1),Yt=.5*Ei,Ei=.5/Ei,yt=(it._transform._rotation01+it._transform._rotation10)*Ei,vt=(it._transform._rotation02+it._transform._rotation20)*Ei,yi=(it._transform._rotation21-it._transform._rotation12)*Ei):(Ei=Math.sqrt(se-Ii-bi+1),vt=.5*Ei,Ei=.5/Ei,Yt=(it._transform._rotation02+it._transform._rotation20)*Ei,yt=(it._transform._rotation12+it._transform._rotation21)*Ei,yi=(it._transform._rotation10-it._transform._rotation01)*Ei):bi>se?(Ei=Math.sqrt(bi-se-Ii+1),yt=.5*Ei,Ei=.5/Ei,Yt=(it._transform._rotation01+it._transform._rotation10)*Ei,vt=(it._transform._rotation12+it._transform._rotation21)*Ei,yi=(it._transform._rotation02-it._transform._rotation20)*Ei):(Ei=Math.sqrt(se-Ii-bi+1),vt=.5*Ei,Ei=.5/Ei,Yt=(it._transform._rotation02+it._transform._rotation20)*Ei,yt=(it._transform._rotation12+it._transform._rotation21)*Ei,yi=(it._transform._rotation10-it._transform._rotation01)*Ei),Yt=ui*Yt+St*yi+ai*vt-qi*yt,yt=ui*yt-St*vt+ai*yi+qi*Yt,vt=ui*vt+St*yt-ai*Yt+qi*yi,yi=ui*yi-St*Yt-ai*yt-qi*vt;let he=Yt*Yt+yt*yt+vt*vt+yi*yi;he>1e-32&&(he=1/Math.sqrt(he)),Yt*=he,yt*=he,vt*=he,yi*=he;let ve=Yt,oi=yt,ce=vt,be=yi,xe=2*ve,Ye=2*oi,Ni=2*ce,Ji=ve*xe,Hi=oi*Ye,_e=ce*Ni,ne=ve*Ye,Ki=oi*Ni,ie=ve*Ni,Ui=be*xe,Wi=be*Ye,Si=be*Ni;it._transform._rotation00=1-Hi-_e,it._transform._rotation01=ne-Si,it._transform._rotation02=ie+Wi,it._transform._rotation10=ne+Si,it._transform._rotation11=1-Ji-_e,it._transform._rotation12=Ki-Ui,it._transform._rotation20=ie-Wi,it._transform._rotation21=Ki+Ui,it._transform._rotation22=1-Ji-Hi;let Ht,ri,Tt,Mi,zi,Pi,Vi,ji,Gt;Ht=it._transform._rotation00*it._invLocalInertia00+it._transform._rotation01*it._invLocalInertia10+it._transform._rotation02*it._invLocalInertia20,ri=it._transform._rotation00*it._invLocalInertia01+it._transform._rotation01*it._invLocalInertia11+it._transform._rotation02*it._invLocalInertia21,Tt=it._transform._rotation00*it._invLocalInertia02+it._transform._rotation01*it._invLocalInertia12+it._transform._rotation02*it._invLocalInertia22,Mi=it._transform._rotation10*it._invLocalInertia00+it._transform._rotation11*it._invLocalInertia10+it._transform._rotation12*it._invLocalInertia20,zi=it._transform._rotation10*it._invLocalInertia01+it._transform._rotation11*it._invLocalInertia11+it._transform._rotation12*it._invLocalInertia21,Pi=it._transform._rotation10*it._invLocalInertia02+it._transform._rotation11*it._invLocalInertia12+it._transform._rotation12*it._invLocalInertia22,Vi=it._transform._rotation20*it._invLocalInertia00+it._transform._rotation21*it._invLocalInertia10+it._transform._rotation22*it._invLocalInertia20,ji=it._transform._rotation20*it._invLocalInertia01+it._transform._rotation21*it._invLocalInertia11+it._transform._rotation22*it._invLocalInertia21,Gt=it._transform._rotation20*it._invLocalInertia02+it._transform._rotation21*it._invLocalInertia12+it._transform._rotation22*it._invLocalInertia22,it._invInertia00=Ht,it._invInertia01=ri,it._invInertia02=Tt,it._invInertia10=Mi,it._invInertia11=zi,it._invInertia12=Pi,it._invInertia20=Vi,it._invInertia21=ji,it._invInertia22=Gt;let dt,Lt,Ai,Li,Di,$i,ae,re,pe;dt=it._invInertia00*it._transform._rotation00+it._invInertia01*it._transform._rotation01+it._invInertia02*it._transform._rotation02,Lt=it._invInertia00*it._transform._rotation10+it._invInertia01*it._transform._rotation11+it._invInertia02*it._transform._rotation12,Ai=it._invInertia00*it._transform._rotation20+it._invInertia01*it._transform._rotation21+it._invInertia02*it._transform._rotation22,Li=it._invInertia10*it._transform._rotation00+it._invInertia11*it._transform._rotation01+it._invInertia12*it._transform._rotation02,Di=it._invInertia10*it._transform._rotation10+it._invInertia11*it._transform._rotation11+it._invInertia12*it._transform._rotation12,$i=it._invInertia10*it._transform._rotation20+it._invInertia11*it._transform._rotation21+it._invInertia12*it._transform._rotation22,ae=it._invInertia20*it._transform._rotation00+it._invInertia21*it._transform._rotation01+it._invInertia22*it._transform._rotation02,re=it._invInertia20*it._transform._rotation10+it._invInertia21*it._transform._rotation11+it._invInertia22*it._transform._rotation12,pe=it._invInertia20*it._transform._rotation20+it._invInertia21*it._transform._rotation21+it._invInertia22*it._transform._rotation22,it._invInertia00=dt,it._invInertia01=Lt,it._invInertia02=Ai,it._invInertia10=Li,it._invInertia11=Di,it._invInertia12=$i,it._invInertia20=ae,it._invInertia21=re,it._invInertia22=pe,it._invInertia00*=it._rotFactor.x,it._invInertia01*=it._rotFactor.x,it._invInertia02*=it._rotFactor.x,it._invInertia10*=it._rotFactor.y,it._invInertia11*=it._rotFactor.y,it._invInertia12*=it._rotFactor.y,it._invInertia20*=it._rotFactor.z,it._invInertia21*=it._rotFactor.z,it._invInertia22*=it._rotFactor.z}let T=this.posBoundarySelector,C=0;for(;T.indices[C]!=p;)++C;for(;C>0;){let L=T.indices[C];T.indices[C]=T.indices[C-1],T.indices[C-1]=L,--C}X=!0;break}}if(!X){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)");return}}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};m.dynamics.constraint.solver.direct.MassMatrix=class{constructor(t){this._size=t,this.tmpMatrix=new Array(this._size),this._invMass=new Array(this._size),this._invMassWithoutCfm=new Array(this._size);let i=0,s=this._size;for(;i<s;){let l=i++;this.tmpMatrix[l]=new Array(this._size),this._invMass[l]=new Array(this._size),this._invMassWithoutCfm[l]=new Array(this._size);let o=0,r=this._size;for(;o<r;){let e=o++;this.tmpMatrix[l][e]=0,this._invMass[l][e]=0,this._invMassWithoutCfm[l][e]=0}}this._maxSubmatrixId=1<<this._size,this._cacheComputed=new Array(this._maxSubmatrixId),this._cachedSubmatrices=new Array(this._maxSubmatrixId);let _=0,n=this._maxSubmatrixId;for(;_<n;){let l=_++,o;o=(l&85)+(l>>1&85),o=(o&51)+(o>>2&51),o=(o&15)+(o>>4&15);let r=o,e=new Array(r),a=0;for(;a<r;){let h=a++;e[h]=new Array(r);let b=0;for(;b<r;)e[h][b++]=0}this._cacheComputed[l]=!1,this._cachedSubmatrices[l]=e}}computeSubmatrix(t,i,s){let _=0;for(;_<s;){let b=_++,X=i[b],c=0;for(;c<s;){let u=c++;this.tmpMatrix[b][u]=this._invMass[X][i[u]]}}let n=this.tmpMatrix,l=this._cachedSubmatrices[t],o,r,e,a,h;switch(s){case 4:o=n[0],r=l[0],h=1/o[0],r[0]=h,o[1]*=h,o[2]*=h,o[3]*=h,e=n[1],a=l[1],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e=n[2],a=l[2],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e=n[3],a=l[3],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],o=n[1],r=l[1],h=1/o[1],r[1]=h,r[0]*=h,o[2]*=h,o[3]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e=n[2],a=l[2],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e=n[3],a=l[3],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],o=n[2],r=l[2],h=1/o[2],r[2]=h,r[0]*=h,r[1]*=h,o[3]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[2],e[3]-=o[3]*e[2],e=n[1],a=l[1],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],e[3]-=o[3]*e[2],e=n[3],a=l[3],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=o[3]*e[2],o=n[3],r=l[3],h=1/o[3],r[3]=h,r[0]*=h,r[1]*=h,r[2]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[3],e=n[1],a=l[1],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],e=n[2],a=l[2],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],r=l[1],l[0][1]=r[0],r=l[2],l[0][2]=r[0],l[1][2]=r[1],r=l[3],l[0][3]=r[0],l[1][3]=r[1],l[2][3]=r[2];break;case 5:o=n[0],r=l[0],h=1/o[0],r[0]=h,o[1]*=h,o[2]*=h,o[3]*=h,o[4]*=h,e=n[1],a=l[1],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e=n[2],a=l[2],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e=n[3],a=l[3],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e=n[4],a=l[4],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],o=n[1],r=l[1],h=1/o[1],r[1]=h,r[0]*=h,o[2]*=h,o[3]*=h,o[4]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e=n[2],a=l[2],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e=n[3],a=l[3],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e=n[4],a=l[4],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],o=n[2],r=l[2],h=1/o[2],r[2]=h,r[0]*=h,r[1]*=h,o[3]*=h,o[4]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e=n[1],a=l[1],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e=n[3],a=l[3],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e=n[4],a=l[4],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],o=n[3],r=l[3],h=1/o[3],r[3]=h,r[0]*=h,r[1]*=h,r[2]*=h,o[4]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[3],e[4]-=o[4]*e[3],e=n[1],a=l[1],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],e[4]-=o[4]*e[3],e=n[2],a=l[2],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],e[4]-=o[4]*e[3],e=n[4],a=l[4],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],a[3]=-h*e[3],e[4]-=o[4]*e[3],o=n[4],r=l[4],h=1/o[4],r[4]=h,r[0]*=h,r[1]*=h,r[2]*=h,r[3]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[4],e=n[1],a=l[1],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],e=n[2],a=l[2],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],a[2]-=r[2]*e[4],e=n[3],a=l[3],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],a[2]-=r[2]*e[4],a[3]-=r[3]*e[4],r=l[1],l[0][1]=r[0],r=l[2],l[0][2]=r[0],l[1][2]=r[1],r=l[3],l[0][3]=r[0],l[1][3]=r[1],l[2][3]=r[2],r=l[4],l[0][4]=r[0],l[1][4]=r[1],l[2][4]=r[2],l[3][4]=r[3];break;case 6:o=n[0],r=l[0],h=1/o[0],r[0]=h,o[1]*=h,o[2]*=h,o[3]*=h,o[4]*=h,o[5]*=h,e=n[1],a=l[1],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=n[2],a=l[2],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=n[3],a=l[3],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=n[4],a=l[4],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=n[5],a=l[5],a[0]=-h*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],o=n[1],r=l[1],h=1/o[1],r[1]=h,r[0]*=h,o[2]*=h,o[3]*=h,o[4]*=h,o[5]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=n[2],a=l[2],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=n[3],a=l[3],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=n[4],a=l[4],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=n[5],a=l[5],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],o=n[2],r=l[2],h=1/o[2],r[2]=h,r[0]*=h,r[1]*=h,o[3]*=h,o[4]*=h,o[5]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=n[1],a=l[1],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=n[3],a=l[3],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=n[4],a=l[4],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=n[5],a=l[5],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],o=n[3],r=l[3],h=1/o[3],r[3]=h,r[0]*=h,r[1]*=h,r[2]*=h,o[4]*=h,o[5]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=n[1],a=l[1],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=n[2],a=l[2],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=n[4],a=l[4],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],a[3]=-h*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=n[5],a=l[5],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],a[3]=-h*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],o=n[4],r=l[4],h=1/o[4],r[4]=h,r[0]*=h,r[1]*=h,r[2]*=h,r[3]*=h,o[5]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[4],e[5]-=o[5]*e[4],e=n[1],a=l[1],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],e[5]-=o[5]*e[4],e=n[2],a=l[2],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],a[2]-=r[2]*e[4],e[5]-=o[5]*e[4],e=n[3],a=l[3],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],a[2]-=r[2]*e[4],a[3]-=r[3]*e[4],e[5]-=o[5]*e[4],e=n[5],a=l[5],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],a[2]-=r[2]*e[4],a[3]-=r[3]*e[4],a[4]=-h*e[4],e[5]-=o[5]*e[4],o=n[5],r=l[5],h=1/o[5],r[5]=h,r[0]*=h,r[1]*=h,r[2]*=h,r[3]*=h,r[4]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[5],e=n[1],a=l[1],a[0]-=r[0]*e[5],a[1]-=r[1]*e[5],e=n[2],a=l[2],a[0]-=r[0]*e[5],a[1]-=r[1]*e[5],a[2]-=r[2]*e[5],e=n[3],a=l[3],a[0]-=r[0]*e[5],a[1]-=r[1]*e[5],a[2]-=r[2]*e[5],a[3]-=r[3]*e[5],e=n[4],a=l[4],a[0]-=r[0]*e[5],a[1]-=r[1]*e[5],a[2]-=r[2]*e[5],a[3]-=r[3]*e[5],a[4]-=r[4]*e[5],r=l[1],l[0][1]=r[0],r=l[2],l[0][2]=r[0],l[1][2]=r[1],r=l[3],l[0][3]=r[0],l[1][3]=r[1],l[2][3]=r[2],r=l[4],l[0][4]=r[0],l[1][4]=r[1],l[2][4]=r[2],l[3][4]=r[3],r=l[5],l[0][5]=r[0],l[1][5]=r[1],l[2][5]=r[2],l[3][5]=r[3],l[4][5]=r[4];break;default:let b=0;for(;b<s;){let c=b++;o=n[c],r=l[c];let u=1/o[c];r[c]=u;let p=0;for(;p<c;)r[p++]*=u;let x=c+1;for(;x<s;)o[x++]*=u;let v=0;for(;v<c;){let g=v++;e=n[g],a=l[g];let V=0,Z=g+1;for(;V<Z;){let M=V++;a[M]-=r[M]*e[c]}let I=c+1;for(;I<s;){let M=I++;e[M]-=o[M]*e[c]}}let f=c+1;for(;f<s;){let g=f++;e=n[g],a=l[g];let V=0;for(;V<c;){let I=V++;a[I]-=r[I]*e[c]}a[c]=-u*e[c];let Z=c+1;for(;Z<s;){let I=Z++;e[I]-=o[I]*e[c]}}}let X=1;for(;X<s;){let c=X++;r=l[c];let u=0;for(;u<c;){let p=u++;l[p][c]=r[p]}}}}computeInvMass(t,i){let s=this._invMass,_=this._invMassWithoutCfm,n=t.numRows,l=t.b1,o=t.b2,r=l._invMass,e=o._invMass,a,h,b,X,c,u,p,x,v,f,g,V,Z,I,M,y,d,B;a=l._invInertia00,h=l._invInertia01,b=l._invInertia02,X=l._invInertia10,c=l._invInertia11,u=l._invInertia12,p=l._invInertia20,x=l._invInertia21,v=l._invInertia22,f=o._invInertia00,g=o._invInertia01,V=o._invInertia02,Z=o._invInertia10,I=o._invInertia11,M=o._invInertia12,y=o._invInertia20,d=o._invInertia21,B=o._invInertia22;let R=0;for(;R<n;){let w=R++,S=t.rows[w].jacobian,P=i[w];if(S.updateSparsity(),S.flag&1?(P.invMLin1X=S.lin1X*r,P.invMLin1Y=S.lin1Y*r,P.invMLin1Z=S.lin1Z*r,P.invMLin2X=S.lin2X*e,P.invMLin2Y=S.lin2Y*e,P.invMLin2Z=S.lin2Z*e):(P.invMLin1X=0,P.invMLin1Y=0,P.invMLin1Z=0,P.invMLin2X=0,P.invMLin2Y=0,P.invMLin2Z=0),S.flag&2){let T,C,L;T=a*S.ang1X+h*S.ang1Y+b*S.ang1Z,C=X*S.ang1X+c*S.ang1Y+u*S.ang1Z,L=p*S.ang1X+x*S.ang1Y+v*S.ang1Z,P.invMAng1X=T,P.invMAng1Y=C,P.invMAng1Z=L;let q,U,Y;q=f*S.ang2X+g*S.ang2Y+V*S.ang2Z,U=Z*S.ang2X+I*S.ang2Y+M*S.ang2Z,Y=y*S.ang2X+d*S.ang2Y+B*S.ang2Z,P.invMAng2X=q,P.invMAng2Y=U,P.invMAng2Z=Y}else P.invMAng1X=0,P.invMAng1Y=0,P.invMAng1Z=0,P.invMAng2X=0,P.invMAng2Y=0,P.invMAng2Z=0}let k=0;for(;k<n;){let w=k++,S=t.rows[w].jacobian,P=w;for(;P<n;){let T=P++,C=i[T],L=S.lin1X*C.invMLin1X+S.lin1Y*C.invMLin1Y+S.lin1Z*C.invMLin1Z+(S.ang1X*C.invMAng1X+S.ang1Y*C.invMAng1Y+S.ang1Z*C.invMAng1Z)+(S.lin2X*C.invMLin2X+S.lin2Y*C.invMLin2Y+S.lin2Z*C.invMLin2Z)+(S.ang2X*C.invMAng2X+S.ang2Y*C.invMAng2Y+S.ang2Z*C.invMAng2Z);w==T?(s[w][T]=L+t.rows[w].cfm,_[w][T]=L,C.mass=L+t.rows[w].cfm,C.massWithoutCfm=L,C.mass!=0&&(C.mass=1/C.mass),C.massWithoutCfm!=0&&(C.massWithoutCfm=1/C.massWithoutCfm)):(s[w][T]=L,s[T][w]=L,_[w][T]=L,_[T][w]=L)}}let A=0,z=this._maxSubmatrixId;for(;A<z;)this._cacheComputed[A++]=!1}};m.dynamics.constraint.solver.pgs||(m.dynamics.constraint.solver.pgs={});m.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends m.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.constraint=t,this.info=new m.dynamics.constraint.info.contact.ContactSolverInfo,this.massData=new Array(m.common.Setting.maxManifoldPoints);let i=0,s=this.massData.length;for(;i<s;)this.massData[i++]=new m.dynamics.constraint.solver.common.ContactSolverMassDataRow}preSolveVelocity(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i=this._b1._invMass,s=this._b2._invMass,_,n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V;_=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,o=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,u=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,g=this._b2._invInertia21,V=this._b2._invInertia22;let Z=0,I=this.info.numRows;for(;Z<I;){let M=Z++,y=this.info.rows[M],d=this.massData[M],B=y.jacobianN;d.invMLinN1X=B.lin1X*i,d.invMLinN1Y=B.lin1Y*i,d.invMLinN1Z=B.lin1Z*i,d.invMLinN2X=B.lin2X*s,d.invMLinN2Y=B.lin2Y*s,d.invMLinN2Z=B.lin2Z*s;let R,k,A;R=_*B.ang1X+n*B.ang1Y+l*B.ang1Z,k=o*B.ang1X+r*B.ang1Y+e*B.ang1Z,A=a*B.ang1X+h*B.ang1Y+b*B.ang1Z,d.invMAngN1X=R,d.invMAngN1Y=k,d.invMAngN1Z=A;let z,w,S;z=X*B.ang2X+c*B.ang2Y+u*B.ang2Z,w=p*B.ang2X+x*B.ang2Y+v*B.ang2Z,S=f*B.ang2X+g*B.ang2Y+V*B.ang2Z,d.invMAngN2X=z,d.invMAngN2Y=w,d.invMAngN2Z=S,d.massN=i+s+(d.invMAngN1X*B.ang1X+d.invMAngN1Y*B.ang1Y+d.invMAngN1Z*B.ang1Z)+(d.invMAngN2X*B.ang2X+d.invMAngN2Y*B.ang2Y+d.invMAngN2Z*B.ang2Z),d.massN!=0&&(d.massN=1/d.massN);let P=y.jacobianT,T=y.jacobianB;d.invMLinT1X=P.lin1X*i,d.invMLinT1Y=P.lin1Y*i,d.invMLinT1Z=P.lin1Z*i,d.invMLinT2X=P.lin2X*s,d.invMLinT2Y=P.lin2Y*s,d.invMLinT2Z=P.lin2Z*s,d.invMLinB1X=T.lin1X*i,d.invMLinB1Y=T.lin1Y*i,d.invMLinB1Z=T.lin1Z*i,d.invMLinB2X=T.lin2X*s,d.invMLinB2Y=T.lin2Y*s,d.invMLinB2Z=T.lin2Z*s;let C,L,q;C=_*P.ang1X+n*P.ang1Y+l*P.ang1Z,L=o*P.ang1X+r*P.ang1Y+e*P.ang1Z,q=a*P.ang1X+h*P.ang1Y+b*P.ang1Z,d.invMAngT1X=C,d.invMAngT1Y=L,d.invMAngT1Z=q;let U,Y,E;U=X*P.ang2X+c*P.ang2Y+u*P.ang2Z,Y=p*P.ang2X+x*P.ang2Y+v*P.ang2Z,E=f*P.ang2X+g*P.ang2Y+V*P.ang2Z,d.invMAngT2X=U,d.invMAngT2Y=Y,d.invMAngT2Z=E;let D,Q,W;D=_*T.ang1X+n*T.ang1Y+l*T.ang1Z,Q=o*T.ang1X+r*T.ang1Y+e*T.ang1Z,W=a*T.ang1X+h*T.ang1Y+b*T.ang1Z,d.invMAngB1X=D,d.invMAngB1Y=Q,d.invMAngB1Z=W;let F,H,G;F=X*T.ang2X+c*T.ang2Y+u*T.ang2Z,H=p*T.ang2X+x*T.ang2Y+v*T.ang2Z,G=f*T.ang2X+g*T.ang2Y+V*T.ang2Z,d.invMAngB2X=F,d.invMAngB2Y=H,d.invMAngB2Z=G;let J=i+s+(d.invMAngT1X*P.ang1X+d.invMAngT1Y*P.ang1Y+d.invMAngT1Z*P.ang1Z)+(d.invMAngT2X*P.ang2X+d.invMAngT2Y*P.ang2Y+d.invMAngT2Z*P.ang2Z),N=d.invMAngT1X*T.ang1X+d.invMAngT1Y*T.ang1Y+d.invMAngT1Z*T.ang1Z+(d.invMAngT2X*T.ang2X+d.invMAngT2Y*T.ang2Y+d.invMAngT2Z*T.ang2Z),K=i+s+(d.invMAngB1X*T.ang1X+d.invMAngB1Y*T.ang1Y+d.invMAngB1Z*T.ang1Z)+(d.invMAngB2X*T.ang2X+d.invMAngB2Y*T.ang2Y+d.invMAngB2Z*T.ang2Z),O=J*K-N*N;O!=0&&(O=1/O),d.massTB00=K*O,d.massTB01=-N*O,d.massTB10=-N*O,d.massTB11=J*O}}warmStart(t){let i,s,_,n,l,o,r,e,a,h,b,X;i=this._b1._velX,s=this._b1._velY,_=this._b1._velZ,n=this._b2._velX,l=this._b2._velY,o=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,a=this._b1._angVelZ,h=this._b2._angVelX,b=this._b2._angVelY,X=this._b2._angVelZ;let c=0,u=this.info.numRows;for(;c<u;){let p=c++,x=this.info.rows[p],v=x.impulse,f=this.massData[p],g=x.jacobianT,V=x.jacobianB,Z=v.impulseN,I=v.impulseLX*g.lin1X+v.impulseLY*g.lin1Y+v.impulseLZ*g.lin1Z,M=v.impulseLX*V.lin1X+v.impulseLY*V.lin1Y+v.impulseLZ*V.lin1Z;v.impulseT=I,v.impulseB=M,v.impulseN*=t.dtRatio,v.impulseT*=t.dtRatio,v.impulseB*=t.dtRatio,i+=f.invMLinN1X*Z,s+=f.invMLinN1Y*Z,_+=f.invMLinN1Z*Z,i+=f.invMLinT1X*I,s+=f.invMLinT1Y*I,_+=f.invMLinT1Z*I,i+=f.invMLinB1X*M,s+=f.invMLinB1Y*M,_+=f.invMLinB1Z*M,n+=f.invMLinN2X*-Z,l+=f.invMLinN2Y*-Z,o+=f.invMLinN2Z*-Z,n+=f.invMLinT2X*-I,l+=f.invMLinT2Y*-I,o+=f.invMLinT2Z*-I,n+=f.invMLinB2X*-M,l+=f.invMLinB2Y*-M,o+=f.invMLinB2Z*-M,r+=f.invMAngN1X*Z,e+=f.invMAngN1Y*Z,a+=f.invMAngN1Z*Z,r+=f.invMAngT1X*I,e+=f.invMAngT1Y*I,a+=f.invMAngT1Z*I,r+=f.invMAngB1X*M,e+=f.invMAngB1Y*M,a+=f.invMAngB1Z*M,h+=f.invMAngN2X*-Z,b+=f.invMAngN2Y*-Z,X+=f.invMAngN2Z*-Z,h+=f.invMAngT2X*-I,b+=f.invMAngT2Y*-I,X+=f.invMAngT2Z*-I,h+=f.invMAngB2X*-M,b+=f.invMAngB2Y*-M,X+=f.invMAngB2Z*-M}this._b1._velX=i,this._b1._velY=s,this._b1._velZ=_,this._b2._velX=n,this._b2._velY=l,this._b2._velZ=o,this._b1._angVelX=r,this._b1._angVelY=e,this._b1._angVelZ=a,this._b2._angVelX=h,this._b2._angVelY=b,this._b2._angVelZ=X}solveVelocity(){let t,i,s,_,n,l,o,r,e,a,h,b;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,_=this._b2._velX,n=this._b2._velY,l=this._b2._velZ,o=this._b1._angVelX,r=this._b1._angVelY,e=this._b1._angVelZ,a=this._b2._angVelX,h=this._b2._angVelY,b=this._b2._angVelZ;let X=0,c=this.info.numRows;for(;X<c;){let x=X++,v=this.info.rows[x],f=this.massData[x],g=v.impulse,V=0,Z=v.jacobianT;V+=t*Z.lin1X+i*Z.lin1Y+s*Z.lin1Z,V-=_*Z.lin2X+n*Z.lin2Y+l*Z.lin2Z,V+=o*Z.ang1X+r*Z.ang1Y+e*Z.ang1Z,V-=a*Z.ang2X+h*Z.ang2Y+b*Z.ang2Z;let I=0;Z=v.jacobianB,I+=t*Z.lin1X+i*Z.lin1Y+s*Z.lin1Z,I-=_*Z.lin2X+n*Z.lin2Y+l*Z.lin2Z,I+=o*Z.ang1X+r*Z.ang1Y+e*Z.ang1Z,I-=a*Z.ang2X+h*Z.ang2Y+b*Z.ang2Z;let M=-(V*f.massTB00+I*f.massTB01),y=-(V*f.massTB10+I*f.massTB11),d=g.impulseT,B=g.impulseB;g.impulseT+=M,g.impulseB+=y;let R=v.friction*g.impulseN;if(R==0)g.impulseT=0,g.impulseB=0;else{let k=g.impulseT*g.impulseT+g.impulseB*g.impulseB;if(k>R*R){let A=R/Math.sqrt(k);g.impulseT*=A,g.impulseB*=A}}M=g.impulseT-d,y=g.impulseB-B,t+=f.invMLinT1X*M,i+=f.invMLinT1Y*M,s+=f.invMLinT1Z*M,t+=f.invMLinB1X*y,i+=f.invMLinB1Y*y,s+=f.invMLinB1Z*y,_+=f.invMLinT2X*-M,n+=f.invMLinT2Y*-M,l+=f.invMLinT2Z*-M,_+=f.invMLinB2X*-y,n+=f.invMLinB2Y*-y,l+=f.invMLinB2Z*-y,o+=f.invMAngT1X*M,r+=f.invMAngT1Y*M,e+=f.invMAngT1Z*M,o+=f.invMAngB1X*y,r+=f.invMAngB1Y*y,e+=f.invMAngB1Z*y,a+=f.invMAngT2X*-M,h+=f.invMAngT2Y*-M,b+=f.invMAngT2Z*-M,a+=f.invMAngB2X*-y,h+=f.invMAngB2Y*-y,b+=f.invMAngB2Z*-y}let u=0,p=this.info.numRows;for(;u<p;){let x=u++,v=this.info.rows[x],f=this.massData[x],g=v.impulse,V=0,Z=v.jacobianN;V+=t*Z.lin1X+i*Z.lin1Y+s*Z.lin1Z,V-=_*Z.lin2X+n*Z.lin2Y+l*Z.lin2Z,V+=o*Z.ang1X+r*Z.ang1Y+e*Z.ang1Z,V-=a*Z.ang2X+h*Z.ang2Y+b*Z.ang2Z;let I=(v.rhs-V)*f.massN,M=g.impulseN;g.impulseN+=I,g.impulseN<0&&(g.impulseN=0),I=g.impulseN-M,t+=f.invMLinN1X*I,i+=f.invMLinN1Y*I,s+=f.invMLinN1Z*I,_+=f.invMLinN2X*-I,n+=f.invMLinN2Y*-I,l+=f.invMLinN2Z*-I,o+=f.invMAngN1X*I,r+=f.invMAngN1Y*I,e+=f.invMAngN1Z*I,a+=f.invMAngN2X*-I,h+=f.invMAngN2Y*-I,b+=f.invMAngN2Z*-I}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=s,this._b2._velX=_,this._b2._velY=n,this._b2._velZ=l,this._b1._angVelX=o,this._b1._angVelY=r,this._b1._angVelZ=e,this._b2._angVelX=a,this._b2._angVelY=h,this._b2._angVelZ=b}preSolvePosition(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i=this._b1._invMass,s=this._b2._invMass,_,n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V;_=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,o=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,u=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,g=this._b2._invInertia21,V=this._b2._invInertia22;let Z=0,I=this.info.numRows;for(;Z<I;){let d=Z++,B=this.massData[d],R=this.info.rows[d].jacobianN;B.invMLinN1X=R.lin1X*i,B.invMLinN1Y=R.lin1Y*i,B.invMLinN1Z=R.lin1Z*i,B.invMLinN2X=R.lin2X*s,B.invMLinN2Y=R.lin2Y*s,B.invMLinN2Z=R.lin2Z*s;let k,A,z;k=_*R.ang1X+n*R.ang1Y+l*R.ang1Z,A=o*R.ang1X+r*R.ang1Y+e*R.ang1Z,z=a*R.ang1X+h*R.ang1Y+b*R.ang1Z,B.invMAngN1X=k,B.invMAngN1Y=A,B.invMAngN1Z=z;let w,S,P;w=X*R.ang2X+c*R.ang2Y+u*R.ang2Z,S=p*R.ang2X+x*R.ang2Y+v*R.ang2Z,P=f*R.ang2X+g*R.ang2Y+V*R.ang2Z,B.invMAngN2X=w,B.invMAngN2Y=S,B.invMAngN2Z=P,B.massN=i+s+(B.invMAngN1X*R.ang1X+B.invMAngN1Y*R.ang1Y+B.invMAngN1Z*R.ang1Z)+(B.invMAngN2X*R.ang2X+B.invMAngN2Y*R.ang2Y+B.invMAngN2Z*R.ang2Z),B.massN!=0&&(B.massN=1/B.massN)}let M=0,y=this.info.numRows;for(;M<y;)this.info.rows[M++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,s,_,n,l,o,r,e,a,h,b;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,_=this._b2._pseudoVelX,n=this._b2._pseudoVelY,l=this._b2._pseudoVelZ,o=this._b1._angPseudoVelX,r=this._b1._angPseudoVelY,e=this._b1._angPseudoVelZ,a=this._b2._angPseudoVelX,h=this._b2._angPseudoVelY,b=this._b2._angPseudoVelZ;let X=0,c=this.info.numRows;for(;X<c;){let u=X++,p=this.info.rows[u],x=this.massData[u],v=p.impulse,f=p.jacobianN,g=0;g+=t*f.lin1X+i*f.lin1Y+s*f.lin1Z,g-=_*f.lin2X+n*f.lin2Y+l*f.lin2Z,g+=o*f.ang1X+r*f.ang1Y+e*f.ang1Z,g-=a*f.ang2X+h*f.ang2Y+b*f.ang2Z;let V=(p.rhs-g)*x.massN*m.common.Setting.positionSplitImpulseBaumgarte,Z=v.impulseP;v.impulseP+=V,v.impulseP<0&&(v.impulseP=0),V=v.impulseP-Z,t+=x.invMLinN1X*V,i+=x.invMLinN1Y*V,s+=x.invMLinN1Z*V,_+=x.invMLinN2X*-V,n+=x.invMLinN2Y*-V,l+=x.invMLinN2Z*-V,o+=x.invMAngN1X*V,r+=x.invMAngN1Y*V,e+=x.invMAngN1Z*V,a+=x.invMAngN2X*-V,h+=x.invMAngN2Y*-V,b+=x.invMAngN2Z*-V}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=s,this._b2._pseudoVelX=_,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=l,this._b1._angPseudoVelX=o,this._b1._angPseudoVelY=r,this._b1._angPseudoVelZ=e,this._b2._angPseudoVelX=a,this._b2._angPseudoVelY=h,this._b2._angPseudoVelZ=b}solvePositionNgs(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i=this._b1._invMass,s=this._b2._invMass,_,n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V;_=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,o=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,u=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,g=this._b2._invInertia21,V=this._b2._invInertia22;let Z=0,I=this.info.numRows;for(;Z<I;){let Ti=Z++,mi=this.massData[Ti],Ct=this.info.rows[Ti].jacobianN;mi.invMLinN1X=Ct.lin1X*i,mi.invMLinN1Y=Ct.lin1Y*i,mi.invMLinN1Z=Ct.lin1Z*i,mi.invMLinN2X=Ct.lin2X*s,mi.invMLinN2Y=Ct.lin2Y*s,mi.invMLinN2Z=Ct.lin2Z*s;let jt,hi,qt;jt=_*Ct.ang1X+n*Ct.ang1Y+l*Ct.ang1Z,hi=o*Ct.ang1X+r*Ct.ang1Y+e*Ct.ang1Z,qt=a*Ct.ang1X+h*Ct.ang1Y+b*Ct.ang1Z,mi.invMAngN1X=jt,mi.invMAngN1Y=hi,mi.invMAngN1Z=qt;let mt,Zt,Et;mt=X*Ct.ang2X+c*Ct.ang2Y+u*Ct.ang2Z,Zt=p*Ct.ang2X+x*Ct.ang2Y+v*Ct.ang2Z,Et=f*Ct.ang2X+g*Ct.ang2Y+V*Ct.ang2Z,mi.invMAngN2X=mt,mi.invMAngN2Y=Zt,mi.invMAngN2Z=Et,mi.massN=i+s+(mi.invMAngN1X*Ct.ang1X+mi.invMAngN1Y*Ct.ang1Y+mi.invMAngN1Z*Ct.ang1Z)+(mi.invMAngN2X*Ct.ang2X+mi.invMAngN2Y*Ct.ang2Y+mi.invMAngN2Z*Ct.ang2Z),mi.massN!=0&&(mi.massN=1/mi.massN)}let M,y,d,B,R,k,A,z,w,S,P,T;M=0,y=0,d=0,B=0,R=0,k=0,A=0,z=0,w=0,S=0,P=0,T=0;let C=0,L=this.info.numRows;for(;C<L;){let Ti=C++,mi=this.info.rows[Ti],Ct=this.massData[Ti],jt=mi.impulse,hi=mi.jacobianN,qt=0;qt+=M*hi.lin1X+y*hi.lin1Y+d*hi.lin1Z,qt-=B*hi.lin2X+R*hi.lin2Y+k*hi.lin2Z,qt+=A*hi.ang1X+z*hi.ang1Y+w*hi.ang1Z,qt-=S*hi.ang2X+P*hi.ang2Y+T*hi.ang2Z;let mt=(mi.rhs-qt)*Ct.massN*m.common.Setting.positionNgsBaumgarte,Zt=jt.impulseP;jt.impulseP+=mt,jt.impulseP<0&&(jt.impulseP=0),mt=jt.impulseP-Zt,M+=Ct.invMLinN1X*mt,y+=Ct.invMLinN1Y*mt,d+=Ct.invMLinN1Z*mt,B+=Ct.invMLinN2X*-mt,R+=Ct.invMLinN2Y*-mt,k+=Ct.invMLinN2Z*-mt,A+=Ct.invMAngN1X*mt,z+=Ct.invMAngN1Y*mt,w+=Ct.invMAngN1Z*mt,S+=Ct.invMAngN2X*-mt,P+=Ct.invMAngN2Y*-mt,T+=Ct.invMAngN2Z*-mt}let q=this._b1;q._transform._positionX+=M,q._transform._positionY+=y,q._transform._positionZ+=d;let U=this._b2;U._transform._positionX+=B,U._transform._positionY+=R,U._transform._positionZ+=k;let Y=this._b1,E=Math.sqrt(A*A+z*z+w*w),D=E*.5,Q,W;if(D<.5){let Ti=D*D;Q=.5*(1-Ti*.16666666666666666+Ti*Ti*.008333333333333333),W=1-Ti*.5+Ti*Ti*.041666666666666664}else Q=Math.sin(D)/E,W=Math.cos(D);let F,H,G;F=A*Q,H=z*Q,G=w*Q;let J,N,K,O;J=F,N=H,K=G,O=W;let $,et,st,lt,rt=Y._transform._rotation00,at=Y._transform._rotation11,_t=Y._transform._rotation22,ht=rt+at+_t,ot;ht>0?(ot=Math.sqrt(ht+1),lt=.5*ot,ot=.5/ot,$=(Y._transform._rotation21-Y._transform._rotation12)*ot,et=(Y._transform._rotation02-Y._transform._rotation20)*ot,st=(Y._transform._rotation10-Y._transform._rotation01)*ot):rt>at?rt>_t?(ot=Math.sqrt(rt-at-_t+1),$=.5*ot,ot=.5/ot,et=(Y._transform._rotation01+Y._transform._rotation10)*ot,st=(Y._transform._rotation02+Y._transform._rotation20)*ot,lt=(Y._transform._rotation21-Y._transform._rotation12)*ot):(ot=Math.sqrt(_t-rt-at+1),st=.5*ot,ot=.5/ot,$=(Y._transform._rotation02+Y._transform._rotation20)*ot,et=(Y._transform._rotation12+Y._transform._rotation21)*ot,lt=(Y._transform._rotation10-Y._transform._rotation01)*ot):at>_t?(ot=Math.sqrt(at-_t-rt+1),et=.5*ot,ot=.5/ot,$=(Y._transform._rotation01+Y._transform._rotation10)*ot,st=(Y._transform._rotation12+Y._transform._rotation21)*ot,lt=(Y._transform._rotation02-Y._transform._rotation20)*ot):(ot=Math.sqrt(_t-rt-at+1),st=.5*ot,ot=.5/ot,$=(Y._transform._rotation02+Y._transform._rotation20)*ot,et=(Y._transform._rotation12+Y._transform._rotation21)*ot,lt=(Y._transform._rotation10-Y._transform._rotation01)*ot),$=O*$+J*lt+N*st-K*et,et=O*et-J*st+N*lt+K*$,st=O*st+J*et-N*$+K*lt,lt=O*lt-J*$-N*et-K*st;let bt=$*$+et*et+st*st+lt*lt;bt>1e-32&&(bt=1/Math.sqrt(bt)),$*=bt,et*=bt,st*=bt,lt*=bt;let Xt=$,ft=et,ut=st,xt=lt,zt=2*Xt,gt=2*ft,pt=2*ut,ct=Xt*zt,nt=ft*gt,tt=ut*pt,kt=Xt*gt,Bt=ft*pt,Mt=Xt*pt,Rt=xt*zt,ci=xt*gt,Xi=xt*pt;Y._transform._rotation00=1-nt-tt,Y._transform._rotation01=kt-Xi,Y._transform._rotation02=Mt+ci,Y._transform._rotation10=kt+Xi,Y._transform._rotation11=1-ct-tt,Y._transform._rotation12=Bt-Rt,Y._transform._rotation20=Mt-ci,Y._transform._rotation21=Bt+Rt,Y._transform._rotation22=1-ct-nt;let gi,ki,wi,ei,Nt,At,ni,di,Oi;gi=Y._transform._rotation00*Y._invLocalInertia00+Y._transform._rotation01*Y._invLocalInertia10+Y._transform._rotation02*Y._invLocalInertia20,ki=Y._transform._rotation00*Y._invLocalInertia01+Y._transform._rotation01*Y._invLocalInertia11+Y._transform._rotation02*Y._invLocalInertia21,wi=Y._transform._rotation00*Y._invLocalInertia02+Y._transform._rotation01*Y._invLocalInertia12+Y._transform._rotation02*Y._invLocalInertia22,ei=Y._transform._rotation10*Y._invLocalInertia00+Y._transform._rotation11*Y._invLocalInertia10+Y._transform._rotation12*Y._invLocalInertia20,Nt=Y._transform._rotation10*Y._invLocalInertia01+Y._transform._rotation11*Y._invLocalInertia11+Y._transform._rotation12*Y._invLocalInertia21,At=Y._transform._rotation10*Y._invLocalInertia02+Y._transform._rotation11*Y._invLocalInertia12+Y._transform._rotation12*Y._invLocalInertia22,ni=Y._transform._rotation20*Y._invLocalInertia00+Y._transform._rotation21*Y._invLocalInertia10+Y._transform._rotation22*Y._invLocalInertia20,di=Y._transform._rotation20*Y._invLocalInertia01+Y._transform._rotation21*Y._invLocalInertia11+Y._transform._rotation22*Y._invLocalInertia21,Oi=Y._transform._rotation20*Y._invLocalInertia02+Y._transform._rotation21*Y._invLocalInertia12+Y._transform._rotation22*Y._invLocalInertia22,Y._invInertia00=gi,Y._invInertia01=ki,Y._invInertia02=wi,Y._invInertia10=ei,Y._invInertia11=Nt,Y._invInertia12=At,Y._invInertia20=ni,Y._invInertia21=di,Y._invInertia22=Oi;let Bi,Vt,wt,$t,fi,Zi,it,Ut,ii;Bi=Y._invInertia00*Y._transform._rotation00+Y._invInertia01*Y._transform._rotation01+Y._invInertia02*Y._transform._rotation02,Vt=Y._invInertia00*Y._transform._rotation10+Y._invInertia01*Y._transform._rotation11+Y._invInertia02*Y._transform._rotation12,wt=Y._invInertia00*Y._transform._rotation20+Y._invInertia01*Y._transform._rotation21+Y._invInertia02*Y._transform._rotation22,$t=Y._invInertia10*Y._transform._rotation00+Y._invInertia11*Y._transform._rotation01+Y._invInertia12*Y._transform._rotation02,fi=Y._invInertia10*Y._transform._rotation10+Y._invInertia11*Y._transform._rotation11+Y._invInertia12*Y._transform._rotation12,Zi=Y._invInertia10*Y._transform._rotation20+Y._invInertia11*Y._transform._rotation21+Y._invInertia12*Y._transform._rotation22,it=Y._invInertia20*Y._transform._rotation00+Y._invInertia21*Y._transform._rotation01+Y._invInertia22*Y._transform._rotation02,Ut=Y._invInertia20*Y._transform._rotation10+Y._invInertia21*Y._transform._rotation11+Y._invInertia22*Y._transform._rotation12,ii=Y._invInertia20*Y._transform._rotation20+Y._invInertia21*Y._transform._rotation21+Y._invInertia22*Y._transform._rotation22,Y._invInertia00=Bi,Y._invInertia01=Vt,Y._invInertia02=wt,Y._invInertia10=$t,Y._invInertia11=fi,Y._invInertia12=Zi,Y._invInertia20=it,Y._invInertia21=Ut,Y._invInertia22=ii,Y._invInertia00*=Y._rotFactor.x,Y._invInertia01*=Y._rotFactor.x,Y._invInertia02*=Y._rotFactor.x,Y._invInertia10*=Y._rotFactor.y,Y._invInertia11*=Y._rotFactor.y,Y._invInertia12*=Y._rotFactor.y,Y._invInertia20*=Y._rotFactor.z,Y._invInertia21*=Y._rotFactor.z,Y._invInertia22*=Y._rotFactor.z;let j=this._b2,Jt=Math.sqrt(S*S+P*P+T*T),Pt=Jt*.5,si,_i;if(Pt<.5){let Ti=Pt*Pt;si=.5*(1-Ti*.16666666666666666+Ti*Ti*.008333333333333333),_i=1-Ti*.5+Ti*Ti*.041666666666666664}else si=Math.sin(Pt)/Jt,_i=Math.cos(Pt);let St,ai,qi;St=S*si,ai=P*si,qi=T*si;let ui,Yt,yt,vt;ui=St,Yt=ai,yt=qi,vt=_i;let yi,Ii,bi,se,me=j._transform._rotation00,Ei=j._transform._rotation11,he=j._transform._rotation22,ve=me+Ei+he,oi;ve>0?(oi=Math.sqrt(ve+1),se=.5*oi,oi=.5/oi,yi=(j._transform._rotation21-j._transform._rotation12)*oi,Ii=(j._transform._rotation02-j._transform._rotation20)*oi,bi=(j._transform._rotation10-j._transform._rotation01)*oi):me>Ei?me>he?(oi=Math.sqrt(me-Ei-he+1),yi=.5*oi,oi=.5/oi,Ii=(j._transform._rotation01+j._transform._rotation10)*oi,bi=(j._transform._rotation02+j._transform._rotation20)*oi,se=(j._transform._rotation21-j._transform._rotation12)*oi):(oi=Math.sqrt(he-me-Ei+1),bi=.5*oi,oi=.5/oi,yi=(j._transform._rotation02+j._transform._rotation20)*oi,Ii=(j._transform._rotation12+j._transform._rotation21)*oi,se=(j._transform._rotation10-j._transform._rotation01)*oi):Ei>he?(oi=Math.sqrt(Ei-he-me+1),Ii=.5*oi,oi=.5/oi,yi=(j._transform._rotation01+j._transform._rotation10)*oi,bi=(j._transform._rotation12+j._transform._rotation21)*oi,se=(j._transform._rotation02-j._transform._rotation20)*oi):(oi=Math.sqrt(he-me-Ei+1),bi=.5*oi,oi=.5/oi,yi=(j._transform._rotation02+j._transform._rotation20)*oi,Ii=(j._transform._rotation12+j._transform._rotation21)*oi,se=(j._transform._rotation10-j._transform._rotation01)*oi),yi=vt*yi+ui*se+Yt*bi-yt*Ii,Ii=vt*Ii-ui*bi+Yt*se+yt*yi,bi=vt*bi+ui*Ii-Yt*yi+yt*se,se=vt*se-ui*yi-Yt*Ii-yt*bi;let ce=yi*yi+Ii*Ii+bi*bi+se*se;ce>1e-32&&(ce=1/Math.sqrt(ce)),yi*=ce,Ii*=ce,bi*=ce,se*=ce;let be=yi,xe=Ii,Ye=bi,Ni=se,Ji=2*be,Hi=2*xe,_e=2*Ye,ne=be*Ji,Ki=xe*Hi,ie=Ye*_e,Ui=be*Hi,Wi=xe*_e,Si=be*_e,Ht=Ni*Ji,ri=Ni*Hi,Tt=Ni*_e;j._transform._rotation00=1-Ki-ie,j._transform._rotation01=Ui-Tt,j._transform._rotation02=Si+ri,j._transform._rotation10=Ui+Tt,j._transform._rotation11=1-ne-ie,j._transform._rotation12=Wi-Ht,j._transform._rotation20=Si-ri,j._transform._rotation21=Wi+Ht,j._transform._rotation22=1-ne-Ki;let Mi,zi,Pi,Vi,ji,Gt,dt,Lt,Ai;Mi=j._transform._rotation00*j._invLocalInertia00+j._transform._rotation01*j._invLocalInertia10+j._transform._rotation02*j._invLocalInertia20,zi=j._transform._rotation00*j._invLocalInertia01+j._transform._rotation01*j._invLocalInertia11+j._transform._rotation02*j._invLocalInertia21,Pi=j._transform._rotation00*j._invLocalInertia02+j._transform._rotation01*j._invLocalInertia12+j._transform._rotation02*j._invLocalInertia22,Vi=j._transform._rotation10*j._invLocalInertia00+j._transform._rotation11*j._invLocalInertia10+j._transform._rotation12*j._invLocalInertia20,ji=j._transform._rotation10*j._invLocalInertia01+j._transform._rotation11*j._invLocalInertia11+j._transform._rotation12*j._invLocalInertia21,Gt=j._transform._rotation10*j._invLocalInertia02+j._transform._rotation11*j._invLocalInertia12+j._transform._rotation12*j._invLocalInertia22,dt=j._transform._rotation20*j._invLocalInertia00+j._transform._rotation21*j._invLocalInertia10+j._transform._rotation22*j._invLocalInertia20,Lt=j._transform._rotation20*j._invLocalInertia01+j._transform._rotation21*j._invLocalInertia11+j._transform._rotation22*j._invLocalInertia21,Ai=j._transform._rotation20*j._invLocalInertia02+j._transform._rotation21*j._invLocalInertia12+j._transform._rotation22*j._invLocalInertia22,j._invInertia00=Mi,j._invInertia01=zi,j._invInertia02=Pi,j._invInertia10=Vi,j._invInertia11=ji,j._invInertia12=Gt,j._invInertia20=dt,j._invInertia21=Lt,j._invInertia22=Ai;let Li,Di,$i,ae,re,pe,ti,Fi,vi;Li=j._invInertia00*j._transform._rotation00+j._invInertia01*j._transform._rotation01+j._invInertia02*j._transform._rotation02,Di=j._invInertia00*j._transform._rotation10+j._invInertia01*j._transform._rotation11+j._invInertia02*j._transform._rotation12,$i=j._invInertia00*j._transform._rotation20+j._invInertia01*j._transform._rotation21+j._invInertia02*j._transform._rotation22,ae=j._invInertia10*j._transform._rotation00+j._invInertia11*j._transform._rotation01+j._invInertia12*j._transform._rotation02,re=j._invInertia10*j._transform._rotation10+j._invInertia11*j._transform._rotation11+j._invInertia12*j._transform._rotation12,pe=j._invInertia10*j._transform._rotation20+j._invInertia11*j._transform._rotation21+j._invInertia12*j._transform._rotation22,ti=j._invInertia20*j._transform._rotation00+j._invInertia21*j._transform._rotation01+j._invInertia22*j._transform._rotation02,Fi=j._invInertia20*j._transform._rotation10+j._invInertia21*j._transform._rotation11+j._invInertia22*j._transform._rotation12,vi=j._invInertia20*j._transform._rotation20+j._invInertia21*j._transform._rotation21+j._invInertia22*j._transform._rotation22,j._invInertia00=Li,j._invInertia01=Di,j._invInertia02=$i,j._invInertia10=ae,j._invInertia11=re,j._invInertia12=pe,j._invInertia20=ti,j._invInertia21=Fi,j._invInertia22=vi,j._invInertia00*=j._rotFactor.x,j._invInertia01*=j._rotFactor.x,j._invInertia02*=j._rotFactor.x,j._invInertia10*=j._rotFactor.y,j._invInertia11*=j._rotFactor.y,j._invInertia12*=j._rotFactor.y,j._invInertia20*=j._rotFactor.z,j._invInertia21*=j._rotFactor.z,j._invInertia22*=j._rotFactor.z}postSolve(){let t,i,s,_,n,l,o,r,e;t=0,i=0,s=0,_=0,n=0,l=0,o=0,r=0,e=0;let a=0,h=this.info.numRows;for(;a<h;){let b=this.info.rows[a++],X=b.impulse,c=b.jacobianN,u=b.jacobianT,p=b.jacobianB,x=X.impulseN,v=X.impulseT,f=X.impulseB,g,V,Z;g=0,V=0,Z=0,g+=u.lin1X*v,V+=u.lin1Y*v,Z+=u.lin1Z*v,g+=p.lin1X*f,V+=p.lin1Y*f,Z+=p.lin1Z*f,X.impulseLX=g,X.impulseLY=V,X.impulseLZ=Z,t+=c.lin1X*x,i+=c.lin1Y*x,s+=c.lin1Z*x,_+=c.ang1X*x,n+=c.ang1Y*x,l+=c.ang1Z*x,o+=c.ang2X*x,r+=c.ang2Y*x,e+=c.ang2Z*x,t+=u.lin1X*v,i+=u.lin1Y*v,s+=u.lin1Z*v,_+=u.ang1X*v,n+=u.ang1Y*v,l+=u.ang1Z*v,o+=u.ang2X*v,r+=u.ang2Y*v,e+=u.ang2Z*v,t+=p.lin1X*f,i+=p.lin1Y*f,s+=p.lin1Z*f,_+=p.ang1X*f,n+=p.ang1Y*f,l+=p.ang1Z*f,o+=p.ang2X*f,r+=p.ang2Y*f,e+=p.ang2Z*f}this._b1._linearContactImpulseX+=t,this._b1._linearContactImpulseY+=i,this._b1._linearContactImpulseZ+=s,this._b1._angularContactImpulseX+=_,this._b1._angularContactImpulseY+=n,this._b1._angularContactImpulseZ+=l,this._b2._linearContactImpulseX-=t,this._b2._linearContactImpulseY-=i,this._b2._linearContactImpulseZ-=s,this._b2._angularContactImpulseX-=o,this._b2._angularContactImpulseY-=r,this._b2._angularContactImpulseZ-=e,this.constraint._syncManifold()}};m.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends m.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new m.dynamics.constraint.info.joint.JointSolverInfo,this.massData=new Array(m.common.Setting.maxJacobianRows);let i=0,s=this.massData.length;for(;i<s;)this.massData[i++]=new m.dynamics.constraint.solver.common.JointSolverMassDataRow}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i=this._b1._invMass,s=this._b2._invMass,_,n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V;_=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,o=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,u=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,g=this._b2._invInertia21,V=this._b2._invInertia22;let Z=0,I=this.info.numRows;for(;Z<I;){let M=Z++,y=this.info.rows[M],d=this.massData[M],B=y.jacobian;if(B.updateSparsity(),B.flag&1?(d.invMLin1X=B.lin1X*i,d.invMLin1Y=B.lin1Y*i,d.invMLin1Z=B.lin1Z*i,d.invMLin2X=B.lin2X*s,d.invMLin2Y=B.lin2Y*s,d.invMLin2Z=B.lin2Z*s):(d.invMLin1X=0,d.invMLin1Y=0,d.invMLin1Z=0,d.invMLin2X=0,d.invMLin2Y=0,d.invMLin2Z=0),B.flag&2){let R,k,A;R=_*B.ang1X+n*B.ang1Y+l*B.ang1Z,k=o*B.ang1X+r*B.ang1Y+e*B.ang1Z,A=a*B.ang1X+h*B.ang1Y+b*B.ang1Z,d.invMAng1X=R,d.invMAng1Y=k,d.invMAng1Z=A;let z,w,S;z=X*B.ang2X+c*B.ang2Y+u*B.ang2Z,w=p*B.ang2X+x*B.ang2Y+v*B.ang2Z,S=f*B.ang2X+g*B.ang2Y+V*B.ang2Z,d.invMAng2X=z,d.invMAng2Y=w,d.invMAng2Z=S}else d.invMAng1X=0,d.invMAng1Y=0,d.invMAng1Z=0,d.invMAng2X=0,d.invMAng2Y=0,d.invMAng2Z=0;d.massWithoutCfm=d.invMLin1X*B.lin1X+d.invMLin1Y*B.lin1Y+d.invMLin1Z*B.lin1Z+(d.invMLin2X*B.lin2X+d.invMLin2Y*B.lin2Y+d.invMLin2Z*B.lin2Z)+(d.invMAng1X*B.ang1X+d.invMAng1Y*B.ang1Y+d.invMAng1Z*B.ang1Z)+(d.invMAng2X*B.ang2X+d.invMAng2Y*B.ang2Y+d.invMAng2Z*B.ang2Z),d.mass=d.massWithoutCfm+y.cfm,d.massWithoutCfm!=0&&(d.massWithoutCfm=1/d.massWithoutCfm),d.mass!=0&&(d.mass=1/d.mass)}}warmStart(t){let i=this.joint._positionCorrectionAlgorithm==m.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?m.common.Setting.jointWarmStartingFactorForBaungarte:m.common.Setting.jointWarmStartingFactor;if(i*=t.dtRatio,i<=0){let x=0,v=this.info.numRows;for(;x<v;){let f=this.info.rows[x++].impulse;f.impulse=0,f.impulseM=0,f.impulseP=0}return}let s,_,n,l,o,r,e,a,h,b,X,c;s=this._b1._velX,_=this._b1._velY,n=this._b1._velZ,l=this._b2._velX,o=this._b2._velY,r=this._b2._velZ,e=this._b1._angVelX,a=this._b1._angVelY,h=this._b1._angVelZ,b=this._b2._angVelX,X=this._b2._angVelY,c=this._b2._angVelZ;let u=0,p=this.info.numRows;for(;u<p;){let x=u++,v=this.massData[x],f=this.info.rows[x].impulse;f.impulse*=i,f.impulseM*=i;let g=f.impulse+f.impulseM;s+=v.invMLin1X*g,_+=v.invMLin1Y*g,n+=v.invMLin1Z*g,l+=v.invMLin2X*-g,o+=v.invMLin2Y*-g,r+=v.invMLin2Z*-g,e+=v.invMAng1X*g,a+=v.invMAng1Y*g,h+=v.invMAng1Z*g,b+=v.invMAng2X*-g,X+=v.invMAng2Y*-g,c+=v.invMAng2Z*-g}this._b1._velX=s,this._b1._velY=_,this._b1._velZ=n,this._b2._velX=l,this._b2._velY=o,this._b2._velZ=r,this._b1._angVelX=e,this._b1._angVelY=a,this._b1._angVelZ=h,this._b2._angVelX=b,this._b2._angVelY=X,this._b2._angVelZ=c}solveVelocity(){let t,i,s,_,n,l,o,r,e,a,h,b;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,_=this._b2._velX,n=this._b2._velY,l=this._b2._velZ,o=this._b1._angVelX,r=this._b1._angVelY,e=this._b1._angVelZ,a=this._b2._angVelX,h=this._b2._angVelY,b=this._b2._angVelZ;let X=0,c=this.info.numRows;for(;X<c;){let x=X++,v=this.info.rows[x],f=this.massData[x],g=v.impulse,V=v.jacobian;if(v.motorMaxImpulse==0)continue;let Z=0;Z+=t*V.lin1X+i*V.lin1Y+s*V.lin1Z,Z-=_*V.lin2X+n*V.lin2Y+l*V.lin2Z,Z+=o*V.ang1X+r*V.ang1Y+e*V.ang1Z,Z-=a*V.ang2X+h*V.ang2Y+b*V.ang2Z;let I=(-v.motorSpeed-Z)*f.massWithoutCfm,M=g.impulseM;g.impulseM+=I,g.impulseM<-v.motorMaxImpulse?g.impulseM=-v.motorMaxImpulse:g.impulseM>v.motorMaxImpulse&&(g.impulseM=v.motorMaxImpulse),I=g.impulseM-M,V.flag&1&&(t+=f.invMLin1X*I,i+=f.invMLin1Y*I,s+=f.invMLin1Z*I,_+=f.invMLin2X*-I,n+=f.invMLin2Y*-I,l+=f.invMLin2Z*-I),V.flag&2&&(o+=f.invMAng1X*I,r+=f.invMAng1Y*I,e+=f.invMAng1Z*I,a+=f.invMAng2X*-I,h+=f.invMAng2Y*-I,b+=f.invMAng2Z*-I)}let u=0,p=this.info.numRows;for(;u<p;){let x=u++,v=this.info.rows[x],f=this.massData[x],g=v.impulse,V=v.jacobian,Z=0;Z+=t*V.lin1X+i*V.lin1Y+s*V.lin1Z,Z-=_*V.lin2X+n*V.lin2Y+l*V.lin2Z,Z+=o*V.ang1X+r*V.ang1Y+e*V.ang1Z,Z-=a*V.ang2X+h*V.ang2Y+b*V.ang2Z;let I=(v.rhs-Z-g.impulse*v.cfm)*f.mass,M=g.impulse;g.impulse+=I,g.impulse<v.minImpulse?g.impulse=v.minImpulse:g.impulse>v.maxImpulse&&(g.impulse=v.maxImpulse),I=g.impulse-M,V.flag&1&&(t+=f.invMLin1X*I,i+=f.invMLin1Y*I,s+=f.invMLin1Z*I,_+=f.invMLin2X*-I,n+=f.invMLin2Y*-I,l+=f.invMLin2Z*-I),V.flag&2&&(o+=f.invMAng1X*I,r+=f.invMAng1Y*I,e+=f.invMAng1Z*I,a+=f.invMAng2X*-I,h+=f.invMAng2Y*-I,b+=f.invMAng2Z*-I)}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=s,this._b2._velX=_,this._b2._velY=n,this._b2._velZ=l,this._b1._angVelX=o,this._b1._angVelY=r,this._b1._angVelZ=e,this._b2._angVelX=a,this._b2._angVelY=h,this._b2._angVelZ=b}postSolveVelocity(t){let i,s,_,n,l,o;i=0,s=0,_=0,n=0,l=0,o=0;let r=0,e=this.info.numRows;for(;r<e;){let a=this.info.rows[r++],h=a.impulse,b=a.jacobian;b.flag&1?(i+=b.lin1X*h.impulse,s+=b.lin1Y*h.impulse,_+=b.lin1Z*h.impulse):b.flag&2&&(n+=b.ang1X*h.impulse,l+=b.ang1Y*h.impulse,o+=b.ang1Z*h.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=s*t.invDt,this.joint._appliedForceZ=_*t.invDt,this.joint._appliedTorqueX=n*t.invDt,this.joint._appliedTorqueY=l*t.invDt,this.joint._appliedTorqueZ=o*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i=this._b1._invMass,s=this._b2._invMass,_,n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V;_=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,o=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,u=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,g=this._b2._invInertia21,V=this._b2._invInertia22;let Z=0,I=this.info.numRows;for(;Z<I;){let d=Z++,B=this.massData[d],R=this.info.rows[d].jacobian;B.invMLin1X=R.lin1X*i,B.invMLin1Y=R.lin1Y*i,B.invMLin1Z=R.lin1Z*i,B.invMLin2X=R.lin2X*s,B.invMLin2Y=R.lin2Y*s,B.invMLin2Z=R.lin2Z*s;let k,A,z;k=_*R.ang1X+n*R.ang1Y+l*R.ang1Z,A=o*R.ang1X+r*R.ang1Y+e*R.ang1Z,z=a*R.ang1X+h*R.ang1Y+b*R.ang1Z,B.invMAng1X=k,B.invMAng1Y=A,B.invMAng1Z=z;let w,S,P;w=X*R.ang2X+c*R.ang2Y+u*R.ang2Z,S=p*R.ang2X+x*R.ang2Y+v*R.ang2Z,P=f*R.ang2X+g*R.ang2Y+V*R.ang2Z,B.invMAng2X=w,B.invMAng2Y=S,B.invMAng2Z=P,B.mass=B.invMLin1X*R.lin1X+B.invMLin1Y*R.lin1Y+B.invMLin1Z*R.lin1Z+(B.invMLin2X*R.lin2X+B.invMLin2Y*R.lin2Y+B.invMLin2Z*R.lin2Z)+(B.invMAng1X*R.ang1X+B.invMAng1Y*R.ang1Y+B.invMAng1Z*R.ang1Z)+(B.invMAng2X*R.ang2X+B.invMAng2Y*R.ang2Y+B.invMAng2Z*R.ang2Z),B.mass!=0&&(B.mass=1/B.mass)}let M=0,y=this.info.numRows;for(;M<y;)this.info.rows[M++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,s,_,n,l,o,r,e,a,h,b;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,_=this._b2._pseudoVelX,n=this._b2._pseudoVelY,l=this._b2._pseudoVelZ,o=this._b1._angPseudoVelX,r=this._b1._angPseudoVelY,e=this._b1._angPseudoVelZ,a=this._b2._angPseudoVelX,h=this._b2._angPseudoVelY,b=this._b2._angPseudoVelZ;let X=0,c=this.info.numRows;for(;X<c;){let u=X++,p=this.info.rows[u],x=this.massData[u],v=p.impulse,f=p.jacobian,g=0;g+=t*f.lin1X+i*f.lin1Y+s*f.lin1Z,g-=_*f.lin2X+n*f.lin2Y+l*f.lin2Z,g+=o*f.ang1X+r*f.ang1Y+e*f.ang1Z,g-=a*f.ang2X+h*f.ang2Y+b*f.ang2Z;let V=(p.rhs*m.common.Setting.positionSplitImpulseBaumgarte-g)*x.mass,Z=v.impulseP;v.impulseP+=V,v.impulseP<p.minImpulse?v.impulseP=p.minImpulse:v.impulseP>p.maxImpulse&&(v.impulseP=p.maxImpulse),V=v.impulseP-Z,t+=x.invMLin1X*V,i+=x.invMLin1Y*V,s+=x.invMLin1Z*V,_+=x.invMLin2X*-V,n+=x.invMLin2Y*-V,l+=x.invMLin2Z*-V,o+=x.invMAng1X*V,r+=x.invMAng1Y*V,e+=x.invMAng1Z*V,a+=x.invMAng2X*-V,h+=x.invMAng2Y*-V,b+=x.invMAng2Z*-V}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=s,this._b2._pseudoVelX=_,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=l,this._b1._angPseudoVelX=o,this._b1._angPseudoVelY=r,this._b1._angPseudoVelZ=e,this._b2._angPseudoVelX=a,this._b2._angPseudoVelY=h,this._b2._angPseudoVelZ=b}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i=this._b1._invMass,s=this._b2._invMass,_,n,l,o,r,e,a,h,b,X,c,u,p,x,v,f,g,V;_=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,o=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,u=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,g=this._b2._invInertia21,V=this._b2._invInertia22;let Z=0,I=this.info.numRows;for(;Z<I;){let Ti=Z++,mi=this.massData[Ti],Ct=this.info.rows[Ti].jacobian;mi.invMLin1X=Ct.lin1X*i,mi.invMLin1Y=Ct.lin1Y*i,mi.invMLin1Z=Ct.lin1Z*i,mi.invMLin2X=Ct.lin2X*s,mi.invMLin2Y=Ct.lin2Y*s,mi.invMLin2Z=Ct.lin2Z*s;let jt,hi,qt;jt=_*Ct.ang1X+n*Ct.ang1Y+l*Ct.ang1Z,hi=o*Ct.ang1X+r*Ct.ang1Y+e*Ct.ang1Z,qt=a*Ct.ang1X+h*Ct.ang1Y+b*Ct.ang1Z,mi.invMAng1X=jt,mi.invMAng1Y=hi,mi.invMAng1Z=qt;let mt,Zt,Et;mt=X*Ct.ang2X+c*Ct.ang2Y+u*Ct.ang2Z,Zt=p*Ct.ang2X+x*Ct.ang2Y+v*Ct.ang2Z,Et=f*Ct.ang2X+g*Ct.ang2Y+V*Ct.ang2Z,mi.invMAng2X=mt,mi.invMAng2Y=Zt,mi.invMAng2Z=Et,mi.mass=mi.invMLin1X*Ct.lin1X+mi.invMLin1Y*Ct.lin1Y+mi.invMLin1Z*Ct.lin1Z+(mi.invMLin2X*Ct.lin2X+mi.invMLin2Y*Ct.lin2Y+mi.invMLin2Z*Ct.lin2Z)+(mi.invMAng1X*Ct.ang1X+mi.invMAng1Y*Ct.ang1Y+mi.invMAng1Z*Ct.ang1Z)+(mi.invMAng2X*Ct.ang2X+mi.invMAng2Y*Ct.ang2Y+mi.invMAng2Z*Ct.ang2Z),mi.mass!=0&&(mi.mass=1/mi.mass)}let M,y,d,B,R,k,A,z,w,S,P,T;M=0,y=0,d=0,B=0,R=0,k=0,A=0,z=0,w=0,S=0,P=0,T=0;let C=0,L=this.info.numRows;for(;C<L;){let Ti=C++,mi=this.info.rows[Ti],Ct=this.massData[Ti],jt=mi.impulse,hi=mi.jacobian,qt=0;qt+=M*hi.lin1X+y*hi.lin1Y+d*hi.lin1Z,qt-=B*hi.lin2X+R*hi.lin2Y+k*hi.lin2Z,qt+=A*hi.ang1X+z*hi.ang1Y+w*hi.ang1Z,qt-=S*hi.ang2X+P*hi.ang2Y+T*hi.ang2Z;let mt=(mi.rhs*m.common.Setting.positionNgsBaumgarte-qt)*Ct.mass,Zt=jt.impulseP;jt.impulseP+=mt,jt.impulseP<mi.minImpulse?jt.impulseP=mi.minImpulse:jt.impulseP>mi.maxImpulse&&(jt.impulseP=mi.maxImpulse),mt=jt.impulseP-Zt,M+=Ct.invMLin1X*mt,y+=Ct.invMLin1Y*mt,d+=Ct.invMLin1Z*mt,B+=Ct.invMLin2X*-mt,R+=Ct.invMLin2Y*-mt,k+=Ct.invMLin2Z*-mt,A+=Ct.invMAng1X*mt,z+=Ct.invMAng1Y*mt,w+=Ct.invMAng1Z*mt,S+=Ct.invMAng2X*-mt,P+=Ct.invMAng2Y*-mt,T+=Ct.invMAng2Z*-mt}let q=this._b1;q._transform._positionX+=M,q._transform._positionY+=y,q._transform._positionZ+=d;let U=this._b2;U._transform._positionX+=B,U._transform._positionY+=R,U._transform._positionZ+=k;let Y=this._b1,E=Math.sqrt(A*A+z*z+w*w),D=E*.5,Q,W;if(D<.5){let Ti=D*D;Q=.5*(1-Ti*.16666666666666666+Ti*Ti*.008333333333333333),W=1-Ti*.5+Ti*Ti*.041666666666666664}else Q=Math.sin(D)/E,W=Math.cos(D);let F,H,G;F=A*Q,H=z*Q,G=w*Q;let J,N,K,O;J=F,N=H,K=G,O=W;let $,et,st,lt,rt=Y._transform._rotation00,at=Y._transform._rotation11,_t=Y._transform._rotation22,ht=rt+at+_t,ot;ht>0?(ot=Math.sqrt(ht+1),lt=.5*ot,ot=.5/ot,$=(Y._transform._rotation21-Y._transform._rotation12)*ot,et=(Y._transform._rotation02-Y._transform._rotation20)*ot,st=(Y._transform._rotation10-Y._transform._rotation01)*ot):rt>at?rt>_t?(ot=Math.sqrt(rt-at-_t+1),$=.5*ot,ot=.5/ot,et=(Y._transform._rotation01+Y._transform._rotation10)*ot,st=(Y._transform._rotation02+Y._transform._rotation20)*ot,lt=(Y._transform._rotation21-Y._transform._rotation12)*ot):(ot=Math.sqrt(_t-rt-at+1),st=.5*ot,ot=.5/ot,$=(Y._transform._rotation02+Y._transform._rotation20)*ot,et=(Y._transform._rotation12+Y._transform._rotation21)*ot,lt=(Y._transform._rotation10-Y._transform._rotation01)*ot):at>_t?(ot=Math.sqrt(at-_t-rt+1),et=.5*ot,ot=.5/ot,$=(Y._transform._rotation01+Y._transform._rotation10)*ot,st=(Y._transform._rotation12+Y._transform._rotation21)*ot,lt=(Y._transform._rotation02-Y._transform._rotation20)*ot):(ot=Math.sqrt(_t-rt-at+1),st=.5*ot,ot=.5/ot,$=(Y._transform._rotation02+Y._transform._rotation20)*ot,et=(Y._transform._rotation12+Y._transform._rotation21)*ot,lt=(Y._transform._rotation10-Y._transform._rotation01)*ot),$=O*$+J*lt+N*st-K*et,et=O*et-J*st+N*lt+K*$,st=O*st+J*et-N*$+K*lt,lt=O*lt-J*$-N*et-K*st;let bt=$*$+et*et+st*st+lt*lt;bt>1e-32&&(bt=1/Math.sqrt(bt)),$*=bt,et*=bt,st*=bt,lt*=bt;let Xt=$,ft=et,ut=st,xt=lt,zt=2*Xt,gt=2*ft,pt=2*ut,ct=Xt*zt,nt=ft*gt,tt=ut*pt,kt=Xt*gt,Bt=ft*pt,Mt=Xt*pt,Rt=xt*zt,ci=xt*gt,Xi=xt*pt;Y._transform._rotation00=1-nt-tt,Y._transform._rotation01=kt-Xi,Y._transform._rotation02=Mt+ci,Y._transform._rotation10=kt+Xi,Y._transform._rotation11=1-ct-tt,Y._transform._rotation12=Bt-Rt,Y._transform._rotation20=Mt-ci,Y._transform._rotation21=Bt+Rt,Y._transform._rotation22=1-ct-nt;let gi,ki,wi,ei,Nt,At,ni,di,Oi;gi=Y._transform._rotation00*Y._invLocalInertia00+Y._transform._rotation01*Y._invLocalInertia10+Y._transform._rotation02*Y._invLocalInertia20,ki=Y._transform._rotation00*Y._invLocalInertia01+Y._transform._rotation01*Y._invLocalInertia11+Y._transform._rotation02*Y._invLocalInertia21,wi=Y._transform._rotation00*Y._invLocalInertia02+Y._transform._rotation01*Y._invLocalInertia12+Y._transform._rotation02*Y._invLocalInertia22,ei=Y._transform._rotation10*Y._invLocalInertia00+Y._transform._rotation11*Y._invLocalInertia10+Y._transform._rotation12*Y._invLocalInertia20,Nt=Y._transform._rotation10*Y._invLocalInertia01+Y._transform._rotation11*Y._invLocalInertia11+Y._transform._rotation12*Y._invLocalInertia21,At=Y._transform._rotation10*Y._invLocalInertia02+Y._transform._rotation11*Y._invLocalInertia12+Y._transform._rotation12*Y._invLocalInertia22,ni=Y._transform._rotation20*Y._invLocalInertia00+Y._transform._rotation21*Y._invLocalInertia10+Y._transform._rotation22*Y._invLocalInertia20,di=Y._transform._rotation20*Y._invLocalInertia01+Y._transform._rotation21*Y._invLocalInertia11+Y._transform._rotation22*Y._invLocalInertia21,Oi=Y._transform._rotation20*Y._invLocalInertia02+Y._transform._rotation21*Y._invLocalInertia12+Y._transform._rotation22*Y._invLocalInertia22,Y._invInertia00=gi,Y._invInertia01=ki,Y._invInertia02=wi,Y._invInertia10=ei,Y._invInertia11=Nt,Y._invInertia12=At,Y._invInertia20=ni,Y._invInertia21=di,Y._invInertia22=Oi;let Bi,Vt,wt,$t,fi,Zi,it,Ut,ii;Bi=Y._invInertia00*Y._transform._rotation00+Y._invInertia01*Y._transform._rotation01+Y._invInertia02*Y._transform._rotation02,Vt=Y._invInertia00*Y._transform._rotation10+Y._invInertia01*Y._transform._rotation11+Y._invInertia02*Y._transform._rotation12,wt=Y._invInertia00*Y._transform._rotation20+Y._invInertia01*Y._transform._rotation21+Y._invInertia02*Y._transform._rotation22,$t=Y._invInertia10*Y._transform._rotation00+Y._invInertia11*Y._transform._rotation01+Y._invInertia12*Y._transform._rotation02,fi=Y._invInertia10*Y._transform._rotation10+Y._invInertia11*Y._transform._rotation11+Y._invInertia12*Y._transform._rotation12,Zi=Y._invInertia10*Y._transform._rotation20+Y._invInertia11*Y._transform._rotation21+Y._invInertia12*Y._transform._rotation22,it=Y._invInertia20*Y._transform._rotation00+Y._invInertia21*Y._transform._rotation01+Y._invInertia22*Y._transform._rotation02,Ut=Y._invInertia20*Y._transform._rotation10+Y._invInertia21*Y._transform._rotation11+Y._invInertia22*Y._transform._rotation12,ii=Y._invInertia20*Y._transform._rotation20+Y._invInertia21*Y._transform._rotation21+Y._invInertia22*Y._transform._rotation22,Y._invInertia00=Bi,Y._invInertia01=Vt,Y._invInertia02=wt,Y._invInertia10=$t,Y._invInertia11=fi,Y._invInertia12=Zi,Y._invInertia20=it,Y._invInertia21=Ut,Y._invInertia22=ii,Y._invInertia00*=Y._rotFactor.x,Y._invInertia01*=Y._rotFactor.x,Y._invInertia02*=Y._rotFactor.x,Y._invInertia10*=Y._rotFactor.y,Y._invInertia11*=Y._rotFactor.y,Y._invInertia12*=Y._rotFactor.y,Y._invInertia20*=Y._rotFactor.z,Y._invInertia21*=Y._rotFactor.z,Y._invInertia22*=Y._rotFactor.z;let j=this._b2,Jt=Math.sqrt(S*S+P*P+T*T),Pt=Jt*.5,si,_i;if(Pt<.5){let Ti=Pt*Pt;si=.5*(1-Ti*.16666666666666666+Ti*Ti*.008333333333333333),_i=1-Ti*.5+Ti*Ti*.041666666666666664}else si=Math.sin(Pt)/Jt,_i=Math.cos(Pt);let St,ai,qi;St=S*si,ai=P*si,qi=T*si;let ui,Yt,yt,vt;ui=St,Yt=ai,yt=qi,vt=_i;let yi,Ii,bi,se,me=j._transform._rotation00,Ei=j._transform._rotation11,he=j._transform._rotation22,ve=me+Ei+he,oi;ve>0?(oi=Math.sqrt(ve+1),se=.5*oi,oi=.5/oi,yi=(j._transform._rotation21-j._transform._rotation12)*oi,Ii=(j._transform._rotation02-j._transform._rotation20)*oi,bi=(j._transform._rotation10-j._transform._rotation01)*oi):me>Ei?me>he?(oi=Math.sqrt(me-Ei-he+1),yi=.5*oi,oi=.5/oi,Ii=(j._transform._rotation01+j._transform._rotation10)*oi,bi=(j._transform._rotation02+j._transform._rotation20)*oi,se=(j._transform._rotation21-j._transform._rotation12)*oi):(oi=Math.sqrt(he-me-Ei+1),bi=.5*oi,oi=.5/oi,yi=(j._transform._rotation02+j._transform._rotation20)*oi,Ii=(j._transform._rotation12+j._transform._rotation21)*oi,se=(j._transform._rotation10-j._transform._rotation01)*oi):Ei>he?(oi=Math.sqrt(Ei-he-me+1),Ii=.5*oi,oi=.5/oi,yi=(j._transform._rotation01+j._transform._rotation10)*oi,bi=(j._transform._rotation12+j._transform._rotation21)*oi,se=(j._transform._rotation02-j._transform._rotation20)*oi):(oi=Math.sqrt(he-me-Ei+1),bi=.5*oi,oi=.5/oi,yi=(j._transform._rotation02+j._transform._rotation20)*oi,Ii=(j._transform._rotation12+j._transform._rotation21)*oi,se=(j._transform._rotation10-j._transform._rotation01)*oi),yi=vt*yi+ui*se+Yt*bi-yt*Ii,Ii=vt*Ii-ui*bi+Yt*se+yt*yi,bi=vt*bi+ui*Ii-Yt*yi+yt*se,se=vt*se-ui*yi-Yt*Ii-yt*bi;let ce=yi*yi+Ii*Ii+bi*bi+se*se;ce>1e-32&&(ce=1/Math.sqrt(ce)),yi*=ce,Ii*=ce,bi*=ce,se*=ce;let be=yi,xe=Ii,Ye=bi,Ni=se,Ji=2*be,Hi=2*xe,_e=2*Ye,ne=be*Ji,Ki=xe*Hi,ie=Ye*_e,Ui=be*Hi,Wi=xe*_e,Si=be*_e,Ht=Ni*Ji,ri=Ni*Hi,Tt=Ni*_e;j._transform._rotation00=1-Ki-ie,j._transform._rotation01=Ui-Tt,j._transform._rotation02=Si+ri,j._transform._rotation10=Ui+Tt,j._transform._rotation11=1-ne-ie,j._transform._rotation12=Wi-Ht,j._transform._rotation20=Si-ri,j._transform._rotation21=Wi+Ht,j._transform._rotation22=1-ne-Ki;let Mi,zi,Pi,Vi,ji,Gt,dt,Lt,Ai;Mi=j._transform._rotation00*j._invLocalInertia00+j._transform._rotation01*j._invLocalInertia10+j._transform._rotation02*j._invLocalInertia20,zi=j._transform._rotation00*j._invLocalInertia01+j._transform._rotation01*j._invLocalInertia11+j._transform._rotation02*j._invLocalInertia21,Pi=j._transform._rotation00*j._invLocalInertia02+j._transform._rotation01*j._invLocalInertia12+j._transform._rotation02*j._invLocalInertia22,Vi=j._transform._rotation10*j._invLocalInertia00+j._transform._rotation11*j._invLocalInertia10+j._transform._rotation12*j._invLocalInertia20,ji=j._transform._rotation10*j._invLocalInertia01+j._transform._rotation11*j._invLocalInertia11+j._transform._rotation12*j._invLocalInertia21,Gt=j._transform._rotation10*j._invLocalInertia02+j._transform._rotation11*j._invLocalInertia12+j._transform._rotation12*j._invLocalInertia22,dt=j._transform._rotation20*j._invLocalInertia00+j._transform._rotation21*j._invLocalInertia10+j._transform._rotation22*j._invLocalInertia20,Lt=j._transform._rotation20*j._invLocalInertia01+j._transform._rotation21*j._invLocalInertia11+j._transform._rotation22*j._invLocalInertia21,Ai=j._transform._rotation20*j._invLocalInertia02+j._transform._rotation21*j._invLocalInertia12+j._transform._rotation22*j._invLocalInertia22,j._invInertia00=Mi,j._invInertia01=zi,j._invInertia02=Pi,j._invInertia10=Vi,j._invInertia11=ji,j._invInertia12=Gt,j._invInertia20=dt,j._invInertia21=Lt,j._invInertia22=Ai;let Li,Di,$i,ae,re,pe,ti,Fi,vi;Li=j._invInertia00*j._transform._rotation00+j._invInertia01*j._transform._rotation01+j._invInertia02*j._transform._rotation02,Di=j._invInertia00*j._transform._rotation10+j._invInertia01*j._transform._rotation11+j._invInertia02*j._transform._rotation12,$i=j._invInertia00*j._transform._rotation20+j._invInertia01*j._transform._rotation21+j._invInertia02*j._transform._rotation22,ae=j._invInertia10*j._transform._rotation00+j._invInertia11*j._transform._rotation01+j._invInertia12*j._transform._rotation02,re=j._invInertia10*j._transform._rotation10+j._invInertia11*j._transform._rotation11+j._invInertia12*j._transform._rotation12,pe=j._invInertia10*j._transform._rotation20+j._invInertia11*j._transform._rotation21+j._invInertia12*j._transform._rotation22,ti=j._invInertia20*j._transform._rotation00+j._invInertia21*j._transform._rotation01+j._invInertia22*j._transform._rotation02,Fi=j._invInertia20*j._transform._rotation10+j._invInertia21*j._transform._rotation11+j._invInertia22*j._transform._rotation12,vi=j._invInertia20*j._transform._rotation20+j._invInertia21*j._transform._rotation21+j._invInertia22*j._transform._rotation22,j._invInertia00=Li,j._invInertia01=Di,j._invInertia02=$i,j._invInertia10=ae,j._invInertia11=re,j._invInertia12=pe,j._invInertia20=ti,j._invInertia21=Fi,j._invInertia22=vi,j._invInertia00*=j._rotFactor.x,j._invInertia01*=j._rotFactor.x,j._invInertia02*=j._rotFactor.x,j._invInertia10*=j._rotFactor.y,j._invInertia11*=j._rotFactor.y,j._invInertia12*=j._rotFactor.y,j._invInertia20*=j._rotFactor.z,j._invInertia21*=j._rotFactor.z,j._invInertia22*=j._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};m.dynamics.rigidbody||(m.dynamics.rigidbody={});m.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new m.common.Mat3}};m.dynamics.rigidbody.RigidBody=class{constructor(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;let i=t.linearVelocity;this._velX=i.x,this._velY=i.y,this._velZ=i.z;let s=t.angularVelocity;this._angVelX=s.x,this._angVelY=s.y,this._angVelZ=s.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new m.common.Transform,this._transform=new m.common.Transform;let _=t.position;this._ptransform._positionX=_.x,this._ptransform._positionY=_.y,this._ptransform._positionZ=_.z;let n=t.rotation;this._ptransform._rotation00=n.e00,this._ptransform._rotation01=n.e01,this._ptransform._rotation02=n.e02,this._ptransform._rotation10=n.e10,this._ptransform._rotation11=n.e11,this._ptransform._rotation12=n.e12,this._ptransform._rotation20=n.e20,this._ptransform._rotation21=n.e21,this._ptransform._rotation22=n.e22;let l=this._transform,o=this._ptransform;l._positionX=o._positionX,l._positionY=o._positionY,l._positionZ=o._positionZ,l._rotation00=o._rotation00,l._rotation01=o._rotation01,l._rotation02=o._rotation02,l._rotation10=o._rotation10,l._rotation11=o._rotation11,l._rotation12=o._rotation12,l._rotation20=o._rotation20,l._rotation21=o._rotation21,l._rotation22=o._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new m.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let i,s,_,n,l,o;i=this._velX*t,s=this._velY*t,_=this._velZ*t,n=this._angVelX*t,l=this._angVelY*t,o=this._angVelZ*t;let r=i*i+s*s+_*_,e=n*n+l*l+o*o;if(r==0&&e==0)return;if(r>m.common.Setting.maxTranslationPerStep*m.common.Setting.maxTranslationPerStep){let xt=m.common.Setting.maxTranslationPerStep/Math.sqrt(r);this._velX*=xt,this._velY*=xt,this._velZ*=xt,i*=xt,s*=xt,_*=xt}if(e>m.common.Setting.maxRotationPerStep*m.common.Setting.maxRotationPerStep){let xt=m.common.Setting.maxRotationPerStep/Math.sqrt(e);this._angVelX*=xt,this._angVelY*=xt,this._angVelZ*=xt,n*=xt,l*=xt,o*=xt}this._transform._positionX+=i,this._transform._positionY+=s,this._transform._positionZ+=_;let a=Math.sqrt(n*n+l*l+o*o),h=a*.5,b,X;if(h<.5){let xt=h*h;b=.5*(1-xt*.16666666666666666+xt*xt*.008333333333333333),X=1-xt*.5+xt*xt*.041666666666666664}else b=Math.sin(h)/a,X=Math.cos(h);let c,u,p;c=n*b,u=l*b,p=o*b;let x,v,f,g;x=c,v=u,f=p,g=X;let V,Z,I,M,y=this._transform._rotation00,d=this._transform._rotation11,B=this._transform._rotation22,R=y+d+B,k;R>0?(k=Math.sqrt(R+1),M=.5*k,k=.5/k,V=(this._transform._rotation21-this._transform._rotation12)*k,Z=(this._transform._rotation02-this._transform._rotation20)*k,I=(this._transform._rotation10-this._transform._rotation01)*k):y>d?y>B?(k=Math.sqrt(y-d-B+1),V=.5*k,k=.5/k,Z=(this._transform._rotation01+this._transform._rotation10)*k,I=(this._transform._rotation02+this._transform._rotation20)*k,M=(this._transform._rotation21-this._transform._rotation12)*k):(k=Math.sqrt(B-y-d+1),I=.5*k,k=.5/k,V=(this._transform._rotation02+this._transform._rotation20)*k,Z=(this._transform._rotation12+this._transform._rotation21)*k,M=(this._transform._rotation10-this._transform._rotation01)*k):d>B?(k=Math.sqrt(d-B-y+1),Z=.5*k,k=.5/k,V=(this._transform._rotation01+this._transform._rotation10)*k,I=(this._transform._rotation12+this._transform._rotation21)*k,M=(this._transform._rotation02-this._transform._rotation20)*k):(k=Math.sqrt(B-y-d+1),I=.5*k,k=.5/k,V=(this._transform._rotation02+this._transform._rotation20)*k,Z=(this._transform._rotation12+this._transform._rotation21)*k,M=(this._transform._rotation10-this._transform._rotation01)*k),V=g*V+x*M+v*I-f*Z,Z=g*Z-x*I+v*M+f*V,I=g*I+x*Z-v*V+f*M,M=g*M-x*V-v*Z-f*I;let A=V*V+Z*Z+I*I+M*M;A>1e-32&&(A=1/Math.sqrt(A)),V*=A,Z*=A,I*=A,M*=A;let z=V,w=Z,S=I,P=M,T=2*z,C=2*w,L=2*S,q=z*T,U=w*C,Y=S*L,E=z*C,D=w*L,Q=z*L,W=P*T,F=P*C,H=P*L;this._transform._rotation00=1-U-Y,this._transform._rotation01=E-H,this._transform._rotation02=Q+F,this._transform._rotation10=E+H,this._transform._rotation11=1-q-Y,this._transform._rotation12=D-W,this._transform._rotation20=Q-F,this._transform._rotation21=D+W,this._transform._rotation22=1-q-U;let G,J,N,K,O,$,et,st,lt;G=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,J=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,N=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,K=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,O=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,$=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,et=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,st=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,lt=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=G,this._invInertia01=J,this._invInertia02=N,this._invInertia10=K,this._invInertia11=O,this._invInertia12=$,this._invInertia20=et,this._invInertia21=st,this._invInertia22=lt;let rt,at,_t,ht,ot,bt,Xt,ft,ut;rt=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,at=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,_t=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,ht=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,ot=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,bt=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Xt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,ft=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,ut=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=rt,this._invInertia01=at,this._invInertia02=_t,this._invInertia10=ht,this._invInertia11=ot,this._invInertia12=bt,this._invInertia20=Xt,this._invInertia21=ft,this._invInertia22=ut,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}_integratePseudoVelocity(){if(!(this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ==0&&this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ==0))switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let t,i,s,_,n,l;t=this._pseudoVelX,i=this._pseudoVelY,s=this._pseudoVelZ,_=this._angPseudoVelX,n=this._angPseudoVelY,l=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=t,this._transform._positionY+=i,this._transform._positionZ+=s;let o=Math.sqrt(_*_+n*n+l*l),r=o*.5,e,a;if(r<.5){let Xt=r*r;e=.5*(1-Xt*.16666666666666666+Xt*Xt*.008333333333333333),a=1-Xt*.5+Xt*Xt*.041666666666666664}else e=Math.sin(r)/o,a=Math.cos(r);let h,b,X;h=_*e,b=n*e,X=l*e;let c,u,p,x;c=h,u=b,p=X,x=a;let v,f,g,V,Z=this._transform._rotation00,I=this._transform._rotation11,M=this._transform._rotation22,y=Z+I+M,d;y>0?(d=Math.sqrt(y+1),V=.5*d,d=.5/d,v=(this._transform._rotation21-this._transform._rotation12)*d,f=(this._transform._rotation02-this._transform._rotation20)*d,g=(this._transform._rotation10-this._transform._rotation01)*d):Z>I?Z>M?(d=Math.sqrt(Z-I-M+1),v=.5*d,d=.5/d,f=(this._transform._rotation01+this._transform._rotation10)*d,g=(this._transform._rotation02+this._transform._rotation20)*d,V=(this._transform._rotation21-this._transform._rotation12)*d):(d=Math.sqrt(M-Z-I+1),g=.5*d,d=.5/d,v=(this._transform._rotation02+this._transform._rotation20)*d,f=(this._transform._rotation12+this._transform._rotation21)*d,V=(this._transform._rotation10-this._transform._rotation01)*d):I>M?(d=Math.sqrt(I-M-Z+1),f=.5*d,d=.5/d,v=(this._transform._rotation01+this._transform._rotation10)*d,g=(this._transform._rotation12+this._transform._rotation21)*d,V=(this._transform._rotation02-this._transform._rotation20)*d):(d=Math.sqrt(M-Z-I+1),g=.5*d,d=.5/d,v=(this._transform._rotation02+this._transform._rotation20)*d,f=(this._transform._rotation12+this._transform._rotation21)*d,V=(this._transform._rotation10-this._transform._rotation01)*d),v=x*v+c*V+u*g-p*f,f=x*f-c*g+u*V+p*v,g=x*g+c*f-u*v+p*V,V=x*V-c*v-u*f-p*g;let B=v*v+f*f+g*g+V*V;B>1e-32&&(B=1/Math.sqrt(B)),v*=B,f*=B,g*=B,V*=B;let R=v,k=f,A=g,z=V,w=2*R,S=2*k,P=2*A,T=R*w,C=k*S,L=A*P,q=R*S,U=k*P,Y=R*P,E=z*w,D=z*S,Q=z*P;this._transform._rotation00=1-C-L,this._transform._rotation01=q-Q,this._transform._rotation02=Y+D,this._transform._rotation10=q+Q,this._transform._rotation11=1-T-L,this._transform._rotation12=U-E,this._transform._rotation20=Y-D,this._transform._rotation21=U+E,this._transform._rotation22=1-T-C;let W,F,H,G,J,N,K,O,$;W=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,F=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,H=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,G=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,J=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,N=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,K=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,O=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,$=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=W,this._invInertia01=F,this._invInertia02=H,this._invInertia10=G,this._invInertia11=J,this._invInertia12=N,this._invInertia20=K,this._invInertia21=O,this._invInertia22=$;let et,st,lt,rt,at,_t,ht,ot,bt;et=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,st=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,lt=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,rt=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,at=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,_t=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,ht=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,ot=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,bt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=et,this._invInertia01=st,this._invInertia02=lt,this._invInertia10=rt,this._invInertia11=at,this._invInertia12=_t,this._invInertia20=ht,this._invInertia21=ot,this._invInertia22=bt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}updateMass(){let t,i,s,_,n,l,o,r,e;t=0,i=0,s=0,_=0,n=0,l=0,o=0,r=0,e=0;let a=0,h=this._shapeList;for(;h!=null;){let A=h._next,z=h._geom;z._updateMass();let w=h._density*z._volume,S,P,T,C,L,q,U,Y,E,D,Q,W,F,H,G,J,N,K;D=h._localTransform._rotation00*z._inertiaCoeff00+h._localTransform._rotation01*z._inertiaCoeff10+h._localTransform._rotation02*z._inertiaCoeff20,Q=h._localTransform._rotation00*z._inertiaCoeff01+h._localTransform._rotation01*z._inertiaCoeff11+h._localTransform._rotation02*z._inertiaCoeff21,W=h._localTransform._rotation00*z._inertiaCoeff02+h._localTransform._rotation01*z._inertiaCoeff12+h._localTransform._rotation02*z._inertiaCoeff22,F=h._localTransform._rotation10*z._inertiaCoeff00+h._localTransform._rotation11*z._inertiaCoeff10+h._localTransform._rotation12*z._inertiaCoeff20,H=h._localTransform._rotation10*z._inertiaCoeff01+h._localTransform._rotation11*z._inertiaCoeff11+h._localTransform._rotation12*z._inertiaCoeff21,G=h._localTransform._rotation10*z._inertiaCoeff02+h._localTransform._rotation11*z._inertiaCoeff12+h._localTransform._rotation12*z._inertiaCoeff22,J=h._localTransform._rotation20*z._inertiaCoeff00+h._localTransform._rotation21*z._inertiaCoeff10+h._localTransform._rotation22*z._inertiaCoeff20,N=h._localTransform._rotation20*z._inertiaCoeff01+h._localTransform._rotation21*z._inertiaCoeff11+h._localTransform._rotation22*z._inertiaCoeff21,K=h._localTransform._rotation20*z._inertiaCoeff02+h._localTransform._rotation21*z._inertiaCoeff12+h._localTransform._rotation22*z._inertiaCoeff22,S=D,P=Q,T=W,C=F,L=H,q=G,U=J,Y=N,E=K;let O,$,et,st,lt,rt,at,_t,ht;O=S*h._localTransform._rotation00+P*h._localTransform._rotation01+T*h._localTransform._rotation02,$=S*h._localTransform._rotation10+P*h._localTransform._rotation11+T*h._localTransform._rotation12,et=S*h._localTransform._rotation20+P*h._localTransform._rotation21+T*h._localTransform._rotation22,st=C*h._localTransform._rotation00+L*h._localTransform._rotation01+q*h._localTransform._rotation02,lt=C*h._localTransform._rotation10+L*h._localTransform._rotation11+q*h._localTransform._rotation12,rt=C*h._localTransform._rotation20+L*h._localTransform._rotation21+q*h._localTransform._rotation22,at=U*h._localTransform._rotation00+Y*h._localTransform._rotation01+E*h._localTransform._rotation02,_t=U*h._localTransform._rotation10+Y*h._localTransform._rotation11+E*h._localTransform._rotation12,ht=U*h._localTransform._rotation20+Y*h._localTransform._rotation21+E*h._localTransform._rotation22,S=O,P=$,T=et,C=st,L=lt,q=rt,U=at,Y=_t,E=ht,S*=w,P*=w,T*=w,C*=w,L*=w,q*=w,U*=w,Y*=w,E*=w;let ot,bt,Xt,ft,ut,xt,zt,gt,pt,ct=h._localTransform._positionX*h._localTransform._positionX,nt=h._localTransform._positionY*h._localTransform._positionY,tt=h._localTransform._positionZ*h._localTransform._positionZ,kt=-h._localTransform._positionX*h._localTransform._positionY,Bt=-h._localTransform._positionY*h._localTransform._positionZ,Mt=-h._localTransform._positionZ*h._localTransform._positionX;ot=nt+tt,bt=kt,Xt=Mt,ft=kt,ut=ct+tt,xt=Bt,zt=Mt,gt=Bt,pt=ct+nt,S+=ot*w,P+=bt*w,T+=Xt*w,C+=ft*w,L+=ut*w,q+=xt*w,U+=zt*w,Y+=gt*w,E+=pt*w,a+=w,t+=S,i+=P,s+=T,_+=C,n+=L,l+=q,o+=U,r+=Y,e+=E,h=A}if(this._mass=a,this._localInertia00=t,this._localInertia01=i,this._localInertia02=s,this._localInertia10=_,this._localInertia11=n,this._localInertia12=l,this._localInertia20=o,this._localInertia21=r,this._localInertia22=e,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&this._type==0){this._invMass=1/this._mass;let A=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,z=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,w=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,S=this._localInertia00*A-this._localInertia01*z+this._localInertia02*w;(S<-1e-32||S>1e-32)&&(S=1/S),this._invLocalInertia00=A*S,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*S,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*S,this._invLocalInertia10=-z*S,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*S,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*S,this._invLocalInertia20=w*S,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*S,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*S,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);let b,X,c,u,p,x,v,f,g;b=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,X=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,c=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,u=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,p=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,x=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,f=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,g=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=b,this._invInertia01=X,this._invInertia02=c,this._invInertia10=u,this._invInertia11=p,this._invInertia12=x,this._invInertia20=v,this._invInertia21=f,this._invInertia22=g;let V,Z,I,M,y,d,B,R,k;V=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,Z=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,I=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,M=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,y=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,d=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,B=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,R=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,k=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=V,this._invInertia01=Z,this._invInertia02=I,this._invInertia10=M,this._invInertia11=y,this._invInertia12=d,this._invInertia20=B,this._invInertia21=R,this._invInertia22=k,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){let t=new m.common.Vec3;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,t}getPositionTo(t){t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(t){this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;let i=this._ptransform,s=this._transform;i._positionX=s._positionX,i._positionY=s._positionY,i._positionZ=s._positionZ,i._rotation00=s._rotation00,i._rotation01=s._rotation01,i._rotation02=s._rotation02,i._rotation10=s._rotation10,i._rotation11=s._rotation11,i._rotation12=s._rotation12,i._rotation20=s._rotation20,i._rotation21=s._rotation21,i._rotation22=s._rotation22;let _=this._shapeList;for(;_!=null;){let n=_._next,l=this._ptransform,o=this._transform,r=_._ptransform,e=_._localTransform,a,h,b,X,c,u,p,x,v;a=l._rotation00*e._rotation00+l._rotation01*e._rotation10+l._rotation02*e._rotation20,h=l._rotation00*e._rotation01+l._rotation01*e._rotation11+l._rotation02*e._rotation21,b=l._rotation00*e._rotation02+l._rotation01*e._rotation12+l._rotation02*e._rotation22,X=l._rotation10*e._rotation00+l._rotation11*e._rotation10+l._rotation12*e._rotation20,c=l._rotation10*e._rotation01+l._rotation11*e._rotation11+l._rotation12*e._rotation21,u=l._rotation10*e._rotation02+l._rotation11*e._rotation12+l._rotation12*e._rotation22,p=l._rotation20*e._rotation00+l._rotation21*e._rotation10+l._rotation22*e._rotation20,x=l._rotation20*e._rotation01+l._rotation21*e._rotation11+l._rotation22*e._rotation21,v=l._rotation20*e._rotation02+l._rotation21*e._rotation12+l._rotation22*e._rotation22,r._rotation00=a,r._rotation01=h,r._rotation02=b,r._rotation10=X,r._rotation11=c,r._rotation12=u,r._rotation20=p,r._rotation21=x,r._rotation22=v;let f,g,V;f=l._rotation00*e._positionX+l._rotation01*e._positionY+l._rotation02*e._positionZ,g=l._rotation10*e._positionX+l._rotation11*e._positionY+l._rotation12*e._positionZ,V=l._rotation20*e._positionX+l._rotation21*e._positionY+l._rotation22*e._positionZ,r._positionX=f,r._positionY=g,r._positionZ=V,r._positionX+=l._positionX,r._positionY+=l._positionY,r._positionZ+=l._positionZ;let Z=_._transform,I=_._localTransform,M,y,d,B,R,k,A,z,w;M=o._rotation00*I._rotation00+o._rotation01*I._rotation10+o._rotation02*I._rotation20,y=o._rotation00*I._rotation01+o._rotation01*I._rotation11+o._rotation02*I._rotation21,d=o._rotation00*I._rotation02+o._rotation01*I._rotation12+o._rotation02*I._rotation22,B=o._rotation10*I._rotation00+o._rotation11*I._rotation10+o._rotation12*I._rotation20,R=o._rotation10*I._rotation01+o._rotation11*I._rotation11+o._rotation12*I._rotation21,k=o._rotation10*I._rotation02+o._rotation11*I._rotation12+o._rotation12*I._rotation22,A=o._rotation20*I._rotation00+o._rotation21*I._rotation10+o._rotation22*I._rotation20,z=o._rotation20*I._rotation01+o._rotation21*I._rotation11+o._rotation22*I._rotation21,w=o._rotation20*I._rotation02+o._rotation21*I._rotation12+o._rotation22*I._rotation22,Z._rotation00=M,Z._rotation01=y,Z._rotation02=d,Z._rotation10=B,Z._rotation11=R,Z._rotation12=k,Z._rotation20=A,Z._rotation21=z,Z._rotation22=w;let S,P,T;S=o._rotation00*I._positionX+o._rotation01*I._positionY+o._rotation02*I._positionZ,P=o._rotation10*I._positionX+o._rotation11*I._positionY+o._rotation12*I._positionZ,T=o._rotation20*I._positionX+o._rotation21*I._positionY+o._rotation22*I._positionZ,Z._positionX=S,Z._positionY=P,Z._positionZ=T,Z._positionX+=o._positionX,Z._positionY+=o._positionY,Z._positionZ+=o._positionZ;let C,L,q,U,Y,E;if(_._geom._computeAabb(_._aabb,_._ptransform),C=_._aabb._minX,L=_._aabb._minY,q=_._aabb._minZ,U=_._aabb._maxX,Y=_._aabb._maxY,E=_._aabb._maxZ,_._geom._computeAabb(_._aabb,_._transform),_._aabb._minX=C<_._aabb._minX?C:_._aabb._minX,_._aabb._minY=L<_._aabb._minY?L:_._aabb._minY,_._aabb._minZ=q<_._aabb._minZ?q:_._aabb._minZ,_._aabb._maxX=U>_._aabb._maxX?U:_._aabb._maxX,_._aabb._maxY=Y>_._aabb._maxY?Y:_._aabb._maxY,_._aabb._maxZ=E>_._aabb._maxZ?E:_._aabb._maxZ,_._proxy!=null){let D,Q,W;D=_._transform._positionX-_._ptransform._positionX,Q=_._transform._positionY-_._ptransform._positionY,W=_._transform._positionZ-_._ptransform._positionZ;let F=_.displacement;F.x=D,F.y=Q,F.z=W,_._rigidBody._world._broadPhase.moveProxy(_._proxy,_._aabb,_.displacement)}_=n}this._sleeping=!1,this._sleepTime=0}translate(t){let i,s,_;i=t.x,s=t.y,_=t.z,this._transform._positionX+=i,this._transform._positionY+=s,this._transform._positionZ+=_;let n=this._ptransform,l=this._transform;n._positionX=l._positionX,n._positionY=l._positionY,n._positionZ=l._positionZ,n._rotation00=l._rotation00,n._rotation01=l._rotation01,n._rotation02=l._rotation02,n._rotation10=l._rotation10,n._rotation11=l._rotation11,n._rotation12=l._rotation12,n._rotation20=l._rotation20,n._rotation21=l._rotation21,n._rotation22=l._rotation22;let o=this._shapeList;for(;o!=null;){let r=o._next,e=this._ptransform,a=this._transform,h=o._ptransform,b=o._localTransform,X,c,u,p,x,v,f,g,V;X=e._rotation00*b._rotation00+e._rotation01*b._rotation10+e._rotation02*b._rotation20,c=e._rotation00*b._rotation01+e._rotation01*b._rotation11+e._rotation02*b._rotation21,u=e._rotation00*b._rotation02+e._rotation01*b._rotation12+e._rotation02*b._rotation22,p=e._rotation10*b._rotation00+e._rotation11*b._rotation10+e._rotation12*b._rotation20,x=e._rotation10*b._rotation01+e._rotation11*b._rotation11+e._rotation12*b._rotation21,v=e._rotation10*b._rotation02+e._rotation11*b._rotation12+e._rotation12*b._rotation22,f=e._rotation20*b._rotation00+e._rotation21*b._rotation10+e._rotation22*b._rotation20,g=e._rotation20*b._rotation01+e._rotation21*b._rotation11+e._rotation22*b._rotation21,V=e._rotation20*b._rotation02+e._rotation21*b._rotation12+e._rotation22*b._rotation22,h._rotation00=X,h._rotation01=c,h._rotation02=u,h._rotation10=p,h._rotation11=x,h._rotation12=v,h._rotation20=f,h._rotation21=g,h._rotation22=V;let Z,I,M;Z=e._rotation00*b._positionX+e._rotation01*b._positionY+e._rotation02*b._positionZ,I=e._rotation10*b._positionX+e._rotation11*b._positionY+e._rotation12*b._positionZ,M=e._rotation20*b._positionX+e._rotation21*b._positionY+e._rotation22*b._positionZ,h._positionX=Z,h._positionY=I,h._positionZ=M,h._positionX+=e._positionX,h._positionY+=e._positionY,h._positionZ+=e._positionZ;let y=o._transform,d=o._localTransform,B,R,k,A,z,w,S,P,T;B=a._rotation00*d._rotation00+a._rotation01*d._rotation10+a._rotation02*d._rotation20,R=a._rotation00*d._rotation01+a._rotation01*d._rotation11+a._rotation02*d._rotation21,k=a._rotation00*d._rotation02+a._rotation01*d._rotation12+a._rotation02*d._rotation22,A=a._rotation10*d._rotation00+a._rotation11*d._rotation10+a._rotation12*d._rotation20,z=a._rotation10*d._rotation01+a._rotation11*d._rotation11+a._rotation12*d._rotation21,w=a._rotation10*d._rotation02+a._rotation11*d._rotation12+a._rotation12*d._rotation22,S=a._rotation20*d._rotation00+a._rotation21*d._rotation10+a._rotation22*d._rotation20,P=a._rotation20*d._rotation01+a._rotation21*d._rotation11+a._rotation22*d._rotation21,T=a._rotation20*d._rotation02+a._rotation21*d._rotation12+a._rotation22*d._rotation22,y._rotation00=B,y._rotation01=R,y._rotation02=k,y._rotation10=A,y._rotation11=z,y._rotation12=w,y._rotation20=S,y._rotation21=P,y._rotation22=T;let C,L,q;C=a._rotation00*d._positionX+a._rotation01*d._positionY+a._rotation02*d._positionZ,L=a._rotation10*d._positionX+a._rotation11*d._positionY+a._rotation12*d._positionZ,q=a._rotation20*d._positionX+a._rotation21*d._positionY+a._rotation22*d._positionZ,y._positionX=C,y._positionY=L,y._positionZ=q,y._positionX+=a._positionX,y._positionY+=a._positionY,y._positionZ+=a._positionZ;let U,Y,E,D,Q,W;if(o._geom._computeAabb(o._aabb,o._ptransform),U=o._aabb._minX,Y=o._aabb._minY,E=o._aabb._minZ,D=o._aabb._maxX,Q=o._aabb._maxY,W=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=U<o._aabb._minX?U:o._aabb._minX,o._aabb._minY=Y<o._aabb._minY?Y:o._aabb._minY,o._aabb._minZ=E<o._aabb._minZ?E:o._aabb._minZ,o._aabb._maxX=D>o._aabb._maxX?D:o._aabb._maxX,o._aabb._maxY=Q>o._aabb._maxY?Q:o._aabb._maxY,o._aabb._maxZ=W>o._aabb._maxZ?W:o._aabb._maxZ,o._proxy!=null){let F,H,G;F=o._transform._positionX-o._ptransform._positionX,H=o._transform._positionY-o._ptransform._positionY,G=o._transform._positionZ-o._ptransform._positionZ;let J=o.displacement;J.x=F,J.y=H,J.z=G,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=r}this._sleeping=!1,this._sleepTime=0}getRotation(){let t=new m.common.Mat3;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,t}getRotationTo(t){t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(t){this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22;let i,s,_,n,l,o,r,e,a;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,_=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,l=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,o=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,a=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=_,this._invInertia10=n,this._invInertia11=l,this._invInertia12=o,this._invInertia20=r,this._invInertia21=e,this._invInertia22=a;let h,b,X,c,u,p,x,v,f;h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,X=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,c=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,x=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,v=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,f=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=b,this._invInertia02=X,this._invInertia10=c,this._invInertia11=u,this._invInertia12=p,this._invInertia20=x,this._invInertia21=v,this._invInertia22=f,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let g=this._ptransform,V=this._transform;g._positionX=V._positionX,g._positionY=V._positionY,g._positionZ=V._positionZ,g._rotation00=V._rotation00,g._rotation01=V._rotation01,g._rotation02=V._rotation02,g._rotation10=V._rotation10,g._rotation11=V._rotation11,g._rotation12=V._rotation12,g._rotation20=V._rotation20,g._rotation21=V._rotation21,g._rotation22=V._rotation22;let Z=this._shapeList;for(;Z!=null;){let I=Z._next,M=this._ptransform,y=this._transform,d=Z._ptransform,B=Z._localTransform,R,k,A,z,w,S,P,T,C;R=M._rotation00*B._rotation00+M._rotation01*B._rotation10+M._rotation02*B._rotation20,k=M._rotation00*B._rotation01+M._rotation01*B._rotation11+M._rotation02*B._rotation21,A=M._rotation00*B._rotation02+M._rotation01*B._rotation12+M._rotation02*B._rotation22,z=M._rotation10*B._rotation00+M._rotation11*B._rotation10+M._rotation12*B._rotation20,w=M._rotation10*B._rotation01+M._rotation11*B._rotation11+M._rotation12*B._rotation21,S=M._rotation10*B._rotation02+M._rotation11*B._rotation12+M._rotation12*B._rotation22,P=M._rotation20*B._rotation00+M._rotation21*B._rotation10+M._rotation22*B._rotation20,T=M._rotation20*B._rotation01+M._rotation21*B._rotation11+M._rotation22*B._rotation21,C=M._rotation20*B._rotation02+M._rotation21*B._rotation12+M._rotation22*B._rotation22,d._rotation00=R,d._rotation01=k,d._rotation02=A,d._rotation10=z,d._rotation11=w,d._rotation12=S,d._rotation20=P,d._rotation21=T,d._rotation22=C;let L,q,U;L=M._rotation00*B._positionX+M._rotation01*B._positionY+M._rotation02*B._positionZ,q=M._rotation10*B._positionX+M._rotation11*B._positionY+M._rotation12*B._positionZ,U=M._rotation20*B._positionX+M._rotation21*B._positionY+M._rotation22*B._positionZ,d._positionX=L,d._positionY=q,d._positionZ=U,d._positionX+=M._positionX,d._positionY+=M._positionY,d._positionZ+=M._positionZ;let Y=Z._transform,E=Z._localTransform,D,Q,W,F,H,G,J,N,K;D=y._rotation00*E._rotation00+y._rotation01*E._rotation10+y._rotation02*E._rotation20,Q=y._rotation00*E._rotation01+y._rotation01*E._rotation11+y._rotation02*E._rotation21,W=y._rotation00*E._rotation02+y._rotation01*E._rotation12+y._rotation02*E._rotation22,F=y._rotation10*E._rotation00+y._rotation11*E._rotation10+y._rotation12*E._rotation20,H=y._rotation10*E._rotation01+y._rotation11*E._rotation11+y._rotation12*E._rotation21,G=y._rotation10*E._rotation02+y._rotation11*E._rotation12+y._rotation12*E._rotation22,J=y._rotation20*E._rotation00+y._rotation21*E._rotation10+y._rotation22*E._rotation20,N=y._rotation20*E._rotation01+y._rotation21*E._rotation11+y._rotation22*E._rotation21,K=y._rotation20*E._rotation02+y._rotation21*E._rotation12+y._rotation22*E._rotation22,Y._rotation00=D,Y._rotation01=Q,Y._rotation02=W,Y._rotation10=F,Y._rotation11=H,Y._rotation12=G,Y._rotation20=J,Y._rotation21=N,Y._rotation22=K;let O,$,et;O=y._rotation00*E._positionX+y._rotation01*E._positionY+y._rotation02*E._positionZ,$=y._rotation10*E._positionX+y._rotation11*E._positionY+y._rotation12*E._positionZ,et=y._rotation20*E._positionX+y._rotation21*E._positionY+y._rotation22*E._positionZ,Y._positionX=O,Y._positionY=$,Y._positionZ=et,Y._positionX+=y._positionX,Y._positionY+=y._positionY,Y._positionZ+=y._positionZ;let st,lt,rt,at,_t,ht;if(Z._geom._computeAabb(Z._aabb,Z._ptransform),st=Z._aabb._minX,lt=Z._aabb._minY,rt=Z._aabb._minZ,at=Z._aabb._maxX,_t=Z._aabb._maxY,ht=Z._aabb._maxZ,Z._geom._computeAabb(Z._aabb,Z._transform),Z._aabb._minX=st<Z._aabb._minX?st:Z._aabb._minX,Z._aabb._minY=lt<Z._aabb._minY?lt:Z._aabb._minY,Z._aabb._minZ=rt<Z._aabb._minZ?rt:Z._aabb._minZ,Z._aabb._maxX=at>Z._aabb._maxX?at:Z._aabb._maxX,Z._aabb._maxY=_t>Z._aabb._maxY?_t:Z._aabb._maxY,Z._aabb._maxZ=ht>Z._aabb._maxZ?ht:Z._aabb._maxZ,Z._proxy!=null){let ot,bt,Xt;ot=Z._transform._positionX-Z._ptransform._positionX,bt=Z._transform._positionY-Z._ptransform._positionY,Xt=Z._transform._positionZ-Z._ptransform._positionZ;let ft=Z.displacement;ft.x=ot,ft.y=bt,ft.z=Xt,Z._rigidBody._world._broadPhase.moveProxy(Z._proxy,Z._aabb,Z.displacement)}Z=I}this._sleeping=!1,this._sleepTime=0}setRotationXyz(t){let i,s,_;i=t.x,s=t.y,_=t.z;let n=Math.sin(i),l=Math.sin(s),o=Math.sin(_),r=Math.cos(i),e=Math.cos(s),a=Math.cos(_);this._transform._rotation00=e*a,this._transform._rotation01=-e*o,this._transform._rotation02=l,this._transform._rotation10=r*o+a*n*l,this._transform._rotation11=r*a-n*l*o,this._transform._rotation12=-e*n,this._transform._rotation20=n*o-r*a*l,this._transform._rotation21=a*n+r*l*o,this._transform._rotation22=r*e;let h,b,X,c,u,p,x,v,f;h=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,b=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,X=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,c=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,u=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,p=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,x=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,v=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,f=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=h,this._invInertia01=b,this._invInertia02=X,this._invInertia10=c,this._invInertia11=u,this._invInertia12=p,this._invInertia20=x,this._invInertia21=v,this._invInertia22=f;let g,V,Z,I,M,y,d,B,R;g=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,V=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Z=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,I=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,M=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,d=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,B=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,R=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=g,this._invInertia01=V,this._invInertia02=Z,this._invInertia10=I,this._invInertia11=M,this._invInertia12=y,this._invInertia20=d,this._invInertia21=B,this._invInertia22=R,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let k=this._ptransform,A=this._transform;k._positionX=A._positionX,k._positionY=A._positionY,k._positionZ=A._positionZ,k._rotation00=A._rotation00,k._rotation01=A._rotation01,k._rotation02=A._rotation02,k._rotation10=A._rotation10,k._rotation11=A._rotation11,k._rotation12=A._rotation12,k._rotation20=A._rotation20,k._rotation21=A._rotation21,k._rotation22=A._rotation22;let z=this._shapeList;for(;z!=null;){let w=z._next,S=this._ptransform,P=this._transform,T=z._ptransform,C=z._localTransform,L,q,U,Y,E,D,Q,W,F;L=S._rotation00*C._rotation00+S._rotation01*C._rotation10+S._rotation02*C._rotation20,q=S._rotation00*C._rotation01+S._rotation01*C._rotation11+S._rotation02*C._rotation21,U=S._rotation00*C._rotation02+S._rotation01*C._rotation12+S._rotation02*C._rotation22,Y=S._rotation10*C._rotation00+S._rotation11*C._rotation10+S._rotation12*C._rotation20,E=S._rotation10*C._rotation01+S._rotation11*C._rotation11+S._rotation12*C._rotation21,D=S._rotation10*C._rotation02+S._rotation11*C._rotation12+S._rotation12*C._rotation22,Q=S._rotation20*C._rotation00+S._rotation21*C._rotation10+S._rotation22*C._rotation20,W=S._rotation20*C._rotation01+S._rotation21*C._rotation11+S._rotation22*C._rotation21,F=S._rotation20*C._rotation02+S._rotation21*C._rotation12+S._rotation22*C._rotation22,T._rotation00=L,T._rotation01=q,T._rotation02=U,T._rotation10=Y,T._rotation11=E,T._rotation12=D,T._rotation20=Q,T._rotation21=W,T._rotation22=F;let H,G,J;H=S._rotation00*C._positionX+S._rotation01*C._positionY+S._rotation02*C._positionZ,G=S._rotation10*C._positionX+S._rotation11*C._positionY+S._rotation12*C._positionZ,J=S._rotation20*C._positionX+S._rotation21*C._positionY+S._rotation22*C._positionZ,T._positionX=H,T._positionY=G,T._positionZ=J,T._positionX+=S._positionX,T._positionY+=S._positionY,T._positionZ+=S._positionZ;let N=z._transform,K=z._localTransform,O,$,et,st,lt,rt,at,_t,ht;O=P._rotation00*K._rotation00+P._rotation01*K._rotation10+P._rotation02*K._rotation20,$=P._rotation00*K._rotation01+P._rotation01*K._rotation11+P._rotation02*K._rotation21,et=P._rotation00*K._rotation02+P._rotation01*K._rotation12+P._rotation02*K._rotation22,st=P._rotation10*K._rotation00+P._rotation11*K._rotation10+P._rotation12*K._rotation20,lt=P._rotation10*K._rotation01+P._rotation11*K._rotation11+P._rotation12*K._rotation21,rt=P._rotation10*K._rotation02+P._rotation11*K._rotation12+P._rotation12*K._rotation22,at=P._rotation20*K._rotation00+P._rotation21*K._rotation10+P._rotation22*K._rotation20,_t=P._rotation20*K._rotation01+P._rotation21*K._rotation11+P._rotation22*K._rotation21,ht=P._rotation20*K._rotation02+P._rotation21*K._rotation12+P._rotation22*K._rotation22,N._rotation00=O,N._rotation01=$,N._rotation02=et,N._rotation10=st,N._rotation11=lt,N._rotation12=rt,N._rotation20=at,N._rotation21=_t,N._rotation22=ht;let ot,bt,Xt;ot=P._rotation00*K._positionX+P._rotation01*K._positionY+P._rotation02*K._positionZ,bt=P._rotation10*K._positionX+P._rotation11*K._positionY+P._rotation12*K._positionZ,Xt=P._rotation20*K._positionX+P._rotation21*K._positionY+P._rotation22*K._positionZ,N._positionX=ot,N._positionY=bt,N._positionZ=Xt,N._positionX+=P._positionX,N._positionY+=P._positionY,N._positionZ+=P._positionZ;let ft,ut,xt,zt,gt,pt;if(z._geom._computeAabb(z._aabb,z._ptransform),ft=z._aabb._minX,ut=z._aabb._minY,xt=z._aabb._minZ,zt=z._aabb._maxX,gt=z._aabb._maxY,pt=z._aabb._maxZ,z._geom._computeAabb(z._aabb,z._transform),z._aabb._minX=ft<z._aabb._minX?ft:z._aabb._minX,z._aabb._minY=ut<z._aabb._minY?ut:z._aabb._minY,z._aabb._minZ=xt<z._aabb._minZ?xt:z._aabb._minZ,z._aabb._maxX=zt>z._aabb._maxX?zt:z._aabb._maxX,z._aabb._maxY=gt>z._aabb._maxY?gt:z._aabb._maxY,z._aabb._maxZ=pt>z._aabb._maxZ?pt:z._aabb._maxZ,z._proxy!=null){let ct,nt,tt;ct=z._transform._positionX-z._ptransform._positionX,nt=z._transform._positionY-z._ptransform._positionY,tt=z._transform._positionZ-z._ptransform._positionZ;let kt=z.displacement;kt.x=ct,kt.y=nt,kt.z=tt,z._rigidBody._world._broadPhase.moveProxy(z._proxy,z._aabb,z.displacement)}z=w}this._sleeping=!1,this._sleepTime=0}rotate(t){let i,s,_,n,l,o,r,e,a;i=t.e00,s=t.e01,_=t.e02,n=t.e10,l=t.e11,o=t.e12,r=t.e20,e=t.e21,a=t.e22;let h,b,X,c,u,p,x,v,f;h=i*this._transform._rotation00+s*this._transform._rotation10+_*this._transform._rotation20,b=i*this._transform._rotation01+s*this._transform._rotation11+_*this._transform._rotation21,X=i*this._transform._rotation02+s*this._transform._rotation12+_*this._transform._rotation22,c=n*this._transform._rotation00+l*this._transform._rotation10+o*this._transform._rotation20,u=n*this._transform._rotation01+l*this._transform._rotation11+o*this._transform._rotation21,p=n*this._transform._rotation02+l*this._transform._rotation12+o*this._transform._rotation22,x=r*this._transform._rotation00+e*this._transform._rotation10+a*this._transform._rotation20,v=r*this._transform._rotation01+e*this._transform._rotation11+a*this._transform._rotation21,f=r*this._transform._rotation02+e*this._transform._rotation12+a*this._transform._rotation22,this._transform._rotation00=h,this._transform._rotation01=b,this._transform._rotation02=X,this._transform._rotation10=c,this._transform._rotation11=u,this._transform._rotation12=p,this._transform._rotation20=x,this._transform._rotation21=v,this._transform._rotation22=f;let g,V,Z,I,M,y,d,B,R;g=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,V=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Z=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,I=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,M=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,y=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,d=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,B=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,R=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=g,this._invInertia01=V,this._invInertia02=Z,this._invInertia10=I,this._invInertia11=M,this._invInertia12=y,this._invInertia20=d,this._invInertia21=B,this._invInertia22=R;let k,A,z,w,S,P,T,C,L;k=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,A=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,z=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,w=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,S=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,P=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,T=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,C=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,L=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=k,this._invInertia01=A,this._invInertia02=z,this._invInertia10=w,this._invInertia11=S,this._invInertia12=P,this._invInertia20=T,this._invInertia21=C,this._invInertia22=L,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let q=this._ptransform,U=this._transform;q._positionX=U._positionX,q._positionY=U._positionY,q._positionZ=U._positionZ,q._rotation00=U._rotation00,q._rotation01=U._rotation01,q._rotation02=U._rotation02,q._rotation10=U._rotation10,q._rotation11=U._rotation11,q._rotation12=U._rotation12,q._rotation20=U._rotation20,q._rotation21=U._rotation21,q._rotation22=U._rotation22;let Y=this._shapeList;for(;Y!=null;){let E=Y._next,D=this._ptransform,Q=this._transform,W=Y._ptransform,F=Y._localTransform,H,G,J,N,K,O,$,et,st;H=D._rotation00*F._rotation00+D._rotation01*F._rotation10+D._rotation02*F._rotation20,G=D._rotation00*F._rotation01+D._rotation01*F._rotation11+D._rotation02*F._rotation21,J=D._rotation00*F._rotation02+D._rotation01*F._rotation12+D._rotation02*F._rotation22,N=D._rotation10*F._rotation00+D._rotation11*F._rotation10+D._rotation12*F._rotation20,K=D._rotation10*F._rotation01+D._rotation11*F._rotation11+D._rotation12*F._rotation21,O=D._rotation10*F._rotation02+D._rotation11*F._rotation12+D._rotation12*F._rotation22,$=D._rotation20*F._rotation00+D._rotation21*F._rotation10+D._rotation22*F._rotation20,et=D._rotation20*F._rotation01+D._rotation21*F._rotation11+D._rotation22*F._rotation21,st=D._rotation20*F._rotation02+D._rotation21*F._rotation12+D._rotation22*F._rotation22,W._rotation00=H,W._rotation01=G,W._rotation02=J,W._rotation10=N,W._rotation11=K,W._rotation12=O,W._rotation20=$,W._rotation21=et,W._rotation22=st;let lt,rt,at;lt=D._rotation00*F._positionX+D._rotation01*F._positionY+D._rotation02*F._positionZ,rt=D._rotation10*F._positionX+D._rotation11*F._positionY+D._rotation12*F._positionZ,at=D._rotation20*F._positionX+D._rotation21*F._positionY+D._rotation22*F._positionZ,W._positionX=lt,W._positionY=rt,W._positionZ=at,W._positionX+=D._positionX,W._positionY+=D._positionY,W._positionZ+=D._positionZ;let _t=Y._transform,ht=Y._localTransform,ot,bt,Xt,ft,ut,xt,zt,gt,pt;ot=Q._rotation00*ht._rotation00+Q._rotation01*ht._rotation10+Q._rotation02*ht._rotation20,bt=Q._rotation00*ht._rotation01+Q._rotation01*ht._rotation11+Q._rotation02*ht._rotation21,Xt=Q._rotation00*ht._rotation02+Q._rotation01*ht._rotation12+Q._rotation02*ht._rotation22,ft=Q._rotation10*ht._rotation00+Q._rotation11*ht._rotation10+Q._rotation12*ht._rotation20,ut=Q._rotation10*ht._rotation01+Q._rotation11*ht._rotation11+Q._rotation12*ht._rotation21,xt=Q._rotation10*ht._rotation02+Q._rotation11*ht._rotation12+Q._rotation12*ht._rotation22,zt=Q._rotation20*ht._rotation00+Q._rotation21*ht._rotation10+Q._rotation22*ht._rotation20,gt=Q._rotation20*ht._rotation01+Q._rotation21*ht._rotation11+Q._rotation22*ht._rotation21,pt=Q._rotation20*ht._rotation02+Q._rotation21*ht._rotation12+Q._rotation22*ht._rotation22,_t._rotation00=ot,_t._rotation01=bt,_t._rotation02=Xt,_t._rotation10=ft,_t._rotation11=ut,_t._rotation12=xt,_t._rotation20=zt,_t._rotation21=gt,_t._rotation22=pt;let ct,nt,tt;ct=Q._rotation00*ht._positionX+Q._rotation01*ht._positionY+Q._rotation02*ht._positionZ,nt=Q._rotation10*ht._positionX+Q._rotation11*ht._positionY+Q._rotation12*ht._positionZ,tt=Q._rotation20*ht._positionX+Q._rotation21*ht._positionY+Q._rotation22*ht._positionZ,_t._positionX=ct,_t._positionY=nt,_t._positionZ=tt,_t._positionX+=Q._positionX,_t._positionY+=Q._positionY,_t._positionZ+=Q._positionZ;let kt,Bt,Mt,Rt,ci,Xi;if(Y._geom._computeAabb(Y._aabb,Y._ptransform),kt=Y._aabb._minX,Bt=Y._aabb._minY,Mt=Y._aabb._minZ,Rt=Y._aabb._maxX,ci=Y._aabb._maxY,Xi=Y._aabb._maxZ,Y._geom._computeAabb(Y._aabb,Y._transform),Y._aabb._minX=kt<Y._aabb._minX?kt:Y._aabb._minX,Y._aabb._minY=Bt<Y._aabb._minY?Bt:Y._aabb._minY,Y._aabb._minZ=Mt<Y._aabb._minZ?Mt:Y._aabb._minZ,Y._aabb._maxX=Rt>Y._aabb._maxX?Rt:Y._aabb._maxX,Y._aabb._maxY=ci>Y._aabb._maxY?ci:Y._aabb._maxY,Y._aabb._maxZ=Xi>Y._aabb._maxZ?Xi:Y._aabb._maxZ,Y._proxy!=null){let gi,ki,wi;gi=Y._transform._positionX-Y._ptransform._positionX,ki=Y._transform._positionY-Y._ptransform._positionY,wi=Y._transform._positionZ-Y._ptransform._positionZ;let ei=Y.displacement;ei.x=gi,ei.y=ki,ei.z=wi,Y._rigidBody._world._broadPhase.moveProxy(Y._proxy,Y._aabb,Y.displacement)}Y=E}this._sleeping=!1,this._sleepTime=0}rotateXyz(t){let i,s,_,n,l,o,r,e,a,h,b,X;i=t.x,s=t.y,_=t.z;let c=Math.sin(i),u=Math.sin(s),p=Math.sin(_),x=Math.cos(i),v=Math.cos(s),f=Math.cos(_);n=v*f,l=-v*p,o=u,r=x*p+f*c*u,e=x*f-c*u*p,a=-v*c,h=c*p-x*f*u,b=f*c+x*u*p,X=x*v;let g,V,Z,I,M,y,d,B,R;g=n*this._transform._rotation00+l*this._transform._rotation10+o*this._transform._rotation20,V=n*this._transform._rotation01+l*this._transform._rotation11+o*this._transform._rotation21,Z=n*this._transform._rotation02+l*this._transform._rotation12+o*this._transform._rotation22,I=r*this._transform._rotation00+e*this._transform._rotation10+a*this._transform._rotation20,M=r*this._transform._rotation01+e*this._transform._rotation11+a*this._transform._rotation21,y=r*this._transform._rotation02+e*this._transform._rotation12+a*this._transform._rotation22,d=h*this._transform._rotation00+b*this._transform._rotation10+X*this._transform._rotation20,B=h*this._transform._rotation01+b*this._transform._rotation11+X*this._transform._rotation21,R=h*this._transform._rotation02+b*this._transform._rotation12+X*this._transform._rotation22,this._transform._rotation00=g,this._transform._rotation01=V,this._transform._rotation02=Z,this._transform._rotation10=I,this._transform._rotation11=M,this._transform._rotation12=y,this._transform._rotation20=d,this._transform._rotation21=B,this._transform._rotation22=R;let k,A,z,w,S,P,T,C,L;k=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,A=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,z=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,w=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,S=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,P=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,T=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,C=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,L=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=k,this._invInertia01=A,this._invInertia02=z,this._invInertia10=w,this._invInertia11=S,this._invInertia12=P,this._invInertia20=T,this._invInertia21=C,this._invInertia22=L;let q,U,Y,E,D,Q,W,F,H;q=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,U=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Y=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,E=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,D=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Q=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,W=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,F=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,H=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=q,this._invInertia01=U,this._invInertia02=Y,this._invInertia10=E,this._invInertia11=D,this._invInertia12=Q,this._invInertia20=W,this._invInertia21=F,this._invInertia22=H,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let G=this._ptransform,J=this._transform;G._positionX=J._positionX,G._positionY=J._positionY,G._positionZ=J._positionZ,G._rotation00=J._rotation00,G._rotation01=J._rotation01,G._rotation02=J._rotation02,G._rotation10=J._rotation10,G._rotation11=J._rotation11,G._rotation12=J._rotation12,G._rotation20=J._rotation20,G._rotation21=J._rotation21,G._rotation22=J._rotation22;let N=this._shapeList;for(;N!=null;){let K=N._next,O=this._ptransform,$=this._transform,et=N._ptransform,st=N._localTransform,lt,rt,at,_t,ht,ot,bt,Xt,ft;lt=O._rotation00*st._rotation00+O._rotation01*st._rotation10+O._rotation02*st._rotation20,rt=O._rotation00*st._rotation01+O._rotation01*st._rotation11+O._rotation02*st._rotation21,at=O._rotation00*st._rotation02+O._rotation01*st._rotation12+O._rotation02*st._rotation22,_t=O._rotation10*st._rotation00+O._rotation11*st._rotation10+O._rotation12*st._rotation20,ht=O._rotation10*st._rotation01+O._rotation11*st._rotation11+O._rotation12*st._rotation21,ot=O._rotation10*st._rotation02+O._rotation11*st._rotation12+O._rotation12*st._rotation22,bt=O._rotation20*st._rotation00+O._rotation21*st._rotation10+O._rotation22*st._rotation20,Xt=O._rotation20*st._rotation01+O._rotation21*st._rotation11+O._rotation22*st._rotation21,ft=O._rotation20*st._rotation02+O._rotation21*st._rotation12+O._rotation22*st._rotation22,et._rotation00=lt,et._rotation01=rt,et._rotation02=at,et._rotation10=_t,et._rotation11=ht,et._rotation12=ot,et._rotation20=bt,et._rotation21=Xt,et._rotation22=ft;let ut,xt,zt;ut=O._rotation00*st._positionX+O._rotation01*st._positionY+O._rotation02*st._positionZ,xt=O._rotation10*st._positionX+O._rotation11*st._positionY+O._rotation12*st._positionZ,zt=O._rotation20*st._positionX+O._rotation21*st._positionY+O._rotation22*st._positionZ,et._positionX=ut,et._positionY=xt,et._positionZ=zt,et._positionX+=O._positionX,et._positionY+=O._positionY,et._positionZ+=O._positionZ;let gt=N._transform,pt=N._localTransform,ct,nt,tt,kt,Bt,Mt,Rt,ci,Xi;ct=$._rotation00*pt._rotation00+$._rotation01*pt._rotation10+$._rotation02*pt._rotation20,nt=$._rotation00*pt._rotation01+$._rotation01*pt._rotation11+$._rotation02*pt._rotation21,tt=$._rotation00*pt._rotation02+$._rotation01*pt._rotation12+$._rotation02*pt._rotation22,kt=$._rotation10*pt._rotation00+$._rotation11*pt._rotation10+$._rotation12*pt._rotation20,Bt=$._rotation10*pt._rotation01+$._rotation11*pt._rotation11+$._rotation12*pt._rotation21,Mt=$._rotation10*pt._rotation02+$._rotation11*pt._rotation12+$._rotation12*pt._rotation22,Rt=$._rotation20*pt._rotation00+$._rotation21*pt._rotation10+$._rotation22*pt._rotation20,ci=$._rotation20*pt._rotation01+$._rotation21*pt._rotation11+$._rotation22*pt._rotation21,Xi=$._rotation20*pt._rotation02+$._rotation21*pt._rotation12+$._rotation22*pt._rotation22,gt._rotation00=ct,gt._rotation01=nt,gt._rotation02=tt,gt._rotation10=kt,gt._rotation11=Bt,gt._rotation12=Mt,gt._rotation20=Rt,gt._rotation21=ci,gt._rotation22=Xi;let gi,ki,wi;gi=$._rotation00*pt._positionX+$._rotation01*pt._positionY+$._rotation02*pt._positionZ,ki=$._rotation10*pt._positionX+$._rotation11*pt._positionY+$._rotation12*pt._positionZ,wi=$._rotation20*pt._positionX+$._rotation21*pt._positionY+$._rotation22*pt._positionZ,gt._positionX=gi,gt._positionY=ki,gt._positionZ=wi,gt._positionX+=$._positionX,gt._positionY+=$._positionY,gt._positionZ+=$._positionZ;let ei,Nt,At,ni,di,Oi;if(N._geom._computeAabb(N._aabb,N._ptransform),ei=N._aabb._minX,Nt=N._aabb._minY,At=N._aabb._minZ,ni=N._aabb._maxX,di=N._aabb._maxY,Oi=N._aabb._maxZ,N._geom._computeAabb(N._aabb,N._transform),N._aabb._minX=ei<N._aabb._minX?ei:N._aabb._minX,N._aabb._minY=Nt<N._aabb._minY?Nt:N._aabb._minY,N._aabb._minZ=At<N._aabb._minZ?At:N._aabb._minZ,N._aabb._maxX=ni>N._aabb._maxX?ni:N._aabb._maxX,N._aabb._maxY=di>N._aabb._maxY?di:N._aabb._maxY,N._aabb._maxZ=Oi>N._aabb._maxZ?Oi:N._aabb._maxZ,N._proxy!=null){let Bi,Vt,wt;Bi=N._transform._positionX-N._ptransform._positionX,Vt=N._transform._positionY-N._ptransform._positionY,wt=N._transform._positionZ-N._ptransform._positionZ;let $t=N.displacement;$t.x=Bi,$t.y=Vt,$t.z=wt,N._rigidBody._world._broadPhase.moveProxy(N._proxy,N._aabb,N.displacement)}N=K}this._sleeping=!1,this._sleepTime=0}getOrientation(){let t=new m.common.Quat,i,s,_,n,l=this._transform._rotation00,o=this._transform._rotation11,r=this._transform._rotation22,e=l+o+r,a;return e>0?(a=Math.sqrt(e+1),n=.5*a,a=.5/a,i=(this._transform._rotation21-this._transform._rotation12)*a,s=(this._transform._rotation02-this._transform._rotation20)*a,_=(this._transform._rotation10-this._transform._rotation01)*a):l>o?l>r?(a=Math.sqrt(l-o-r+1),i=.5*a,a=.5/a,s=(this._transform._rotation01+this._transform._rotation10)*a,_=(this._transform._rotation02+this._transform._rotation20)*a,n=(this._transform._rotation21-this._transform._rotation12)*a):(a=Math.sqrt(r-l-o+1),_=.5*a,a=.5/a,i=(this._transform._rotation02+this._transform._rotation20)*a,s=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation10-this._transform._rotation01)*a):o>r?(a=Math.sqrt(o-r-l+1),s=.5*a,a=.5/a,i=(this._transform._rotation01+this._transform._rotation10)*a,_=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation02-this._transform._rotation20)*a):(a=Math.sqrt(r-l-o+1),_=.5*a,a=.5/a,i=(this._transform._rotation02+this._transform._rotation20)*a,s=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation10-this._transform._rotation01)*a),t.x=i,t.y=s,t.z=_,t.w=n,t}getOrientationTo(t){let i,s,_,n,l=this._transform._rotation00,o=this._transform._rotation11,r=this._transform._rotation22,e=l+o+r,a;e>0?(a=Math.sqrt(e+1),n=.5*a,a=.5/a,i=(this._transform._rotation21-this._transform._rotation12)*a,s=(this._transform._rotation02-this._transform._rotation20)*a,_=(this._transform._rotation10-this._transform._rotation01)*a):l>o?l>r?(a=Math.sqrt(l-o-r+1),i=.5*a,a=.5/a,s=(this._transform._rotation01+this._transform._rotation10)*a,_=(this._transform._rotation02+this._transform._rotation20)*a,n=(this._transform._rotation21-this._transform._rotation12)*a):(a=Math.sqrt(r-l-o+1),_=.5*a,a=.5/a,i=(this._transform._rotation02+this._transform._rotation20)*a,s=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation10-this._transform._rotation01)*a):o>r?(a=Math.sqrt(o-r-l+1),s=.5*a,a=.5/a,i=(this._transform._rotation01+this._transform._rotation10)*a,_=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation02-this._transform._rotation20)*a):(a=Math.sqrt(r-l-o+1),_=.5*a,a=.5/a,i=(this._transform._rotation02+this._transform._rotation20)*a,s=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation10-this._transform._rotation01)*a),t.x=i,t.y=s,t.z=_,t.w=n}setOrientation(t){let i,s,_,n;i=t.x,s=t.y,_=t.z,n=t.w;let l=i,o=s,r=_,e=n,a=2*l,h=2*o,b=2*r,X=l*a,c=o*h,u=r*b,p=l*h,x=o*b,v=l*b,f=e*a,g=e*h,V=e*b;this._transform._rotation00=1-c-u,this._transform._rotation01=p-V,this._transform._rotation02=v+g,this._transform._rotation10=p+V,this._transform._rotation11=1-X-u,this._transform._rotation12=x-f,this._transform._rotation20=v-g,this._transform._rotation21=x+f,this._transform._rotation22=1-X-c;let Z,I,M,y,d,B,R,k,A;Z=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,I=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,M=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,y=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,d=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,B=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,R=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,k=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,A=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=Z,this._invInertia01=I,this._invInertia02=M,this._invInertia10=y,this._invInertia11=d,this._invInertia12=B,this._invInertia20=R,this._invInertia21=k,this._invInertia22=A;let z,w,S,P,T,C,L,q,U;z=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,w=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,S=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,P=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,T=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,C=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,L=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,q=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,U=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=z,this._invInertia01=w,this._invInertia02=S,this._invInertia10=P,this._invInertia11=T,this._invInertia12=C,this._invInertia20=L,this._invInertia21=q,this._invInertia22=U,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let Y=this._ptransform,E=this._transform;Y._positionX=E._positionX,Y._positionY=E._positionY,Y._positionZ=E._positionZ,Y._rotation00=E._rotation00,Y._rotation01=E._rotation01,Y._rotation02=E._rotation02,Y._rotation10=E._rotation10,Y._rotation11=E._rotation11,Y._rotation12=E._rotation12,Y._rotation20=E._rotation20,Y._rotation21=E._rotation21,Y._rotation22=E._rotation22;let D=this._shapeList;for(;D!=null;){let Q=D._next,W=this._ptransform,F=this._transform,H=D._ptransform,G=D._localTransform,J,N,K,O,$,et,st,lt,rt;J=W._rotation00*G._rotation00+W._rotation01*G._rotation10+W._rotation02*G._rotation20,N=W._rotation00*G._rotation01+W._rotation01*G._rotation11+W._rotation02*G._rotation21,K=W._rotation00*G._rotation02+W._rotation01*G._rotation12+W._rotation02*G._rotation22,O=W._rotation10*G._rotation00+W._rotation11*G._rotation10+W._rotation12*G._rotation20,$=W._rotation10*G._rotation01+W._rotation11*G._rotation11+W._rotation12*G._rotation21,et=W._rotation10*G._rotation02+W._rotation11*G._rotation12+W._rotation12*G._rotation22,st=W._rotation20*G._rotation00+W._rotation21*G._rotation10+W._rotation22*G._rotation20,lt=W._rotation20*G._rotation01+W._rotation21*G._rotation11+W._rotation22*G._rotation21,rt=W._rotation20*G._rotation02+W._rotation21*G._rotation12+W._rotation22*G._rotation22,H._rotation00=J,H._rotation01=N,H._rotation02=K,H._rotation10=O,H._rotation11=$,H._rotation12=et,H._rotation20=st,H._rotation21=lt,H._rotation22=rt;let at,_t,ht;at=W._rotation00*G._positionX+W._rotation01*G._positionY+W._rotation02*G._positionZ,_t=W._rotation10*G._positionX+W._rotation11*G._positionY+W._rotation12*G._positionZ,ht=W._rotation20*G._positionX+W._rotation21*G._positionY+W._rotation22*G._positionZ,H._positionX=at,H._positionY=_t,H._positionZ=ht,H._positionX+=W._positionX,H._positionY+=W._positionY,H._positionZ+=W._positionZ;let ot=D._transform,bt=D._localTransform,Xt,ft,ut,xt,zt,gt,pt,ct,nt;Xt=F._rotation00*bt._rotation00+F._rotation01*bt._rotation10+F._rotation02*bt._rotation20,ft=F._rotation00*bt._rotation01+F._rotation01*bt._rotation11+F._rotation02*bt._rotation21,ut=F._rotation00*bt._rotation02+F._rotation01*bt._rotation12+F._rotation02*bt._rotation22,xt=F._rotation10*bt._rotation00+F._rotation11*bt._rotation10+F._rotation12*bt._rotation20,zt=F._rotation10*bt._rotation01+F._rotation11*bt._rotation11+F._rotation12*bt._rotation21,gt=F._rotation10*bt._rotation02+F._rotation11*bt._rotation12+F._rotation12*bt._rotation22,pt=F._rotation20*bt._rotation00+F._rotation21*bt._rotation10+F._rotation22*bt._rotation20,ct=F._rotation20*bt._rotation01+F._rotation21*bt._rotation11+F._rotation22*bt._rotation21,nt=F._rotation20*bt._rotation02+F._rotation21*bt._rotation12+F._rotation22*bt._rotation22,ot._rotation00=Xt,ot._rotation01=ft,ot._rotation02=ut,ot._rotation10=xt,ot._rotation11=zt,ot._rotation12=gt,ot._rotation20=pt,ot._rotation21=ct,ot._rotation22=nt;let tt,kt,Bt;tt=F._rotation00*bt._positionX+F._rotation01*bt._positionY+F._rotation02*bt._positionZ,kt=F._rotation10*bt._positionX+F._rotation11*bt._positionY+F._rotation12*bt._positionZ,Bt=F._rotation20*bt._positionX+F._rotation21*bt._positionY+F._rotation22*bt._positionZ,ot._positionX=tt,ot._positionY=kt,ot._positionZ=Bt,ot._positionX+=F._positionX,ot._positionY+=F._positionY,ot._positionZ+=F._positionZ;let Mt,Rt,ci,Xi,gi,ki;if(D._geom._computeAabb(D._aabb,D._ptransform),Mt=D._aabb._minX,Rt=D._aabb._minY,ci=D._aabb._minZ,Xi=D._aabb._maxX,gi=D._aabb._maxY,ki=D._aabb._maxZ,D._geom._computeAabb(D._aabb,D._transform),D._aabb._minX=Mt<D._aabb._minX?Mt:D._aabb._minX,D._aabb._minY=Rt<D._aabb._minY?Rt:D._aabb._minY,D._aabb._minZ=ci<D._aabb._minZ?ci:D._aabb._minZ,D._aabb._maxX=Xi>D._aabb._maxX?Xi:D._aabb._maxX,D._aabb._maxY=gi>D._aabb._maxY?gi:D._aabb._maxY,D._aabb._maxZ=ki>D._aabb._maxZ?ki:D._aabb._maxZ,D._proxy!=null){let wi,ei,Nt;wi=D._transform._positionX-D._ptransform._positionX,ei=D._transform._positionY-D._ptransform._positionY,Nt=D._transform._positionZ-D._ptransform._positionZ;let At=D.displacement;At.x=wi,At.y=ei,At.z=Nt,D._rigidBody._world._broadPhase.moveProxy(D._proxy,D._aabb,D.displacement)}D=Q}this._sleeping=!1,this._sleepTime=0}getTransform(){let t=this._transform,i=new m.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setTransform(t){this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22;let i,s,_,n,l,o,r,e,a;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,_=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,l=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,o=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,a=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=_,this._invInertia10=n,this._invInertia11=l,this._invInertia12=o,this._invInertia20=r,this._invInertia21=e,this._invInertia22=a;let h,b,X,c,u,p,x,v,f;h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,X=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,c=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,x=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,v=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,f=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=b,this._invInertia02=X,this._invInertia10=c,this._invInertia11=u,this._invInertia12=p,this._invInertia20=x,this._invInertia21=v,this._invInertia22=f,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let g=this._ptransform,V=this._transform;g._positionX=V._positionX,g._positionY=V._positionY,g._positionZ=V._positionZ,g._rotation00=V._rotation00,g._rotation01=V._rotation01,g._rotation02=V._rotation02,g._rotation10=V._rotation10,g._rotation11=V._rotation11,g._rotation12=V._rotation12,g._rotation20=V._rotation20,g._rotation21=V._rotation21,g._rotation22=V._rotation22;let Z=this._shapeList;for(;Z!=null;){let I=Z._next,M=this._ptransform,y=this._transform,d=Z._ptransform,B=Z._localTransform,R,k,A,z,w,S,P,T,C;R=M._rotation00*B._rotation00+M._rotation01*B._rotation10+M._rotation02*B._rotation20,k=M._rotation00*B._rotation01+M._rotation01*B._rotation11+M._rotation02*B._rotation21,A=M._rotation00*B._rotation02+M._rotation01*B._rotation12+M._rotation02*B._rotation22,z=M._rotation10*B._rotation00+M._rotation11*B._rotation10+M._rotation12*B._rotation20,w=M._rotation10*B._rotation01+M._rotation11*B._rotation11+M._rotation12*B._rotation21,S=M._rotation10*B._rotation02+M._rotation11*B._rotation12+M._rotation12*B._rotation22,P=M._rotation20*B._rotation00+M._rotation21*B._rotation10+M._rotation22*B._rotation20,T=M._rotation20*B._rotation01+M._rotation21*B._rotation11+M._rotation22*B._rotation21,C=M._rotation20*B._rotation02+M._rotation21*B._rotation12+M._rotation22*B._rotation22,d._rotation00=R,d._rotation01=k,d._rotation02=A,d._rotation10=z,d._rotation11=w,d._rotation12=S,d._rotation20=P,d._rotation21=T,d._rotation22=C;let L,q,U;L=M._rotation00*B._positionX+M._rotation01*B._positionY+M._rotation02*B._positionZ,q=M._rotation10*B._positionX+M._rotation11*B._positionY+M._rotation12*B._positionZ,U=M._rotation20*B._positionX+M._rotation21*B._positionY+M._rotation22*B._positionZ,d._positionX=L,d._positionY=q,d._positionZ=U,d._positionX+=M._positionX,d._positionY+=M._positionY,d._positionZ+=M._positionZ;let Y=Z._transform,E=Z._localTransform,D,Q,W,F,H,G,J,N,K;D=y._rotation00*E._rotation00+y._rotation01*E._rotation10+y._rotation02*E._rotation20,Q=y._rotation00*E._rotation01+y._rotation01*E._rotation11+y._rotation02*E._rotation21,W=y._rotation00*E._rotation02+y._rotation01*E._rotation12+y._rotation02*E._rotation22,F=y._rotation10*E._rotation00+y._rotation11*E._rotation10+y._rotation12*E._rotation20,H=y._rotation10*E._rotation01+y._rotation11*E._rotation11+y._rotation12*E._rotation21,G=y._rotation10*E._rotation02+y._rotation11*E._rotation12+y._rotation12*E._rotation22,J=y._rotation20*E._rotation00+y._rotation21*E._rotation10+y._rotation22*E._rotation20,N=y._rotation20*E._rotation01+y._rotation21*E._rotation11+y._rotation22*E._rotation21,K=y._rotation20*E._rotation02+y._rotation21*E._rotation12+y._rotation22*E._rotation22,Y._rotation00=D,Y._rotation01=Q,Y._rotation02=W,Y._rotation10=F,Y._rotation11=H,Y._rotation12=G,Y._rotation20=J,Y._rotation21=N,Y._rotation22=K;let O,$,et;O=y._rotation00*E._positionX+y._rotation01*E._positionY+y._rotation02*E._positionZ,$=y._rotation10*E._positionX+y._rotation11*E._positionY+y._rotation12*E._positionZ,et=y._rotation20*E._positionX+y._rotation21*E._positionY+y._rotation22*E._positionZ,Y._positionX=O,Y._positionY=$,Y._positionZ=et,Y._positionX+=y._positionX,Y._positionY+=y._positionY,Y._positionZ+=y._positionZ;let st,lt,rt,at,_t,ht;if(Z._geom._computeAabb(Z._aabb,Z._ptransform),st=Z._aabb._minX,lt=Z._aabb._minY,rt=Z._aabb._minZ,at=Z._aabb._maxX,_t=Z._aabb._maxY,ht=Z._aabb._maxZ,Z._geom._computeAabb(Z._aabb,Z._transform),Z._aabb._minX=st<Z._aabb._minX?st:Z._aabb._minX,Z._aabb._minY=lt<Z._aabb._minY?lt:Z._aabb._minY,Z._aabb._minZ=rt<Z._aabb._minZ?rt:Z._aabb._minZ,Z._aabb._maxX=at>Z._aabb._maxX?at:Z._aabb._maxX,Z._aabb._maxY=_t>Z._aabb._maxY?_t:Z._aabb._maxY,Z._aabb._maxZ=ht>Z._aabb._maxZ?ht:Z._aabb._maxZ,Z._proxy!=null){let ot,bt,Xt;ot=Z._transform._positionX-Z._ptransform._positionX,bt=Z._transform._positionY-Z._ptransform._positionY,Xt=Z._transform._positionZ-Z._ptransform._positionZ;let ft=Z.displacement;ft.x=ot,ft.y=bt,ft.z=Xt,Z._rigidBody._world._broadPhase.moveProxy(Z._proxy,Z._aabb,Z.displacement)}Z=I}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){let t=new m.common.Mat3;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,t}getLocalInertiaTo(t){t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){let t=new m.dynamics.rigidbody.MassData;t.mass=this._mass;let i=t.localInertia;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t}getMassDataTo(t){t.mass=this._mass;let i=t.localInertia;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22}setMassData(t){this._mass=t.mass;let i=t.localInertia;if(this._localInertia00=i.e00,this._localInertia01=i.e01,this._localInertia02=i.e02,this._localInertia10=i.e10,this._localInertia11=i.e11,this._localInertia12=i.e12,this._localInertia20=i.e20,this._localInertia21=i.e21,this._localInertia22=i.e22,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&this._type==0){this._invMass=1/this._mass;let V=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,Z=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,I=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,M=this._localInertia00*V-this._localInertia01*Z+this._localInertia02*I;(M<-1e-32||M>1e-32)&&(M=1/M),this._invLocalInertia00=V*M,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*M,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*M,this._invLocalInertia10=-Z*M,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*M,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*M,this._invLocalInertia20=I*M,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*M,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*M,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);let s,_,n,l,o,r,e,a,h;s=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,_=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,l=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,o=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=s,this._invInertia01=_,this._invInertia02=n,this._invInertia10=l,this._invInertia11=o,this._invInertia12=r,this._invInertia20=e,this._invInertia21=a,this._invInertia22=h;let b,X,c,u,p,x,v,f,g;b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,X=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,c=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,u=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,v=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,g=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=X,this._invInertia02=c,this._invInertia10=u,this._invInertia11=p,this._invInertia12=x,this._invInertia20=v,this._invInertia21=f,this._invInertia22=g,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){let t=this._rotFactor;return new m.common.Vec3(t.x,t.y,t.z)}setRotationFactor(t){let i=this._rotFactor;i.x=t.x,i.y=t.y,i.z=t.z;let s,_,n,l,o,r,e,a,h;s=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,_=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,l=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,o=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=s,this._invInertia01=_,this._invInertia02=n,this._invInertia10=l,this._invInertia11=o,this._invInertia12=r,this._invInertia20=e,this._invInertia21=a,this._invInertia22=h;let b,X,c,u,p,x,v,f,g;b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,X=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,c=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,u=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,v=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,g=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=X,this._invInertia02=c,this._invInertia10=u,this._invInertia11=p,this._invInertia12=x,this._invInertia20=v,this._invInertia21=f,this._invInertia22=g,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){let t=new m.common.Vec3;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,t}getLinearVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(t){this._type==1?(this._velX=0,this._velY=0,this._velZ=0):(this._velX=t.x,this._velY=t.y,this._velZ=t.z),this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){let t=new m.common.Vec3;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,t}getAngularVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(t){this._type==1?(this._angVelX=0,this._angVelY=0,this._angVelZ=0):(this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z),this._sleeping=!1,this._sleepTime=0}addLinearVelocity(t){if(this._type!=1){let i,s,_;i=t.x,s=t.y,_=t.z,this._velX+=i,this._velY+=s,this._velZ+=_}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(t){if(this._type!=1){let i,s,_;i=t.x,s=t.y,_=t.z,this._angVelX+=i,this._angVelY+=s,this._angVelZ+=_}this._sleeping=!1,this._sleepTime=0}applyImpulse(t,i){let s,_,n;s=t.x,_=t.y,n=t.z,this._velX+=s*this._invMass,this._velY+=_*this._invMass,this._velZ+=n*this._invMass;let l,o,r,e,a,h;e=i.x,a=i.y,h=i.z,e-=this._transform._positionX,a-=this._transform._positionY,h-=this._transform._positionZ,l=a*n-h*_,o=h*s-e*n,r=e*_-a*s;let b,X,c;b=this._invInertia00*l+this._invInertia01*o+this._invInertia02*r,X=this._invInertia10*l+this._invInertia11*o+this._invInertia12*r,c=this._invInertia20*l+this._invInertia21*o+this._invInertia22*r,l=b,o=X,r=c,this._angVelX+=l,this._angVelY+=o,this._angVelZ+=r,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(t){let i,s,_;i=t.x,s=t.y,_=t.z,this._velX+=i*this._invMass,this._velY+=s*this._invMass,this._velZ+=_*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(t){let i,s,_;i=t.x,s=t.y,_=t.z;let n,l,o;n=this._invInertia00*i+this._invInertia01*s+this._invInertia02*_,l=this._invInertia10*i+this._invInertia11*s+this._invInertia12*_,o=this._invInertia20*i+this._invInertia21*s+this._invInertia22*_,i=n,s=l,_=o,this._angVelX+=i,this._angVelY+=s,this._angVelZ+=_,this._sleeping=!1,this._sleepTime=0}applyForce(t,i){let s,_,n;s=t.x,_=t.y,n=t.z,this._forceX+=s,this._forceY+=_,this._forceZ+=n;let l,o,r,e,a,h;e=i.x,a=i.y,h=i.z,e-=this._transform._positionX,a-=this._transform._positionY,h-=this._transform._positionZ,l=a*n-h*_,o=h*s-e*n,r=e*_-a*s,this._torqueX+=l,this._torqueY+=o,this._torqueZ+=r,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(t){let i,s,_;i=t.x,s=t.y,_=t.z,this._forceX+=i,this._forceY+=s,this._forceZ+=_,this._sleeping=!1,this._sleepTime=0}applyTorque(t){let i,s,_;i=t.x,s=t.y,_=t.z,this._torqueX+=i,this._torqueY+=s,this._torqueZ+=_,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){let t=new m.common.Vec3;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,t}getLinearContactImpulseTo(t){t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){let t=new m.common.Vec3;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,t}getAngularContactImpulseTo(t){t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0}getLocalPoint(t){let i,s,_;i=t.x,s=t.y,_=t.z,i-=this._transform._positionX,s-=this._transform._positionY,_-=this._transform._positionZ;let n,l,o;n=this._transform._rotation00*i+this._transform._rotation10*s+this._transform._rotation20*_,l=this._transform._rotation01*i+this._transform._rotation11*s+this._transform._rotation21*_,o=this._transform._rotation02*i+this._transform._rotation12*s+this._transform._rotation22*_,i=n,s=l,_=o;let r=new m.common.Vec3;return r.x=i,r.y=s,r.z=_,r}getLocalPointTo(t,i){let s,_,n;s=t.x,_=t.y,n=t.z,s-=this._transform._positionX,_-=this._transform._positionY,n-=this._transform._positionZ;let l,o,r;l=this._transform._rotation00*s+this._transform._rotation10*_+this._transform._rotation20*n,o=this._transform._rotation01*s+this._transform._rotation11*_+this._transform._rotation21*n,r=this._transform._rotation02*s+this._transform._rotation12*_+this._transform._rotation22*n,s=l,_=o,n=r,i.x=s,i.y=_,i.z=n}getLocalVector(t){let i,s,_;i=t.x,s=t.y,_=t.z;let n,l,o;n=this._transform._rotation00*i+this._transform._rotation10*s+this._transform._rotation20*_,l=this._transform._rotation01*i+this._transform._rotation11*s+this._transform._rotation21*_,o=this._transform._rotation02*i+this._transform._rotation12*s+this._transform._rotation22*_,i=n,s=l,_=o;let r=new m.common.Vec3;return r.x=i,r.y=s,r.z=_,r}getLocalVectorTo(t,i){let s,_,n;s=t.x,_=t.y,n=t.z;let l,o,r;l=this._transform._rotation00*s+this._transform._rotation10*_+this._transform._rotation20*n,o=this._transform._rotation01*s+this._transform._rotation11*_+this._transform._rotation21*n,r=this._transform._rotation02*s+this._transform._rotation12*_+this._transform._rotation22*n,s=l,_=o,n=r,i.x=s,i.y=_,i.z=n}getWorldPoint(t){let i,s,_;i=t.x,s=t.y,_=t.z;let n,l,o;n=this._transform._rotation00*i+this._transform._rotation01*s+this._transform._rotation02*_,l=this._transform._rotation10*i+this._transform._rotation11*s+this._transform._rotation12*_,o=this._transform._rotation20*i+this._transform._rotation21*s+this._transform._rotation22*_,i=n,s=l,_=o,i+=this._transform._positionX,s+=this._transform._positionY,_+=this._transform._positionZ;let r=new m.common.Vec3;return r.x=i,r.y=s,r.z=_,r}getWorldPointTo(t,i){let s,_,n;s=t.x,_=t.y,n=t.z;let l,o,r;l=this._transform._rotation00*s+this._transform._rotation01*_+this._transform._rotation02*n,o=this._transform._rotation10*s+this._transform._rotation11*_+this._transform._rotation12*n,r=this._transform._rotation20*s+this._transform._rotation21*_+this._transform._rotation22*n,s=l,_=o,n=r,s+=this._transform._positionX,_+=this._transform._positionY,n+=this._transform._positionZ,i.x=s,i.y=_,i.z=n}getWorldVector(t){let i,s,_;i=t.x,s=t.y,_=t.z;let n,l,o;n=this._transform._rotation00*i+this._transform._rotation01*s+this._transform._rotation02*_,l=this._transform._rotation10*i+this._transform._rotation11*s+this._transform._rotation12*_,o=this._transform._rotation20*i+this._transform._rotation21*s+this._transform._rotation22*_,i=n,s=l,_=o;let r=new m.common.Vec3;return r.x=i,r.y=s,r.z=_,r}getWorldVectorTo(t,i){let s,_,n;s=t.x,_=t.y,n=t.z;let l,o,r;l=this._transform._rotation00*s+this._transform._rotation01*_+this._transform._rotation02*n,o=this._transform._rotation10*s+this._transform._rotation11*_+this._transform._rotation12*n,r=this._transform._rotation20*s+this._transform._rotation21*_+this._transform._rotation22*n,s=l,_=o,n=r,i.x=s,i.y=_,i.z=n}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContectLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(t){if(this._shapeList==null?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,this._world!=null){let s=this._world;t._proxy=s._broadPhase.createProxy(t,t._aabb),t._id=s._shapeIdCount++,s._numShapes++}this.updateMass();let i=this._shapeList;for(;i!=null;){let s=i._next,_=this._ptransform,n=this._transform,l=i._ptransform,o=i._localTransform,r,e,a,h,b,X,c,u,p;r=_._rotation00*o._rotation00+_._rotation01*o._rotation10+_._rotation02*o._rotation20,e=_._rotation00*o._rotation01+_._rotation01*o._rotation11+_._rotation02*o._rotation21,a=_._rotation00*o._rotation02+_._rotation01*o._rotation12+_._rotation02*o._rotation22,h=_._rotation10*o._rotation00+_._rotation11*o._rotation10+_._rotation12*o._rotation20,b=_._rotation10*o._rotation01+_._rotation11*o._rotation11+_._rotation12*o._rotation21,X=_._rotation10*o._rotation02+_._rotation11*o._rotation12+_._rotation12*o._rotation22,c=_._rotation20*o._rotation00+_._rotation21*o._rotation10+_._rotation22*o._rotation20,u=_._rotation20*o._rotation01+_._rotation21*o._rotation11+_._rotation22*o._rotation21,p=_._rotation20*o._rotation02+_._rotation21*o._rotation12+_._rotation22*o._rotation22,l._rotation00=r,l._rotation01=e,l._rotation02=a,l._rotation10=h,l._rotation11=b,l._rotation12=X,l._rotation20=c,l._rotation21=u,l._rotation22=p;let x,v,f;x=_._rotation00*o._positionX+_._rotation01*o._positionY+_._rotation02*o._positionZ,v=_._rotation10*o._positionX+_._rotation11*o._positionY+_._rotation12*o._positionZ,f=_._rotation20*o._positionX+_._rotation21*o._positionY+_._rotation22*o._positionZ,l._positionX=x,l._positionY=v,l._positionZ=f,l._positionX+=_._positionX,l._positionY+=_._positionY,l._positionZ+=_._positionZ;let g=i._transform,V=i._localTransform,Z,I,M,y,d,B,R,k,A;Z=n._rotation00*V._rotation00+n._rotation01*V._rotation10+n._rotation02*V._rotation20,I=n._rotation00*V._rotation01+n._rotation01*V._rotation11+n._rotation02*V._rotation21,M=n._rotation00*V._rotation02+n._rotation01*V._rotation12+n._rotation02*V._rotation22,y=n._rotation10*V._rotation00+n._rotation11*V._rotation10+n._rotation12*V._rotation20,d=n._rotation10*V._rotation01+n._rotation11*V._rotation11+n._rotation12*V._rotation21,B=n._rotation10*V._rotation02+n._rotation11*V._rotation12+n._rotation12*V._rotation22,R=n._rotation20*V._rotation00+n._rotation21*V._rotation10+n._rotation22*V._rotation20,k=n._rotation20*V._rotation01+n._rotation21*V._rotation11+n._rotation22*V._rotation21,A=n._rotation20*V._rotation02+n._rotation21*V._rotation12+n._rotation22*V._rotation22,g._rotation00=Z,g._rotation01=I,g._rotation02=M,g._rotation10=y,g._rotation11=d,g._rotation12=B,g._rotation20=R,g._rotation21=k,g._rotation22=A;let z,w,S;z=n._rotation00*V._positionX+n._rotation01*V._positionY+n._rotation02*V._positionZ,w=n._rotation10*V._positionX+n._rotation11*V._positionY+n._rotation12*V._positionZ,S=n._rotation20*V._positionX+n._rotation21*V._positionY+n._rotation22*V._positionZ,g._positionX=z,g._positionY=w,g._positionZ=S,g._positionX+=n._positionX,g._positionY+=n._positionY,g._positionZ+=n._positionZ;let P,T,C,L,q,U;if(i._geom._computeAabb(i._aabb,i._ptransform),P=i._aabb._minX,T=i._aabb._minY,C=i._aabb._minZ,L=i._aabb._maxX,q=i._aabb._maxY,U=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=P<i._aabb._minX?P:i._aabb._minX,i._aabb._minY=T<i._aabb._minY?T:i._aabb._minY,i._aabb._minZ=C<i._aabb._minZ?C:i._aabb._minZ,i._aabb._maxX=L>i._aabb._maxX?L:i._aabb._maxX,i._aabb._maxY=q>i._aabb._maxY?q:i._aabb._maxY,i._aabb._maxZ=U>i._aabb._maxZ?U:i._aabb._maxZ,i._proxy!=null){let Y,E,D;Y=i._transform._positionX-i._ptransform._positionX,E=i._transform._positionY-i._ptransform._positionY,D=i._transform._positionZ-i._ptransform._positionZ;let Q=i.displacement;Q.x=Y,Q.y=E,Q.z=D,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=s}}removeShape(t){let i=t._prev,s=t._next;if(i!=null&&(i._next=s),s!=null&&(s._prev=i),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,this._world!=null){let n=this._world;n._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;let l=t._rigidBody._contactLinkList;for(;l!=null;){let o=l._next,r=l._contact;if(r._s1==t||r._s2==t){let e=l._other;e._sleeping=!1,e._sleepTime=0;let a=n._contactManager,h=r._prev,b=r._next;if(h!=null&&(h._next=b),b!=null&&(b._prev=h),r==a._contactList&&(a._contactList=a._contactList._next),r==a._contactListLast&&(a._contactListLast=a._contactListLast._prev),r._next=null,r._prev=null,r._touching){let v=r._s1._contactCallback,f=r._s2._contactCallback;v==f&&(f=null),v?.endContact(r),f?.endContact(r)}let X=r._link1._prev,c=r._link1._next;X!=null&&(X._next=c),c!=null&&(c._prev=X),r._link1==r._b1._contactLinkList&&(r._b1._contactLinkList=r._b1._contactLinkList._next),r._link1==r._b1._contactLinkListLast&&(r._b1._contactLinkListLast=r._b1._contactLinkListLast._prev),r._link1._next=null,r._link1._prev=null;let u=r._link2._prev,p=r._link2._next;u!=null&&(u._next=p),p!=null&&(p._prev=u),r._link2==r._b2._contactLinkList&&(r._b2._contactLinkList=r._b2._contactLinkList._next),r._link2==r._b2._contactLinkListLast&&(r._b2._contactLinkListLast=r._b2._contactLinkListLast._prev),r._link2._next=null,r._link2._prev=null,r._b1._numContactLinks--,r._b2._numContactLinks--,r._link1._other=null,r._link2._other=null,r._link1._contact=null,r._link2._contact=null,r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._touching=!1,r._cachedDetectorData._clear(),r._manifold._clear(),r._detector=null;let x=r._contactConstraint;x._s1=null,x._s2=null,x._b1=null,x._b2=null,x._tf1=null,x._tf2=null,r._next=a._contactPool,a._contactPool=r,a._numContacts--}l=o}n._numShapes--}this.updateMass();let _=this._shapeList;for(;_!=null;){let n=_._next,l=this._ptransform,o=this._transform,r=_._ptransform,e=_._localTransform,a,h,b,X,c,u,p,x,v;a=l._rotation00*e._rotation00+l._rotation01*e._rotation10+l._rotation02*e._rotation20,h=l._rotation00*e._rotation01+l._rotation01*e._rotation11+l._rotation02*e._rotation21,b=l._rotation00*e._rotation02+l._rotation01*e._rotation12+l._rotation02*e._rotation22,X=l._rotation10*e._rotation00+l._rotation11*e._rotation10+l._rotation12*e._rotation20,c=l._rotation10*e._rotation01+l._rotation11*e._rotation11+l._rotation12*e._rotation21,u=l._rotation10*e._rotation02+l._rotation11*e._rotation12+l._rotation12*e._rotation22,p=l._rotation20*e._rotation00+l._rotation21*e._rotation10+l._rotation22*e._rotation20,x=l._rotation20*e._rotation01+l._rotation21*e._rotation11+l._rotation22*e._rotation21,v=l._rotation20*e._rotation02+l._rotation21*e._rotation12+l._rotation22*e._rotation22,r._rotation00=a,r._rotation01=h,r._rotation02=b,r._rotation10=X,r._rotation11=c,r._rotation12=u,r._rotation20=p,r._rotation21=x,r._rotation22=v;let f,g,V;f=l._rotation00*e._positionX+l._rotation01*e._positionY+l._rotation02*e._positionZ,g=l._rotation10*e._positionX+l._rotation11*e._positionY+l._rotation12*e._positionZ,V=l._rotation20*e._positionX+l._rotation21*e._positionY+l._rotation22*e._positionZ,r._positionX=f,r._positionY=g,r._positionZ=V,r._positionX+=l._positionX,r._positionY+=l._positionY,r._positionZ+=l._positionZ;let Z=_._transform,I=_._localTransform,M,y,d,B,R,k,A,z,w;M=o._rotation00*I._rotation00+o._rotation01*I._rotation10+o._rotation02*I._rotation20,y=o._rotation00*I._rotation01+o._rotation01*I._rotation11+o._rotation02*I._rotation21,d=o._rotation00*I._rotation02+o._rotation01*I._rotation12+o._rotation02*I._rotation22,B=o._rotation10*I._rotation00+o._rotation11*I._rotation10+o._rotation12*I._rotation20,R=o._rotation10*I._rotation01+o._rotation11*I._rotation11+o._rotation12*I._rotation21,k=o._rotation10*I._rotation02+o._rotation11*I._rotation12+o._rotation12*I._rotation22,A=o._rotation20*I._rotation00+o._rotation21*I._rotation10+o._rotation22*I._rotation20,z=o._rotation20*I._rotation01+o._rotation21*I._rotation11+o._rotation22*I._rotation21,w=o._rotation20*I._rotation02+o._rotation21*I._rotation12+o._rotation22*I._rotation22,Z._rotation00=M,Z._rotation01=y,Z._rotation02=d,Z._rotation10=B,Z._rotation11=R,Z._rotation12=k,Z._rotation20=A,Z._rotation21=z,Z._rotation22=w;let S,P,T;S=o._rotation00*I._positionX+o._rotation01*I._positionY+o._rotation02*I._positionZ,P=o._rotation10*I._positionX+o._rotation11*I._positionY+o._rotation12*I._positionZ,T=o._rotation20*I._positionX+o._rotation21*I._positionY+o._rotation22*I._positionZ,Z._positionX=S,Z._positionY=P,Z._positionZ=T,Z._positionX+=o._positionX,Z._positionY+=o._positionY,Z._positionZ+=o._positionZ;let C,L,q,U,Y,E;if(_._geom._computeAabb(_._aabb,_._ptransform),C=_._aabb._minX,L=_._aabb._minY,q=_._aabb._minZ,U=_._aabb._maxX,Y=_._aabb._maxY,E=_._aabb._maxZ,_._geom._computeAabb(_._aabb,_._transform),_._aabb._minX=C<_._aabb._minX?C:_._aabb._minX,_._aabb._minY=L<_._aabb._minY?L:_._aabb._minY,_._aabb._minZ=q<_._aabb._minZ?q:_._aabb._minZ,_._aabb._maxX=U>_._aabb._maxX?U:_._aabb._maxX,_._aabb._maxY=Y>_._aabb._maxY?Y:_._aabb._maxY,_._aabb._maxZ=E>_._aabb._maxZ?E:_._aabb._maxZ,_._proxy!=null){let D,Q,W;D=_._transform._positionX-_._ptransform._positionX,Q=_._transform._positionY-_._ptransform._positionY,W=_._transform._positionZ-_._ptransform._positionZ;let F=_.displacement;F.x=D,F.y=Q,F.z=W,_._rigidBody._world._broadPhase.moveProxy(_._proxy,_._aabb,_.displacement)}_=n}}getType(){return this._type}setType(t){this._type=t,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(t){this._linearDamping=t}getAngularDamping(){return this._angularDamping}setAngularDamping(t){this._angularDamping=t}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new m.common.Vec3,this.rotation=new m.common.Mat3,this.linearVelocity=new m.common.Vec3,this.angularVelocity=new m.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}};m.dynamics.rigidbody.RigidBodyType=class{};m.dynamics.rigidbody.Shape=class{constructor(t){this._id=-1,this._localTransform=new m.common.Transform,this._ptransform=new m.common.Transform,this._transform=new m.common.Transform;let i=t.position;this._localTransform._positionX=i.x,this._localTransform._positionY=i.y,this._localTransform._positionZ=i.z;let s=t.rotation;this._localTransform._rotation00=s.e00,this._localTransform._rotation01=s.e01,this._localTransform._rotation02=s.e02,this._localTransform._rotation10=s.e10,this._localTransform._rotation11=s.e11,this._localTransform._rotation12=s.e12,this._localTransform._rotation20=s.e20,this._localTransform._rotation21=s.e21,this._localTransform._rotation22=s.e22;let _=this._ptransform,n=this._localTransform;_._positionX=n._positionX,_._positionY=n._positionY,_._positionZ=n._positionZ,_._rotation00=n._rotation00,_._rotation01=n._rotation01,_._rotation02=n._rotation02,_._rotation10=n._rotation10,_._rotation11=n._rotation11,_._rotation12=n._rotation12,_._rotation20=n._rotation20,_._rotation21=n._rotation21,_._rotation22=n._rotation22;let l=this._transform,o=this._localTransform;l._positionX=o._positionX,l._positionY=o._positionY,l._positionZ=o._positionZ,l._rotation00=o._rotation00,l._rotation01=o._rotation01,l._rotation02=o._rotation02,l._rotation10=o._rotation10,l._rotation11=o._rotation11,l._rotation12=o._rotation12,l._rotation20=o._rotation20,l._rotation21=o._rotation21,l._rotation22=o._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new m.collision.geometry.Aabb,this._proxy=null,this.displacement=new m.common.Vec3}getFriction(){return this._friction}setFriction(t){this._friction=t}getRestitution(){return this._restitution}setRestitution(t){this._restitution=t}getLocalTransform(){let t=this._localTransform,i=new m.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getLocalTransformTo(t){let i=this._localTransform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}getTransform(){let t=this._transform,i=new m.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setLocalTransform(t){let i=this._localTransform;if(i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,this._rigidBody!=null){let s=this._rigidBody;s.updateMass();let _=s._shapeList;for(;_!=null;){let n=_._next,l=s._ptransform,o=s._transform,r=_._ptransform,e=_._localTransform,a,h,b,X,c,u,p,x,v;a=l._rotation00*e._rotation00+l._rotation01*e._rotation10+l._rotation02*e._rotation20,h=l._rotation00*e._rotation01+l._rotation01*e._rotation11+l._rotation02*e._rotation21,b=l._rotation00*e._rotation02+l._rotation01*e._rotation12+l._rotation02*e._rotation22,X=l._rotation10*e._rotation00+l._rotation11*e._rotation10+l._rotation12*e._rotation20,c=l._rotation10*e._rotation01+l._rotation11*e._rotation11+l._rotation12*e._rotation21,u=l._rotation10*e._rotation02+l._rotation11*e._rotation12+l._rotation12*e._rotation22,p=l._rotation20*e._rotation00+l._rotation21*e._rotation10+l._rotation22*e._rotation20,x=l._rotation20*e._rotation01+l._rotation21*e._rotation11+l._rotation22*e._rotation21,v=l._rotation20*e._rotation02+l._rotation21*e._rotation12+l._rotation22*e._rotation22,r._rotation00=a,r._rotation01=h,r._rotation02=b,r._rotation10=X,r._rotation11=c,r._rotation12=u,r._rotation20=p,r._rotation21=x,r._rotation22=v;let f,g,V;f=l._rotation00*e._positionX+l._rotation01*e._positionY+l._rotation02*e._positionZ,g=l._rotation10*e._positionX+l._rotation11*e._positionY+l._rotation12*e._positionZ,V=l._rotation20*e._positionX+l._rotation21*e._positionY+l._rotation22*e._positionZ,r._positionX=f,r._positionY=g,r._positionZ=V,r._positionX+=l._positionX,r._positionY+=l._positionY,r._positionZ+=l._positionZ;let Z=_._transform,I=_._localTransform,M,y,d,B,R,k,A,z,w;M=o._rotation00*I._rotation00+o._rotation01*I._rotation10+o._rotation02*I._rotation20,y=o._rotation00*I._rotation01+o._rotation01*I._rotation11+o._rotation02*I._rotation21,d=o._rotation00*I._rotation02+o._rotation01*I._rotation12+o._rotation02*I._rotation22,B=o._rotation10*I._rotation00+o._rotation11*I._rotation10+o._rotation12*I._rotation20,R=o._rotation10*I._rotation01+o._rotation11*I._rotation11+o._rotation12*I._rotation21,k=o._rotation10*I._rotation02+o._rotation11*I._rotation12+o._rotation12*I._rotation22,A=o._rotation20*I._rotation00+o._rotation21*I._rotation10+o._rotation22*I._rotation20,z=o._rotation20*I._rotation01+o._rotation21*I._rotation11+o._rotation22*I._rotation21,w=o._rotation20*I._rotation02+o._rotation21*I._rotation12+o._rotation22*I._rotation22,Z._rotation00=M,Z._rotation01=y,Z._rotation02=d,Z._rotation10=B,Z._rotation11=R,Z._rotation12=k,Z._rotation20=A,Z._rotation21=z,Z._rotation22=w;let S,P,T;S=o._rotation00*I._positionX+o._rotation01*I._positionY+o._rotation02*I._positionZ,P=o._rotation10*I._positionX+o._rotation11*I._positionY+o._rotation12*I._positionZ,T=o._rotation20*I._positionX+o._rotation21*I._positionY+o._rotation22*I._positionZ,Z._positionX=S,Z._positionY=P,Z._positionZ=T,Z._positionX+=o._positionX,Z._positionY+=o._positionY,Z._positionZ+=o._positionZ;let C,L,q,U,Y,E;if(_._geom._computeAabb(_._aabb,_._ptransform),C=_._aabb._minX,L=_._aabb._minY,q=_._aabb._minZ,U=_._aabb._maxX,Y=_._aabb._maxY,E=_._aabb._maxZ,_._geom._computeAabb(_._aabb,_._transform),_._aabb._minX=C<_._aabb._minX?C:_._aabb._minX,_._aabb._minY=L<_._aabb._minY?L:_._aabb._minY,_._aabb._minZ=q<_._aabb._minZ?q:_._aabb._minZ,_._aabb._maxX=U>_._aabb._maxX?U:_._aabb._maxX,_._aabb._maxY=Y>_._aabb._maxY?Y:_._aabb._maxY,_._aabb._maxZ=E>_._aabb._maxZ?E:_._aabb._maxZ,_._proxy!=null){let D,Q,W;D=_._transform._positionX-_._ptransform._positionX,Q=_._transform._positionY-_._ptransform._positionY,W=_._transform._positionZ-_._ptransform._positionZ;let F=_.displacement;F.x=D,F.y=Q,F.z=W,_._rigidBody._world._broadPhase.moveProxy(_._proxy,_._aabb,_.displacement)}_=n}}}getDensity(){return this._density}setDensity(t){if(this._density=t,this._rigidBody!=null){let i=this._rigidBody;i.updateMass();let s=i._shapeList;for(;s!=null;){let _=s._next,n=i._ptransform,l=i._transform,o=s._ptransform,r=s._localTransform,e,a,h,b,X,c,u,p,x;e=n._rotation00*r._rotation00+n._rotation01*r._rotation10+n._rotation02*r._rotation20,a=n._rotation00*r._rotation01+n._rotation01*r._rotation11+n._rotation02*r._rotation21,h=n._rotation00*r._rotation02+n._rotation01*r._rotation12+n._rotation02*r._rotation22,b=n._rotation10*r._rotation00+n._rotation11*r._rotation10+n._rotation12*r._rotation20,X=n._rotation10*r._rotation01+n._rotation11*r._rotation11+n._rotation12*r._rotation21,c=n._rotation10*r._rotation02+n._rotation11*r._rotation12+n._rotation12*r._rotation22,u=n._rotation20*r._rotation00+n._rotation21*r._rotation10+n._rotation22*r._rotation20,p=n._rotation20*r._rotation01+n._rotation21*r._rotation11+n._rotation22*r._rotation21,x=n._rotation20*r._rotation02+n._rotation21*r._rotation12+n._rotation22*r._rotation22,o._rotation00=e,o._rotation01=a,o._rotation02=h,o._rotation10=b,o._rotation11=X,o._rotation12=c,o._rotation20=u,o._rotation21=p,o._rotation22=x;let v,f,g;v=n._rotation00*r._positionX+n._rotation01*r._positionY+n._rotation02*r._positionZ,f=n._rotation10*r._positionX+n._rotation11*r._positionY+n._rotation12*r._positionZ,g=n._rotation20*r._positionX+n._rotation21*r._positionY+n._rotation22*r._positionZ,o._positionX=v,o._positionY=f,o._positionZ=g,o._positionX+=n._positionX,o._positionY+=n._positionY,o._positionZ+=n._positionZ;let V=s._transform,Z=s._localTransform,I,M,y,d,B,R,k,A,z;I=l._rotation00*Z._rotation00+l._rotation01*Z._rotation10+l._rotation02*Z._rotation20,M=l._rotation00*Z._rotation01+l._rotation01*Z._rotation11+l._rotation02*Z._rotation21,y=l._rotation00*Z._rotation02+l._rotation01*Z._rotation12+l._rotation02*Z._rotation22,d=l._rotation10*Z._rotation00+l._rotation11*Z._rotation10+l._rotation12*Z._rotation20,B=l._rotation10*Z._rotation01+l._rotation11*Z._rotation11+l._rotation12*Z._rotation21,R=l._rotation10*Z._rotation02+l._rotation11*Z._rotation12+l._rotation12*Z._rotation22,k=l._rotation20*Z._rotation00+l._rotation21*Z._rotation10+l._rotation22*Z._rotation20,A=l._rotation20*Z._rotation01+l._rotation21*Z._rotation11+l._rotation22*Z._rotation21,z=l._rotation20*Z._rotation02+l._rotation21*Z._rotation12+l._rotation22*Z._rotation22,V._rotation00=I,V._rotation01=M,V._rotation02=y,V._rotation10=d,V._rotation11=B,V._rotation12=R,V._rotation20=k,V._rotation21=A,V._rotation22=z;let w,S,P;w=l._rotation00*Z._positionX+l._rotation01*Z._positionY+l._rotation02*Z._positionZ,S=l._rotation10*Z._positionX+l._rotation11*Z._positionY+l._rotation12*Z._positionZ,P=l._rotation20*Z._positionX+l._rotation21*Z._positionY+l._rotation22*Z._positionZ,V._positionX=w,V._positionY=S,V._positionZ=P,V._positionX+=l._positionX,V._positionY+=l._positionY,V._positionZ+=l._positionZ;let T,C,L,q,U,Y;if(s._geom._computeAabb(s._aabb,s._ptransform),T=s._aabb._minX,C=s._aabb._minY,L=s._aabb._minZ,q=s._aabb._maxX,U=s._aabb._maxY,Y=s._aabb._maxZ,s._geom._computeAabb(s._aabb,s._transform),s._aabb._minX=T<s._aabb._minX?T:s._aabb._minX,s._aabb._minY=C<s._aabb._minY?C:s._aabb._minY,s._aabb._minZ=L<s._aabb._minZ?L:s._aabb._minZ,s._aabb._maxX=q>s._aabb._maxX?q:s._aabb._maxX,s._aabb._maxY=U>s._aabb._maxY?U:s._aabb._maxY,s._aabb._maxZ=Y>s._aabb._maxZ?Y:s._aabb._maxZ,s._proxy!=null){let E,D,Q;E=s._transform._positionX-s._ptransform._positionX,D=s._transform._positionY-s._ptransform._positionY,Q=s._transform._positionZ-s._ptransform._positionZ;let W=s.displacement;W.x=E,W.y=D,W.z=Q,s._rigidBody._world._broadPhase.moveProxy(s._proxy,s._aabb,s.displacement)}s=_}}}getAabb(){return this._aabb.clone()}getAabbTo(t){t.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(t){this._collisionGroup=t}getCollisionMask(){return this._collisionMask}setCollisionMask(t){this._collisionMask=t}getContactCallback(){return this._contactCallback}setContactCallback(t){this._contactCallback=t}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new m.common.Vec3,this.rotation=new m.common.Mat3,this.friction=m.common.Setting.defaultFriction,this.restitution=m.common.Setting.defaultRestitution,this.density=m.common.Setting.defaultDensity,this.collisionGroup=m.common.Setting.defaultCollisionGroup,this.collisionMask=m.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}};m.m||(m.m={});m.m.M=class{};m.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1;m.collision.broadphase.BroadPhaseType._BVH=2;m.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1;m.collision.broadphase.BroadPhaseType.BVH=2;m.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0;m.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1;m.collision.geometry.GeometryType._SPHERE=0;m.collision.geometry.GeometryType._BOX=1;m.collision.geometry.GeometryType._CYLINDER=2;m.collision.geometry.GeometryType._CONE=3;m.collision.geometry.GeometryType._CAPSULE=4;m.collision.geometry.GeometryType._CONVEX_HULL=5;m.collision.geometry.GeometryType._CONVEX_MIN=0;m.collision.geometry.GeometryType._CONVEX_MAX=5;m.collision.geometry.GeometryType.SPHERE=0;m.collision.geometry.GeometryType.BOX=1;m.collision.geometry.GeometryType.CYLINDER=2;m.collision.geometry.GeometryType.CONE=3;m.collision.geometry.GeometryType.CAPSULE=4;m.collision.geometry.GeometryType.CONVEX_HULL=5;m.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6;m.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0;m.common.Vec3.numCreations=0;m.common.Setting.defaultFriction=.2;m.common.Setting.defaultRestitution=.2;m.common.Setting.defaultDensity=1;m.common.Setting.defaultCollisionGroup=1;m.common.Setting.defaultCollisionMask=1;m.common.Setting.maxTranslationPerStep=20;m.common.Setting.maxRotationPerStep=3.14159265358979;m.common.Setting.bvhProxyPadding=.1;m.common.Setting.bvhIncrementalCollisionThreshold=.45;m.common.Setting.defaultGJKMargin=.05;m.common.Setting.enableGJKCaching=!0;m.common.Setting.maxEPAVertices=128;m.common.Setting.maxEPAPolyhedronFaces=128;m.common.Setting.contactEnableBounceThreshold=.5;m.common.Setting.velocityBaumgarte=.2;m.common.Setting.positionSplitImpulseBaumgarte=.4;m.common.Setting.positionNgsBaumgarte=1;m.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05;m.common.Setting.defaultContactPositionCorrectionAlgorithm=0;m.common.Setting.alternativeContactPositionCorrectionAlgorithm=1;m.common.Setting.contactPersistenceThreshold=.05;m.common.Setting.maxManifoldPoints=4;m.common.Setting.defaultJointConstraintSolverType=0;m.common.Setting.defaultJointPositionCorrectionAlgorithm=0;m.common.Setting.jointWarmStartingFactorForBaungarte=.8;m.common.Setting.jointWarmStartingFactor=.95;m.common.Setting.minSpringDamperDampingRatio=1e-6;m.common.Setting.minRagdollMaxSwingAngle=1e-6;m.common.Setting.maxJacobianRows=6;m.common.Setting.directMlcpSolverEps=1e-9;m.common.Setting.islandInitialRigidBodyArraySize=128;m.common.Setting.islandInitialConstraintArraySize=128;m.common.Setting.sleepingVelocityThreshold=.2;m.common.Setting.sleepingAngularVelocityThreshold=.5;m.common.Setting.sleepingTimeThreshold=1;m.common.Setting.disableSleeping=!1;m.common.Setting.linearSlop=.005;m.common.Setting.angularSlop=.017453292519943278;m.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new m.collision.narrowphase.detector.gjkepa.GjkEpa;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259;m.common.Mat3.numCreations=0;m.common.Mat4.numCreations=0;m.common.MathUtil.POSITIVE_INFINITY=1/0;m.common.MathUtil.NEGATIVE_INFINITY=-1/0;m.common.MathUtil.PI=3.14159265358979;m.common.MathUtil.TWO_PI=6.28318530717958;m.common.MathUtil.HALF_PI=1.570796326794895;m.common.MathUtil.TO_RADIANS=.017453292519943278;m.common.MathUtil.TO_DEGREES=57.29577951308238;m.common.Quat.numCreations=0;m.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8;m.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4;m.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8;m.dynamics.common.Performance.broadPhaseCollisionTime=0;m.dynamics.common.Performance.narrowPhaseCollisionTime=0;m.dynamics.common.Performance.dynamicsTime=0;m.dynamics.common.Performance.totalTime=0;m.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0;m.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1;m.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2;m.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0;m.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1;m.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2;m.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1;m.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2;m.dynamics.constraint.joint.JointType._SPHERICAL=0;m.dynamics.constraint.joint.JointType._REVOLUTE=1;m.dynamics.constraint.joint.JointType._CYLINDRICAL=2;m.dynamics.constraint.joint.JointType._PRISMATIC=3;m.dynamics.constraint.joint.JointType._UNIVERSAL=4;m.dynamics.constraint.joint.JointType._RAGDOLL=5;m.dynamics.constraint.joint.JointType._GENERIC=6;m.dynamics.constraint.joint.JointType.SPHERICAL=0;m.dynamics.constraint.joint.JointType.REVOLUTE=1;m.dynamics.constraint.joint.JointType.CYLINDRICAL=2;m.dynamics.constraint.joint.JointType.PRISMATIC=3;m.dynamics.constraint.joint.JointType.UNIVERSAL=4;m.dynamics.constraint.joint.JointType.RAGDOLL=5;m.dynamics.constraint.joint.JointType.GENERIC=6;m.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0;m.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1;m.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0;m.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1;m.dynamics.rigidbody.RigidBodyType._DYNAMIC=0;m.dynamics.rigidbody.RigidBodyType._STATIC=1;m.dynamics.rigidbody.RigidBodyType._KINEMATIC=2;m.dynamics.rigidbody.RigidBodyType.DYNAMIC=0;m.dynamics.rigidbody.RigidBodyType.STATIC=1;m.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;const hs=m.dynamics.World,Be=m.dynamics.rigidbody.RigidBodyType,Fe=m.dynamics.rigidbody.RigidBodyConfig,Ne=m.dynamics.rigidbody.ShapeConfig,We=m.dynamics.rigidbody.RigidBody,Ge=m.dynamics.rigidbody.Shape;m.dynamics.constraint.joint.SphericalJoint;m.dynamics.constraint.joint.RevoluteJointConfig;m.dynamics.constraint.joint.UniversalJointConfig;m.dynamics.constraint.joint.CylindricalJoint;m.dynamics.constraint.joint.PrismaticJoint;m.dynamics.constraint.joint.PrismaticJointConfig;m.dynamics.constraint.joint.RevoluteJoint;m.dynamics.constraint.joint.RagdollJoint;m.dynamics.constraint.joint.CylindricalJointConfig;m.dynamics.constraint.joint.SphericalJointConfig;m.dynamics.constraint.joint.RagdollJointConfig;m.dynamics.constraint.joint.SpringDamper;m.dynamics.constraint.joint.TranslationalLimitMotor;m.dynamics.constraint.joint.RotationalLimitMotor;m.dynamics.constraint.joint.UniversalJoint;const Me=m.common.Vec3;m.common.Quat;m.common.Mat3;m.common.MathUtil;m.common.Transform;m.collision.geometry.CapsuleGeometry;m.collision.geometry.ConvexHullGeometry;const cs=m.collision.geometry.BoxGeometry,ms=m.collision.geometry.SphereGeometry;m.collision.geometry.CylinderGeometry;m.collision.geometry.ConeGeometry;m.collision.geometry.Geometry;m.dynamics.callback.RayCastClosest;async function ps(){const t=new hs(2,new Me(0,-9.8,0));function i(h){const b=h.parameters;if(h.type==="BoxGeometry"){const X=b.width!==void 0?b.width/2:.5,c=b.height!==void 0?b.height/2:.5,u=b.depth!==void 0?b.depth/2:.5;return new cs(new Me(X,c,u))}else if(h.type==="SphereGeometry"||h.type==="IcosahedronGeometry"){const X=b.radius!==void 0?b.radius:1;return new ms(X)}return null}const s=[],_=new WeakMap;function n(h,b=0){const X=i(h.geometry);X!==null&&(h.isInstancedMesh?o(h,b,X):h.isMesh&&l(h,b,X))}function l(h,b,X){const c=new Ne;c.geometry=X;const u=new Fe;u.type=b===0?Be.STATIC:Be.DYNAMIC,u.position=new Me(h.position.x,h.position.y,h.position.z);const p=new We(u);p.addShape(new Ge(c)),t.addRigidBody(p),b>0&&(s.push(h),_.set(h,p))}function o(h,b,X){const c=h.instanceMatrix.array,u=[];for(let p=0;p<h.count;p++){const x=p*16,v=new Ne;v.geometry=X;const f=new Fe;f.type=b===0?Be.STATIC:Be.DYNAMIC,f.position=new Me(c[x+12],c[x+13],c[x+14]);const g=new We(f);g.addShape(new Ge(v)),t.addRigidBody(g),u.push(g)}b>0&&(s.push(h),_.set(h,u))}function r(h,b,X=0){h.isInstancedMesh?_.get(h)[X].setPosition(new Me(b.x,b.y,b.z)):h.isMesh&&_.get(h).setPosition(new Me(b.x,b.y,b.z))}let e=0;function a(){const h=performance.now();e>0&&t.step(1/60),e=h;for(let b=0,X=s.length;b<X;b++){const c=s[b];if(c.isInstancedMesh){const u=c.instanceMatrix.array,p=_.get(c);for(let x=0;x<p.length;x++){const v=p[x];bs(v.getPosition(),v.getOrientation(),u,x*16)}c.instanceMatrix.needsUpdate=!0}else if(c.isMesh){const u=_.get(c);c.position.copy(u.getPosition()),c.quaternion.copy(u.getOrientation())}}}return setInterval(a,1e3/60),{addMesh:n,setMeshPosition:r}}function bs(Dt,t,i,s){const _=t.x,n=t.y,l=t.z,o=t.w,r=_+_,e=n+n,a=l+l,h=_*r,b=_*e,X=_*a,c=n*e,u=n*a,p=l*a,x=o*r,v=o*e,f=o*a;i[s+0]=1-(c+p),i[s+1]=b+f,i[s+2]=X-v,i[s+3]=0,i[s+4]=b-f,i[s+5]=1-(h+p),i[s+6]=u+x,i[s+7]=0,i[s+8]=X+v,i[s+9]=u-x,i[s+10]=1-(h+c),i[s+11]=0,i[s+12]=Dt.x,i[s+13]=Dt.y,i[s+14]=Dt.z,i[s+15]=1}const Pe=ls.getInstance();let ze,ke,Qe,de,ge,ue,Te,Ae,Ie;const Se=new Ue;vs();xs();fs();Xs();await Ys();Oe();function vs(){ze=new He,ze.background=new Je(8947848),ke=new Ke(50,Pe.aspect,.1,100),ke.position.set(4,4,4),ze.add(ke),de=new $e,de.setSize(Pe.width,Pe.height),de.setPixelRatio(Pe.pixelRatio),de.outputEncoding=ts,document.body.appendChild(de.domElement),Qe=new rs(ke,de.domElement)}function xs(){const Dt=new is;ge=new De(new Ee(.1,.1,.1),Dt,100),ue=new De(new es(.075),Dt,100);const t=new ss,i=new Je;for(let s=0;s<ge.count;s++)t.setPosition(Math.random()-.5,Math.random()*2,Math.random()-.5),ge.setMatrixAt(s,t),ge.setColorAt(s,i.setHex(Math.random()*16777215));for(let s=0;s<ue.count;s++)t.setPosition(Math.random()-.5,Math.random()*2,Math.random()-.5),ue.setMatrixAt(s,t),ue.setColorAt(s,i.setHex(Math.random()*16777215));ze.add(ge,ue),Ae=new as(new Ee(10,1,10),new ns({color:1118481})),Ae.position.set(0,-1,0),ze.add(Ae)}function fs(){const Dt=new _s;Dt.intensity=.3,ze.add(Dt),Te=new os(16777215,1),Te.position.set(5,5,-5),ze.add(Te)}function Xs(){de.shadowMap.enabled=!0,Te.castShadow=!0,ge.castShadow=!0,ue.castShadow=!0,Ae.receiveShadow=!0}async function Ys(){Ie=await ps(),Ie.addMesh(Ae,0),Ie.addMesh(ge,1),Ie.addMesh(ue,1)}function Oe(){de.render(ze,ke),Qe.update();let Dt=Math.floor(Math.random()*ge.count);Se.set(0,Math.random()+1,0),Ie.setMeshPosition(ge,Se,Dt),Dt=Math.floor(Math.random()*ue.count),Se.set(0,Math.random()+1,0),Ie.setMeshPosition(ue,Se,Dt),requestAnimationFrame(Oe)}
