import{J as D,X as T,a9 as C,a1 as L,S as I,B as x,u as P,az as R,Y as M,a as m,M as E}from"./three.module-67558082.js";const A=new WeakMap;class O extends D{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,s,r,o){const i=new T(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,t=>{this.decodeDracoFile(t,s).catch(o)},r,o)}decodeDracoFile(e,s,r,o){const i={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!r};return this.decodeGeometry(e,i).then(s)}decodeGeometry(e,s){const r=JSON.stringify(s);if(A.has(e)){const c=A.get(e);if(c.key===r)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let o;const i=this.workerNextTaskID++,t=e.byteLength,n=this._getWorker(i,t).then(c=>(o=c,new Promise((u,d)=>{o._callbacks[i]={resolve:u,reject:d},o.postMessage({type:"decode",id:i,taskConfig:s,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return n.catch(()=>!0).then(()=>{o&&i&&this._releaseTask(o,i)}),A.set(e,{key:r,promise:n}),n}_createGeometry(e){const s=new C;e.index&&s.setIndex(new L(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const o=e.attributes[r],i=o.name,t=o.array,n=o.itemSize;s.setAttribute(i,new L(t,n))}return s}_loadLibrary(e,s){const r=new T(this.manager);return r.setPath(this.decoderPath),r.setResponseType(s),r.setWithCredentials(this.withCredentials),new Promise((o,i)=>{r.load(e,o,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",s=[];return e?s.push(this._loadLibrary("draco_decoder.js","text")):(s.push(this._loadLibrary("draco_wasm_wrapper.js","text")),s.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(s).then(r=>{const o=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const i=U.toString(),t=["/* draco decoder */",o,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([t]))}),this.decoderPending}_getWorker(e,s){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const o=new Worker(this.workerSourceURL);o._callbacks={},o._taskCosts={},o._taskLoad=0,o.postMessage({type:"init",decoderConfig:this.decoderConfig}),o.onmessage=function(i){const t=i.data;switch(t.type){case"decode":o._callbacks[t.id].resolve(t);break;case"error":o._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(o)}else this.workerPool.sort(function(o,i){return o._taskLoad>i._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=s,r._taskLoad+=s,r})}_releaseTask(e,s){e._taskLoad-=e._taskCosts[s],delete e._callbacks[s],delete e._taskCosts[s]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function U(){let g,e;onmessage=function(t){const n=t.data;switch(n.type){case"init":g=n.decoderConfig,e=new Promise(function(d){g.onModuleLoaded=function(l){d({draco:l})},DracoDecoderModule(g)});break;case"decode":const c=n.buffer,u=n.taskConfig;e.then(d=>{const l=d.draco,a=new l.Decoder,f=new l.DecoderBuffer;f.Init(new Int8Array(c),c.byteLength);try{const h=s(l,a,f,u),y=h.attributes.map(p=>p.array.buffer);h.index&&y.push(h.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:h},y)}catch(h){console.error(h),self.postMessage({type:"error",id:n.id,error:h.message})}finally{l.destroy(f),l.destroy(a)}});break}};function s(t,n,c,u){const d=u.attributeIDs,l=u.attributeTypes;let a,f;const h=n.GetEncodedGeometryType(c);if(h===t.TRIANGULAR_MESH)a=new t.Mesh,f=n.DecodeBufferToMesh(c,a);else if(h===t.POINT_CLOUD)a=new t.PointCloud,f=n.DecodeBufferToPointCloud(c,a);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||a.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const y={index:null,attributes:[]};for(const p in d){const w=self[l[p]];let k,_;if(u.useUniqueIDs)_=d[p],k=n.GetAttributeByUniqueId(a,_);else{if(_=n.GetAttributeId(a,t[d[p]]),_===-1)continue;k=n.GetAttribute(a,_)}y.attributes.push(o(t,n,a,p,w,k))}return h===t.TRIANGULAR_MESH&&(y.index=r(t,n,a)),t.destroy(a),y}function r(t,n,c){const d=c.num_faces()*3,l=d*4,a=t._malloc(l);n.GetTrianglesUInt32Array(c,l,a);const f=new Uint32Array(t.HEAPF32.buffer,a,d).slice();return t._free(a),{array:f,itemSize:1}}function o(t,n,c,u,d,l){const a=l.num_components(),h=c.num_points()*a,y=h*d.BYTES_PER_ELEMENT,p=i(t,d),w=t._malloc(y);n.GetAttributeDataArrayForAllPoints(c,l,p,y,w);const k=new d(t.HEAPF32.buffer,w,h).slice();return t._free(w),{name:u,array:k,itemSize:a}}function i(t,n){switch(n){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}}class N extends I{constructor(){super();const e=new x;e.deleteAttribute("uv");const s=new P({side:R}),r=new P,o=new M(16777215,5,28,2);o.position.set(.418,16.199,.3),this.add(o);const i=new m(e,s);i.position.set(-.757,13.219,.717),i.scale.set(31.713,28.305,28.591),this.add(i);const t=new m(e,r);t.position.set(-10.906,2.009,1.846),t.rotation.set(0,-.195,0),t.scale.set(2.328,7.905,4.651),this.add(t);const n=new m(e,r);n.position.set(-5.607,-.754,-.758),n.rotation.set(0,.994,0),n.scale.set(1.97,1.534,3.955),this.add(n);const c=new m(e,r);c.position.set(6.167,.857,7.803),c.rotation.set(0,.561,0),c.scale.set(3.927,6.285,3.687),this.add(c);const u=new m(e,r);u.position.set(-2.017,.018,6.124),u.rotation.set(0,.333,0),u.scale.set(2.002,4.566,2.064),this.add(u);const d=new m(e,r);d.position.set(2.291,-.756,-2.621),d.rotation.set(0,-.286,0),d.scale.set(1.546,1.552,1.496),this.add(d);const l=new m(e,r);l.position.set(-2.193,-.369,-5.547),l.rotation.set(0,.516,0),l.scale.set(3.875,3.487,2.986),this.add(l);const a=new m(e,b(50));a.position.set(-16.116,14.37,8.208),a.scale.set(.1,2.428,2.739),this.add(a);const f=new m(e,b(50));f.position.set(-16.109,18.021,-8.207),f.scale.set(.1,2.425,2.751),this.add(f);const h=new m(e,b(17));h.position.set(14.904,12.198,-1.832),h.scale.set(.15,4.265,6.331),this.add(h);const y=new m(e,b(43));y.position.set(-.462,8.89,14.52),y.scale.set(4.38,5.441,.088),this.add(y);const p=new m(e,b(20));p.position.set(3.235,11.486,-12.541),p.scale.set(2.5,2,.1),this.add(p);const w=new m(e,b(100));w.position.set(0,20,0),w.scale.set(1,.1,1),this.add(w)}dispose(){const e=new Set;this.traverse(s=>{s.isMesh&&(e.add(s.geometry),e.add(s.material))});for(const s of e)s.dispose()}}function b(g){const e=new E;return e.color.setScalar(g),e}export{O as D,N as R};
