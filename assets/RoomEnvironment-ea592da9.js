import{G as x,J as T,ax as C,ay as R,K as S,az as P,g as I,S as U,B as M,q as D,ai as E,Z as O,a as p,M as G}from"./three.module-2fef69e5.js";const L=new WeakMap;class F extends x{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,r,o,s){const n=new T(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,t=>{this.parse(t,r,s)},o,s)}parse(e,r,o){this.decodeDracoFile(e,r,null,null,C).catch(o)}decodeDracoFile(e,r,o,s,n=R){const t={attributeIDs:o||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!o,vertexColorSpace:n};return this.decodeGeometry(e,t).then(r)}decodeGeometry(e,r){const o=JSON.stringify(r);if(L.has(e)){const a=L.get(e);if(a.key===o)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const n=this.workerNextTaskID++,t=e.byteLength,i=this._getWorker(n,t).then(a=>(s=a,new Promise((u,d)=>{s._callbacks[n]={resolve:u,reject:d},s.postMessage({type:"decode",id:n,taskConfig:r,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return i.catch(()=>!0).then(()=>{s&&n&&this._releaseTask(s,n)}),L.set(e,{key:o,promise:i}),i}_createGeometry(e){const r=new S;e.index&&r.setIndex(new P(e.index.array,1));for(let o=0;o<e.attributes.length;o++){const s=e.attributes[o],n=s.name,t=s.array,i=s.itemSize,a=new P(t,i);n==="color"&&this._assignVertexColorSpace(a,s.vertexColorSpace),r.setAttribute(n,a)}return r}_assignVertexColorSpace(e,r){if(r!==C)return;const o=new I;for(let s=0,n=e.count;s<n;s++)o.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,o.r,o.g,o.b)}_loadLibrary(e,r){const o=new T(this.manager);return o.setPath(this.decoderPath),o.setResponseType(r),o.setWithCredentials(this.withCredentials),new Promise((s,n)=>{o.load(e,s,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",r=[];return e?r.push(this._loadLibrary("draco_decoder.js","text")):(r.push(this._loadLibrary("draco_wasm_wrapper.js","text")),r.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then(o=>{const s=o[0];e||(this.decoderConfig.wasmBinary=o[1]);const n=B.toString(),t=["/* draco decoder */",s,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([t]))}),this.decoderPending}_getWorker(e,r){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(n){const t=n.data;switch(t.type){case"decode":s._callbacks[t.id].resolve(t);break;case"error":s._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,n){return s._taskLoad>n._taskLoad?-1:1});const o=this.workerPool[this.workerPool.length-1];return o._taskCosts[e]=r,o._taskLoad+=r,o})}_releaseTask(e,r){e._taskLoad-=e._taskCosts[r],delete e._callbacks[r],delete e._taskCosts[r]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function B(){let g,e;onmessage=function(t){const i=t.data;switch(i.type){case"init":g=i.decoderConfig,e=new Promise(function(d){g.onModuleLoaded=function(h){d({draco:h})},DracoDecoderModule(g)});break;case"decode":const a=i.buffer,u=i.taskConfig;e.then(d=>{const h=d.draco,c=new h.Decoder;try{const l=r(h,c,new Int8Array(a),u),f=l.attributes.map(y=>y.array.buffer);l.index&&f.push(l.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:l},f)}catch(l){console.error(l),self.postMessage({type:"error",id:i.id,error:l.message})}finally{h.destroy(c)}});break}};function r(t,i,a,u){const d=u.attributeIDs,h=u.attributeTypes;let c,l;const f=i.GetEncodedGeometryType(a);if(f===t.TRIANGULAR_MESH)c=new t.Mesh,l=i.DecodeArrayToMesh(a,a.byteLength,c);else if(f===t.POINT_CLOUD)c=new t.PointCloud,l=i.DecodeArrayToPointCloud(a,a.byteLength,c);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!l.ok()||c.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const y={index:null,attributes:[]};for(const w in d){const m=self[h[w]];let k,_;if(u.useUniqueIDs)_=d[w],k=i.GetAttributeByUniqueId(c,_);else{if(_=i.GetAttributeId(c,t[d[w]]),_===-1)continue;k=i.GetAttribute(c,_)}const A=s(t,i,c,w,m,k);w==="color"&&(A.vertexColorSpace=u.vertexColorSpace),y.attributes.push(A)}return f===t.TRIANGULAR_MESH&&(y.index=o(t,i,c)),t.destroy(c),y}function o(t,i,a){const d=a.num_faces()*3,h=d*4,c=t._malloc(h);i.GetTrianglesUInt32Array(a,h,c);const l=new Uint32Array(t.HEAPF32.buffer,c,d).slice();return t._free(c),{array:l,itemSize:1}}function s(t,i,a,u,d,h){const c=h.num_components(),f=a.num_points()*c,y=f*d.BYTES_PER_ELEMENT,w=n(t,d),m=t._malloc(y);i.GetAttributeDataArrayForAllPoints(a,h,w,y,m);const k=new d(t.HEAPF32.buffer,m,f).slice();return t._free(m),{name:u,array:k,itemSize:c}}function n(t,i){switch(i){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}}class v extends U{constructor(){super();const e=new M;e.deleteAttribute("uv");const r=new D({side:E}),o=new D,s=new O(16777215,5,28,2);s.position.set(.418,16.199,.3),this.add(s);const n=new p(e,r);n.position.set(-.757,13.219,.717),n.scale.set(31.713,28.305,28.591),this.add(n);const t=new p(e,o);t.position.set(-10.906,2.009,1.846),t.rotation.set(0,-.195,0),t.scale.set(2.328,7.905,4.651),this.add(t);const i=new p(e,o);i.position.set(-5.607,-.754,-.758),i.rotation.set(0,.994,0),i.scale.set(1.97,1.534,3.955),this.add(i);const a=new p(e,o);a.position.set(6.167,.857,7.803),a.rotation.set(0,.561,0),a.scale.set(3.927,6.285,3.687),this.add(a);const u=new p(e,o);u.position.set(-2.017,.018,6.124),u.rotation.set(0,.333,0),u.scale.set(2.002,4.566,2.064),this.add(u);const d=new p(e,o);d.position.set(2.291,-.756,-2.621),d.rotation.set(0,-.286,0),d.scale.set(1.546,1.552,1.496),this.add(d);const h=new p(e,o);h.position.set(-2.193,-.369,-5.547),h.rotation.set(0,.516,0),h.scale.set(3.875,3.487,2.986),this.add(h);const c=new p(e,b(50));c.position.set(-16.116,14.37,8.208),c.scale.set(.1,2.428,2.739),this.add(c);const l=new p(e,b(50));l.position.set(-16.109,18.021,-8.207),l.scale.set(.1,2.425,2.751),this.add(l);const f=new p(e,b(17));f.position.set(14.904,12.198,-1.832),f.scale.set(.15,4.265,6.331),this.add(f);const y=new p(e,b(43));y.position.set(-.462,8.89,14.52),y.scale.set(4.38,5.441,.088),this.add(y);const w=new p(e,b(20));w.position.set(3.235,11.486,-12.541),w.scale.set(2.5,2,.1),this.add(w);const m=new p(e,b(100));m.position.set(0,20,0),m.scale.set(1,.1,1),this.add(m)}dispose(){const e=new Set;this.traverse(r=>{r.isMesh&&(e.add(r.geometry),e.add(r.material))});for(const r of e)r.dispose()}}function b(g){const e=new G;return e.color.setScalar(g),e}export{F as D,v as R};
